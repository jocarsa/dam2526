:root { --nodo-w: 180px; --nodo-h: 120px; --port: 16px; }

body{
  display:grid;grid-template-columns:260px 1fr 340px;grid-template-rows:auto 1fr;gap:10px;
  min-height:100vh;padding:10px;box-sizing:border-box;background:linear-gradient(135deg,#f7f8fb,#eef1f7);color:#1e2a3a;
}
header{
  grid-column:1/-1;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid #e7e9f3;
  border-radius:10px;padding:10px 12px;box-shadow:0 6px 24px rgba(0,0,0,.06);
}
#tools,#console{
  background:#fff;border:1px solid #e7e9f3;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.07);
  padding:10px;display:flex;flex-direction:column;gap:10px;min-height:0;
}
#tools h3,#console h3{margin:0 0 6px 0;font:600 14px/1.2 system-ui;color:#31415a}
#console pre{
  flex:1;background:#0f172a;color:#e5e7eb;border-radius:8px;padding:10px;overflow:auto;margin:0;
  font:12px/1.4 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
}
.tool-card{border:1px solid #e1e6f3;border-radius:10px;padding:8px;background:linear-gradient(180deg,#fff,#fafbff);box-shadow:0 2px 10px rgba(62,96,181,.12);}
.tool-card .btn-add{margin-top:8px;display:inline-block;padding:6px 10px;border-radius:8px;border:1px solid #b7c2e6;cursor:pointer;background:#fff;}
.tool-desc{font-size:12px;color:#5b6b85;margin-top:2px}
.muted{opacity:.7}

#centro{
  position:relative; overflow:hidden; border-radius:14px;
  box-shadow:0 10px 40px rgba(0,0,0,0.18); background:#f6f6f9;
  user-select:none; touch-action:none; border:1px solid #e5e7f0; min-height:70vh;
}
#mundo{
  position:absolute; left:0; top:0; width:4000px; height:3000px;
  background-image: radial-gradient(circle at 1px 1px, rgba(0,0,0,0.06) 1px, transparent 1px);
  background-size: 40px 40px;
  transform-origin: 0 0;
}
#edges{ position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; }

article{
  position:absolute; left:0; top:0; width:var(--nodo-w); height:var(--nodo-h);
  border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(250,251,255,.7));
  border:1px solid #dfe4ef; box-shadow: 0 12px 30px rgba(30,60,120,0.18), inset 0 1px 0 rgba(255,255,255,.6);
  /* IMPORTANTE: permitimos seleccionar dentro de inputs más abajo */
  user-select:none; 
  font:600 14px/1.2 ui-sans-serif, system-ui, -apple-system, "Segoe UI"; color:#2b3a55;
}
article.dragging{ opacity:.95; }

.titlebar{
  position:absolute; left:0; top:0; right:0; height:34px; border-radius:14px 14px 10px 10px;
  background:linear-gradient(90deg,#6aa3ff,#9c7bff); box-shadow:inset 0 -1px 0 rgba(255,255,255,.35); opacity:.95;
  cursor:grab;
}
.titlebar:active{ cursor:grabbing; }
.title{
  position:absolute; top:8px; left:12px; font:600 12px/1 ui-sans-serif; color:white; text-shadow:0 1px 2px rgba(0,0,0,.25);
}
.body{
  position:absolute; inset:34px 10px 10px 16px;
  display:flex;flex-direction:column;gap:6px;align-items:stretch;justify-content:flex-start;
}

/* PUERTOS */
.port{
  position:absolute; width:var(--port); height:var(--port); border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, #cfe0ff);
  border:1px solid #9db5ff; box-shadow: 0 0 0 2px #ffffffaa, 0 6px 14px rgba(90,120,200,.35);
  display:grid; place-items:center;
}
.port::after{content:""; width:6px; height:6px; border-radius:50%; background:#4a7dff; box-shadow:0 0 10px #6aa3ff;}
.port.in  { left: calc(-.5 * var(--port)); top: 50%; transform: translateY(-50%); }
.port.out { right: calc(-.5 * var(--port)); top: 50%; transform: translateY(-50%); }
.port.highlight { border-color:#53e3a6; box-shadow:0 0 0 2px #eafff5, 0 0 24px rgba(83,227,166,.7); }
.port.block { pointer-events:none; filter:grayscale(1) opacity(.6); }

/* LÍNEAS */
.edge-path{ fill:none; stroke:#6a86ff; stroke-width:3; filter: drop-shadow(0 2px 2px rgba(0,0,0,.15)); }
.edge-path.bg{ stroke:#cdd8ff; stroke-width:7; opacity:.75; }
.edge-path.preview{ stroke-dasharray:8 8; opacity:.85; }
.edge-path.glow{ stroke:#6a86ff; stroke-width:8; filter: blur(8px); opacity:.45; }

/* Botones y ayudas */
.btn{padding:6px 10px;border-radius:8px;border:1px solid #b7c2e6;background:#fff;cursor:pointer}
#play{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border-radius:10px;border:1px solid #98a6d6;background:#eef2ff;cursor:pointer}
#play:active{transform:translateY(1px)}
#hint{
  position:absolute; right:10px; bottom:10px; background:rgba(255,255,255,.9); padding:.4rem .6rem;
  border:1px solid #dfe4ef; border-radius:8px; font:12px system-ui; box-shadow:0 8px 20px rgba(0,0,0,.08);
}

/* Formularios dentro del nodo: permitir interacción */
.body input, .body textarea, .body select, .body button {
  user-select:text;
  pointer-events:auto;
  cursor:text;
  font:12px system-ui;
  padding:6px 8px;
  border:1px solid #cfd7ea;
  border-radius:8px;
  background:#fff;
}

.status-ok{color:#16a34a}
.status-bad{color:#dc2626}

