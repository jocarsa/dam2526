# Reporte de proyecto

## Estructura del proyecto

```
/var/www/html/jocarsa-orange
├── .gitignore
├── README.md
├── app.js
├── backend.php
├── index.html
├── manifest.json
├── orange.png
├── shopping.db
└── style.css
```

## Código (intercalado)

# jocarsa-orange
**README.md**
```markdown
# jocarsa-orange
```
**app.js**
```js
document.addEventListener("DOMContentLoaded", () => {
  // --- Auth Elements ---
  const authSection = document.getElementById("auth-section");
  const loginForm = document.getElementById("login-form");
  const registerForm = document.getElementById("register-form");

  // --- Main App Elements ---
  const appSection = document.getElementById("app-section");
  const logoutBtn = document.getElementById("logout-btn");

  // --- Navigation Buttons ---
  const navList = document.getElementById("nav-list");
  const navNew = document.getElementById("nav-new");
  const navEdit = document.getElementById("nav-edit");
  const navTheme = document.getElementById("nav-theme");

  // --- Screens ---
  const listScreen = document.getElementById("list-screen");
  const productScreen = document.getElementById("product-screen");
  const newListScreen = document.getElementById("new-list-screen");
  const editListScreen = document.getElementById("edit-list-screen");
  const themeScreen = document.getElementById("theme-screen");

  // "Mis Listas" screen
  const listContainer = document.getElementById("list-container");

  // "Productos" screen
  const productListInfo = document.getElementById("product-list-info");
  const productsContainer = document.getElementById("products-container");
  const newProductForm = document.getElementById("new-product-form");
  const productNameInput = document.getElementById("product-name");

  // "Nueva Lista" screen
  const newListForm = document.getElementById("new-list-form");
  const newListName = document.getElementById("new-list-name");
  const newListDescription = document.getElementById("new-list-description");
  const newListColor = document.getElementById("new-list-color");
  const newListDate = document.getElementById("new-list-date");

  // "Editar Lista" screen
  const editListsContainer = document.getElementById("edit-lists-container");
  const editFormContainer = document.getElementById("edit-form-container");
  const editListForm = document.getElementById("edit-list-form");
  const editListId = document.getElementById("edit-list-id");
  const editListName = document.getElementById("edit-list-name");
  const editListDescription = document.getElementById("edit-list-description");
  const editListColor = document.getElementById("edit-list-color");
  const editListDate = document.getElementById("edit-list-date");
  const deleteListBtn = document.getElementById("delete-list-btn");

  // Global state
  let currentUser = JSON.parse(localStorage.getItem("user")) || null;
  let currentList = null;

  // Helper to switch screens
  function showScreen(screenName) {
    listScreen.style.display = "none";
    productScreen.style.display = "none";
    newListScreen.style.display = "none";
    editListScreen.style.display = "none";

    switch (screenName) {
      case "list":
        listScreen.style.display = "block";
        break;
      case "product":
        productScreen.style.display = "block";
        break;
      case "new":
        newListScreen.style.display = "block";
        break;
      case "edit":
        editListScreen.style.display = "block";
        break;
    }
  }

  // Set today's date for date inputs
  function setDefaultDate(input) {
    const today = new Date().toISOString().split("T")[0];
    input.value = today;
  }
  setDefaultDate(newListDate);

  // If already logged in, apply saved theme
  if (currentUser) {
    authSection.style.display = "none";
    appSection.style.display = "block";
    if (currentUser.theme) {
      appSection.style.filter = `hue-rotate(${currentUser.theme}deg)`;
    }
    showScreen("list");
    loadLists();
  } else {
    authSection.style.display = "block";
    appSection.style.display = "none";
  }

  // --- Auth: Login ---
  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value.trim();

    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "login", username, password }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          currentUser = { 
            id: data.user.id, 
            username: data.user.username,
            theme: data.user.theme
          };
          localStorage.setItem("user", JSON.stringify(currentUser));
          authSection.style.display = "none";
          appSection.style.display = "block";
          if (currentUser.theme) {
            appSection.style.filter = `hue-rotate(${currentUser.theme}deg)`;
          }
          showScreen("list");
          loadLists();
        } else {
          alert(data.message);
        }
      });
  });

  // --- Auth: Register ---
  registerForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const username = document.getElementById("register-username").value.trim();
    const password = document.getElementById("register-password").value.trim();

    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "register", username, password }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          alert("Registro exitoso. Ahora inicia sesión.");
        } else {
          alert(data.message);
        }
      });
  });

  // --- Logout ---
  logoutBtn.addEventListener("click", () => {
    localStorage.removeItem("user");
    currentUser = null;
    location.reload();
  });

  // --- Navigation ---
  navList.addEventListener("click", () => {
    showScreen("list");
    loadLists();
  });
  navNew.addEventListener("click", () => {
    showScreen("new");
    newListForm.reset();
    setDefaultDate(newListDate);
  });
  navEdit.addEventListener("click", () => {
    showScreen("edit");
    editListsContainer.innerHTML = "";
    editFormContainer.style.display = "none";
    loadListsForEditing();
  });

  // --- Theming Screen ---
  navTheme.addEventListener("click", () => {
    themeScreen.style.display = themeScreen.style.display === "none" ? "block" : "none";
  });
  document.querySelectorAll(".theme-option").forEach(option => {
    option.addEventListener("click", () => {
      const hue = option.getAttribute("data-hue");
      appSection.style.filter = `hue-rotate(${hue}deg)`;
      themeScreen.style.display = "none";
      updateTheme(hue);
    });
  });

  // Update theme setting for current user
  function updateTheme(themeValue) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "update_theme",
        user_id: currentUser.id,
        theme: themeValue
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          currentUser.theme = themeValue;
          localStorage.setItem("user", JSON.stringify(currentUser));
        } else {
          alert(data.message);
        }
      });
  }

  // -----------------------------------------------------------
  //  "Mis Listas" Screen
  // -----------------------------------------------------------
  function loadLists() {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "get_lists", user_id: currentUser.id }),
    })
      .then((res) => res.json())
      .then((data) => {
        listContainer.innerHTML = "";
        if (data.success) {
          data.lists.forEach((list) => {
            // Create a container for list item
            const div = document.createElement("div");
            div.className = "list-item";
            // Apply list background color
            div.style.backgroundColor = list.color ? list.color : "#ffffff";

            // Create an inner container for list info and count
            const infoDiv = document.createElement("div");
            infoDiv.className = "list-info";
            // List name and date
            const textSpan = document.createElement("span");
            textSpan.textContent = `${list.name} (${list.date})`;
            // Product count badge
            const countSpan = document.createElement("span");
            countSpan.textContent = list.product_count ? list.product_count : "0";
            countSpan.className = "list-count";

            infoDiv.appendChild(textSpan);
            infoDiv.appendChild(countSpan);

            // Completion switch for list
            const compLabel = document.createElement("label");
            compLabel.className = "list-switch";
            const compInput = document.createElement("input");
            compInput.type = "checkbox";
            compInput.checked = list.completed == 1;
            compInput.addEventListener("click", (e) => {
              // Prevent click from triggering the list selection event
              e.stopPropagation();
            });
            compInput.addEventListener("change", () => {
              updateListCompletion(list.id, compInput.checked ? 1 : 0);
              // Reload lists after a short delay to update ordering
              setTimeout(loadLists, 300);
            });
            const compSlider = document.createElement("span");
            compSlider.className = "slider";
            compLabel.appendChild(compInput);
            compLabel.appendChild(compSlider);

            // Assemble list item: clicking infoDiv opens the list
            infoDiv.addEventListener("click", () => {
              currentList = list;
              showScreen("product");
              displayListInfo(currentList);
              loadProducts(currentList.id);
            });
            div.appendChild(infoDiv);
            div.appendChild(compLabel);

            listContainer.appendChild(div);
          });
        } else {
          alert(data.message);
        }
      });
  }

  // Display list info above products
  function displayListInfo(list) {
    productListInfo.innerHTML = `
      <h3>${list.name}</h3>
      <p>${list.description || ""}</p>
      <small>Fecha: ${list.date}</small>
    `;
  }

  // -----------------------------------------------------------
  //  "Productos" Screen
  // -----------------------------------------------------------
  function loadProducts(list_id) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "get_products", list_id }),
    })
      .then((res) => res.json())
      .then((data) => {
        productsContainer.innerHTML = "";
        if (data.success) {
          // Sort: not bought (switch=0) first, then done (switch=1)
          data.products.sort((a, b) => a.switch - b.switch);
          data.products.forEach((product) => {
            const div = document.createElement("div");
            div.className = "product-item";
            // Use provided product color (default to white)
            const prodColor = product.color && product.color.trim() !== "" ? product.color : "#ffffff";
            div.style.backgroundColor = prodColor;
            
            // Add a small color-picker at top left for changing product color
            const prodColorPicker = document.createElement("input");
            prodColorPicker.type = "color";
            prodColorPicker.value = prodColor;
            prodColorPicker.style.width = "20px";
            prodColorPicker.style.height = "20px";
            prodColorPicker.style.border = "none";
            prodColorPicker.style.marginRight = "5px";
            prodColorPicker.addEventListener("change", () => {
              const newColor = prodColorPicker.value;
              // Immediately update this product's background color
              div.style.backgroundColor = newColor;
              updateProductColor(product.id, newColor);
            });
            div.insertBefore(prodColorPicker, div.firstChild);
            
            // Product Name
            const nameSpan = document.createElement("span");
            nameSpan.textContent = product.name;
            
            // Switch (toggle) for product completion
            const switchLabel = document.createElement("label");
            switchLabel.className = "switch";
            const switchInput = document.createElement("input");
            switchInput.type = "checkbox";
            switchInput.checked = product.switch == 1;
            switchInput.addEventListener("change", () => {
              updateProductSwitch(product.id, switchInput.checked ? 1 : 0);
              setTimeout(() => loadProducts(currentList.id), 300);
            });
            const sliderSpan = document.createElement("span");
            sliderSpan.className = "slider";
            switchLabel.appendChild(switchInput);
            switchLabel.appendChild(sliderSpan);
            
            // Actions (edit/delete)
            const actionsDiv = document.createElement("div");
            actionsDiv.className = "product-actions";
            const editBtn = document.createElement("button");
            editBtn.className = "edit-btn";
            editBtn.textContent = "E";
            editBtn.addEventListener("click", () => {
              const newName = prompt("Nuevo nombre del producto:", product.name);
              if (newName && newName.trim() !== "") {
                updateProductName(product.id, newName.trim());
              }
            });
            const deleteBtn = document.createElement("button");
            deleteBtn.className = "delete-btn";
            deleteBtn.textContent = "X";
            deleteBtn.addEventListener("click", () => {
              if (confirm("¿Eliminar este producto?")) {
                deleteProduct(product.id);
              }
            });
            actionsDiv.appendChild(editBtn);
            actionsDiv.appendChild(deleteBtn);
            
            // Assemble product div
            div.appendChild(nameSpan);
            div.appendChild(switchLabel);
            div.appendChild(actionsDiv);
            
            productsContainer.appendChild(div);
          });
        } else {
          alert(data.message);
        }
      });
  }

  // New product form submission
  newProductForm.addEventListener("submit", (e) => {
    e.preventDefault();
    if (!currentList) {
      alert("No hay lista seleccionada.");
      return;
    }
    const name = productNameInput.value.trim();
    const colorInput = document.getElementById("product-color");
    const color = colorInput.value; // default is white (#ffffff)
    if (!name) {
      alert("Nombre de producto requerido.");
      return;
    }
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "add_product",
        list_id: currentList.id,
        name,
        color
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          newProductForm.reset();
          loadProducts(currentList.id);
        } else {
          alert(data.message);
        }
      });
  });

  // Update product switch
  function updateProductSwitch(product_id, switchVal) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "toggle_product",
        product_id,
        switch: switchVal,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (!data.success) {
          alert(data.message);
        }
      });
  }

  // Update product name
  function updateProductName(product_id, newName) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "update_product",
        product_id,
        name: newName,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          loadProducts(currentList.id);
        } else {
          alert(data.message);
        }
      });
  }

  // Update product color (new action)
  function updateProductColor(product_id, newColor) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "update_product_color",
        product_id,
        color: newColor,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (!data.success) {
          alert(data.message);
        }
      });
  }

  // Delete product
  function deleteProduct(product_id) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "delete_product", product_id }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          loadProducts(currentList.id);
        } else {
          alert(data.message);
        }
      });
  }

  // -----------------------------------------------------------
  //  "Nueva Lista" Screen
  // -----------------------------------------------------------
  newListForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const name = newListName.value.trim();
    const description = newListDescription.value.trim();
    const color = newListColor.value; // list color (default white)
    const date = newListDate.value;
    if (!name || !date) {
      alert("Nombre y fecha son requeridos.");
      return;
    }
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "create_list",
        user_id: currentUser.id,
        name,
        description,
        color,
        date,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          alert("Lista creada correctamente.");
          newListForm.reset();
          setDefaultDate(newListDate);
          showScreen("list");
          loadLists();
        } else {
          alert(data.message);
        }
      });
  });

  // -----------------------------------------------------------
  //  "Editar Lista" Screen
  // -----------------------------------------------------------
  function loadListsForEditing() {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "get_lists", user_id: currentUser.id }),
    })
      .then((res) => res.json())
      .then((data) => {
        editListsContainer.innerHTML = "";
        if (data.success) {
          data.lists.forEach((list) => {
            const div = document.createElement("div");
            div.className = "list-item";
            div.textContent = `${list.name} (${list.date})`;
            div.addEventListener("click", () => {
              currentList = list;
              editFormContainer.style.display = "block";
              editListId.value = list.id;
              editListName.value = list.name;
              editListDescription.value = list.description;
              editListColor.value = list.color && list.color.trim() !== "" ? list.color : "#ffffff";
              editListDate.value = list.date;
            });
            editListsContainer.appendChild(div);
          });
        } else {
          alert(data.message);
        }
      });
  }

  // Submit Edit List form
  editListForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const list_id = editListId.value;
    const name = editListName.value.trim();
    const description = editListDescription.value.trim();
    const color = editListColor.value; // list color from edit form
    const date = editListDate.value;
    if (!name || !date) {
      alert("Nombre y fecha son requeridos.");
      return;
    }
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "update_list",
        list_id,
        name,
        description,
        color,
        date,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          alert("Lista actualizada correctamente.");
          loadListsForEditing();
        } else {
          alert(data.message);
        }
      });
  });

  // Delete List button
  deleteListBtn.addEventListener("click", () => {
    if (!currentList) {
      alert("No hay lista seleccionada para eliminar.");
      return;
    }
    if (confirm("¿Estás seguro de eliminar esta lista? (Se eliminarán todos sus productos)")) {
      fetch("backend.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "delete_list", list_id: currentList.id }),
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            alert("Lista eliminada correctamente.");
            currentList = null;
            editFormContainer.style.display = "none";
            loadListsForEditing();
          } else {
            alert(data.message);
          }
        });
    }
  });

  // Update list completion status
  function updateListCompletion(list_id, completed) {
    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "toggle_list",
        list_id,
        completed
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (!data.success) {
          alert(data.message);
        }
      });
  }
});


```
**backend.php**
```php
<?php
header("Content-Type: application/json");

// Decodificar la entrada JSON
$input = json_decode(file_get_contents("php://input"), true);
if (!$input || !isset($input['action'])) {
    echo json_encode(["success" => false, "message" => "Acción no especificada."]);
    exit;
}

$action = $input['action'];

// Abrir o crear la base de datos SQLite
$db = new SQLite3('../databases/orange.db');

// Crear las tablas si no existen

// Users: added 'theme' column (default 0)
$db->exec("CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE,
    password TEXT,
    theme INTEGER DEFAULT 0
)");

// Lists: added 'color' and 'completed' columns (color default white, completed default 0)
$db->exec("CREATE TABLE IF NOT EXISTS lists (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    name TEXT,
    description TEXT,
    date TEXT,
    color TEXT,
    completed INTEGER DEFAULT 0
)");

// Products: added 'color' column (default white)
$db->exec("CREATE TABLE IF NOT EXISTS products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    list_id INTEGER,
    name TEXT,
    switch INTEGER DEFAULT 0,
    color TEXT
)");

// Función para hashear contraseñas
function hashPassword($password) {
    return password_hash($password, PASSWORD_DEFAULT);
}

// Manejo de acciones
switch($action) {

    case "register":
        $username = trim($input['username']);
        $password = trim($input['password']);
        if (empty($username) || empty($password)) {
            echo json_encode(["success" => false, "message" => "Usuario y contraseña requeridos."]);
            exit;
        }
        $hashedPassword = hashPassword($password);
        $stmt = $db->prepare("INSERT INTO users (username, password) VALUES (:username, :password)");
        $stmt->bindValue(':username', $username, SQLITE3_TEXT);
        $stmt->bindValue(':password', $hashedPassword, SQLITE3_TEXT);
        $result = @$stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Usuario registrado correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al registrar el usuario (posiblemente ya existe)."]);
        }
        break;

    case "login":
        $username = trim($input['username']);
        $password = trim($input['password']);
        if (empty($username) || empty($password)) {
            echo json_encode(["success" => false, "message" => "Usuario y contraseña requeridos."]);
            exit;
        }
        $stmt = $db->prepare("SELECT * FROM users WHERE username = :username");
        $stmt->bindValue(':username', $username, SQLITE3_TEXT);
        $result = $stmt->execute();
        $user = $result->fetchArray(SQLITE3_ASSOC);
        if ($user && password_verify($password, $user['password'])) {
            echo json_encode(["success" => true, "user" => [
                "id" => $user['id'], 
                "username" => $user['username'],
                "theme" => $user['theme']
            ]]);
        } else {
            echo json_encode(["success" => false, "message" => "Credenciales incorrectas."]);
        }
        break;

    case "update_theme":
        $user_id = intval($input['user_id']);
        $theme = intval($input['theme']);
        $stmt = $db->prepare("UPDATE users SET theme = :theme WHERE id = :user_id");
        $stmt->bindValue(':theme', $theme, SQLITE3_INTEGER);
        $stmt->bindValue(':user_id', $user_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Tema actualizado correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al actualizar el tema."]);
        }
        break;

    case "create_list":
        $user_id = intval($input['user_id']);
        $name = trim($input['name']);
        $description = trim($input['description']);
        $date = trim($input['date']);
        $color = isset($input['color']) && trim($input['color']) !== "" ? trim($input['color']) : "#ffffff";
        if (empty($name) || empty($date)) {
            echo json_encode(["success" => false, "message" => "Nombre y fecha son requeridos."]);
            exit;
        }
        $stmt = $db->prepare("INSERT INTO lists (user_id, name, description, date, color) VALUES (:user_id, :name, :description, :date, :color)");
        $stmt->bindValue(':user_id', $user_id, SQLITE3_INTEGER);
        $stmt->bindValue(':name', $name, SQLITE3_TEXT);
        $stmt->bindValue(':description', $description, SQLITE3_TEXT);
        $stmt->bindValue(':date', $date, SQLITE3_TEXT);
        $stmt->bindValue(':color', $color, SQLITE3_TEXT);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Lista creada correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al crear la lista."]);
        }
        break;

    case "get_lists":
        $user_id = intval($input['user_id']);
        // Select lists along with a count of products in each list.
        $stmt = $db->prepare("SELECT l.*, (SELECT COUNT(*) FROM products WHERE list_id = l.id) as product_count 
                              FROM lists l 
                              WHERE user_id = :user_id 
                              ORDER BY completed ASC, date DESC");
        $stmt->bindValue(':user_id', $user_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        $lists = [];
        while ($row = $result->fetchArray(SQLITE3_ASSOC)) {
            $lists[] = $row;
        }
        echo json_encode(["success" => true, "lists" => $lists]);
        break;

    case "update_list":
        $list_id = intval($input['list_id']);
        $name = trim($input['name']);
        $description = trim($input['description']);
        $date = trim($input['date']);
        $color = isset($input['color']) && trim($input['color']) !== "" ? trim($input['color']) : "#ffffff";
        if (empty($name) || empty($date)) {
            echo json_encode(["success" => false, "message" => "Nombre y fecha son requeridos."]);
            exit;
        }
        $stmt = $db->prepare("UPDATE lists SET name = :name, description = :description, date = :date, color = :color WHERE id = :list_id");
        $stmt->bindValue(':name', $name, SQLITE3_TEXT);
        $stmt->bindValue(':description', $description, SQLITE3_TEXT);
        $stmt->bindValue(':date', $date, SQLITE3_TEXT);
        $stmt->bindValue(':color', $color, SQLITE3_TEXT);
        $stmt->bindValue(':list_id', $list_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Lista actualizada correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al actualizar la lista."]);
        }
        break;

    case "delete_list":
        $list_id = intval($input['list_id']);
        $db->exec("DELETE FROM products WHERE list_id = $list_id");
        $stmt = $db->prepare("DELETE FROM lists WHERE id = :list_id");
        $stmt->bindValue(':list_id', $list_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Lista eliminada correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al eliminar la lista."]);
        }
        break;

    case "toggle_list":
        $list_id = intval($input['list_id']);
        $completed = intval($input['completed']);
        $stmt = $db->prepare("UPDATE lists SET completed = :completed WHERE id = :list_id");
        $stmt->bindValue(':completed', $completed, SQLITE3_INTEGER);
        $stmt->bindValue(':list_id', $list_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Estado de lista actualizado."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al actualizar el estado de la lista."]);
        }
        break;

    case "add_product":
        $list_id = intval($input['list_id']);
        $name = trim($input['name']);
        $color = isset($input['color']) && trim($input['color']) !== "" ? trim($input['color']) : "#ffffff";
        if (empty($name)) {
            echo json_encode(["success" => false, "message" => "Nombre del producto requerido."]);
            exit;
        }
        $stmt = $db->prepare("INSERT INTO products (list_id, name, color) VALUES (:list_id, :name, :color)");
        $stmt->bindValue(':list_id', $list_id, SQLITE3_INTEGER);
        $stmt->bindValue(':name', $name, SQLITE3_TEXT);
        $stmt->bindValue(':color', $color, SQLITE3_TEXT);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Producto añadido correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al añadir el producto."]);
        }
        break;

    case "get_products":
        $list_id = intval($input['list_id']);
        $stmt = $db->prepare("SELECT * FROM products WHERE list_id = :list_id");
        $stmt->bindValue(':list_id', $list_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        $products = [];
        while ($row = $result->fetchArray(SQLITE3_ASSOC)) {
            $products[] = $row;
        }
        echo json_encode(["success" => true, "products" => $products]);
        break;

    case "toggle_product":
        $product_id = intval($input['product_id']);
        $switchVal = intval($input['switch']);
        $stmt = $db->prepare("UPDATE products SET switch = :switch WHERE id = :product_id");
        $stmt->bindValue(':switch', $switchVal, SQLITE3_INTEGER);
        $stmt->bindValue(':product_id', $product_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Producto actualizado."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al actualizar el producto."]);
        }
        break;
        
    case "update_product":
        $product_id = intval($input['product_id']);
        $name = trim($input['name']);
        if(empty($name)){
            echo json_encode(["success" => false, "message" => "Nombre del producto requerido."]);
            exit;
        }
        $stmt = $db->prepare("UPDATE products SET name = :name WHERE id = :product_id");
        $stmt->bindValue(':name', $name, SQLITE3_TEXT);
        $stmt->bindValue(':product_id', $product_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Producto actualizado correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al actualizar el producto."]);
        }
        break;
        
    case "update_product_color":
        $product_id = intval($input['product_id']);
        $color = trim($input['color']);
        $stmt = $db->prepare("UPDATE products SET color = :color WHERE id = :product_id");
        $stmt->bindValue(':color', $color, SQLITE3_TEXT);
        $stmt->bindValue(':product_id', $product_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Color de producto actualizado correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al actualizar el color del producto."]);
        }
        break;
        
    case "delete_product":
        $product_id = intval($input['product_id']);
        $stmt = $db->prepare("DELETE FROM products WHERE id = :product_id");
        $stmt->bindValue(':product_id', $product_id, SQLITE3_INTEGER);
        $result = $stmt->execute();
        if ($result) {
            echo json_encode(["success" => true, "message" => "Producto eliminado correctamente."]);
        } else {
            echo json_encode(["success" => false, "message" => "Error al eliminar el producto."]);
        }
        break;

    default:
        echo json_encode(["success" => false, "message" => "Acción no reconocida."]);
        break;
}
?>


```
**index.html**
```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>jocarsa | orange</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/svg+xml" href="orange.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="orange.png" />

  <!-- Add to Home Screen manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
  <!-- Sección de autenticación -->
  <div id="auth-section">
    <div class="auth-container">
      <img src="orange.png" alt="Logo" />
      <h1>jocarsa | orange</h1>
      <h2>Iniciar Sesión</h2>
      <form id="login-form">
        <input type="text" id="login-username" placeholder="Usuario" required />
        <input type="password" id="login-password" placeholder="Contraseña" required />
        <button type="submit">Iniciar Sesión</button>
      </form>

      <h2>Registrarse</h2>
      <form id="register-form">
        <input type="text" id="register-username" placeholder="Usuario" required />
        <input type="password" id="register-password" placeholder="Contraseña" required />
        <button type="submit">Registrarse</button>
      </form>
    </div>
  </div>

  <!-- Sección principal de la aplicación -->
  <div id="app-section" style="display: none;">
    <header id="app-header">
      <div class="header-left">
        <img src="orange.png" alt="Logo" id="app-logo" />
        <h1>jocarsa | orange</h1>
      </div>
      <button id="logout-btn">Cerrar Sesión</button>
    </header>

    <nav id="nav-menu">
      <button id="nav-list">Mis Listas</button>
      <button id="nav-new">Nueva Lista</button>
      <button id="nav-edit">Editar Lista</button>
      <button id="nav-theme">Temas</button>
    </nav>

    <!-- Pantalla: Lista de Listas (Mis Listas) -->
    <section id="list-screen">
      <h2>Mis Listas</h2>
      <div id="list-container">
        <!-- Se cargarán las listas aquí -->
      </div>
    </section>

    <!-- Pantalla: Productos de la Lista Seleccionada -->
    <section id="product-screen" style="display:none;">
      <h2>Productos de la Lista</h2>
      <!-- Información de la lista en modo lectura -->
      <div id="product-list-info" style="margin-bottom: 1em;"></div>

      <div id="products-container">
        <!-- Se cargarán los productos aquí -->
      </div>
      <form id="new-product-form">
        <div class="product-input-group">
          <input type="text" id="product-name" placeholder="Nombre del producto" required />
          <!-- Default product color is white -->
          <input type="color" id="product-color" value="#ffffff" title="Selecciona un color (opcional)" />
        </div>
        <button type="submit">Añadir Producto</button>
      </form>
    </section>

    <!-- Pantalla: Crear Nueva Lista -->
    <section id="new-list-screen" style="display: none;">
      <h2>Crear Nueva Lista</h2>
      <form id="new-list-form">
        <input type="text" id="new-list-name" placeholder="Nombre de la lista" required />
        <textarea id="new-list-description" placeholder="Descripción"></textarea>
        <!-- New list color input (default white) -->
        <input type="color" id="new-list-color" value="#ffffff" title="Color de la lista (opcional)" />
        <input type="date" id="new-list-date" required />
        <button type="submit">Crear Lista</button>
      </form>
    </section>

    <!-- Pantalla: Editar Lista (solo propiedades, NO productos) -->
    <section id="edit-list-screen" style="display: none;">
      <h2>Selecciona una Lista para Editar</h2>
      <div id="edit-lists-container">
        <!-- Se cargan las listas para editar -->
      </div>

      <div id="edit-form-container" style="display:none;">
        <h3>Editar Datos de la Lista</h3>
        <form id="edit-list-form">
          <input type="hidden" id="edit-list-id" />
          <input type="text" id="edit-list-name" placeholder="Nombre de la lista" required />
          <textarea id="edit-list-description" placeholder="Descripción"></textarea>
          <!-- List color input (default white) -->
          <input type="color" id="edit-list-color" value="#ffffff" title="Color de la lista (opcional)" />
          <input type="date" id="edit-list-date" required />
          <button type="submit">Guardar Cambios</button>
        </form>
        <button id="delete-list-btn" class="danger-btn">Eliminar Lista</button>
      </div>
    </section>
  </div>

  <!-- Theming Screen -->
  <div id="theme-screen" style="display: none;">
    <h3>Selecciona un tema</h3>
    <div id="theme-options">
      <div class="theme-option" data-hue="0" style="background: hsl(0,70%,50%);"></div>
      <div class="theme-option" data-hue="45" style="background: hsl(45,70%,50%);"></div>
      <div class="theme-option" data-hue="90" style="background: hsl(90,70%,50%);"></div>
      <div class="theme-option" data-hue="135" style="background: hsl(135,70%,50%);"></div>
      <div class="theme-option" data-hue="180" style="background: hsl(180,70%,50%);"></div>
      <div class="theme-option" data-hue="225" style="background: hsl(225,70%,50%);"></div>
      <div class="theme-option" data-hue="270" style="background: hsl(270,70%,50%);"></div>
      <div class="theme-option" data-hue="315" style="background: hsl(315,70%,50%);"></div>
    </div>
  </div>

  <script src="app.js"></script>
  <script src="https://ghostwhite.jocarsa.com/analytics.js?user=orange.jocarsa.com"></script>
</body>
</html>


```
**manifest.json**
```json
{
  "name": "jocarsa | orange",
  "short_name": "jocarsa",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#ffffff",
  "icons": [
    {
      "src": "orange.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "orange.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}


```
**style.css**
```css
/* Base y reset */
@import url('https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap');

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: Ubuntu, sans-serif;
  background: #fff;
  color: #333;
}
body, html {
  padding: 0;
  margin: 0;
}

/* Header de la App */
#app-header {
  background: #ff7f00;
  color: #fff;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-left {
  display: flex;
  align-items: center;
}
#app-logo {
  height: 40px;
  margin-right: 10px;
}
#app-header h1 {
  font-size: 24px;
}

/* Sección de Autenticación */
#auth-section {
  max-width: 100%;
  margin: 40px auto;
  padding: 20px;
  text-align: center;
  background: #fff;
}
#product-screen {
  padding: 20px;
}
.auth-container img {
  width: 50%;
  margin: auto;
}
#edit-list-screen {
  padding: 20px;
}
#list-screen {
  padding: 20px;
}
.auth-container h2 {
  text-align: center;
  color: #ff7f00;
  margin-bottom: 10px;
}
form {
  display: flex;
  flex-direction: column;
  margin: 10px 0;
}
input[type="text"],
input[type="password"],
input[type="date"],
input[type="color"],
textarea {
  padding: 10px;
  margin: 5px 0;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 16px;
  height:45px;
}
button {
  padding: 10px;
  margin: 10px 0;
  background: #ff7f00;
  color: #fff;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s ease;
}
button:hover {
  background: #e66a00;
}

/* Botón de eliminación (rojo) */
.danger-btn {
  background: #d9534f;
}
.danger-btn:hover {
  background: #c9302c;
}

/* Menú de Navegación (full width buttons) */
#nav-menu {
  display: block;
  padding: 10px;
  background: #ffe0b3;
  display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: space-between;
	align-items: stretch;
	align-content: stretch;
	gap:10px;
}
#nav-menu button {
  width: 100%;
  margin: 5px 0;
  background: #ff7f00;
}
#nav-menu button:hover {
  background: #e66a00;
}
#product-name{
	flex-basis:80%;
	flex-shrink: 0;
}
/* Sección de la App */
#app-section {
  max-width: 100%;
  margin: 0 auto;
  padding: 0;
}
.list-count{
	background:rgba(255,255,255,0.3);
	width:25px;
	height:25px;
	text-align:center;
	border-radius:25px;
	margin-right:20px;
	line-height:25px;
}
section {
  margin: 20px 0;
}
h2, h3 {
  text-align: center;
  color: #ff7f00;
}

/* Listas y Productos */
.list-item, .product-item {
  background: #fff;
  border: 1px solid #ff7f00;
  border-radius: 5px;
  padding: 10px;
  margin: 5px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  transition: all 0.3s ease;
}
.list-item:hover, .product-item:hover {
  box-shadow: 0 4px 8px rgba(255, 127, 0, 0.3);
}

/* Container for list info (to show name, count and switch) */
.list-item .list-info {
  flex: 1;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Estilos para los botones de edición y eliminación en productos */
.product-actions button {
  margin-left: 5px;
  padding: 5px 8px;
  font-size: 14px;
}
.product-actions .edit-btn {
  background: #5bc0de;
}
.product-actions .edit-btn:hover {
  background: #31b0d5;
}
.product-actions .delete-btn {
  background: #d9534f;
}
.product-actions .delete-btn:hover {
  background: #c9302c;
}

/* Custom Switch (interruptor animado) */
.switch, .list-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
  margin-left: auto;
}
.switch input, .list-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.4s;
  border-radius: 24px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}
.switch input:checked + .slider,
.list-switch input:checked + .slider {
  background-color: #ff7f00;
}
.switch input:checked + .slider:before,
.list-switch input:checked + .slider:before {
  transform: translateX(26px);
}

/* New product input group */
.product-input-group {
  display: flex;
  gap: 10px;
  align-items: center;
}

/* Theming Screen */
#theme-screen {
  position: fixed;
  top: 60px;
  right: 20px;
  background: #fff;
  border: 1px solid #ccc;
  padding: 10px;
  z-index: 1000;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
#theme-screen h3 {
  margin-bottom: 10px;
  text-align: center;
}
#theme-options {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
.theme-option {
  width: 40px;
  height: 40px;
  border-radius: 5px;
  cursor: pointer;
  border: 1px solid #ccc;
}

/* Responsive */
@media (max-width: 600px) {
  #app-section {
    padding: 0;
  }
  #app-header h1 {
    font-size: 20px;
  }
}
input[type=color]{
	width:100%;
}

```