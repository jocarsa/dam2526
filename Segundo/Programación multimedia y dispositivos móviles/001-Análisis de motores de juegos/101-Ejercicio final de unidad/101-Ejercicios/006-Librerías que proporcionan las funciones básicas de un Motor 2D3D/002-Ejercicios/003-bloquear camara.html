<!DOCTYPE html>
<html>
<head>
    <title>Isometric Box with WASD Controls</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #4CC3D9;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .header p {
            margin: 8px 0 0;
            font-size: 16px;
            opacity: 0.8;
        }
        .scene-container {
            flex: 1;
            position: relative;
        }
        #aframe-scene {
            width: 100%;
            height: 100%;
        }
        .controls {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            border-top: 2px solid #4CC3D9;
        }
        .control-group {
            text-align: center;
        }
        .control-group h3 {
            margin: 0 0 10px;
            color: #4CC3D9;
        }
        .key {
            display: inline-block;
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            border: 2px solid #4CC3D9;
            border-radius: 8px;
            margin: 5px;
            line-height: 60px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 0 #1a5f6e, 0 6px 8px rgba(0, 0, 0, 0.4);
            transition: all 0.1s;
            text-transform: uppercase;
        }
        .key.active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #1a5f6e, 0 2px 4px rgba(0, 0, 0, 0.4);
            background: linear-gradient(145deg, #4CC3D9, #2a9bb8);
        }
        .status {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 18px;
        }
        .speed {
            color: #FFC65D;
        }
        .direction {
            color: #7BC8A4;
        }
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            border-left: 4px solid #4CC3D9;
        }
        .instructions h3 {
            margin-top: 0;
            color: #4CC3D9;
        }
        .instructions p {
            margin: 8px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Isometric Box Controller</h1>
            <p>Use WASD keys to control the blue box like a car</p>
        </div>
        <div class="status">
            <div>Speed: <span class="speed" id="speed-display">0</span> m/s</div>
            <div>Direction: <span class="direction" id="direction-display">0Â°</span></div>
        </div>
        <div class="scene-container">
            <a-scene id="aframe-scene" 
                background="color: #1a2a6c"
                shadow="autoUpdate: true; type: pcfsoft">
                
                <!-- Sun (directional light) -->
                <a-entity light="type: directional; color: #FFF; intensity: 0.9; castShadow: true;" 
                          position="5 12 5" rotation="-45 30 0"></a-entity>
                
                <!-- Ambient light for overall illumination -->
                <a-entity light="type: ambient; color: #AAA; intensity: 0.3"></a-entity>
                
                <!-- Ground plane -->
                <a-plane 
                    position="0 0 0" 
                    rotation="-90 0 0" 
                    width="30" 
                    height="30" 
                    color="#2E8B57"
                    shadow="receive: true"
                    repeat="10 10"
                    src="https://cdn.aframe.io/a-painter/images/floor.jpg">
                </a-plane>
                
                <!-- Main box (car) -->
                <a-box 
                    id="car"
                    position="0 1.5 0" 
                    width="2" 
                    height="1" 
                    depth="3" 
                    color="#4CC3D9"
                    shadow="cast: true">
                    <!-- Car details -->
                    <a-box position="0 0.6 1" width="1.8" height="0.5" depth="0.5" color="#2a9bb8"></a-box>
                    <a-box position="0 0.6 -1" width="1.8" height="0.5" depth="0.5" color="#2a9bb8"></a-box>
                    <a-cylinder position="-0.8 0 -1.2" radius="0.3" height="0.2" color="#333"></a-cylinder>
                    <a-cylinder position="0.8 0 -1.2" radius="0.3" height="0.2" color="#333"></a-cylinder>
                    <a-cylinder position="-0.8 0 1.2" radius="0.3" height="0.2" color="#333"></a-cylinder>
                    <a-cylinder position="0.8 0 1.2" radius="0.3" height="0.2" color="#333"></a-cylinder>
                    
                    <!-- Camera parented to the car -->
                    <a-entity id="camera-rig" position="0 15 15" rotation="-30 45 0">
                        <a-camera></a-camera>
                    </a-entity>
                </a-box>
                
                <!-- Additional elements for visual interest -->
                <a-box 
                    position="-8 1 5" 
                    width="2" 
                    height="2" 
                    depth="2" 
                    color="#FFC65D"
                    shadow="cast: true">
                </a-box>
                
                <a-cylinder 
                    position="7 1 -6" 
                    radius="1" 
                    height="2" 
                    color="#F16745"
                    shadow="cast: true">
                </a-cylinder>
                
                <a-box 
                    position="10 1 8" 
                    width="3" 
                    height="1.5" 
                    depth="1.5" 
                    color="#7BC8A4"
                    shadow="cast: true">
                </a-box>
                
                <!-- Road markings -->
                <a-plane position="0 0.01 0" rotation="-90 0 0" width="30" height="0.5" color="#555" repeat="30 1"></a-plane>
                <a-plane position="0 0.02 0" rotation="-90 0 0" width="0.2" height="30" color="#FFF" repeat="1 30"></a-plane>
                <a-plane position="0 0.02 0" rotation="-90 90 0" width="0.2" height="30" color="#FFF" repeat="1 30"></a-plane>
                
                <!-- Sky -->
                <a-sky color="#1a2a6c"></a-sky>
            </a-scene>
            
            <div class="instructions">
                <h3>Controls:</h3>
                <p>W - Accelerate forward</p>
                <p>S - Brake / Reverse</p>
                <p>A - Turn left</p>
                <p>D - Turn right</p>
                <p>Space - Reset position</p>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>Movement</h3>
                <div class="key" id="key-w">W</div>
                <br>
                <div class="key" id="key-a">A</div>
                <div class="key" id="key-s">S</div>
                <div class="key" id="key-d">D</div>
            </div>
            <div class="control-group">
                <h3>Actions</h3>
                <div class="key" id="key-space">Space</div>
            </div>
        </div>
    </div>

    <script>
        // Car controller component
        AFRAME.registerComponent('car-controls', {
            init: function() {
                // Car properties
                this.speed = 0;
                this.maxSpeed = 0.3;
                this.acceleration = 0.01;
                this.deceleration = 0.02;
                this.turnSpeed = 2;
                this.direction = 0; // In degrees
                
                // Key states
                this.keys = {
                    'w': false,
                    's': false,
                    'a': false,
                    'd': false,
                    ' ': false
                };
                
                // Add event listeners
                window.addEventListener('keydown', (e) => {
                    if (this.keys.hasOwnProperty(e.key.toLowerCase())) {
                        this.keys[e.key.toLowerCase()] = true;
                        document.getElementById(`key-${e.key.toLowerCase()}`).classList.add('active');
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    if (this.keys.hasOwnProperty(e.key.toLowerCase())) {
                        this.keys[e.key.toLowerCase()] = false;
                        document.getElementById(`key-${e.key.toLowerCase()}`).classList.remove('active');
                    }
                });
                
                // Update car movement
                this.updateCar = this.updateCar.bind(this);
            },
            
            tick: function() {
                this.updateCar();
            },
            
            updateCar: function() {
                const el = this.el;
                
                // Acceleration and braking
                if (this.keys['w']) {
                    this.speed = Math.min(this.speed + this.acceleration, this.maxSpeed);
                } else if (this.keys['s']) {
                    this.speed = Math.max(this.speed - this.deceleration, -this.maxSpeed/2);
                } else {
                    // Gradual slowdown when no keys pressed
                    if (this.speed > 0) {
                        this.speed = Math.max(this.speed - this.deceleration/2, 0);
                    } else if (this.speed < 0) {
                        this.speed = Math.min(this.speed + this.deceleration/2, 0);
                    }
                }
                
                // Turning
                if (this.keys['a']) {
                    this.direction += this.turnSpeed;
                }
                if (this.keys['d']) {
                    this.direction -= this.turnSpeed;
                }
                
                // Reset position with space
                if (this.keys[' ']) {
                    el.setAttribute('position', {x: 0, y: 1.5, z: 0});
                    this.speed = 0;
                    this.direction = 0;
                    el.object3D.rotation.y = 0;
                }
                
                // Update position based on speed and direction
                if (Math.abs(this.speed) > 0.001) {
                    const rad = this.direction * Math.PI / 180;
                    const currentPos = el.getAttribute('position');
                    
                    const newX = currentPos.x - Math.sin(rad) * this.speed;
                    const newZ = currentPos.z - Math.cos(rad) * this.speed;
                    
                    // Boundary checks
                    if (Math.abs(newX) < 14 && Math.abs(newZ) < 14) {
                        el.setAttribute('position', {
                            x: newX,
                            y: currentPos.y,
                            z: newZ
                        });
                    }
                    
                    // Update rotation
                    el.object3D.rotation.y = rad;
                }
                
                // Update UI
                document.getElementById('speed-display').textContent = (Math.abs(this.speed) * 10).toFixed(1);
                document.getElementById('direction-display').textContent = ((360 - this.direction) % 360).toFixed(0);
            }
        });
        
        // Add car controls to the car element after scene loads
        document.querySelector('a-scene').addEventListener('loaded', function() {
            const car = document.getElementById('car');
            car.setAttribute('car-controls', '');
        });
    </script>
</body>
</html>
