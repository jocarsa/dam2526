<!doctype html>
<html>
  <head>
    <style></style>
  </head>
  <body>
    <canvas width=512 height=512></canvas>
    <script>
      // Declarar las clases reutilizables (objetos del juego) ///////////////////////////////////////////////
      
      class Jugador{
         constructor(){
            this.posx = anchura/2;
            this.posy = altura/2;
            this.angulo = 0
         }
         dibuja(){
            contexto.fillStyle = "red"
            contexto.beginPath()
            contexto.arc(this.posx,this.posy,5,0,Math.PI*2)
            contexto.fill()
            contexto.beginPath()
            contexto.moveTo(
              this.posx-Math.cos(this.angulo+Math.PI/4)*20,
              this.posy-Math.sin(this.angulo+Math.PI/4)*20  
            )
            contexto.lineTo(
              this.posx+Math.cos(this.angulo+Math.PI/4)*20,
              this.posy-Math.sin(this.angulo+Math.PI/4)*20  
            )
            contexto.lineTo(
              this.posx,
              this.posy+Math.sin(this.angulo)*15 
            )
            contexto.closePath()
            contexto.stroke()
         }
      }
      
      class Roca{
        // Clase roca que crea rocas en la pantalla las cuales tenemos que destruir
        constructor(){
            // El constructor define siempre las condiciones de inicio de la clase
            this.posx = Math.random()*anchura;
            this.posy = Math.random()*altura;
            this.angulo = Math.random()*Math.PI*2
            this.lados = Math.round(Math.random()*20+5)
            this.radio = Math.random()*20+10
            const rugosidad = 0.4;
            this.puntas = Array.from({length:this.lados}, () => 1 + (Math.random()*2 - 1) * rugosidad);

         }
         // Ahora creamos tantos métodos como sea necesario para definir el comportamiento de la clase
         dibuja(){
            contexto.beginPath();
            for(let i = 0; i < this.lados; i++){
              const ang = (i/this.lados)*Math.PI*2 + this.angulo;
              const r   = this.radio * this.puntas[i];
              const x   = this.posx + Math.cos(ang)*r;
              const y   = this.posy + Math.sin(ang)*r;
              if(i===0) contexto.moveTo(x,y); else contexto.lineTo(x,y);
            }
            contexto.closePath();
            contexto.strokeStyle = "#333";
            contexto.stroke();
           }
         mueve(){
          this.angulo += (Math.random()-0.5)*0.1
          this.posx += Math.cos(this.angulo)
          this.posy += Math.sin(this.angulo)
         }
      }
      
      class Bala{
        
      }
    
      // Condiciones de inicio ///////////////////////////////////////////////////////////////////
      // Variables globales a todo el programa
      
      const anchura = window.innerWidth
      const altura = window.innerHeight
      // Primero seleccionarmos el lienzo donde vamos a pintar
      
      const lienzo = document.querySelector("canvas");
      lienzo.width = anchura
      lienzo.height = altura
      const contexto = lienzo.getContext("2d");
      
      // Instancio las clases necesarias 
      
      var jugador = new Jugador()
      var rocas = []
      var numerorocas = 10;
      for(let i = 0;i<numerorocas;i++){
        rocas.push(new Roca())
      }
      
      // Entramos en el bucle ///////////////////////////////////////////////////////////////////////
      
      // Definimos un temporizador
      
      var temporizador = setTimeout("bucle()",1000)
      
      function bucle(){
        // De una forma u otra, borro la pantalla para dibujar el siguiente fotograma
        contexto.clearRect(0,0,anchura,altura)
        // Generalmente, primero llamo al jugador (suele haber 1)
        jugador.dibuja()
        // Y a continuación llamo a NPC, props, lo que sea
        rocas.forEach(function(roca){
          roca.dibuja()
          roca.mueve()
        })
        clearTimeout(temporizador)
        temporizador = setTimeout("bucle()",100)
      }
    </script>
  </body>
</html>

