<!doctype html>
<html>
  <head>
    <style>body,html{padding:0;margin:0;overflow:hidden;background:#000}</style>
  </head>
  <body>
    <canvas width="512" height="512"></canvas>
    <script>
      // ================= Utilidades =================
      function distancia(x1, y1, x2, y2) {
        let dx = x2 - x1;
        let dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
      }

      // ================= Clases =================
      class Jugador{
         constructor(){
            this.posx = anchura/2;
            this.posy = altura/2;
            this.angulo = 0;

            // Física con inercia
            this.velx = 0;
            this.vely = 0;
            this.aceleracion = 0.18;   // empuje por frame cuando hay thrust
            this.rozamiento = 0.995;   // amortiguación (1 = sin rozamiento)
            this.velMax = 8;           // límite de velocidad
         }
         dibuja(){
            // Triángulo orientado
            contexto.fillStyle = "white";
            const noseLen = 22;
            const baseLen = 14;
            const spread  = Math.PI * 0.75;

            const noseX  = this.posx + Math.cos(this.angulo) * noseLen;
            const noseY  = this.posy + Math.sin(this.angulo) * noseLen;

            const leftX  = this.posx + Math.cos(this.angulo + spread) * baseLen;
            const leftY  = this.posy + Math.sin(this.angulo + spread) * baseLen;

            const rightX = this.posx + Math.cos(this.angulo - spread) * baseLen;
            const rightY = this.posy + Math.sin(this.angulo - spread) * baseLen;

            contexto.beginPath();
            contexto.moveTo(noseX, noseY);
            contexto.lineTo(leftX, leftY);
            contexto.lineTo(rightX, rightY);
            contexto.closePath();
            contexto.lineWidth = 2;
            contexto.strokeStyle = "#000";
            contexto.fill();

            // Punto rojo central
            contexto.fillStyle = "red";
            contexto.beginPath();
            contexto.arc(this.posx, this.posy, 5, 0, Math.PI*2);
            contexto.fill();
         }
         aplicaThrust(activado){
           if(!activado) return;
           // Empuje en la dirección del ángulo
           this.velx += Math.cos(this.angulo) * this.aceleracion;
           this.vely += Math.sin(this.angulo) * this.aceleracion;

           // Cap de velocidad
           const v = Math.hypot(this.velx, this.vely);
           if (v > this.velMax){
             const f = this.velMax / v;
             this.velx *= f;
             this.vely *= f;
           }
         }
         mueve(){
           // Aplicar rozamiento
           this.velx *= this.rozamiento;
           this.vely *= this.rozamiento;

           // Integrar posición
           this.posx += this.velx;
           this.posy += this.vely;

           // Screen wrap
           if (this.posx < 0) this.posx += anchura;
           if (this.posx > anchura) this.posx -= anchura;
           if (this.posy < 0) this.posy += altura;
           if (this.posy > altura) this.posy -= altura;
         }
      }

      class Bala{
        constructor(xinicial,yinicial,anguloinicial){
            this.posx = xinicial;
            this.posy = yinicial;
            this.angulo = anguloinicial;
            this.velocidad = 12;
         }
         dibuja(){
            contexto.fillStyle = "dodgerblue";
            contexto.beginPath();
            contexto.arc(this.posx,this.posy,3,0,Math.PI*2);
            contexto.fill();
         }
         mueve(){
          this.posx += Math.cos(this.angulo)*this.velocidad;
          this.posy += Math.sin(this.angulo)*this.velocidad;
         }
      }

      class Estrella{
        constructor(){
            this.posx = Math.random()*anchura;
            this.posy = Math.random()*altura;
         }
         dibuja(){
            contexto.fillStyle = "white";
            contexto.beginPath();
            contexto.arc(this.posx,this.posy,1,0,Math.PI*2);
            contexto.fill();
         }
      }

      class Roca{
        constructor(){
            this.posx = Math.random()*anchura;
            this.posy = Math.random()*altura;
            this.angulo = Math.random()*Math.PI*2;
            this.lados = Math.round(Math.random()*20+5);
            this.radio = Math.random()*20+10;
            const rugosidad = 0.4;
            this.puntas = Array.from({length:this.lados}, () => 1 + (Math.random()*2 - 1) * rugosidad);

            // ligera velocidad para que naveguen
            const v = Math.random()*1.2+0.3;
            this.vx = Math.cos(this.angulo)*v;
            this.vy = Math.sin(this.angulo)*v;
         }
         dibuja(){
            contexto.fillStyle = "grey";
            contexto.beginPath();
            for(let i = 0; i < this.lados; i++){
              const ang = (i/this.lados)*Math.PI*2 + this.angulo;
              const r   = this.radio * this.puntas[i];
              const x   = this.posx + Math.cos(ang)*r;
              const y   = this.posy + Math.sin(ang)*r;
              if(i===0) contexto.moveTo(x,y); else contexto.lineTo(x,y);
            }
            contexto.closePath();
            contexto.strokeStyle = "#333";
            contexto.fill();
         }
         mueve(){
          // ligera rotación y movimiento
          this.angulo += (Math.random()-0.5)*0.04;
          this.posx += this.vx;
          this.posy += this.vy;

          // Screen wrap para rocas
          if (this.posx < -this.radio) this.posx = anchura + this.radio;
          if (this.posx > anchura + this.radio) this.posx = -this.radio;
          if (this.posy < -this.radio) this.posy = altura + this.radio;
          if (this.posy > altura + this.radio) this.posy = -this.radio;
         }
      }

      // ================= Inicio =================
      const anchura = window.innerWidth;
      const altura  = window.innerHeight;

      let giro = 0;        // -1 izquierda, 1 derecha
      let thrust = false;  // empuje activo (W)

      const lienzo = document.querySelector("canvas");
      lienzo.width = anchura;
      lienzo.height = altura;
      const contexto = lienzo.getContext("2d");

      const jugador = new Jugador();

      let rocas = [];
      const numerorocas = 10;
      for(let i = 0; i < numerorocas; i++) rocas.push(new Roca());

      let balas = [];

      let estrellas = [];
      const numeroestrellas = 100;
      for(let i = 0; i < numeroestrellas; i++) estrellas.push(new Estrella());

      // ================= Controles =================
      document.body.onkeydown = function(e){
        switch(e.key){
          case "w": thrust = true; break;
          case "a": giro = -1; break;
          case "d": giro = 1; break;
        }
        if (e.code === "Space"){
          balas.push(new Bala(jugador.posx, jugador.posy, jugador.angulo));
        }
      };
      document.body.onkeyup = function(e){
        switch(e.key){
          case "w": thrust = false; break;
          case "a": if (giro === -1) giro = 0; break;
          case "d": if (giro === 1)  giro = 0; break;
        }
      };

      // ================= Bucle =================
      let temporizador = null;

      function bucle(){
        // Input -> rotación y thrust
        jugador.angulo += giro * 0.08; // suavizo un poco el giro
        jugador.aplicaThrust(thrust);

        // Fondo
        contexto.fillStyle = "black";
        contexto.fillRect(0,0,anchura,altura);

        // Estrellas
        estrellas.forEach(e => e.dibuja());

        // Entidades
        rocas.forEach(r => { r.dibuja(); r.mueve(); });
        balas.forEach(b => { b.dibuja(); b.mueve(); });

        // Jugador al final para que quede por encima
        jugador.mueve();
        jugador.dibuja();

        // Colisiones bala-roca
        for(let i = rocas.length - 1; i >= 0; i--){
          let roca = rocas[i];
          for(let j = balas.length - 1; j >= 0; j--){
            let bala = balas[j];
            if (distancia(bala.posx, bala.posy, roca.posx, roca.posy) < roca.radio){
              rocas.splice(i,1);
              balas.splice(j,1);
              break; // roca destruida, pasar a la siguiente roca
            }
          }
        }

        // Borrar balas fuera de pantalla
        for(let j = balas.length - 1; j >= 0; j--){
          if(balas[j].posx < 0 || balas[j].posx > anchura || balas[j].posy < 0 || balas[j].posy > altura){
            balas.splice(j,1);
          }
        }

        // Repetir
        temporizador = setTimeout(bucle, 16); // ~60 FPS
      }

      // Lanzar juego
      temporizador = setTimeout(bucle, 16);
    </script>
  </body>
</html>

