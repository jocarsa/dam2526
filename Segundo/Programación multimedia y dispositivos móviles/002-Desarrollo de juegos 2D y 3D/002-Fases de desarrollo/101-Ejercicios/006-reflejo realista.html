<!doctype html>
<html>
  <head>
  </head>
  <body>
    <canvas></canvas>
    <script>
    
      function distance2D(x1, y1, x2, y2) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            return Math.sqrt(dx * dx + dy * dy);
        }
      function bounceAngle(incidentAngle, wallAngle) {
          const relative = incidentAngle - wallAngle;   // angle of incidence
          const reflectedRelative = -relative;          // mirror
          return reflectedRelative + wallAngle;         // return to world space
      }
      let anchura = 512;
      let altura = 512;
      let lienzo = document.querySelector("canvas")
      let contexto = lienzo.getContext("2d")
      lienzo.width = anchura
      lienzo.height = altura
      
      class Particula{
          constructor(x,y,a){
              this.x = x;
              this.y = y;
              this.a = a;
          }
          dibuja(){
              contexto.beginPath();
              contexto.arc(this.x,this.y,5,0,Math.PI*2);
              contexto.fill();
          }
          lineas(){
              for(let i = 0;i<numeroparticulas;i++){
                  if(distance2D(this.x, this.y, particulas[i].x, particulas[i].y) < 100){
                      contexto.beginPath();
                      contexto.moveTo(this.x,this.y);
                      contexto.lineTo(particulas[i].x, particulas[i].y);
                      contexto.stroke();
                  }
              }
          }
          mueve(){
              this.a += (Math.random()-0.5) * 0.1;
              this.x += Math.cos(this.a);
              this.y += Math.sin(this.a);
          }

          rebote(){
              // Right wall
              if (this.x > anchura) {
                  this.x = anchura;
                  this.a = bounceAngle(this.a, Math.PI/2); // wall angle = vertical
              }
              // Left wall
              if (this.x < 0) {
                  this.x = 0;
                  this.a = bounceAngle(this.a, Math.PI/2);
              }

              // Bottom wall
              if (this.y > altura) {
                  this.y = altura;
                  this.a = bounceAngle(this.a, 0); // horizontal wall
              }
              // Top wall
              if (this.y < 0) {
                  this.y = 0;
                  this.a = bounceAngle(this.a, 0);
              }
          }
      }

      let particulas = [];
      let numeroparticulas = 50
      
      for(let i = 0;i<numeroparticulas;i++){
        particulas.push(
          new Particula(
            Math.random()*anchura,
            Math.random()*altura,
            Math.random()*Math.PI*2
          )
        )
      }
      let temporizador = setTimeout("bucle()",1000)
      function bucle(){
        contexto.clearRect(0,0,anchura,altura)
        // Las particulas
        for(let i = 0;i<numeroparticulas;i++){
          particulas[i].mueve();
          particulas[i].dibuja();
          particulas[i].lineas();
          particulas[i].rebote();
        }
        clearTimeout(temporizador)
        temporizador = setTimeout("bucle()",10)
      }
      
    </script>
  </body>
</html>
