# Desarrollo de interfaces

**Author:** Jose Vicente Carratala Sanchis

## Table of contents

- [Generación de interfaces de usuario](#generacion-de-interfaces-de-usuario)
  - [Patrones de arquitectura de las aplicaciones gráficas](#patrones-de-arquitectura-de-las-aplicaciones-graficas)
  - [Librerías de componentes nativas y multiplataforma](#librerias-de-componentes-nativas-y-multiplataforma)
  - [Herramientas propietarias y libres de edición de interfaces](#herramientas-propietarias-y-libres-de-edicion-de-interfaces)
  - [Lenguajes descriptivos para la definición de interfaces](#lenguajes-descriptivos-para-la-definicion-de-interfaces)
  - [Componentes características y campo de aplicación](#componentes-caracteristicas-y-campo-de-aplicacion)
  - [Enlace de componentes a orígenes de datos](#enlace-de-componentes-a-origenes-de-datos)
  - [Asociación de acciones a eventos](#asociacion-de-acciones-a-eventos)
  - [Edición del código generado por la herramienta de diseño](#edicion-del-codigo-generado-por-la-herramienta-de-diseno)
  - [Clases, propiedades, métodos](#clases-propiedades-metodos)
  - [Eventos; escuchadores](#eventos-escuchadores)
  - [Ejercicio de final de unidad](#ejercicio-de-final-de-unidad)
- [Generación de interfaces naturales de usuario](#generacion-de-interfaces-naturales-de-usuario)
  - [Herramientas para el aprendizaje automático](#herramientas-para-el-aprendizaje-automatico)
  - [Interfaces naturales](#interfaces-naturales)
  - [Voz y Habla](#voz-y-habla)
  - [Partes y movimientos del cuerpo](#partes-y-movimientos-del-cuerpo)
  - [Realidad aumentada](#realidad-aumentada)
  - [Ejercicio de final de unidad](#ejercicio-de-final-de-unidad-1)
- [Creación de componentes visuales](#creacion-de-componentes-visuales)
  - [Concepto de componente](#concepto-de-componente)
  - [Propiedades, atributos y métodos](#propiedades-atributos-y-metodos)
  - [Eventos; asociación de acciones a eventos](#eventos-asociacion-de-acciones-a-eventos)
  - [Persistencia del componente](#persistencia-del-componente)
  - [Herramientas para desarrollo de componentes visuales](#herramientas-para-desarrollo-de-componentes-visuales)
  - [Prueba de los componentes](#prueba-de-los-componentes)
  - [Empaquetado de componentes](#empaquetado-de-componentes)
  - [Ejercicio de final de unidad](#ejercicio-de-final-de-unidad-2)
  - [Examen final](#examen-final)
- [Diseño de interfaces gráficas](#diseno-de-interfaces-graficas)
  - [Usabilidad y accesibilidad](#usabilidad-y-accesibilidad)
  - [Medidas de usabilidad y accesibilidad de las aplicaciones](#medidas-de-usabilidad-y-accesibilidad-de-las-aplicaciones)
  - [b-Esquemas (Wireframes) y Maquetas (Mockups)](#b-esquemas-wireframes-y-maquetas-mockups)
  - [Esquemas (Wireframes) y Maquetas (Mockups)](#esquemas-wireframes-y-maquetas-mockups)
  - [Pautas de diseño de la estructura de la interfaz de usuario](#pautas-de-diseno-de-la-estructura-de-la-interfaz-de-usuario)
  - [Pautas de diseño del aspecto de la interfaz de usuario](#pautas-de-diseno-del-aspecto-de-la-interfaz-de-usuario)
  - [Pautas de diseño](#pautas-de-diseno)
  - [Pautas de diseño de la secuencia de control de la aplicación](#pautas-de-diseno-de-la-secuencia-de-control-de-la-aplicacion)
- [Creación de informes](#creacion-de-informes)
  - [Informes incrustados y no incrustados en la aplicación](#informes-incrustados-y-no-incrustados-en-la-aplicacion)
  - [Herramientas gráficas integradas en el IDE y externas al mismo](#herramientas-graficas-integradas-en-el-ide-y-externas-al-mismo)
  - [Estructura general. Secciones](#estructura-general-secciones)
  - [Filtrado de datos](#filtrado-de-datos)
  - [Numeración de líneas, recuentos y totales](#numeracion-de-lineas-recuentos-y-totales)
  - [Gráficos](#graficos)
  - [Librerías para generación de informes. Clases, métodos y atributos](#librerias-para-generacion-de-informes-clases-metodos-y-atributos)
  - [Conexión con las fuentes de datos. Ejecución de consultas](#conexion-con-las-fuentes-de-datos-ejecucion-de-consultas)
- [Documentación de aplicaciones](#documentacion-de-aplicaciones)
  - [Ficheros de ayuda. Formatos](#ficheros-de-ayuda-formatos)
  - [Herramientas de generación de ayudas](#herramientas-de-generacion-de-ayudas)
  - [Tablas de contenidos, índices, sistemas de búsqueda, entre otros](#tablas-de-contenidos-indices-sistemas-de-busqueda-entre-otros)
  - [Tipos de manuales](#tipos-de-manuales)
  - [Elaboración de tutoriales](#elaboracion-de-tutoriales)
- [Distribución de aplicaciones](#distribucion-de-aplicaciones)
  - [Componentes de una aplicación. Empaquetado](#componentes-de-una-aplicacion-empaquetado)
  - [Instaladores](#instaladores)
  - [Paquetes autoinstalables](#paquetes-autoinstalables)
  - [Firma digital de aplicaciones](#firma-digital-de-aplicaciones)
  - [Herramientas para crear paquetes de instalación](#herramientas-para-crear-paquetes-de-instalacion)
  - [Personalización de la instalación](#personalizacion-de-la-instalacion)
  - [Asistentes de instalación y desinstalación](#asistentes-de-instalacion-y-desinstalacion)
  - [Canales de distribución repositorios](#canales-de-distribucion-repositorios)
- [Realización de pruebas](#realizacion-de-pruebas)
  - [Objetivo, importancia y limitaciones del proceso de prueba](#objetivo-importancia-y-limitaciones-del-proceso-de-prueba)
  - [Pruebas de integración ascendentes y descendentes](#pruebas-de-integracion-ascendentes-y-descendentes)
  - [Pruebas de sistema configuración, recuperación, entre otras](#pruebas-de-sistema-configuracion-recuperacion-entre-otras)
  - [Pruebas de uso de recursos](#pruebas-de-uso-de-recursos)
  - [Pruebas de seguridad](#pruebas-de-seguridad)
  - [Pruebas manuales y automáticas](#pruebas-manuales-y-automaticas)
- [Actividad libre de final de evaluación - La milla extra](#actividad-libre-de-final-de-evaluacion-la-milla-extra)
  - [La Milla Extra - Primera evaluación](#la-milla-extra-primera-evaluacion)

---

<a id="generacion-de-interfaces-de-usuario"></a>
# Generación de interfaces de usuario

<a id="patrones-de-arquitectura-de-las-aplicaciones-graficas"></a>
## Patrones de arquitectura de las aplicaciones gráficas

En el campo de la programación, la generación de interfaces de usuario (UI) es un aspecto crucial que requiere una comprensión profunda de los patrones de arquitectura de las aplicaciones gráficas. Estos patrones proporcionan estructuras y mejores prácticas para diseñar interfaces que sean intuitivas, eficientes y escalables.

La arquitectura de las aplicaciones gráficas se centra en cómo organizar y presentar los componentes visuales y la lógica detrás de ellos. Uno de los patrones más reconocidos es el Modelo-Vista-Controlador (MVC), que divide la aplicación en tres partes interconectadas: el modelo, la vista y el controlador.

El **Modelo** representa los datos y las reglas de negocio de la aplicación. Es independiente del usuario y no tiene conocimiento sobre cómo se muestran o interactúan con estos datos. Su principal responsabilidad es mantener los datos en un estado consistente y proporcionar acceso a ellos para el controlador.

La **Vista** es la representación visual de los datos del modelo. Se encarga de mostrar los datos al usuario y permitir que el usuario interactúe con ellos. La vista no tiene conocimiento sobre cómo se manejan los datos o qué lógica está detrás de ellas; solo muestra lo que recibe del controlador.

El **Controlador** actúa como intermediario entre el modelo y la vista. Recoge las acciones del usuario a través de la vista, actualiza el modelo según sea necesario y luego notifica a la vista para reflejar los cambios en la interfaz gráfica. Este patrón permite una separación clara de responsabilidades, facilitando la mantenibilidad y la escalabilidad del código.

Otro patrón importante es el **Modelo-Vista-ViewModel (MVVM)**, que se utiliza especialmente en aplicaciones basadas en plataformas como WPF o UWP. En este caso, el ViewModel actúa como una capa de intermediación entre el modelo y la vista. Proporciona datos y comandos a la vista para su presentación y permite que la vista interactúe con el modelo a través del ViewModel.

El **Patrón Singleton** es útil cuando se necesita asegurar que solo haya una instancia de un objeto en toda la aplicación. Esto es especialmente relevante en interfaces de usuario, donde ciertos objetos como el gestor de recursos o el controlador principal deben ser accesibles desde cualquier parte de la aplicación sin necesidad de instanciarlos múltiples veces.

El **Patrón Factory** permite crear objetos sin especificar su clase concreta. En el contexto de interfaces de usuario, esto puede ser útil para crear instancias de componentes visuales o controladores según las necesidades específicas del escenario.

La **Arquitectura de Capas (Layered Architecture)** divide la aplicación en capas lógicas, cada una responsable de un aspecto específico. En el caso de interfaces gráficas, esta arquitectura puede incluir una capa de presentación que se encarga de la interfaz del usuario, una capa de negocio que gestiona las reglas de negocio y una capa de datos que interactúa con la base de datos.

El **Patrón Observer** es útil para implementar sistemas de notificación. En interfaces gráficas, este patrón puede ser utilizado para actualizar automáticamente los componentes visuales cuando cambia el estado del modelo o viceversa.

La **Arquitectura Microservicios** permite dividir una aplicación en servicios pequeños y autónomos que se comunican entre sí a través de APIs. En interfaces gráficas, esto puede ser útil para crear aplicaciones complejas que pueden escalar horizontalmente y mantenerse más fáciles de gestionar.

La **Arquitectura Event-Driven** basada en eventos permite que los componentes de la aplicación se comuniquen entre sí mediante eventos. En interfaces gráficas, este patrón puede ser útil para implementar interacciones asincrónicas y responder a acciones del usuario sin bloquear el hilo principal.

Cada uno de estos patrones ofrece soluciones específicas para problemas comunes en el diseño de interfaces de usuario. La elección del patrón adecuado depende del contexto específico de la aplicación, las necesidades del proyecto y los requisitos funcionales y no funcionales. Comprender y aplicar estos patrones puede mejorar significativamente la calidad y la eficiencia del código, facilitando el mantenimiento y la escalabilidad de las interfaces gráficas en proyectos de desarrollo de software.

<a id="librerias-de-componentes-nativas-y-multiplataforma"></a>
## Librerías de componentes nativas y multiplataforma

En el mundo digital actual, las interfaces de usuario (UI) desempeñan un papel crucial en la experiencia del usuario final. La generación de interfaces de usuario es una parte integral del desarrollo de software, y para lograrlo de manera eficiente y consistente, se utilizan diversas librerías de componentes nativos y multiplataforma.

Las librerías de componentes nativas son específicas del sistema operativo en el que se ejecuta la aplicación. Por ejemplo, en Windows, las librerías como Windows Forms o WPF (Windows Presentation Foundation) proporcionan una amplia gama de controles predefinidos que pueden ser utilizados para crear interfaces de usuario atractivas y funcionales. Estos componentes son fáciles de usar y se integran perfectamente con el sistema operativo, lo que permite un rendimiento óptimo.

Por otro lado, las librerías de componentes multiplataforma ofrecen la ventaja de ser utilizadas en diferentes sistemas operativos sin necesidad de recompilar el código. Frameworks como JavaFX o Qt son ejemplos populares de esta categoría. Estas librerías proporcionan una gran variedad de controles y herramientas que pueden ser personalizados según las necesidades del proyecto, lo que facilita la creación de interfaces de usuario consistentes y adaptadas a diferentes plataformas.

La elección entre usar librerías nativas o multiplataforma depende en gran medida de los requisitos específicos del proyecto. Si se requiere una alta personalización y un rendimiento óptimo, las librerías nativas pueden ser la mejor opción. Sin embargo, si el objetivo es crear aplicaciones que funcionen sin problemas en múltiples sistemas operativos, las librerías multiplataforma son más adecuadas.

Además de proporcionar controles predefinidos, estas librerías también ofrecen funcionalidades adicionales como la gestión de eventos, la personalización del aspecto visual y la integración con otros componentes del sistema. Esto permite a los desarrolladores crear interfaces de usuario complejas y dinámicas sin tener que reinventar la rueda.

La documentación asociada a estas librerías es generalmente extensa y detallada, lo que facilita el aprendizaje y el desarrollo de aplicaciones utilizando estas herramientas. Además, existen comunidades activas y foros donde los desarrolladores pueden compartir conocimientos y resolver dudas, lo que añade valor al uso de estas librerías.

En resumen, las librerías de componentes nativas y multiplataforma son herramientas esenciales para el desarrollo de interfaces de usuario. Cada una tiene sus ventajas y desventajas, y la elección dependerá del contexto específico del proyecto. Al dominar estas librerías, los desarrolladores pueden crear aplicaciones con interfaces de usuario profesionales y funcionales que ofrecan una excelente experiencia al usuario final.

### revision de componentes

```html
<!doctype html>
<html>
  <body>
    
  </body>
</html>
```

### componentes de formulario

```html
<!doctype html>
<html>
  <body>
    <h1>Componentes de formulario</h1>
    <input type="text">
    <input type="password">
    <input type="tel">
    <input type="url">
    <input type="email">
    <input type="number">
    <input type="date">
    <input type="time">
    <input type="datetime-local">
    <input type="month">
    <input type="week">
    <input type="radio">
    <input type="checkbox">
    <input type="file">
    <input type="reset">
    <input type="submit">
    <input type="color">
    <input type="hidden">
    <input type="search">
    <input type="image" src="envio.jpg">
  </body>
</html>
```

### meters

```html
<!doctype html>
<html>
  <body>
    <h1>Componentes de formulario</h1>
    <meter id="nivel" min="0" max="100" low="30" high="80" optimum="90" value="65">
  65%
</meter>
<progress id="progreso" value="70" max="100">70%</progress>

  </body>
</html>
```

### sugerencias para un input

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <label for="persona">Elige una persona:</label>
    <input id="persona" list="personas" name="persona">
    
    <datalist id="personas">
      <option value="Jose Vicente">
      <option value="Juan">
      <option value="Jorge">
      <option value="Jaime">
    </datalist>
  </body>
</html>
```

### Resultados calculados

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <form oninput="resultado.value = parseInt(a.value) + parseInt(b.value)">
  <input type="number" id="a" value="10"> +
  <input type="number" id="b" value="20"> =
  <output name="resultado" for="a b"></output>
</form>
  </body>
</html>
```

### detalles y sumario

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <details>
      <summary>Ver más detalles</summary>
      <p>Este es el contenido oculto que puedes expandir.</p>
    </details>
  </body>
</html>
```

### agrupar campos

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <fieldset>
      <legend>Datos personales</legend>
      <label>Nombre: <input type="text"></label>
      <label>Email: <input type="email"></label>
    </fieldset>
  </body>
</html>
```

### campo select

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <select>
      <option>Uno</option>
      <option>Dos</option>
      <option>Tres</option>
      <option>Cuatro</option>
      <option>Cinco</option>
    </select>
  </body>
</html>
```

### textarea

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <textarea>
    </textarea>
  </body>
</html>
```

### range

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <input type="range">
  </body>
</html>
```

### boton con input

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <input type="button" value="Púlsame">
  </body>
</html>
```

### boton de verdad

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <button>Púlsame</button>
  </body>
</html>
```

### Form como contenedor

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Componentes de formulario</h1>
    
    <form action="quienteprocesa.php" method="POST"> 
      <input type="text">
      <input type="submit">
    </form>
  </body>
</html>
```

<a id="herramientas-propietarias-y-libres-de-edicion-de-interfaces"></a>
## Herramientas propietarias y libres de edición de interfaces

En la generación de interfaces de usuario (UI), las herramientas propietarias y libres desempeñan un papel crucial, ofreciendo diferentes niveles de personalización, funcionalidad y facilidad de uso. Las herramientas propietarias, como Adobe XD o Figma, son conocidas por su alta calidad visual y la capacidad para crear interfaces sofisticadas con una gran cantidad de detalles. Estas plataformas a menudo incluyen funciones avanzadas como la simulación de interacciones y el prototipado interactivo, lo que facilita enormemente el proceso de diseño.

Por otro lado, las herramientas libres ofrecen un enfoque más accesible y económico para los desarrolladores y diseñadores. Herramientas como Inkscape o GIMP son excelentes opciones para crear interfaces básicas y estáticas, con la ventaja adicional de ser software libre y gratuito. Estas herramientas permiten a los usuarios experimentar con diferentes diseños sin restricciones financieras, lo que es especialmente beneficioso en proyectos pequeños o de bajo presupuesto.

La elección entre una herramienta propietaria y una libres depende del proyecto específico y las necesidades del equipo. Las herramientas propietarias suelen ofrecer un nivel más alto de personalización y funcionalidad, pero también pueden ser más costosas a largo plazo. Por otro lado, las herramientas libres son una opción económica y flexible que permiten experimentar con diferentes enfoques sin comprometer el presupuesto.

Además de las herramientas gráficas, existen lenguajes de marcado como HTML y CSS que también juegan un papel crucial en la generación de interfaces de usuario. Estos lenguajes permiten a los desarrolladores crear estructuras y estilos para las páginas web, ofreciendo una gran flexibilidad y control sobre el diseño final.

En el mundo del desarrollo de aplicaciones móviles, herramientas como Sketch o Figma también son populares para diseñar interfaces de usuario. Estas plataformas permiten a los diseñadores crear prototipos interactivos que pueden ser compartidos con los desarrolladores para su implementación en la aplicación final.

La integración entre las herramientas gráficas y los lenguajes de marcado es fundamental para el desarrollo completo de interfaces de usuario. Los diseñadores utilizan herramientas como Adobe XD o Figma para crear diseños visuales, mientras que los desarrolladores usan HTML y CSS para implementar estos diseños en la aplicación final.

En resumen, las herramientas propietarias y libres ofrecen diferentes enfoques para la generación de interfaces de usuario. Cada opción tiene sus ventajas y desventajas, y la elección dependerá del proyecto específico y las necesidades del equipo. La combinación de herramientas gráficas y lenguajes de marcado es esencial para crear interfaces de usuario sofisticadas y funcionales que brinden una excelente experiencia al usuario final.

### interfaz inicial

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
  </head>
  <body>
    <h1>Diseñador de formularios</h1>
    <div id="contenedor">
      <div id="areadetrabajo">
      </div>
      <div id="componentes">
        <button>Input text</button>
        <button>Input password</button>
      </div>
    </div    
  </body>
</html>
```

### maquetar

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
    <style>
      #contenedor{
        width:100%;
        display:flex;
        border:1px solid grey;
      }
      #areadetrabajo{
        flex:3;
        border:1px solid grey;
      }
      #componentes{
        flex:1;
        border:1px solid grey;
      }
      #componentes button{
        width:100%;
      }
      
    </style>
  </head>
  <body>
    <h1>Diseñador de formularios</h1>
    <div id="contenedor">
      <div id="areadetrabajo">
      </div>
      <div id="componentes">
        <button>Input text</button>
        <button>Input password</button>
      </div>
    </div    
  </body>
</html>
```

### comportamiento

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
    <style>
      #contenedor{
        width:100%;
        display:flex;
        border:1px solid grey;
      }
      #areadetrabajo{
        flex:3;
        border:1px solid grey;
      }
      #componentes{
        flex:1;
        border:1px solid grey;
      }
      #componentes button{
        width:100%;
      }
      
    </style>
  </head>
  <body>
    <h1>Diseñador de formularios</h1>
    <div id="contenedor">
      <div id="areadetrabajo">
      </div>
      <div id="componentes">
        <button value="text">Input text</button>
        <button value="date">Input date</button>
      </div>
    </div>
    <script>
      let areadetrabajo = document.querySelector("#areadetrabajo")
      document.querySelector("button").onclick = function(){
        areadetrabajo.innerHTML += "<input type='"+this.value+"'>"
      }
    </script> 
  </body>
</html>
```

### recorro el for

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
    <style>
      #contenedor{
        width:100%;
        display:flex;
        border:1px solid grey;
      }
      #areadetrabajo{
        flex:3;
        border:1px solid grey;
      }
      #componentes{
        flex:1;
        border:1px solid grey;
        box-sizing:border-box;
      }
      #componentes button{
        width:100%;
      }
      #areadetrabajo input{
        margin:5px;
        padding:5px;
        width:90%;
        box-sizing:border-box;
      }
      
    </style>
  </head>
  <body>
    <h1>Diseñador de formularios</h1>
    <div id="contenedor">
      <div id="areadetrabajo">
      </div>
      <div id="componentes">
        <button value="text">Input text</button>
        <button value="date">Input date</button>
        <button value="password">Input password</button>
        <button value="email">Input email</button>
        <button value="number">Input number</button>
        <button value="time">Input time</button>
        <button value="datetime-local">Input datetime-local</button>
        <button value="month">Input month</button>
        <button value="week">Input week</button>
        <button value="color">Input color</button>

      </div>
    </div>
    <script>
      let areadetrabajo = document.querySelector("#areadetrabajo")
      document.querySelector("#componentes").onclick = function(e){
          if(e.target.tagName === "BUTTON"){
            areadetrabajo.innerHTML += "<input type='"+e.target.value+"'>"
          }
        }
    </script> 
  </body>
</html>
```

### boton de generar html

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
    <style>
      #contenedor{
        width:100%;
        display:flex;
        border:1px solid grey;
      }
      #areadetrabajo{
        flex:3;
        border:1px solid grey;
      }
      #componentes{
        flex:1;
        border:1px solid grey;
        box-sizing:border-box;
      }
      #componentes button{
        width:100%;
      }
      #areadetrabajo input{
        margin:5px;
        padding:5px;
        width:90%;
        box-sizing:border-box;
      }
      
    </style>
  </head>
  <body>
    <h1>Diseñador de formularios</h1>
    <div id="contenedor">
      <div id="areadetrabajo">
      </div>
      <div id="componentes">
        <button value="text">Input text</button>
        <button value="date">Input date</button>
        <button value="password">Input password</button>
        <button value="email">Input email</button>
        <button value="number">Input number</button>
        <button value="time">Input time</button>
        <button value="datetime-local">Input datetime-local</button>
        <button value="month">Input month</button>
        <button value="week">Input week</button>
        <button value="color">Input color</button>

      </div>
    </div>
    <button id="html">Generar HTML</button>
    <div id="resultado">
    <script>
      let areadetrabajo = document.querySelector("#areadetrabajo")
      document.querySelector("#componentes").onclick = function(e){
          if(e.target.tagName === "BUTTON"){
            areadetrabajo.innerHTML += "<input type='"+e.target.value+"'>"
          }
        }
        document.querySelector("#html").onclick = function(e){
          document.querySelector("#resultado").textContent = document.querySelector("#areadetrabajo").innerHTML
        }
    </script> 
    
    </div>
  </body>
</html>
```

### nombre id y clase

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Ejemplo datalist</title>
    <style>
      #contenedor{
        width:100%;
        display:flex;
        border:1px solid grey;
      }
      #areadetrabajo{
        flex:3;
        border:1px solid grey;
      }
      #componentes{
        flex:1;
        border:1px solid grey;
        box-sizing:border-box;
      }
      #componentes button{
        width:100%;
      }
      #areadetrabajo input{
        margin:5px;
        padding:5px;
        width:90%;
        box-sizing:border-box;
      }
      
    </style>
  </head>
  <body>
    <h1>Diseñador de formularios</h1>
    <div id="contenedor">
      <div id="areadetrabajo">
      </div>
      <div id="componentes">
        <button value="text">Input text</button>
        <button value="date">Input date</button>
        <button value="password">Input password</button>
        <button value="email">Input email</button>
        <button value="number">Input number</button>
        <button value="time">Input time</button>
        <button value="datetime-local">Input datetime-local</button>
        <button value="month">Input month</button>
        <button value="week">Input week</button>
        <button value="color">Input color</button>

      </div>
    </div>
    <button id="html">Generar HTML</button>
    <div id="resultado">
    <script>
      let areadetrabajo = document.querySelector("#areadetrabajo")
      document.querySelector("#componentes").onclick = function(e){
          if(e.target.tagName === "BUTTON"){
            let identificador = prompt("Introduce el identificador único del elemento (id)");
            let clase = prompt("Introduce la clase del elemento (class)");
            let nombre = prompt("Introduce el nombre único del elemento (name)");
            areadetrabajo.innerHTML += "<input type='"+e.target.value+"' id='"+identificador+"' class='"+clase+"' name='"+nombre+"'>"
          }
        }
        document.querySelector("#html").onclick = function(e){
          document.querySelector("#resultado").textContent = document.querySelector("#areadetrabajo").innerHTML
        }
    </script> 
    
    </div>
  </body>
</html>
```

### mejora de los estilos

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Diseñador de formularios</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root{
        --bg: #0f172a;           /* slate-900 */
        --bg-soft: #111827;      /* gray-900 */
        --card: #0b1224e6;       /* glassy */
        --text: #e5e7eb;         /* gray-200 */
        --muted: #9ca3af;        /* gray-400 */
        --brand: #7c3aed;        /* violet-600 */
        --brand-2: #22d3ee;      /* cyan-400 */
        --line: #1f2937;         /* gray-800 */
        --ok: #10b981;           /* emerald-500 */
        --warn: #f59e0b;         /* amber-500 */
        --radius-xl: 18px;
        --radius-lg: 14px;
        --shadow-1: 0 10px 30px rgba(0,0,0,.35);
        --shadow-2: 0 6px 16px rgba(0,0,0,.25);
        --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body{
        margin:0;
        font-family: var(--font);
        color: var(--text);
        background:
          radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.25), transparent 60%),
          radial-gradient(1000px 600px at 110% 10%, rgba(34,211,238,.20), transparent 60%),
          linear-gradient(180deg, #0b1022 0%, var(--bg) 100%);
      }

      /* Header */
      header{
        padding: 28px clamp(16px, 4vw, 40px);
        border-bottom: 1px solid var(--line);
        backdrop-filter: blur(8px);
        position: sticky; top: 0; z-index: 10;
        background: linear-gradient(180deg, rgba(11,16,34,.75), rgba(11,16,34,.35));
      }
      .title{
        display:flex; align-items:center; gap:14px;
      }
      .logo{
        width:40px; height:40px; border-radius:12px;
        background: conic-gradient(from 180deg, var(--brand), var(--brand-2), var(--brand));
        filter: saturate(1.1) brightness(1.1);
        box-shadow: var(--shadow-2);
      }
      h1{ margin:0; font-size: clamp(18px, 1.6vw, 24px); letter-spacing:.3px; }
      .subtitle{ margin:4px 0 0 54px; color: var(--muted); font-size: 14px; }

      /* Layout */
      .wrapper{
        padding: clamp(16px, 4vw, 40px);
        display:grid;
        grid-template-columns: 1.2fr .8fr;
        gap: 24px;
        max-width: 1280px;
        margin: 0 auto;
      }

      .card{
        background: var(--card);
        border: 1px solid rgba(255,255,255,.06);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-1);
      }

      /* Work area + Components */
      #contenedor{
        display:grid;
        grid-template-columns: 1fr .8fr;
        gap: 20px;
        border: none;
        background: transparent;
      }

      #areadetrabajo{
        min-height: 360px;
        padding: 18px;
        border-radius: var(--radius-xl);
        outline: 1px dashed rgba(255,255,255,.12);
        outline-offset: -8px;
        transition: outline-color .2s ease, background .2s ease;
      }
      #areadetrabajo:hover{ outline-color: rgba(124,58,237,.4); background: rgba(124,58,237,.05); }

      #componentes{
        padding: 18px;
        border-radius: var(--radius-xl);
      }
      .components-grid{
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      #componentes h3{
        margin: 0 0 12px 0;
        font-size: 14px;
        color: var(--muted);
        letter-spacing:.2px;
      }
      #componentes button{
        width:100%;
        border: 1px solid rgba(255,255,255,.08);
        background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: transform .06s ease, border-color .2s ease, background .2s ease;
        backdrop-filter: blur(2px);
      }
      #componentes button:hover{
        transform: translateY(-1px);
        border-color: rgba(124,58,237,.5);
        background: linear-gradient(180deg, rgba(124,58,237,.18), rgba(255,255,255,.02));
      }
      #componentes button:active{ transform: translateY(0); }

      /* Inputs inside work area */
      #areadetrabajo input{
        display:block;
        width:100%;
        margin: 10px 0;
        padding: 12px 14px;
        border-radius: 12px;
        background: #0d1530;
        border: 1px solid rgba(255,255,255,.08);
        color: var(--text);
        outline: none;
        transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
      }
      #areadetrabajo input:hover{
        border-color: rgba(255,255,255,.14);
      }
      #areadetrabajo input:focus{
        border-color: rgba(124,58,237,.7);
        box-shadow: 0 0 0 4px rgba(124,58,237,.18);
        background: #0f1a3b;
      }

      /* Actions + Result */
      .actions{
        display:flex; gap:12px; align-items:center; justify-content:flex-end;
        margin-top: 8px;
      }
      .btn{
        border: 1px solid rgba(255,255,255,.1);
        border-radius: 12px;
        padding: 10px 14px;
        background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
        color: var(--text);
        cursor:pointer;
        transition: transform .06s ease, border-color .2s ease, background .2s ease;
      }
      .btn:hover{
        transform: translateY(-1px);
        border-color: rgba(34,211,238,.6);
        background: linear-gradient(180deg, rgba(34,211,238,.16), rgba(255,255,255,.02));
      }
      .btn--primary{
        border-color: rgba(124,58,237,.6);
        background: linear-gradient(180deg, rgba(124,58,237,.35), rgba(124,58,237,.15));
      }
      .btn--primary:hover{
        background: linear-gradient(180deg, rgba(124,58,237,.5), rgba(124,58,237,.18));
      }

      .result-card{
        padding:16px;
      }
      .result-head{
        display:flex; align-items:center; justify-content:space-between; gap:12px;
        margin-bottom:8px;
      }
      .result-head h3{ margin:0; font-size: 14px; color: var(--muted); }
      .codewrap{
        position: relative;
        border: 1px solid rgba(255,255,255,.08);
        border-radius: 12px;
        background: #0b1224;
        padding: 12px;
        max-height: 320px;
        overflow: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 13px;
        line-height: 1.45;
        white-space: pre-wrap;
        word-break: break-word;
      }

      /* Tiny toast */
      .toast{
        position: fixed; bottom: 22px; right: 22px;
        background: #0f1a3b; color: var(--text);
        border:1px solid rgba(124,58,237,.5);
        border-radius: 12px; padding: 10px 14px;
        box-shadow: var(--shadow-2);
        opacity: 0; transform: translateY(8px);
        transition: opacity .2s ease, transform .2s ease;
        pointer-events: none;
      }
      .toast.show{ opacity:1; transform: translateY(0); }

      /* Responsive */
      @media (max-width: 980px){
        .wrapper{ grid-template-columns: 1fr; }
        #contenedor{ grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Diseñador de formularios</h1>
          <p class="subtitle">Clic en un componente para añadirlo. Se te pedirá id, class y name.</p>
        </div>
      </div>
    </header>

    <main class="wrapper">
      <!-- Panel principal -->
      <section class="card" style="padding: 20px;">
        <div id="contenedor" class="grid">
          <div id="areadetrabajo" class="card" aria-label="Área de trabajo (previsualización)">
            <!-- Inputs generados aparecerán aquí -->
          </div>
          <aside id="componentes" class="card">
            <h3>Componentes</h3>
            <div class="components-grid">
              <button value="text">Text</button>
              <button value="date">Date</button>
              <button value="password">Password</button>
              <button value="email">Email</button>
              <button value="number">Number</button>
              <button value="time">Time</button>
              <button value="datetime-local">Datetime-local</button>
              <button value="month">Month</button>
              <button value="week">Week</button>
              <button value="color">Color</button>
            </div>
          </aside>
        </div>

        <div class="actions">
          <button id="clear" class="btn" title="Vaciar el área de trabajo">Vaciar</button>
          <button id="html" class="btn btn--primary">Generar HTML</button>
        </div>
      </section>

      <!-- Resultado -->
      <section class="card result-card">
        <div class="result-head">
          <h3>HTML generado</h3>
          <div style="display:flex; gap:8px;">
            <button id="copy" class="btn" title="Copiar al portapapeles">Copiar</button>
          </div>
        </div>
        <div id="resultado" class="codewrap" aria-live="polite"></div>
      </section>
    </main>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
      const areadetrabajo = document.querySelector("#areadetrabajo");
      const componentes = document.querySelector("#componentes");
      const btnHTML = document.querySelector("#html");
      const btnCopy = document.querySelector("#copy");
      const btnClear = document.querySelector("#clear");
      const resultado = document.querySelector("#resultado");
      const toast = document.querySelector("#toast");

      function showToast(msg){
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 1600);
      }

      // Añadir componentes con prompts
      componentes.addEventListener("click", (e) => {
        if(e.target.tagName !== "BUTTON") return;
        const tipo = e.target.value;

        const identificador = prompt("Introduce el identificador único del elemento (id)", `${tipo}_${Math.random().toString(36).slice(2,6)}`) || "";
        const clase = prompt("Introduce la clase del elemento (class)", "campo") || "";
        const nombre = prompt("Introduce el nombre único del elemento (name)", identificador || tipo) || "";

        // Plantilla de input
        const input = document.createElement("input");
        input.type = tipo;
        if(identificador) input.id = identificador;
        if(clase) input.className = clase;
        if(nombre) input.name = nombre;
        input.placeholder = nombre || tipo;

        areadetrabajo.appendChild(input);
        input.scrollIntoView({ behavior: "smooth", block: "center" });
      });

      // Generar HTML
      btnHTML.addEventListener("click", () => {
        resultado.textContent = areadetrabajo.innerHTML.trim() || "<!-- vacío -->";
        showToast("HTML generado");
      });

      // Copiar al portapapeles
      btnCopy.addEventListener("click", async () => {
        const code = resultado.textContent;
        if(!code){ showToast("Nada que copiar"); return; }
        try{
          await navigator.clipboard.writeText(code);
          showToast("Copiado al portapapeles");
        }catch(err){
          showToast("No se pudo copiar");
        }
      });

      // Vaciar área de trabajo
      btnClear.addEventListener("click", () => {
        areadetrabajo.innerHTML = "";
        resultado.textContent = "";
        showToast("Área de trabajo vaciada");
      });
    </script>
  </body>
</html>
```

### mejora de funcionalidades

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Diseñador de formularios (Tema claro)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root{
        --bg: #f7fafc;            /* light background */
        --bg-soft: #ffffff;
        --card: #ffffff;
        --text: #0f172a;          /* slate-900 */
        --muted: #64748b;         /* slate-500 */
        --brand: #7c3aed;         /* violet-600 */
        --brand-2: #06b6d4;       /* cyan-500 */
        --line: #e5e7eb;          /* gray-200 */
        --ok: #10b981;            /* emerald-500 */
        --radius-xl: 18px;
        --radius-lg: 14px;
        --shadow-1: 0 10px 30px rgba(2, 6, 23, 0.08);
        --shadow-2: 0 6px 16px rgba(2, 6, 23, 0.06);
        --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      }

      *{ box-sizing: border-box; }
      html, body{ height:100%; }
      body{
        margin:0;
        font-family: var(--font);
        color: var(--text);
        background:
          radial-gradient(1000px 500px at -10% -10%, rgba(124,58,237,.08), transparent 60%),
          radial-gradient(1000px 500px at 110% -10%, rgba(6,182,212,.10), transparent 60%),
          var(--bg);
      }

      /* Header */
      header{
        padding: 24px clamp(16px, 4vw, 40px);
        border-bottom: 1px solid var(--line);
        background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
        position: sticky; top:0; z-index: 10;
      }
      .title{ display:flex; align-items:center; gap:14px; }
      .logo{
        width:40px; height:40px; border-radius:12px;
        background: conic-gradient(from 180deg, var(--brand), var(--brand-2), var(--brand));
        filter: saturate(1.05);
        box-shadow: var(--shadow-2);
      }
      h1{ margin:0; font-size: clamp(18px, 1.6vw, 24px); letter-spacing:.2px; }
      .subtitle{ margin:4px 0 0 54px; color: var(--muted); font-size: 14px; }

      /* Layout */
      .wrapper{
        padding: clamp(16px, 4vw, 40px);
        display:grid;
        
        gap: 24px;
        max-width: 1280px;
        margin: 0 auto;
      }

      .card{
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-1);
      }

      /* Work area + Components */
      #contenedor{
        display:grid;
        grid-template-columns: 2fr .8fr;
        gap: 20px;
      }

      #areadetrabajo{
        min-height: 360px;
        padding: 18px;
        border-radius: var(--radius-xl);
        border: 1px dashed #d1d5db;
        background: #fcfdff;
        transition: border-color .2s ease, background .2s ease;
      }
      #areadetrabajo:hover{ border-color: #c4b5fd; background: #ffffff; }

      #componentes{
        padding: 18px;
        border-radius: var(--radius-xl);
      }
      #componentes h3{
        margin: 0 0 12px 0;
        font-size: 14px;
        color: var(--muted);
        letter-spacing:.2px;
      }
      .components-grid{
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      #componentes button{
        width:100%;
        border: 1px solid var(--line);
        background: linear-gradient(180deg, #ffffff, #f8fafc);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: transform .06s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
      }
      #componentes button:hover{
        transform: translateY(-1px);
        border-color: #c4b5fd;
        box-shadow: 0 4px 14px rgba(124,58,237,.12);
        background: linear-gradient(180deg, #ffffff, #f1f5f9);
      }
      #componentes button:active{ transform: translateY(0); }

      /* Field block (label + input) */
      .field{
        display: inline-block;     /* permite ancho por porcentaje y flujo responsivo */
        vertical-align: top;
        padding: 8px;
        margin: 6px 6px 10px 0;
        background: #ffffff;
        border: 1px solid var(--line);
        border-radius: 12px;
        box-shadow: var(--shadow-2);
      }
      .field label{
        display:block;
        font-size: 13px;
        color: var(--muted);
        margin: 2px 0 6px 2px;
      }
      .field input{
        display:block;
        width:100%;
        margin: 0;
        padding: 10px 12px;
        border-radius: 10px;
        background: #f8fafc;
        border: 1px solid #e5e7eb;
        color: var(--text);
        outline: none;
        transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
      }
      .field input:hover{ border-color: #d1d5db; }
      .field input:focus{
        border-color: #7c3aed;
        box-shadow: 0 0 0 4px rgba(124,58,237,.15);
        background: #ffffff;
      }

      /* Actions + Result */
      .actions{
        display:flex; gap:12px; align-items:center; justify-content:flex-end;
        margin-top: 8px;
      }
      .btn{
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 10px 14px;
        background: linear-gradient(180deg, #ffffff, #f8fafc);
        color: var(--text);
        cursor:pointer;
        transition: transform .06s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
      }
      .btn:hover{
        transform: translateY(-1px);
        border-color: #06b6d4;
        box-shadow: 0 4px 14px rgba(6,182,212,.16);
        background: linear-gradient(180deg, #ffffff, #f1f5f9);
      }
      .btn--primary{
        border-color: #7c3aed;
        background: linear-gradient(180deg, #ffffff, #ede9fe);
      }
      .btn--primary:hover{
        box-shadow: 0 4px 14px rgba(124,58,237,.2);
        background: linear-gradient(180deg, #ffffff, #e9d5ff);
      }

      .result-card{ padding:16px; }
      .result-head{
        display:flex; align-items:center; justify-content:space-between; gap:12px;
        margin-bottom:8px;
      }
      .result-head h3{ margin:0; font-size: 14px; color: var(--muted); }

      .codewrap{
        position: relative;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: #ffffff;
        padding: 12px;
        max-height: 320px;
        overflow: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 13px;
        line-height: 1.45;
        white-space: pre-wrap;
        word-break: break-word;
      }

      /* Toast */
      .toast{
        position: fixed; bottom: 22px; right: 22px;
        background: #ffffff; color: var(--text);
        border:1px solid #c4b5fd;
        border-radius: 12px; padding: 10px 14px;
        box-shadow: var(--shadow-2);
        opacity: 0; transform: translateY(8px);
        transition: opacity .2s ease, transform .2s ease;
        pointer-events: none;
      }
      .toast.show{ opacity:1; transform: translateY(0); }

      /* Responsive */
      @media (max-width: 980px){
        .wrapper{ grid-template-columns: 1fr; }
        #contenedor{ grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Diseñador de formularios</h1>
          <p class="subtitle">Elige un componente y define id, class, name, label, placeholder y ancho (%)</p>
        </div>
      </div>
    </header>

    <main class="wrapper">
      <!-- Panel principal -->
      <section class="card" style="padding: 20px;">
        <div id="contenedor" class="grid">
          <div id="areadetrabajo" class="card" aria-label="Área de trabajo (previsualización)">
            <!-- Bloques .field aparecerán aquí -->
          </div>

          <aside id="componentes" class="card">
            <h3>Componentes</h3>
            <div class="components-grid">
              <button value="text">Text</button>
              <button value="date">Date</button>
              <button value="password">Password</button>
              <button value="email">Email</button>
              <button value="number">Number</button>
              <button value="time">Time</button>
              <button value="datetime-local">Datetime-local</button>
              <button value="month">Month</button>
              <button value="week">Week</button>
              <button value="color">Color</button>
            </div>
          </aside>
        </div>

        <div class="actions">
          <button id="clear" class="btn" title="Vaciar el área de trabajo">Vaciar</button>
          <button id="html" class="btn btn--primary">Generar HTML</button>
        </div>
      </section>

      <!-- Resultado -->
      <section class="card result-card">
        <div class="result-head">
          <h3>HTML generado</h3>
          <div style="display:flex; gap:8px;">
            <button id="copy" class="btn" title="Copiar al portapapeles">Copiar</button>
          </div>
        </div>
        <div id="resultado" class="codewrap" aria-live="polite"></div>
      </section>
    </main>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
      const areadetrabajo = document.querySelector("#areadetrabajo");
      const componentes = document.querySelector("#componentes");
      const btnHTML = document.querySelector("#html");
      const btnCopy = document.querySelector("#copy");
      const btnClear = document.querySelector("#clear");
      const resultado = document.querySelector("#resultado");
      const toast = document.querySelector("#toast");

      function showToast(msg){
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 1600);
      }

      function sanitizePercent(value, fallback = 100){
        const n = parseFloat(String(value).replace(',', '.'));
        if (Number.isFinite(n) && n > 0 && n <= 100) return n;
        return fallback;
      }

      // Crea un bloque .field con label + input
      function createField({tipo, id, clase, nombre, etiqueta, placeholder, anchoPct}){
        // Contenedor
        const field = document.createElement("div");
        field.className = "field";
        field.style.width = `${anchoPct}%`;

        // Label
        const label = document.createElement("label");
        label.htmlFor = id || nombre || tipo;
        label.textContent = etiqueta || nombre || tipo;

        // Input
        const input = document.createElement("input");
        input.type = tipo;
        input.id = id || nombre || `${tipo}_${Math.random().toString(36).slice(2,6)}`;
        if (clase) input.className = clase;
        input.name = nombre || input.id;
        if (placeholder) input.placeholder = placeholder;

        // Estructura
        field.appendChild(label);
        field.appendChild(input);
        return field;
      }

      // Añadir componentes con prompts extendidos
      componentes.addEventListener("click", (e) => {
        if(e.target.tagName !== "BUTTON") return;
        const tipo = e.target.value;

        const id = prompt("Introduce el identificador único (id)", `${tipo}_${Math.random().toString(36).slice(2,6)}`) || "";
        const clase = prompt("Introduce la clase (class)", "campo") || "";
        const nombre = prompt("Introduce el nombre (name)", id || tipo) || "";
        const etiqueta = prompt("Texto de la etiqueta (label)", nombre || tipo) || "";
        const placeholder = prompt("Placeholder (opcional)", "") || "";
        const anchoStr = prompt("Ancho del control en % (1-100)", "100") || "100";
        const anchoPct = sanitizePercent(anchoStr, 100);

        const field = createField({tipo, id, clase, nombre, etiqueta, placeholder, anchoPct});
        areadetrabajo.appendChild(field);
        field.scrollIntoView({ behavior: "smooth", block: "center" });
      });

      // Generar HTML (tal como está en el área de trabajo)
      btnHTML.addEventListener("click", () => {
        // Exporta solo el HTML de los hijos del área de trabajo
        resultado.textContent = areadetrabajo.innerHTML.trim() || "<!-- vacío -->";
        showToast("HTML generado");
      });

      // Copiar al portapapeles
      btnCopy.addEventListener("click", async () => {
        const code = resultado.textContent;
        if(!code){ showToast("Nada que copiar"); return; }
        try{
          await navigator.clipboard.writeText(code);
          showToast("Copiado al portapapeles");
        }catch(err){
          showToast("No se pudo copiar");
        }
      });

      // Vaciar área de trabajo
      btnClear.addEventListener("click", () => {
        areadetrabajo.innerHTML = "";
        resultado.textContent = "";
        showToast("Área de trabajo vaciada");
      });
    </script>
  </body>
</html>
```

<a id="lenguajes-descriptivos-para-la-definicion-de-interfaces"></a>
## Lenguajes descriptivos para la definición de interfaces

En la actualidad, los lenguajes descriptivos para la definición de interfaces de usuario (UI) representan una evolución significativa en cómo se crean aplicaciones. Estos lenguajes permiten a los desarrolladores describir el aspecto y el comportamiento de las interfaces sin necesidad de escribir código detallado, lo que facilita el diseño y la implementación de interfaces gráficas intuitivas y eficientes.

Uno de los lenguajes descriptivos más populares para definir interfaces de usuario es **Figma**. Figma es una herramienta en línea que permite a los diseñadores crear prototipos interactivos y colaborativos de interfaces de usuario. Con Figma, puedes dibujar componentes visuales, establecer relaciones entre ellos y añadir interacciones simples directamente desde la interfaz gráfica. La capacidad de compartir proyectos en tiempo real con otros miembros del equipo es una ventaja significativa, ya que permite un trabajo colaborativo eficiente.

Otro lenguaje descriptivo que merece mencionar es **Adobe XD**. Similar a Figma, Adobe XD ofrece herramientas avanzadas para el diseño y prototipado de interfaces de usuario. Permite crear diseños responsivos y animaciones interactivas con facilidad. La integración con otros productos de la suite Adobe como Photoshop y Illustrator facilita el flujo de trabajo entre diferentes disciplinas del equipo.

En el ámbito de los lenguajes descriptivos, también hay opciones más formales basadas en texto que permiten una mayor precisión y control sobre el diseño. **Sketch** es uno de estos sistemas. Aunque no es completamente visual como Figma o Adobe XD, Sketch permite a los diseñadores crear interfaces de usuario utilizando un lenguaje de descripción textual. Esto puede ser especialmente útil para proyectos donde la documentación detallada del diseño es crucial.

Otro enfoque basado en texto es **React Native Paper**. Aunque no es un lenguaje descriptivo tradicional, React Native Paper ofrece una biblioteca de componentes visuales que siguen las guías de Material Design. Permite a los desarrolladores crear interfaces de usuario modernas y consistentes utilizando JSX, lo que combina la facilidad de uso de Figma o Adobe XD con el poder del código.

La elección del lenguaje descriptivo para definir interfaces de usuario depende en gran medida de las necesidades específicas del proyecto y del equipo de desarrollo. Algunos proyectos pueden beneficiarse más de herramientas visuales como Figma, mientras que otros pueden preferir la precisión y control ofrecidos por sistemas basados en texto como Sketch o React Native Paper.

En cualquier caso, los lenguajes descriptivos para la definición de interfaces de usuario representan una evolución importante en el campo del desarrollo de software. Permiten a los diseñadores y desarrolladores trabajar juntos de manera más eficiente y crear interfaces de usuario que sean no solo funcionales, sino también atractivas y intuitivas para los usuarios finales.

### componente basico

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      
    </style>
  </head>
  <body>
    <input type="text">
  </body>
</html>
```

### aplico estilo

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      .jvinput{
        padding:5px;
        border:1px solid grey;
        outline:none;
        text-align:center;
        border-top:0px solid grey;
        border-left:1px solid grey;
        border-right:1px solid grey;
        border-bottom:0px solid grey;
        border-radius:5px;
      }
    </style>
  </head>
  <body>
    <input type="text" class="jvinput">
  </body>
</html>
```

### animar control

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      body{
        text-align:center;
      }
      .jvinput{
        padding:5px;
        border:1px solid grey;
        outline:none;
        text-align:center;
        border-top:0px solid grey;
        border-left:1px solid grey;
        border-right:1px solid grey;
        border-bottom:0px solid grey;
        border-radius:5px;
        animation:expande 1s;
        animation-delay:3s;
        animation-iteration-count:1;
        animation-fill-mode:forwards;
        width:0px;
        height:0px;
        padding:0px;
        font-family:monospace;
      }
      @keyframes expande{
        0%{width:0px;height:0px;}
        50%{width:0px;height:20px;}
        100%{width:100px;height:20px;}
      }
    </style>
  </head>
  <body>
    <input type="text" class="jvinput">
  </body>
</html>
```

### propiedades y sombras

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      
      .jvinput{
        padding:5px;
        border:1px solid grey;
        outline:none;
        text-align:center;
        border-top:0px solid grey;
        border-left:1px solid grey;
        border-right:1px solid grey;
        border-bottom:0px solid grey;
        border-radius:5px;
        animation:expande 1s;
        animation-delay:3s;
        animation-iteration-count:1;
        animation-fill-mode:forwards;
        width:0px;
        height:0px;
        padding:0px;
        font-family:monospace;
        text-shadow:0px 1px 2px rgba(0,0,0,0.4);
        background:rgb(250,250,250);
        font-size:10px;
        box-shadow:0px 2px 6px rgba(0,0,0,0.1) inset;
      }
      @keyframes expande{
        0%{width:0px;height:0px;}
        50%{width:0px;height:20px;}
        100%{width:100px;height:20px;}
      }
    </style>
  </head>
  <body>
    <input type="text" class="jvinput">
  </body>
</html>
```

### centrar siempre

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      
      .jvinput{
        padding:5px;
        border:1px solid grey;
        outline:none;
        text-align:center;
        border-top:0px solid grey;
        border-left:1px solid grey;
        border-right:1px solid grey;
        border-bottom:0px solid grey;
        border-radius:5px;
        animation:expande 1s;
        animation-delay:3s;
        animation-iteration-count:1;
        animation-fill-mode:forwards;
        width:0px;
        height:0px;
        padding:0px;
        font-family:monospace;
        text-shadow:0px 1px 2px rgba(0,0,0,0.4);
        background:rgb(250,250,250);
        font-size:10px;
        box-shadow:0px 2px 6px rgba(0,0,0,0.1) inset;
      }
      @keyframes expande{
        0%{width:0px;height:0px;margin-left:50px;margin-right:50px;}
        50%{width:0px;height:20px;margin-left:50px;margin-right:50px;}
        100%{width:100px;height:20px;margin-left:0px;margin-right:0px;}
      }
    </style>
  </head>
  <body>
    <input type="text" class="jvinput" placeholder="nombre">
    <input type="text" class="jvinput" placeholder="apellidos">
    <input type="text" class="jvinput" placeholder="telefono">
    <input type="text" class="jvinput" placeholder="direccion">
    <input type="text" class="jvinput" placeholder="email">
 
  </body>
</html>
```

### js para componentes

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      .jvinput{
        padding:5px;
        border:1px solid grey;
        outline:none;
        text-align:center;
        border-top:0px solid grey;
        border-left:1px solid grey;
        border-right:1px solid grey;
        border-bottom:0px solid grey;
        border-radius:5px;
        animation:expande 1s;
       
        animation-iteration-count:1;
        animation-fill-mode:forwards;
        width:0px;
        height:0px;
        padding:0px;
        font-family:monospace;
        text-shadow:0px 1px 2px rgba(0,0,0,0.4);
        background:rgb(250,250,250);
        font-size:10px;
        box-shadow:0px 2px 6px rgba(0,0,0,0.1) inset;
        
      }
      @keyframes expande{
        0%{width:0px;height:0px;margin-left:50px;margin-right:50px;}
        50%{width:0px;height:20px;margin-left:50px;margin-right:50px;}
        100%{width:100px;height:20px;margin-left:0px;margin-right:0px;}
      }
    </style>
  </head>
  <body>
    <input type="text" class="jvinput" placeholder="nombre">
    <input type="text" class="jvinput" placeholder="apellidos">
    <input type="text" class="jvinput" placeholder="telefono">
    <input type="text" class="jvinput" placeholder="direccion">
    <input type="text" class="jvinput" placeholder="email">
 <script>
 let tiempo = 0;
  let elementos = document.querySelectorAll(".jvinput")
  elementos.forEach(function(elemento){
  elemento.style.color = "red"
    elemento.style.animationDelay = tiempo+"s"
    tiempo += 1
  })
 </script>
  </body>
</html>
```

<a id="componentes-caracteristicas-y-campo-de-aplicacion"></a>
## Componentes características y campo de aplicación

En el mundo digital actual, las interfaces de usuario (UI) son esenciales para la interacción entre los usuarios y los sistemas informáticos. Una interfaz de usuario bien diseñada no solo facilita la navegación y el uso del software, sino que también puede mejorar significativamente la experiencia del usuario final.

Los componentes son los elementos individuales que componen una interfaz de usuario. Cada componente tiene características específicas que lo definen y determinan su funcionalidad dentro del sistema. Por ejemplo, un botón es un componente que permite a los usuarios realizar acciones como enviar un formulario o navegar entre páginas.

El campo de aplicación de cada componente depende de la funcionalidad específica que se desea implementar. Un botón puede estar diseñado para enviar datos, mientras que una caja de texto puede ser utilizada para ingresar información. Cada uno de estos componentes tiene propiedades y atributos que lo caracterizan, como su tamaño, color, tipo de fuente y estado (activo o inactivo).

La elección y el diseño de los componentes adecuados son cruciales para crear una interfaz de usuario eficiente y atractiva. Los desarrolladores deben considerar la funcionalidad necesaria, la experiencia del usuario y las restricciones técnicas al seleccionar los componentes que utilizarán en su aplicación.

Además de sus características visuales, los componentes también pueden interactuar con el código subyacente del sistema. Por ejemplo, un botón puede estar asociado a una función que se ejecuta cuando es presionado, lo que permite realizar acciones complejas y personalizadas según la necesidad del usuario.

La documentación detallada de cada componente es fundamental para su uso en proyectos de desarrollo. Los desarrolladores deben proporcionar información sobre cómo utilizar los componentes, sus propiedades y métodos disponibles, así como ejemplos prácticos de su implementación. Esta documentación facilita el trabajo en equipo y asegura que todos estén alineados con la misma comprensión del componente.

La adaptabilidad es una característica importante de los componentes de interfaz de usuario. Los componentes deben ser capaces de funcionar en diferentes contextos y plataformas, desde aplicaciones web hasta dispositivos móviles. Esto requiere un diseño flexible que permita la personalización y el ajuste según las necesidades específicas del proyecto.

En conclusión, los componentes son los pilares fundamentales de cualquier interfaz de usuario. Cada uno de ellos tiene características únicas y un campo de aplicación específico, lo que los hace esenciales para crear experiencias de usuario eficientes y atractivas. La elección, diseño y documentación adecuados de los componentes son cruciales para el éxito del proyecto y la satisfacción del usuario final.

<a id="enlace-de-componentes-a-origenes-de-datos"></a>
## Enlace de componentes a orígenes de datos

En el desarrollo de interfaces de usuario (UI), un componente es una unidad funcional que puede ser reutilizada dentro de la aplicación. Estos componentes pueden ser botones, cajas de texto, etiquetas o incluso otras interfaces más complejas. La capacidad de enlazar estos componentes a orígenes de datos es fundamental para que la interfaz interactúe con el mundo exterior y muestre información relevante al usuario.

Para enlazar un componente a un origen de datos, primero se debe definir cómo el componente obtendrá su información. Esto puede implicar establecer conexiones a bases de datos, leer archivos o incluso consumir servicios web. Una vez que se ha configurado la fuente de datos, el componente necesita saber qué información mostrar y cómo actualizarla cuando cambia.

La mayoría de las herramientas modernas para el desarrollo de interfaces proporcionan mecanismos integrados para enlazar componentes a orígenes de datos. Estos mecanismos pueden variar según la plataforma o el lenguaje de programación, pero generalmente implican configurar propiedades específicas del componente que apunten al origen de datos deseado.

Por ejemplo, si estamos trabajando con un componente de texto en una interfaz gráfica, podemos establecer su propiedad `Text` para que muestre el contenido de una columna específica de una base de datos. Cuando la información en la base de datos cambia, el componente también se actualizará automáticamente.

Además de mostrar información, los componentes a menudo deben permitir al usuario modificarla. En estos casos, es necesario configurar eventos o métodos que actualicen el origen de datos cuando el usuario realiza cambios en la interfaz. Por ejemplo, si un usuario ingresa texto en una caja de texto y luego presiona un botón "Guardar", el componente debe enviar esa información a la base de datos para su almacenamiento.

Es importante tener en cuenta que el enlace entre componentes y orígenes de datos no es solo una cuestión técnica. También implica consideraciones de seguridad, como garantizar que los usuarios solo puedan acceder a la información a la que tienen permiso y proteger contra accesos no autorizados.

En resumen, el enlace de componentes a orígenes de datos es un paso crucial en el desarrollo de interfaces de usuario. Permite que las aplicaciones interactúen con el mundo exterior, mostrando información relevante y permitiendo la modificación de esa información por parte del usuario. A través de configuraciones específicas y eventos adecuados, los componentes pueden mantenerse sincronizados con sus fuentes de datos, proporcionando una experiencia de usuario fluida y responsive.

### json inicial

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
      clientes = [
          {
            "id": 1,
            "nombre": "Laura Gómez",
            "email": "laura.gomez@example.com",
            "telefono": "+34 612 345 678",
            "direccion": {
              "calle": "Calle Mayor 12",
              "ciudad": "Valencia",
              "cp": "46001",
              "pais": "España"
            },
            "fecha_alta": "2023-05-14",
            "activo": true
          },
          {
            "id": 2,
            "nombre": "Carlos Martínez",
            "email": "carlos.martinez@example.com",
            "telefono": "+34 698 765 432",
            "direccion": {
              "calle": "Avenida de la Constitución 45",
              "ciudad": "Madrid",
              "cp": "28001",
              "pais": "España"
            },
            "fecha_alta": "2024-01-20",
            "activo": false
          },
          {
            "id": 3,
            "nombre": "Ana Torres",
            "email": "ana.torres@example.com",
            "telefono": "+34 634 112 233",
            "direccion": {
              "calle": "Plaza del Carmen 7",
              "ciudad": "Sevilla",
              "cp": "41003",
              "pais": "España"
            },
            "fecha_alta": "2022-11-03",
            "activo": true
          },
          {
            "id": 4,
            "nombre": "David López",
            "email": "david.lopez@example.com",
            "telefono": "+34 622 987 654",
            "direccion": {
              "calle": "Carrer de la Pau 30",
              "ciudad": "Barcelona",
              "cp": "08002",
              "pais": "España"
            },
            "fecha_alta": "2024-07-08",
            "activo": true
          },
          {
            "id": 5,
            "nombre": "María Fernández",
            "email": "maria.fernandez@example.com",
            "telefono": "+34 655 443 221",
            "direccion": {
              "calle": "Camino Viejo 15",
              "ciudad": "Bilbao",
              "cp": "48005",
              "pais": "España"
            },
            "fecha_alta": "2023-03-25",
            "activo": false
          }
        ]

    </style>
  </head>
  <body>
    <table></table>
    <script>
      let table = document.querySelector("table")
    </script>
  </body>
</html>
```

### tomo el primer elemento del json

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
     
    </style>
  </head>
  <body>
    <table></table>
    <script>
     clientes = [
          {
            "id": 1,
            "nombre": "Laura Gómez",
            "email": "laura.gomez@example.com",
            "telefono": "+34 612 345 678",
            "direccion": {
              "calle": "Calle Mayor 12",
              "ciudad": "Valencia",
              "cp": "46001",
              "pais": "España"
            },
            "fecha_alta": "2023-05-14",
            "activo": true
          },
          {
            "id": 2,
            "nombre": "Carlos Martínez",
            "email": "carlos.martinez@example.com",
            "telefono": "+34 698 765 432",
            "direccion": {
              "calle": "Avenida de la Constitución 45",
              "ciudad": "Madrid",
              "cp": "28001",
              "pais": "España"
            },
            "fecha_alta": "2024-01-20",
            "activo": false
          },
          {
            "id": 3,
            "nombre": "Ana Torres",
            "email": "ana.torres@example.com",
            "telefono": "+34 634 112 233",
            "direccion": {
              "calle": "Plaza del Carmen 7",
              "ciudad": "Sevilla",
              "cp": "41003",
              "pais": "España"
            },
            "fecha_alta": "2022-11-03",
            "activo": true
          },
          {
            "id": 4,
            "nombre": "David López",
            "email": "david.lopez@example.com",
            "telefono": "+34 622 987 654",
            "direccion": {
              "calle": "Carrer de la Pau 30",
              "ciudad": "Barcelona",
              "cp": "08002",
              "pais": "España"
            },
            "fecha_alta": "2024-07-08",
            "activo": true
          },
          {
            "id": 5,
            "nombre": "María Fernández",
            "email": "maria.fernandez@example.com",
            "telefono": "+34 655 443 221",
            "direccion": {
              "calle": "Camino Viejo 15",
              "ciudad": "Bilbao",
              "cp": "48005",
              "pais": "España"
            },
            "fecha_alta": "2023-03-25",
            "activo": false
          }
        ]

      let tabla = document.querySelector("table")
      let primerelemento = clientes[0]
      let claves = Object.keys(primerelemento)
      
      cadena = "<tr>";
      claves.forEach(function(clave){
        cadena += "<th>"+clave+"</th>";
      })
      cadena += "</tr>";
      tabla.innerHTML = cadena;
    </script>
  </body>
</html>
```

### poblar los datos

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Estilizar</title>
    <style>
     body {
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f9f9f9;
      padding: 40px;
    }

    table {
      width: 80%;
      margin: auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
    }

    th {
      background: #4CAF50;
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    tr:nth-child(even) {
      background: #f2f2f2;
    }

    tr:hover {
      background: #eafaf1;
    }

    td {
      color: #333;
    }
    </style>
  </head>
  <body>
    <table></table>
    <script>
     clientes = [
          {
            "id": 1,
            "nombre": "Laura Gómez",
            "email": "laura.gomez@example.com",
            "telefono": "+34 612 345 678",
            "fecha_alta": "2023-05-14",
            "activo": true
          },
          {
            "id": 2,
            "nombre": "Carlos Martínez",
            "email": "carlos.martinez@example.com",
            "telefono": "+34 698 765 432",
          
            "fecha_alta": "2024-01-20",
            "activo": false
          },
          {
            "id": 3,
            "nombre": "Ana Torres",
            "email": "ana.torres@example.com",
            "telefono": "+34 634 112 233",
            
            "fecha_alta": "2022-11-03",
            "activo": true
          },
          {
            "id": 4,
            "nombre": "David López",
            "email": "david.lopez@example.com",
            "telefono": "+34 622 987 654",
            
            "fecha_alta": "2024-07-08",
            "activo": true
          },
          {
            "id": 5,
            "nombre": "María Fernández",
            "email": "maria.fernandez@example.com",
            "telefono": "+34 655 443 221",
            
            "fecha_alta": "2023-03-25",
            "activo": false
          }
        ]

      let tabla = document.querySelector("table")
      let primerelemento = clientes[0]
      let claves = Object.keys(primerelemento)
      
      cadena = "<tr>";
      claves.forEach(function(clave){
        cadena += "<th>"+clave+"</th>";
      })
      cadena += "</tr>";
      clientes.forEach(function(cliente){
        cadena += "<tr>";
        for(let clave in cliente){
          cadena += "<td>"+cliente[clave]+"</td>"
        }
        cadena += "</tr>";
      })
      tabla.innerHTML = cadena;
    </script>
  </body>
</html>
```

<a id="asociacion-de-acciones-a-eventos"></a>
## Asociación de acciones a eventos

En el desarrollo de interfaces de usuario (UI), una de las habilidades más cruciales es la asociación de acciones a eventos. Esta técnica permite que los usuarios interactúen con la aplicación respondiendo a diferentes tipos de eventos, como clics de botones, pulsaciones de teclas o movimientos del mouse.

Los eventos son ocurrencias específicas dentro de una interfaz gráfica que pueden ser detectados y respondidos por el programa. Por ejemplo, cuando un usuario hace clic en un botón, se produce un evento de tipo "click". El programador debe asociar una acción específica a este evento para que la aplicación responda adecuadamente.

Para asociar acciones a eventos, los desarrolladores utilizan bibliotecas y frameworks específicos del lenguaje de programación o el entorno gráfico. Estas herramientas proporcionan métodos y funciones que permiten vincular un método o función al evento deseado. Por ejemplo, en Java Swing, se puede asociar una acción a un botón utilizando el método `addActionListener`.

La asociación de acciones a eventos es fundamental para crear interfaces interactivas y dinámicas. Permite a los usuarios realizar tareas específicas dentro de la aplicación respondiendo a sus acciones. Además, facilita la implementación de funcionalidades complejas como validaciones de entrada, actualizaciones de estado o transiciones entre pantallas.

Es importante destacar que la asociación de eventos no solo se limita a acciones visuales, sino también a otras interacciones más sutiles. Por ejemplo, en aplicaciones web, los eventos pueden ser desencadenados por el movimiento del mouse sobre un elemento, el cambio de valor en un campo de entrada o incluso el envío de una solicitud AJAX.

Además de la asociación de acciones a eventos, es crucial considerar la eficiencia y la seguridad de estas interacciones. Un buen diseño debe garantizar que las acciones asociadas a los eventos sean rápidas y seguras, evitando posibles problemas como pérdidas de datos o comportamientos inesperados.

En resumen, la asociación de acciones a eventos es una habilidad esencial en el desarrollo de interfaces de usuario. Permite crear aplicaciones interactivas y dinámicas que respondan eficazmente a las acciones del usuario, mejorando así la experiencia del usuario final.

<a id="edicion-del-codigo-generado-por-la-herramienta-de-diseno"></a>
## Edición del código generado por la herramienta de diseño

Después de generar una interfaz de usuario con una herramienta de diseño gráfico, el siguiente paso es editar el código generado automáticamente para personalizar aún más la aplicación. Esta edición puede implicar modificar propiedades, atributos y métodos de los componentes generados por la herramienta. Por ejemplo, si se ha creado un botón en la interfaz, podemos cambiar su texto o su tamaño a través del editor de código. Además, es común asociar acciones específicas a eventos como clics o cambios de estado. Esto se logra mediante el enlace de métodos o funciones al evento correspondiente, permitiendo una interacción más rica y personalizada con el usuario.

El proceso de edición también puede incluir la creación de nuevas clases o componentes si las herramientas disponibles no ofrecen todas las funcionalidades necesarias. En este caso, se debe escribir código adicional que interactúe con los elementos existentes para implementar las nuevas características deseadas. Es importante mantener una buena estructura y organización del código durante esta etapa, utilizando buenas prácticas de programación para facilitar la mantenibilidad y el depurado.

Además de modificar propiedades y métodos, también es posible reemplazar componentes existentes por otros más adecuados o personalizados. Esto puede implicar eliminar el componente original y agregar uno nuevo, ajustando su posición y tamaño según sea necesario. Es crucial mantener la consistencia visual y funcional entre los diferentes componentes de la interfaz.

La edición del código generado también permite realizar pruebas manuales para asegurar que las modificaciones no hayan introducido errores o comportamientos inesperados. Esto puede implicar interactuar con la aplicación, verificar el funcionamiento de los nuevos componentes y comprobar que las acciones asociadas a eventos siguen siendo correctas. Es importante documentar todos los cambios realizados durante este proceso para facilitar futuras modificaciones o reparaciones.

Al finalizar la edición del código generado, es necesario probar la aplicación en su totalidad para asegurar que todas las funcionalidades estén trabajando correctamente juntas. Esto puede implicar ejecutar pruebas de integración y de sistema para verificar que los diferentes componentes interactúen como se espera. Además, es recomendable realizar pruebas de seguridad para asegurar que la aplicación no tenga vulnerabilidades potenciales.

La distribución final de la aplicación también requiere una buena documentación. Esto puede implicar crear ficheros de ayuda o tutoriales que expliquen cómo usar la interfaz y las funcionalidades principales. Es importante proporcionar suficiente información para que los usuarios puedan utilizar la aplicación sin problemas, incluso si no son expertos en programación.

En resumen, la edición del código generado por una herramienta de diseño gráfico es un paso crucial en el proceso de desarrollo de interfaces de usuario. Permite personalizar y mejorar la funcionalidad de la aplicación, pero también requiere cuidado y atención para mantener la consistencia visual y funcional entre los diferentes componentes. La documentación adecuada es fundamental para facilitar la utilización y mantenimiento de la interfaz final.

### grafica

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    
  </body>
</html>
```

### primera grafica

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Valor</th>
          <th>Gráfica</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>15</td>
          <td><div class="barra" style="width:15px;"></div></td>
        </tr>
        <tr>
          <td>25</td>
          <td><div class="barra" style="width:25px;"></div></td>
        </tr>
        <tr>
          <td>125</td>
          <td><div class="barra" style="width:125px;"></div></td>
        </tr>
        <tr>
          <td>45</td>
          <td><div class="barra" style="width:45px;"></div></td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
```

### estilo de la barra

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      table{
        font-family:sans-serif;
      }
      table td:first-child{
        text-align:right;
      }
      .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Valor</th>
          <th>Gráfica</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>150</td>
          <td><div class="barra" style="width:150px;">Etiqueta 1</div></td>
        </tr>
        <tr>
          <td>250</td>
          <td><div class="barra" style="width:250px;">Etiqueta 2</div></td>
        </tr>
        <tr>
          <td>170</td>
          <td><div class="barra" style="width:170px;">Etiqueta 3</div></td>
        </tr>
        <tr>
          <td>450</td>
          <td><div class="barra" style="width:450px;">Etiqueta 4</div></td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
```

### empiezo a encapsular

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      table{
        font-family:sans-serif;
      }
      table td:first-child{
        text-align:right;
      }
      .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Valor</th>
          <th>Gráfica</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>150</td>
          <td><div class="barra" style="width:150px;">Etiqueta 1</div></td>
        </tr>
        <tr>
          <td>250</td>
          <td><div class="barra" style="width:250px;">Etiqueta 2</div></td>
        </tr>
        <tr>
          <td>170</td>
          <td><div class="barra" style="width:170px;">Etiqueta 3</div></td>
        </tr>
        <tr>
          <td>450</td>
          <td><div class="barra" style="width:450px;">Etiqueta 4</div></td>
        </tr>
      </tbody>
    </table>
    <div class="grafica"></div>
    <script>
      
      let grafica = document.querySelector(".grafica");
      let tabla = document.createElement("table");
      grafica.appendChild(tabla)
      let cabecera = document.createElement("thead");
      tabla.appendChild(cabecera)
      let filacabecera = document.createElement("tr");
      cabecera.appendChild(filacabecera)
      filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
      let cuerpo = document.createElement("tbody");
      cuerpo.appendChild(cabecera);
      
      
    </script>
  </body>
</html>
```

### creo un objeto de datos

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      table{
        font-family:sans-serif;
      }
      table td:first-child{
        text-align:right;
      }
      .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    
    <div class="grafica"></div>
    <script>
      let datos = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let grafica = document.querySelector(".grafica");
      
      let tabla = document.createElement("table");
      grafica.appendChild(tabla)
      
      let cabecera = document.createElement("thead");
      tabla.appendChild(cabecera)
      
      let filacabecera = document.createElement("tr");
      filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
      cabecera.appendChild(filacabecera)
      
      let cuerpo = document.createElement("tbody");
      tabla.appendChild(cuerpo);
      
      datos.forEach(function(dato){
      console.log("hola")
     
        let fila = document.createElement("tr")
        cuerpo.appendChild(fila);
         
        let valor = document.createElement("td")
        valor.textContent = dato.Valor
        fila.appendChild(valor)
        
        let contienebarra = document.createElement("td")
        let barra = document.createElement("div")
        barra.classList.add("barra")
        barra.textContent = dato.Etiqueta
        barra.style.width = dato.Valor+"px"
        contienebarra.appendChild(barra)
        
        fila.appendChild(contienebarra)
        
      })
      
    </script>
  </body>
</html>
```

### encapsulo en funcion

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      table{
        font-family:sans-serif;
      }
      table td:first-child{
        text-align:right;
      }
      .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    
    <div class="grafica"></div>
    <script>
      let datos = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      
      function graficaBarras(selector,misdatos){
      
        let grafica = document.querySelector(selector);
        
        let tabla = document.createElement("table");
        grafica.appendChild(tabla)
        
        let cabecera = document.createElement("thead");
        tabla.appendChild(cabecera)
        
        let filacabecera = document.createElement("tr");
        filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
        cabecera.appendChild(filacabecera)
        
        let cuerpo = document.createElement("tbody");
        tabla.appendChild(cuerpo);
        
        datos.forEach(function(dato){
        console.log("hola")
       
          let fila = document.createElement("tr")
          cuerpo.appendChild(fila);
           
          let valor = document.createElement("td")
          valor.textContent = dato.Valor
          fila.appendChild(valor)
          
          let contienebarra = document.createElement("td")
          let barra = document.createElement("div")
          barra.classList.add("barra")
          barra.textContent = dato.Etiqueta
          barra.style.width = dato.Valor+"px"
          contienebarra.appendChild(barra)
          
          fila.appendChild(contienebarra)
          
        })
      }
      
      graficaBarras(".grafica",datos)
    </script>
  </body>
</html>
```

### mas origenes de datos

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      table{
        font-family:sans-serif;
      }
      table td:first-child{
        text-align:right;
      }
      .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      function graficaBarras(selector,misdatos){
      
        let grafica = document.querySelector(selector);
        
        let tabla = document.createElement("table");
        grafica.appendChild(tabla)
        
        let cabecera = document.createElement("thead");
        tabla.appendChild(cabecera)
        
        let filacabecera = document.createElement("tr");
        filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
        cabecera.appendChild(filacabecera)
        
        let cuerpo = document.createElement("tbody");
        tabla.appendChild(cuerpo);
        
        misdatos.forEach(function(dato){
        console.log("hola")
       
          let fila = document.createElement("tr")
          cuerpo.appendChild(fila);
           
          let valor = document.createElement("td")
          valor.textContent = dato.Valor
          fila.appendChild(valor)
          
          let contienebarra = document.createElement("td")
          let barra = document.createElement("div")
          barra.classList.add("barra")
          barra.textContent = dato.Etiqueta
          barra.style.width = dato.Valor+"px"
          contienebarra.appendChild(barra)
          
          fila.appendChild(contienebarra)
          
        })
      }
      
      graficaBarras(".grafica1",datos1)
      graficaBarras(".grafica2",datos2)
      graficaBarras(".grafica3",datos3)
      graficaBarras(".grafica4",datos4)
    </script>
  </body>
</html>
```

### y si le pongo color

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      table{
        font-family:sans-serif;
      }
      table td:first-child{
        text-align:right;
      }
      .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      function graficaBarras(selector,misdatos,color){
      
        let grafica = document.querySelector(selector);
        
        let tabla = document.createElement("table");
        grafica.appendChild(tabla)
        
        let cabecera = document.createElement("thead");
        tabla.appendChild(cabecera)
        
        let filacabecera = document.createElement("tr");
        filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
        cabecera.appendChild(filacabecera)
        
        let cuerpo = document.createElement("tbody");
        tabla.appendChild(cuerpo);
        
        misdatos.forEach(function(dato){
        console.log("hola")
       
          let fila = document.createElement("tr")
          cuerpo.appendChild(fila);
           
          let valor = document.createElement("td")
          valor.textContent = dato.Valor
          fila.appendChild(valor)
          
          let contienebarra = document.createElement("td")
          let barra = document.createElement("div")
          barra.classList.add("barra")
          barra.textContent = dato.Etiqueta
          barra.style.width = dato.Valor+"px"
          barra.style.backgroundColor = color
          contienebarra.appendChild(barra)
          
          fila.appendChild(contienebarra)
          
        })
      }
      
      graficaBarras(".grafica1",datos1,"red")
      graficaBarras(".grafica2",datos2,"blue")
      graficaBarras(".grafica3",datos3,"green")
      graficaBarras(".grafica4",datos4,"pink")
    </script>
  </body>
</html>
```

### en cierta forma un espacio de nombrs

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      .jvgraficabarras{
        font-family:sans-serif;
      }
      .jvgraficabarras td:first-child{
        text-align:right;
      }
      .jvgraficabarras .barra{
        min-width:0px;
        height:10px;
        background:blue;
        border-radius:5px;
        padding:5px;
        color:white;
        font-size:10px;
        line-height:10px;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      function graficaBarras(selector,misdatos,color){
      
        let grafica = document.querySelector(selector);
        
        let tabla = document.createElement("table");
        tabla.classList.add("jvgraficabarras")
        grafica.appendChild(tabla)
        
        let cabecera = document.createElement("thead");
        tabla.appendChild(cabecera)
        
        let filacabecera = document.createElement("tr");
        filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
        cabecera.appendChild(filacabecera)
        
        let cuerpo = document.createElement("tbody");
        tabla.appendChild(cuerpo);
        
        misdatos.forEach(function(dato){
        console.log("hola")
       
          let fila = document.createElement("tr")
          cuerpo.appendChild(fila);
           
          let valor = document.createElement("td")
          valor.textContent = dato.Valor
          fila.appendChild(valor)
          
          let contienebarra = document.createElement("td")
          let barra = document.createElement("div")
          barra.classList.add("barra")
          barra.textContent = dato.Etiqueta
          barra.style.width = dato.Valor+"px"
          barra.style.backgroundColor = color
          contienebarra.appendChild(barra)
          
          fila.appendChild(contienebarra)
          
        })
      }
      
      graficaBarras(".grafica1",datos1,"red")
      graficaBarras(".grafica2",datos2,"blue")
      graficaBarras(".grafica3",datos3,"green")
      graficaBarras(".grafica4",datos4,"pink")
    </script>
  </body>
</html>
```

### externalizo a archivos

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
     
    </style>
  </head>
  <body>
    
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>
    <link rel="Stylesheet" href="jvgraficabarras.css">
    <script src="jvgraficabarras.js"></script>
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      
      
      graficaBarras(".grafica1",datos1,"red")
      graficaBarras(".grafica2",datos2,"blue")
      graficaBarras(".grafica3",datos3,"green")
      graficaBarras(".grafica4",datos4,"pink")
    </script>
  </body>
</html>
```

### lo cargo como libreria externa

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
     
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>
    <link rel="Stylesheet" href="https://jocarsa.github.io/jvgraficabarras/jvgraficabarras.css">
    <script src="https://jocarsa.github.io/jvgraficabarras/jvgraficabarras.js"></script>
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      
      
      graficaBarras(".grafica1",datos1,"red")
      graficaBarras(".grafica2",datos2,"blue")
      graficaBarras(".grafica3",datos3,"green")
      graficaBarras(".grafica4",datos4,"pink")
    </script>
  </body>
</html>
```

### grafica de tarta

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
     
    .grafica{
  position: relative;
  width: 240px;
  aspect-ratio: 1;
  border-radius: 50%;
  /* Example chart: replace with your own */
  background: conic-gradient(
    #60a5fa 0 25%,
    #34d399 0 55%,
    #f59e0b 0 78%,
    #f43f5e 0
  );
}
    </style>
  </head>
  <body>
    <div class="grafica">

    </div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let grafica = document.querySelector(".grafica")
      grafica.style.position = "relative"
      grafica.width = 240
      grafica.style.aspectRatio = 1
      grafica.style.borderRadius = "50%";
      grafica.style.background = `
        conic-gradient(
          #60a5fa 0 25%,
          #34d399 0 55%,
          #f59e0b 0 78%,
          #00ff00 0 88%,
          #f43f5e 0
        );
      `
    </script>
    
  </body>
</html>
```

### a javascript

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <div class="grafica">

    </div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let grafica = document.querySelector(".grafica")
      grafica.style.position = "relative"
      grafica.style.width = "240px"
      grafica.style.aspectRatio = 1
      grafica.style.borderRadius = "50%";
      grafica.style.background = `
        conic-gradient(
          #60a5fa 0% 25%,
          #34d399 25% 55%,
          #f59e0b 55% 78%,
          #00ff00 78% 88%,
          #f43f5e 88% 100%
        )
      `;
    </script>
    
  </body>
</html>
```

### averiguamos el total

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <div class="grafica">

    </div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      /*
      let grafica = document.querySelector(".grafica")
      grafica.style.position = "relative"
      grafica.style.width = "240px"
      grafica.style.aspectRatio = 1
      grafica.style.borderRadius = "50%";
      grafica.style.background = `
        conic-gradient(
          #60a5fa 0% 25%,
          #34d399 25% 55%,
          #f59e0b 55% 78%,
          #00ff00 78% 88%,
          #f43f5e 88% 100%
        )
      `;
      */
      let suma = 0;
      for(let i = 0;i<datos1.length;i++){
        suma += datos1[i].Valor
      }
      console.log("La suma es:",suma)
      let cursor = 0
      console.log(datos1)
      for(let i = 0;i<datos1.length;i++){
        console.log(cursor*100+"%")
        cursor += (datos1[i].Valor)/suma
        console.log(cursor*100+"%")
      }
    </script>
    
  </body>
</html>
```

### construyo una cadena

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <div class="grafica">

    </div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":74
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      
      function getRandomHexColor() {
        return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
      }
      
      let suma = 0;
      for(let i = 0;i<datos1.length;i++){
        suma += datos1[i].Valor
      }
      console.log("La suma es:",suma)
      let cursor = 0
      let cadena = ""
      console.log(datos1)
      for(let i = 0;i<datos1.length;i++){
        inicio = cursor*100+"%"
        cursor += (datos1[i].Valor)/suma
        final = cursor*100+"%"
        cadena += getRandomHexColor()+" "+inicio+" "+final+","
      }
      console.log(cadena)
      cadena = cadena.slice(0, -1);
      let grafica = document.querySelector(".grafica")
      grafica.style.position = "relative"
      grafica.style.width = "240px"
      grafica.style.aspectRatio = 1
      grafica.style.borderRadius = "50%";
      grafica.style.background = `
        conic-gradient(
          `+cadena+`
        )
      `;
      
    </script>
    
  </body>
</html>
```

### encapsulo

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <div class="grafica">

    </div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":74
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      
      function getRandomHexColor() {
        return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
      }
      function jvgraficatarta(selector,datos1){
        let suma = 0;
        for(let i = 0;i<datos1.length;i++){
          suma += datos1[i].Valor
        }
        console.log("La suma es:",suma)
        let cursor = 0
        let cadena = ""
        console.log(datos1)
        for(let i = 0;i<datos1.length;i++){
          inicio = cursor*100+"%"
          cursor += (datos1[i].Valor)/suma
          final = cursor*100+"%"
          cadena += getRandomHexColor()+" "+inicio+" "+final+","
        }
        console.log(cadena)
        cadena = cadena.slice(0, -1);
        let grafica = document.querySelector(selector)
        grafica.style.position = "relative"
        grafica.style.width = "240px"
        grafica.style.aspectRatio = 1
        grafica.style.borderRadius = "50%";
        grafica.style.background = `
          conic-gradient(
            `+cadena+`
          )
        `;
      }
      
      jvgraficatarta(".grafica",datos1)
    </script>
    
  </body>
</html>
```

### probamos multiple

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      function getRandomHexColor() {
        return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
      }
      function jvgraficatarta(selector,datos1){
        let suma = 0;
        for(let i = 0;i<datos1.length;i++){
          suma += datos1[i].Valor
        }
        console.log("La suma es:",suma)
        let cursor = 0
        let cadena = ""
        console.log(datos1)
        for(let i = 0;i<datos1.length;i++){
          inicio = cursor*100+"%"
          cursor += (datos1[i].Valor)/suma
          final = cursor*100+"%"
          cadena += getRandomHexColor()+" "+inicio+" "+final+","
        }
        console.log(cadena)
        cadena = cadena.slice(0, -1);
        let grafica = document.querySelector(selector)
        grafica.style.position = "relative"
        grafica.style.width = "240px"
        grafica.style.aspectRatio = 1
        grafica.style.borderRadius = "50%";
        grafica.style.background = `
          conic-gradient(
            `+cadena+`
          )
        `;
      }
      
      jvgraficatarta(".grafica1",datos1)
      jvgraficatarta(".grafica2",datos2)
      jvgraficatarta(".grafica3",datos3)
      jvgraficatarta(".grafica4",datos4)
    </script>
    
  </body>
</html>
```

### estilizar mejor las gráficas

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>  
    <script>
      let datos1 = [
        {
          "Etiqueta":"España",
          "Valor":34
        },
        {
          "Etiqueta":"Francia",
          "Valor":78
        },
        {
          "Etiqueta":"Alemania",
          "Valor":76
        },
        {
          "Etiqueta":"Austria",
          "Valor":87
        },
        {
          "Etiqueta":"Italia",
          "Valor":127
        }
      ]
      let datos2 = [
          {
            "Etiqueta": "Valencia",
            "Valor": 56
          },
          {
            "Etiqueta": "Madrid",
            "Valor": 102
          },
          {
            "Etiqueta": "Barcelona",
            "Valor": 88
          },
          {
            "Etiqueta": "Sevilla",
            "Valor": 74
          },
          {
            "Etiqueta": "Bilbao",
            "Valor": 61
          }
        ]

      
      let datos3 = [
          {
            "Etiqueta": "Python",
            "Valor": 120
          },
          {
            "Etiqueta": "JavaScript",
            "Valor": 98
          },
          {
            "Etiqueta": "C++",
            "Valor": 77
          },
          {
            "Etiqueta": "Java",
            "Valor": 110
          },
          {
            "Etiqueta": "Go",
            "Valor": 45
          }
        ]

      
      let datos4 = [
          {
            "Etiqueta": "Manzana",
            "Valor": 34
          },
          {
            "Etiqueta": "Plátano",
            "Valor": 52
          },
          {
            "Etiqueta": "Naranja",
            "Valor": 46
          },
          {
            "Etiqueta": "Uva",
            "Valor": 29
          },
          {
            "Etiqueta": "Sandía",
            "Valor": 67
          }
        ]

      
      function getRandomHexColor() {
        return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
      }
      function randomLightnessVariation(hex, min = 0.7, max = 1.3) {
        // Convert hex → RGB
        let r = parseInt(hex.slice(1, 3), 16) / 255;
        let g = parseInt(hex.slice(3, 5), 16) / 255;
        let b = parseInt(hex.slice(5, 7), 16) / 255;

        // Find min/max for lightness and chroma
        let maxC = Math.max(r, g, b), minC = Math.min(r, g, b);
        let l = (maxC + minC) / 2; // lightness
        let s, h;
        if (maxC === minC) {
          s = h = 0;
        } else {
          let d = maxC - minC;
          s = l > 0.5 ? d / (2 - maxC - minC) : d / (maxC + minC);
          switch (maxC) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }

        // Random variation on lightness
        let variation = l * (min + Math.random() * (max - min));
        if (variation > 1) variation = 1;
        if (variation < 0) variation = 0;

        // Convert HSL → RGB
        function hue2rgb(p, q, t) {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        }

        let q = variation < 0.5 ? variation * (1 + s) : variation + s - variation * s;
        let p = 2 * variation - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);

        // Back to hex
        return "#" + 
          Math.round(r * 255).toString(16).padStart(2, "0") +
          Math.round(g * 255).toString(16).padStart(2, "0") +
          Math.round(b * 255).toString(16).padStart(2, "0");
      }
      function jvgraficatarta(selector,datos1,color){
        let suma = 0;
        for(let i = 0;i<datos1.length;i++){
          suma += datos1[i].Valor
        }
        console.log("La suma es:",suma)
        let cursor = 0
        let cadena = ""
        console.log(datos1)
        for(let i = 0;i<datos1.length;i++){
          inicio = cursor*100+"%"
          cursor += (datos1[i].Valor)/suma
          final = cursor*100+"%"
          cadena += randomLightnessVariation(color)+" "+inicio+" "+final+","
        }
        console.log(cadena)
        cadena = cadena.slice(0, -1);
        let grafica = document.querySelector(selector)
        grafica.style.position = "relative"
        grafica.style.width = "240px"
        grafica.style.aspectRatio = 1
        grafica.style.borderRadius = "50%";
        grafica.style.background = `
          conic-gradient(
            `+cadena+`
          )
        `;
      }
      
      jvgraficatarta(".grafica1",datos1,"#c02424")
      jvgraficatarta(".grafica2",datos2,"#2acb71")
      jvgraficatarta(".grafica3",datos3,"#4e61cd")
      jvgraficatarta(".grafica4",datos4,"#cdab5a")
    </script>
    
  </body>
</html>
```

### svg sobreimpreso

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      /* Tamaño y forma comunes a todas las gráficas */
      .grafica1, .grafica2, .grafica3, .grafica4{
        position: relative;
        width: 240px;
        aspect-ratio: 1;
        border-radius: 50%;
        display: inline-block;
        margin: 8px;
      }
      /* SVG superpuesto para captar eventos sin alterar el look */
      .overlay {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
      }
      .overlay path {
        fill: transparent;        /* No pinta nada: se ve el conic-gradient */
        pointer-events: all;      /* Pero sí captura el hover */
      }
      /* Tooltip */
      .tooltip {
        position: absolute;
        transform: translate(-50%, -120%);
        padding: 6px 10px;
        border-radius: 8px;
        background: rgba(17, 24, 39, 0.9); /* gris muy oscuro */
        color: white;
        font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        white-space: nowrap;
        box-shadow: 0 6px 18px rgba(0,0,0,.25);
        pointer-events: none;     /* No interfiere con el ratón */
        opacity: 0;
        transition: opacity .12s ease;
        z-index: 2;
      }
      .tooltip b{ font-weight: 700; }
      .tooltip.visible{ opacity: 1; }
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>  
    <script>
      let datos1 = [
        {"Etiqueta":"España","Valor":34},
        {"Etiqueta":"Francia","Valor":78},
        {"Etiqueta":"Alemania","Valor":76},
        {"Etiqueta":"Austria","Valor":87},
        {"Etiqueta":"Italia","Valor":127}
      ];
      let datos2 = [
        {"Etiqueta":"Valencia","Valor":56},
        {"Etiqueta":"Madrid","Valor":102},
        {"Etiqueta":"Barcelona","Valor":88},
        {"Etiqueta":"Sevilla","Valor":74},
        {"Etiqueta":"Bilbao","Valor":61}
      ];
      let datos3 = [
        {"Etiqueta":"Python","Valor":120},
        {"Etiqueta":"JavaScript","Valor":98},
        {"Etiqueta":"C++","Valor":77},
        {"Etiqueta":"Java","Valor":110},
        {"Etiqueta":"Go","Valor":45}
      ];
      let datos4 = [
        {"Etiqueta":"Manzana","Valor":34},
        {"Etiqueta":"Plátano","Valor":52},
        {"Etiqueta":"Naranja","Valor":46},
        {"Etiqueta":"Uva","Valor":29},
        {"Etiqueta":"Sandía","Valor":67}
      ];

      function getRandomHexColor() {
        return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
      }
      function randomLightnessVariation(hex, min = 0.7, max = 1.3) {
        // Convert hex → RGB
        let r = parseInt(hex.slice(1, 3), 16) / 255;
        let g = parseInt(hex.slice(3, 5), 16) / 255;
        let b = parseInt(hex.slice(5, 7), 16) / 255;

        // RGB → HSL (para mantener el tono y variar la L)
        let maxC = Math.max(r, g, b), minC = Math.min(r, g, b);
        let l = (maxC + minC) / 2;
        let s, h;
        if (maxC === minC) {
          s = h = 0;
        } else {
          let d = maxC - minC;
          s = l > 0.5 ? d / (2 - maxC - minC) : d / (maxC + minC);
          switch (maxC) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }

        // Variación de luminosidad
        let L = l * (min + Math.random() * (max - min));
        L = Math.max(0, Math.min(1, L));

        // HSL → RGB
        function hue2rgb(p, q, t) {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        }
        let q = L < 0.5 ? L * (1 + s) : L + s - L * s;
        let p = 2 * L - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);

        return "#" +
          Math.round(r * 255).toString(16).padStart(2, "0") +
          Math.round(g * 255).toString(16).padStart(2, "0") +
          Math.round(b * 255).toString(16).padStart(2, "0");
      }

      // Utilidad para generar paths de arco en SVG
      function arcoPath(cx, cy, r, angInicio, angFin){
        // Angulos en radianes, 0 arriba (12h), sentido horario
        const a1 = angInicio - Math.PI/2;
        const a2 = angFin   - Math.PI/2;
        const x1 = cx + r * Math.cos(a1);
        const y1 = cy + r * Math.sin(a1);
        const x2 = cx + r * Math.cos(a2);
        const y2 = cy + r * Math.sin(a2);
        const largeArc = (angFin - angInicio) > Math.PI ? 1 : 0;
        // Pie (no donut): movemos al centro, trazamos línea y arco y cerramos
        return `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
      }

      function jvgraficatarta(selector, datos, colorBase){
        const suma = datos.reduce((acc, d) => acc + d.Valor, 0);

        // 1) Construir paleta (variaciones de luminancia del color base) y gradiente
        const colores = datos.map(() => randomLightnessVariation(colorBase));
        let cursor = 0;
        let grad = "";
        for (let i=0;i<datos.length;i++){
          const inicio = (cursor * 100).toFixed(6) + "%";
          cursor += datos[i].Valor / suma;
          const fin = (cursor * 100).toFixed(6) + "%";
          grad += `${colores[i]} ${inicio} ${fin},`;
        }
        grad = grad.slice(0,-1);

        // 2) Pintar la tarta (conic-gradient) en el contenedor
        const grafica = document.querySelector(selector);
        grafica.style.background = `conic-gradient(${grad})`;

        // 3) Crear/colocar tooltip (una única instancia por grafica)
        let tooltip = grafica.querySelector(".tooltip");
        if(!tooltip){
          tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          grafica.appendChild(tooltip);
        }

        // 4) Crear un SVG superpuesto con las cuñas para captar hover
        //    (lo regeneramos por si se llama de nuevo)
        let overlay = grafica.querySelector("svg.overlay");
        if(overlay) overlay.remove();

        const size = grafica.clientWidth || 240;    // 240px por CSS
        const cx = size/2, cy = size/2, r = size/2; // pie completo
        overlay = document.createElementNS("http://www.w3.org/2000/svg","svg");
        overlay.setAttribute("class","overlay");
        overlay.setAttribute("viewBox", `0 0 ${size} ${size}`);
        overlay.setAttribute("preserveAspectRatio","xMidYMid meet");

        // Eventos para tooltip
        overlay.addEventListener("mousemove", (e) => {
          const rect = grafica.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          tooltip.style.left = x + "px";
          tooltip.style.top  = y + "px";
        });
        overlay.addEventListener("mouseleave", () => {
          tooltip.classList.remove("visible");
        });

        // 5) Dibujar cuñas interactivas
        let angAcum = 0; // en radianes
        for (let i=0;i<datos.length;i++){
          const fraccion = datos[i].Valor / suma;
          const angInicio = angAcum;
          const angFin = angAcum + fraccion * Math.PI * 2;
          angAcum = angFin;

          const path = document.createElementNS("http://www.w3.org/2000/svg","path");
          path.setAttribute("d", arcoPath(cx, cy, r, angInicio, angFin));
          path.setAttribute("data-etiqueta", datos[i].Etiqueta);
          path.setAttribute("data-valor", datos[i].Valor);
          // (Opcional) usar el color para ampliar el área pintada a opacidad mínima:
          // path.setAttribute("fill", colores[i]); path.setAttribute("opacity", "0.001");
          // pero con fill: transparent + pointer-events: all (en CSS) ya funciona:
          overlay.appendChild(path);

          // Mostrar tooltip
          path.addEventListener("mouseenter", () => {
            tooltip.innerHTML = `<b>${datos[i].Etiqueta}</b><br>${datos[i].Valor}`;
            tooltip.classList.add("visible");
          });
          path.addEventListener("mouseleave", () => {
            tooltip.classList.remove("visible");
          });
        }

        grafica.appendChild(overlay);
      }

      // Render
      jvgraficatarta(".grafica1", datos1, "#c02424");
      jvgraficatarta(".grafica2", datos2, "#2acb71");
      jvgraficatarta(".grafica3", datos3, "#4e61cd");
      jvgraficatarta(".grafica4", datos4, "#cdab5a");
    </script>
  </body>
</html>
```

### leyendas en las partes

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      .grafica1, .grafica2, .grafica3, .grafica4{
        position: relative;
        width: 240px;
        aspect-ratio: 1;
        border-radius: 50%;
        display: inline-block;
        margin: 8px;
      }
      .overlay {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
      }
      .overlay path {
        fill: transparent;
        pointer-events: all;
      }
      /* Tooltip (sigue funcionando) */
      .tooltip {
        position: absolute;
        transform: translate(-50%, -120%);
        padding: 6px 10px;
        border-radius: 8px;
        background: rgba(17, 24, 39, 0.9);
        color: white;
        font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        white-space: nowrap;
        box-shadow: 0 6px 18px rgba(0,0,0,.25);
        pointer-events: none;
        opacity: 0;
        transition: opacity .12s ease;
        z-index: 2;
      }
      .tooltip b{ font-weight: 700; }
      .tooltip.visible{ opacity: 1; }

      /* Estilos de leyendas estáticas */
      .label {
        font: 11px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        fill: #111827;            /* gris muy oscuro */
        paint-order: stroke;
        stroke: white;            /* halo para contraste */
        stroke-width: 3px;
        stroke-linejoin: round;
        text-anchor: middle;
        pointer-events: none;     /* que no interfiera con hover */
      }
      .leader {
        stroke: rgba(0,0,0,.4);
        stroke-width: 1;
        fill: none;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>  
    <script>
      let datos1 = [
        {"Etiqueta":"España","Valor":34},
        {"Etiqueta":"Francia","Valor":78},
        {"Etiqueta":"Alemania","Valor":76},
        {"Etiqueta":"Austria","Valor":87},
        {"Etiqueta":"Italia","Valor":127}
      ];
      let datos2 = [
        {"Etiqueta":"Valencia","Valor":56},
        {"Etiqueta":"Madrid","Valor":102},
        {"Etiqueta":"Barcelona","Valor":88},
        {"Etiqueta":"Sevilla","Valor":74},
        {"Etiqueta":"Bilbao","Valor":61}
      ];
      let datos3 = [
        {"Etiqueta":"Python","Valor":120},
        {"Etiqueta":"JavaScript","Valor":98},
        {"Etiqueta":"C++","Valor":77},
        {"Etiqueta":"Java","Valor":110},
        {"Etiqueta":"Go","Valor":45}
      ];
      let datos4 = [
        {"Etiqueta":"Manzana","Valor":34},
        {"Etiqueta":"Plátano","Valor":52},
        {"Etiqueta":"Naranja","Valor":46},
        {"Etiqueta":"Uva","Valor":29},
        {"Etiqueta":"Sandía","Valor":67}
      ];

      function randomLightnessVariation(hex, min = 0.7, max = 1.3) {
        let r = parseInt(hex.slice(1, 3), 16) / 255;
        let g = parseInt(hex.slice(3, 5), 16) / 255;
        let b = parseInt(hex.slice(5, 7), 16) / 255;
        let maxC = Math.max(r, g, b), minC = Math.min(r, g, b);
        let l = (maxC + minC) / 2;
        let s, h;
        if (maxC === minC) { s = h = 0; }
        else {
          let d = maxC - minC;
          s = l > 0.5 ? d / (2 - maxC - minC) : d / (maxC + minC);
          switch (maxC) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }
        let L = l * (min + Math.random() * (max - min));
        L = Math.max(0, Math.min(1, L));
        function hue2rgb(p, q, t) {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        }
        let q = L < 0.5 ? L * (1 + s) : L + s - L * s;
        let p = 2 * L - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
        return "#" +
          Math.round(r * 255).toString(16).padStart(2, "0") +
          Math.round(g * 255).toString(16).padStart(2, "0") +
          Math.round(b * 255).toString(16).padStart(2, "0");
      }

      function arcoPath(cx, cy, r, angInicio, angFin){
        const a1 = angInicio - Math.PI/2;
        const a2 = angFin   - Math.PI/2;
        const x1 = cx + r * Math.cos(a1);
        const y1 = cy + r * Math.sin(a1);
        const x2 = cx + r * Math.cos(a2);
        const y2 = cy + r * Math.sin(a2);
        const largeArc = (angFin - angInicio) > Math.PI ? 1 : 0;
        return `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
      }

      // labelFormatter: función para el texto de la leyenda
      const defaultLabelFormatter = (d, fraccion) => `${d.Etiqueta} (${d.Valor})`;

      function jvgraficatarta(selector, datos, colorBase, {
        labelFormatter = defaultLabelFormatter,
        insideMinFraction = 0.08,   // umbral: si la porción ≥ 8%, etiqueta dentro; si no, fuera con línea guía
        innerRadiusRatio = 0.55,    // radio relativo para etiquetas internas
        outerLineStart = 0.72,      // radio relativo inicio línea guía
        outerLineEnd = 0.92,        // radio relativo fin línea guía
        outerLabelRadius = 1.02     // radio relativo para etiqueta externa
      } = {}){
        const suma = datos.reduce((acc, d) => acc + d.Valor, 0);

        // 1) Paleta + conic-gradient
        const colores = datos.map(() => randomLightnessVariation(colorBase));
        let cursor = 0, grad = "";
        for (let i=0;i<datos.length;i++){
          const inicio = (cursor * 100).toFixed(6) + "%";
          cursor += datos[i].Valor / suma;
          const fin = (cursor * 100).toFixed(6) + "%";
          grad += `${colores[i]} ${inicio} ${fin},`;
        }
        grad = grad.slice(0,-1);

        const grafica = document.querySelector(selector);
        grafica.style.background = `conic-gradient(${grad})`;

        // Tooltip (reutilizamos)
        let tooltip = grafica.querySelector(".tooltip");
        if(!tooltip){
          tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          grafica.appendChild(tooltip);
        }

        // SVG overlay (regenerar)
        let overlay = grafica.querySelector("svg.overlay");
        if(overlay) overlay.remove();

        const size = grafica.clientWidth || 240;
        const cx = size/2, cy = size/2, r = size/2;

        overlay = document.createElementNS("http://www.w3.org/2000/svg","svg");
        overlay.setAttribute("class","overlay");
        overlay.setAttribute("viewBox", `0 0 ${size} ${size}`);
        overlay.setAttribute("preserveAspectRatio","xMidYMid meet");

        // Grupos para orden de dibujo: primero paths (para hover), luego líneas, luego etiquetas
        const gSlices = document.createElementNS("http://www.w3.org/2000/svg","g");
        const gLeaders = document.createElementNS("http://www.w3.org/2000/svg","g");
        const gLabels  = document.createElementNS("http://www.w3.org/2000/svg","g");
        overlay.appendChild(gSlices);
        overlay.appendChild(gLeaders);
        overlay.appendChild(gLabels);

        overlay.addEventListener("mousemove", (e) => {
          const rect = grafica.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          tooltip.style.left = x + "px";
          tooltip.style.top  = y + "px";
        });
        overlay.addEventListener("mouseleave", () => {
          tooltip.classList.remove("visible");
        });

        let angAcum = 0;
        for (let i=0;i<datos.length;i++){
          const fr = datos[i].Valor / suma;
          const angInicio = angAcum;
          const angFin = angAcum + fr * Math.PI * 2;
          const angMid = (angInicio + angFin) / 2;
          angAcum = angFin;

          // Slice para hover
          const path = document.createElementNS("http://www.w3.org/2000/svg","path");
          path.setAttribute("d", arcoPath(cx, cy, r, angInicio, angFin));
          gSlices.appendChild(path);

          path.addEventListener("mouseenter", () => {
            tooltip.innerHTML = `<b>${datos[i].Etiqueta}</b><br>${datos[i].Valor}`;
            tooltip.classList.add("visible");
          });
          path.addEventListener("mouseleave", () => {
            tooltip.classList.remove("visible");
          });

          // ====== Etiquetas estáticas ======
          const text = document.createElementNS("http://www.w3.org/2000/svg","text");
          text.setAttribute("class","label");
          text.textContent = labelFormatter(datos[i], fr);

          // Convertimos ángulo a sistema de coordenadas (0 arriba, horario)
          const a = angMid - Math.PI/2;

          if (fr >= insideMinFraction){
            // Etiqueta dentro
            const rx = r * innerRadiusRatio;
            const x = cx + rx * Math.cos(a);
            const y = cy + rx * Math.sin(a);
            text.setAttribute("x", x);
            text.setAttribute("y", y);
            text.setAttribute("text-anchor","middle");
            gLabels.appendChild(text);
          } else {
            // Etiqueta fuera con línea guía
            const x1 = cx + r * outerLineStart * Math.cos(a);
            const y1 = cy + r * outerLineStart * Math.sin(a);
            const x2 = cx + r * outerLineEnd   * Math.cos(a);
            const y2 = cy + r * outerLineEnd   * Math.sin(a);
            const line = document.createElementNS("http://www.w3.org/2000/svg","path");
            line.setAttribute("class","leader");

            // Pequeño codo hacia izquierda/derecha para separar
            const side = Math.cos(a) >= 0 ? 1 : -1;
            const x2b = x2 + side * 8;
            const y2b = y2;

            line.setAttribute("d", `M ${x1} ${y1} L ${x2} ${y2} L ${x2b} ${y2b}`);
            gLeaders.appendChild(line);

            const xText = cx + r * outerLabelRadius * Math.cos(a) + side * 14;
            const yText = cy + r * outerLabelRadius * Math.sin(a);
            text.setAttribute("x", xText);
            text.setAttribute("y", yText);
            text.setAttribute("text-anchor", side === 1 ? "start" : "end");
            gLabels.appendChild(text);
          }
        }

        grafica.appendChild(overlay);
      }

      // Render con leyendas estáticas
      jvgraficatarta(".grafica1", datos1, "#c02424");
      jvgraficatarta(".grafica2", datos2, "#2acb71");
      jvgraficatarta(".grafica3", datos3, "#4e61cd");
      jvgraficatarta(".grafica4", datos4, "#cdab5a");

      // EJEMPLO (opcional): formatear etiquetas como porcentaje
      // jvgraficatarta(".grafica1", datos1, "#c02424", {
      //   labelFormatter: (d, fr) => `${d.Etiqueta} (${(fr*100).toFixed(1)}%)`
      // });
    </script>
  </body>
</html>
```

### titulo de la grafica

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      .grafica1, .grafica2, .grafica3, .grafica4{
        position: relative;
        width: 240px;
        aspect-ratio: 1;
        border-radius: 50%;
        display: inline-block;
        margin: 8px;
      }
      .overlay {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
      }
      .overlay path {
        fill: transparent;
        pointer-events: all;
      }
      /* Tooltip (sigue funcionando) */
      .tooltip {
        position: absolute;
        transform: translate(-50%, -120%);
        padding: 6px 10px;
        border-radius: 8px;
        background: rgba(17, 24, 39, 0.9);
        color: white;
        font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        white-space: nowrap;
        box-shadow: 0 6px 18px rgba(0,0,0,.25);
        pointer-events: none;
        opacity: 0;
        transition: opacity .12s ease;
        z-index: 2;
      }
      .tooltip b{ font-weight: 700; }
      .tooltip.visible{ opacity: 1; }

      /* Estilos de leyendas estáticas */
      .label {
        font: 11px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        fill: #111827;            /* gris muy oscuro */
        paint-order: stroke;
        stroke: white;            /* halo para contraste */
        stroke-width: 3px;
        stroke-linejoin: round;
        text-anchor: middle;
        pointer-events: none;     /* que no interfiera con hover */
      }
      .leader {
        stroke: rgba(0,0,0,.4);
        stroke-width: 1;
        fill: none;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>  
    <script>
      let datos1 = [
        {"Etiqueta":"España","Valor":34},
        {"Etiqueta":"Francia","Valor":78},
        {"Etiqueta":"Alemania","Valor":76},
        {"Etiqueta":"Austria","Valor":87},
        {"Etiqueta":"Italia","Valor":127}
      ];
      let datos2 = [
        {"Etiqueta":"Valencia","Valor":56},
        {"Etiqueta":"Madrid","Valor":102},
        {"Etiqueta":"Barcelona","Valor":88},
        {"Etiqueta":"Sevilla","Valor":74},
        {"Etiqueta":"Bilbao","Valor":61}
      ];
      let datos3 = [
        {"Etiqueta":"Python","Valor":120},
        {"Etiqueta":"JavaScript","Valor":98},
        {"Etiqueta":"C++","Valor":77},
        {"Etiqueta":"Java","Valor":110},
        {"Etiqueta":"Go","Valor":45}
      ];
      let datos4 = [
        {"Etiqueta":"Manzana","Valor":34},
        {"Etiqueta":"Plátano","Valor":52},
        {"Etiqueta":"Naranja","Valor":46},
        {"Etiqueta":"Uva","Valor":29},
        {"Etiqueta":"Sandía","Valor":67}
      ];

      function randomLightnessVariation(hex, min = 0.7, max = 1.3) {
        let r = parseInt(hex.slice(1, 3), 16) / 255;
        let g = parseInt(hex.slice(3, 5), 16) / 255;
        let b = parseInt(hex.slice(5, 7), 16) / 255;
        let maxC = Math.max(r, g, b), minC = Math.min(r, g, b);
        let l = (maxC + minC) / 2;
        let s, h;
        if (maxC === minC) { s = h = 0; }
        else {
          let d = maxC - minC;
          s = l > 0.5 ? d / (2 - maxC - minC) : d / (maxC + minC);
          switch (maxC) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }
        let L = l * (min + Math.random() * (max - min));
        L = Math.max(0, Math.min(1, L));
        function hue2rgb(p, q, t) {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        }
        let q = L < 0.5 ? L * (1 + s) : L + s - L * s;
        let p = 2 * L - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
        return "#" +
          Math.round(r * 255).toString(16).padStart(2, "0") +
          Math.round(g * 255).toString(16).padStart(2, "0") +
          Math.round(b * 255).toString(16).padStart(2, "0");
      }

      function arcoPath(cx, cy, r, angInicio, angFin){
        const a1 = angInicio - Math.PI/2;
        const a2 = angFin   - Math.PI/2;
        const x1 = cx + r * Math.cos(a1);
        const y1 = cy + r * Math.sin(a1);
        const x2 = cx + r * Math.cos(a2);
        const y2 = cy + r * Math.sin(a2);
        const largeArc = (angFin - angInicio) > Math.PI ? 1 : 0;
        return `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
      }

      // labelFormatter: función para el texto de la leyenda
      const defaultLabelFormatter = (d, fraccion) => `${d.Etiqueta} (${d.Valor})`;

      function jvgraficatarta(selector, datos, colorBase, {
        labelFormatter = defaultLabelFormatter,
        insideMinFraction = 0.08,   // umbral: si la porción ≥ 8%, etiqueta dentro; si no, fuera con línea guía
        innerRadiusRatio = 0.55,    // radio relativo para etiquetas internas
        outerLineStart = 0.72,      // radio relativo inicio línea guía
        outerLineEnd = 0.92,        // radio relativo fin línea guía
        outerLabelRadius = 1.02     // radio relativo para etiqueta externa
      } = {}){
        const suma = datos.reduce((acc, d) => acc + d.Valor, 0);

        // 1) Paleta + conic-gradient
        const colores = datos.map(() => randomLightnessVariation(colorBase));
        let cursor = 0, grad = "";
        for (let i=0;i<datos.length;i++){
          const inicio = (cursor * 100).toFixed(6) + "%";
          cursor += datos[i].Valor / suma;
          const fin = (cursor * 100).toFixed(6) + "%";
          grad += `${colores[i]} ${inicio} ${fin},`;
        }
        grad = grad.slice(0,-1);

        const grafica = document.querySelector(selector);
        grafica.style.background = `conic-gradient(${grad})`;

        // Tooltip (reutilizamos)
        let tooltip = grafica.querySelector(".tooltip");
        if(!tooltip){
          tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          grafica.appendChild(tooltip);
        }

        // SVG overlay (regenerar)
        let overlay = grafica.querySelector("svg.overlay");
        if(overlay) overlay.remove();

        const size = grafica.clientWidth || 240;
        const cx = size/2, cy = size/2, r = size/2;

        overlay = document.createElementNS("http://www.w3.org/2000/svg","svg");
        overlay.setAttribute("class","overlay");
        overlay.setAttribute("viewBox", `0 0 ${size} ${size}`);
        overlay.setAttribute("preserveAspectRatio","xMidYMid meet");

        // Grupos para orden de dibujo: primero paths (para hover), luego líneas, luego etiquetas
        const gSlices = document.createElementNS("http://www.w3.org/2000/svg","g");
        const gLeaders = document.createElementNS("http://www.w3.org/2000/svg","g");
        const gLabels  = document.createElementNS("http://www.w3.org/2000/svg","g");
        overlay.appendChild(gSlices);
        overlay.appendChild(gLeaders);
        overlay.appendChild(gLabels);

        overlay.addEventListener("mousemove", (e) => {
          const rect = grafica.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          tooltip.style.left = x + "px";
          tooltip.style.top  = y + "px";
        });
        overlay.addEventListener("mouseleave", () => {
          tooltip.classList.remove("visible");
        });

        let angAcum = 0;
        for (let i=0;i<datos.length;i++){
          const fr = datos[i].Valor / suma;
          const angInicio = angAcum;
          const angFin = angAcum + fr * Math.PI * 2;
          const angMid = (angInicio + angFin) / 2;
          angAcum = angFin;

          // Slice para hover
          const path = document.createElementNS("http://www.w3.org/2000/svg","path");
          path.setAttribute("d", arcoPath(cx, cy, r, angInicio, angFin));
          gSlices.appendChild(path);

          path.addEventListener("mouseenter", () => {
            tooltip.innerHTML = `<b>${datos[i].Etiqueta}</b><br>${datos[i].Valor}`;
            tooltip.classList.add("visible");
          });
          path.addEventListener("mouseleave", () => {
            tooltip.classList.remove("visible");
          });

          // ====== Etiquetas estáticas ======
          const text = document.createElementNS("http://www.w3.org/2000/svg","text");
          text.setAttribute("class","label");
          text.textContent = labelFormatter(datos[i], fr);

          // Convertimos ángulo a sistema de coordenadas (0 arriba, horario)
          const a = angMid - Math.PI/2;

          if (fr >= insideMinFraction){
            // Etiqueta dentro
            const rx = r * innerRadiusRatio;
            const x = cx + rx * Math.cos(a);
            const y = cy + rx * Math.sin(a);
            text.setAttribute("x", x);
            text.setAttribute("y", y);
            text.setAttribute("text-anchor","middle");
            gLabels.appendChild(text);
          } else {
            // Etiqueta fuera con línea guía
            const x1 = cx + r * outerLineStart * Math.cos(a);
            const y1 = cy + r * outerLineStart * Math.sin(a);
            const x2 = cx + r * outerLineEnd   * Math.cos(a);
            const y2 = cy + r * outerLineEnd   * Math.sin(a);
            const line = document.createElementNS("http://www.w3.org/2000/svg","path");
            line.setAttribute("class","leader");

            // Pequeño codo hacia izquierda/derecha para separar
            const side = Math.cos(a) >= 0 ? 1 : -1;
            const x2b = x2 + side * 8;
            const y2b = y2;

            line.setAttribute("d", `M ${x1} ${y1} L ${x2} ${y2} L ${x2b} ${y2b}`);
            gLeaders.appendChild(line);

            const xText = cx + r * outerLabelRadius * Math.cos(a) + side * 14;
            const yText = cy + r * outerLabelRadius * Math.sin(a);
            text.setAttribute("x", xText);
            text.setAttribute("y", yText);
            text.setAttribute("text-anchor", side === 1 ? "start" : "end");
            gLabels.appendChild(text);
          }
        }

        grafica.appendChild(overlay);
      }

      // Render con leyendas estáticas
      jvgraficatarta(".grafica1", datos1, "#c02424","Paises");
      jvgraficatarta(".grafica2", datos2, "#2acb71","Ciudades");
      jvgraficatarta(".grafica3", datos3, "#4e61cd","Lenguajes de programación");
      jvgraficatarta(".grafica4", datos4, "#cdab5a","Frutas");

      // EJEMPLO (opcional): formatear etiquetas como porcentaje
      // jvgraficatarta(".grafica1", datos1, "#c02424", {
      //   labelFormatter: (d, fr) => `${d.Etiqueta} (${(fr*100).toFixed(1)}%)`
      // });
    </script>
  </body>
</html>
```

### titulo de la grafica

```html
<!doctype html>
<html>
  <head>
    <title>Gráficas</title>
    <meta charset="utf-8">
    <style>
      .grafica1, .grafica2, .grafica3, .grafica4{
        position: relative;
        width: 240px;
        aspect-ratio: 1;
        border-radius: 50%;
        display: inline-block;
        margin: 8px;
        /* reservamos espacio bajo el pastel para el título */
        margin-bottom: 36px;
      }
      .overlay {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
      }
      .overlay path {
        fill: transparent;
        pointer-events: all;
      }
      /* Tooltip */
      .tooltip {
        position: absolute;
        transform: translate(-50%, -120%);
        padding: 6px 10px;
        border-radius: 8px;
        background: rgba(17, 24, 39, 0.9);
        color: white;
        font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        white-space: nowrap;
        box-shadow: 0 6px 18px rgba(0,0,0,.25);
        pointer-events: none;
        opacity: 0;
        transition: opacity .12s ease;
        z-index: 2;
      }
      .tooltip b{ font-weight: 700; }
      .tooltip.visible{ opacity: 1; }

      /* Leyendas estáticas */
      .label {
        font: 11px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        fill: #111827;
        paint-order: stroke;
        stroke: white;
        stroke-width: 3px;
        stroke-linejoin: round;
        text-anchor: middle;
        pointer-events: none;
      }
      .leader {
        stroke: rgba(0,0,0,.4);
        stroke-width: 1;
        fill: none;
        pointer-events: none;
      }

      /* Título de la gráfica */
      .chart-title{
        position: absolute;
        left: 50%;
        bottom: -26px; /* lo situamos bajo el círculo */
        transform: translateX(-50%);
        font: 600 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        color: #111827;
        text-align: center;
        white-space: nowrap;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="grafica1"></div>
    <div class="grafica2"></div>
    <div class="grafica3"></div>
    <div class="grafica4"></div>  
    <script>
      let datos1 = [
        {"Etiqueta":"España","Valor":34},
        {"Etiqueta":"Francia","Valor":78},
        {"Etiqueta":"Alemania","Valor":76},
        {"Etiqueta":"Austria","Valor":87},
        {"Etiqueta":"Italia","Valor":127}
      ];
      let datos2 = [
        {"Etiqueta":"Valencia","Valor":56},
        {"Etiqueta":"Madrid","Valor":102},
        {"Etiqueta":"Barcelona","Valor":88},
        {"Etiqueta":"Sevilla","Valor":74},
        {"Etiqueta":"Bilbao","Valor":61}
      ];
      let datos3 = [
        {"Etiqueta":"Python","Valor":120},
        {"Etiqueta":"JavaScript","Valor":98},
        {"Etiqueta":"C++","Valor":77},
        {"Etiqueta":"Java","Valor":110},
        {"Etiqueta":"Go","Valor":45}
      ];
      let datos4 = [
        {"Etiqueta":"Manzana","Valor":34},
        {"Etiqueta":"Plátano","Valor":52},
        {"Etiqueta":"Naranja","Valor":46},
        {"Etiqueta":"Uva","Valor":29},
        {"Etiqueta":"Sandía","Valor":67}
      ];

      function randomLightnessVariation(hex, min = 0.7, max = 1.3) {
        let r = parseInt(hex.slice(1, 3), 16) / 255;
        let g = parseInt(hex.slice(3, 5), 16) / 255;
        let b = parseInt(hex.slice(5, 7), 16) / 255;
        let maxC = Math.max(r, g, b), minC = Math.min(r, g, b);
        let l = (maxC + minC) / 2;
        let s, h;
        if (maxC === minC) { s = h = 0; }
        else {
          let d = maxC - minC;
          s = l > 0.5 ? d / (2 - maxC - minC) : d / (maxC + minC);
          switch (maxC) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }
        let L = l * (min + Math.random() * (max - min));
        L = Math.max(0, Math.min(1, L));
        function hue2rgb(p, q, t) {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        }
        let q = L < 0.5 ? L * (1 + s) : L + s - L * s;
        let p = 2 * L - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
        return "#" +
          Math.round(r * 255).toString(16).padStart(2, "0") +
          Math.round(g * 255).toString(16).padStart(2, "0") +
          Math.round(b * 255).toString(16).padStart(2, "0");
      }

      function arcoPath(cx, cy, r, angInicio, angFin){
        const a1 = angInicio - Math.PI/2;
        const a2 = angFin   - Math.PI/2;
        const x1 = cx + r * Math.cos(a1);
        const y1 = cy + r * Math.sin(a1);
        const x2 = cx + r * Math.cos(a2);
        const y2 = cy + r * Math.sin(a2);
        const largeArc = (angFin - angInicio) > Math.PI ? 1 : 0;
        return `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
      }

      const defaultLabelFormatter = (d, fraccion) => `${d.Etiqueta} (${d.Valor})`;

      // Ahora acepta: selector, datos, colorBase, titulo, options
      function jvgraficatarta(selector, datos, colorBase, titulo = "", {
        labelFormatter = defaultLabelFormatter,
        insideMinFraction = 0.08,
        innerRadiusRatio = 0.55,
        outerLineStart = 0.72,
        outerLineEnd = 0.92,
        outerLabelRadius = 1.02
      } = {}){
        const suma = datos.reduce((acc, d) => acc + d.Valor, 0);

        // Paleta + conic-gradient
        const colores = datos.map(() => randomLightnessVariation(colorBase));
        let cursor = 0, grad = "";
        for (let i=0;i<datos.length;i++){
          const inicio = (cursor * 100).toFixed(6) + "%";
          cursor += datos[i].Valor / suma;
          const fin = (cursor * 100).toFixed(6) + "%";
          grad += `${colores[i]} ${inicio} ${fin},`;
        }
        grad = grad.slice(0,-1);

        const grafica = document.querySelector(selector);
        grafica.style.background = `conic-gradient(${grad})`;
        grafica.setAttribute("role","img");
        grafica.setAttribute("aria-label", titulo ? `Gráfica de tarta: ${titulo}` : "Gráfica de tarta");

        // Título (crear/actualizar)
        let titleEl = grafica.querySelector(".chart-title");
        if(!titleEl){
          titleEl = document.createElement("div");
          titleEl.className = "chart-title";
          grafica.appendChild(titleEl);
        }
        titleEl.textContent = titulo || "";

        // Tooltip (crear/rehusar)
        let tooltip = grafica.querySelector(".tooltip");
        if(!tooltip){
          tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          grafica.appendChild(tooltip);
        }

        // SVG overlay (regenerar)
        let overlay = grafica.querySelector("svg.overlay");
        if(overlay) overlay.remove();

        const size = grafica.clientWidth || 240;
        const cx = size/2, cy = size/2, r = size/2;

        overlay = document.createElementNS("http://www.w3.org/2000/svg","svg");
        overlay.setAttribute("class","overlay");
        overlay.setAttribute("viewBox", `0 0 ${size} ${size}`);
        overlay.setAttribute("preserveAspectRatio","xMidYMid meet");

        const gSlices = document.createElementNS("http://www.w3.org/2000/svg","g");
        const gLeaders = document.createElementNS("http://www.w3.org/2000/svg","g");
        const gLabels  = document.createElementNS("http://www.w3.org/2000/svg","g");
        overlay.appendChild(gSlices);
        overlay.appendChild(gLeaders);
        overlay.appendChild(gLabels);

        overlay.addEventListener("mousemove", (e) => {
          const rect = grafica.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          tooltip.style.left = x + "px";
          tooltip.style.top  = y + "px";
        });
        overlay.addEventListener("mouseleave", () => {
          tooltip.classList.remove("visible");
        });

        let angAcum = 0;
        for (let i=0;i<datos.length;i++){
          const fr = datos[i].Valor / suma;
          const angInicio = angAcum;
          const angFin = angAcum + fr * Math.PI * 2;
          const angMid = (angInicio + angFin) / 2;
          angAcum = angFin;

          // Path para hover
          const path = document.createElementNS("http://www.w3.org/2000/svg","path");
          path.setAttribute("d", arcoPath(cx, cy, r, angInicio, angFin));
          gSlices.appendChild(path);

          path.addEventListener("mouseenter", () => {
            tooltip.innerHTML = `<b>${datos[i].Etiqueta}</b><br>${datos[i].Valor}`;
            tooltip.classList.add("visible");
          });
          path.addEventListener("mouseleave", () => {
            tooltip.classList.remove("visible");
          });

          // Etiquetas estáticas
          const text = document.createElementNS("http://www.w3.org/2000/svg","text");
          text.setAttribute("class","label");
          text.textContent = labelFormatter(datos[i], fr);
          const a = angMid - Math.PI/2;

          if (fr >= insideMinFraction){
            const rx = r * innerRadiusRatio;
            const x = cx + rx * Math.cos(a);
            const y = cy + rx * Math.sin(a);
            text.setAttribute("x", x);
            text.setAttribute("y", y);
            text.setAttribute("text-anchor","middle");
            gLabels.appendChild(text);
          } else {
            const x1 = cx + r * outerLineStart * Math.cos(a);
            const y1 = cy + r * outerLineStart * Math.sin(a);
            const x2 = cx + r * outerLineEnd   * Math.cos(a);
            const y2 = cy + r * outerLineEnd   * Math.sin(a);
            const line = document.createElementNS("http://www.w3.org/2000/svg","path");
            line.setAttribute("class","leader");
            const side = Math.cos(a) >= 0 ? 1 : -1;
            const x2b = x2 + side * 8;
            const y2b = y2;
            line.setAttribute("d", `M ${x1} ${y1} L ${x2} ${y2} L ${x2b} ${y2b}`);
            gLeaders.appendChild(line);

            const xText = cx + r * outerLabelRadius * Math.cos(a) + side * 14;
            const yText = cy + r * outerLabelRadius * Math.sin(a);
            text.setAttribute("x", xText);
            text.setAttribute("y", yText);
            text.setAttribute("text-anchor", side === 1 ? "start" : "end");
            gLabels.appendChild(text);
          }
        }

        grafica.appendChild(overlay);
      }

      // Render con títulos
      jvgraficatarta(".grafica1", datos1, "#c02424", "Países");
      jvgraficatarta(".grafica2", datos2, "#2acb71", "Ciudades");
      jvgraficatarta(".grafica3", datos3, "#4e61cd", "Lenguajes de programación");
      jvgraficatarta(".grafica4", datos4, "#cdab5a", "Frutas");

      // Ejemplo alternativo con porcentaje en etiquetas:
      // jvgraficatarta(".grafica1", datos1, "#c02424", "Países", {
      //   labelFormatter: (d, fr) => `${d.Etiqueta} (${(fr*100).toFixed(1)}%)`
      // });
    </script>
  </body>
</html>
```

### jvgraficabarras

```css
 .jvgraficabarras{
  font-family:sans-serif;
}
.jvgraficabarras td:first-child{
  text-align:right;
}
.jvgraficabarras .barra{
  min-width:0px;
  height:10px;
  background:blue;
  border-radius:5px;
  padding:5px;
  color:white;
  font-size:10px;
  line-height:10px;
  font-weight:bold;
}
```

### jvgraficabarras

```javascript
function graficaBarras(selector,misdatos,color){
      
  let grafica = document.querySelector(selector);
  
  let tabla = document.createElement("table");
  tabla.classList.add("jvgraficabarras")
  grafica.appendChild(tabla)
  
  let cabecera = document.createElement("thead");
  tabla.appendChild(cabecera)
  
  let filacabecera = document.createElement("tr");
  filacabecera.innerHTML = "<th>Valor</th><th>Gráfica</th>"
  cabecera.appendChild(filacabecera)
  
  let cuerpo = document.createElement("tbody");
  tabla.appendChild(cuerpo);
  
  misdatos.forEach(function(dato){
  console.log("hola")
 
    let fila = document.createElement("tr")
    cuerpo.appendChild(fila);
     
    let valor = document.createElement("td")
    valor.textContent = dato.Valor
    fila.appendChild(valor)
    
    let contienebarra = document.createElement("td")
    let barra = document.createElement("div")
    barra.classList.add("barra")
    barra.textContent = dato.Etiqueta
    barra.style.width = dato.Valor+"px"
    barra.style.backgroundColor = color
    contienebarra.appendChild(barra)
    
    fila.appendChild(contienebarra)
    
  })
}
```

<a id="clases-propiedades-metodos"></a>
## Clases, propiedades, métodos

En este capítulo del curso sobre desarrollo de interfaces de usuario, nos adentramos en el mundo de las clases, propiedades y métodos, elementos fundamentales para la creación de componentes visuales interactivos. Comenzamos por entender qué es una clase en el contexto de la programación orientada a objetos (POO), un paradigma que permite organizar y reutilizar código de manera eficiente.

Una clase es una plantilla o molde que define las características y comportamientos comunes de un conjunto de objetos. Cada objeto creado a partir de una clase se considera una instancia de esa clase, y puede acceder a los atributos (propiedades) y métodos definidos en la clase. Por ejemplo, si estamos creando una aplicación gráfica, podríamos tener una clase llamada `Botón`, que tendría propiedades como el texto del botón y métodos para cambiar ese texto o simular un clic.

Las propiedades son variables asociadas a una clase que almacenan los valores de los atributos. En la clase `Botón`, las propiedades podrían incluir el texto del botón (`texto`) y su estado (`habilitado`). Estas propiedades pueden ser modificadas o consultadas desde cualquier instancia de la clase, lo que permite cambiar dinámicamente la apariencia y el comportamiento del componente.

Los métodos son funciones asociadas a una clase que definen las acciones que puede realizar un objeto. En la clase `Botón`, los métodos podrían incluir `clic()`, que simula un clic en el botón, o `deshabilitar()`, que cambia el estado del botón a deshabilitado. Al llamar a estos métodos en una instancia de la clase, se ejecutan las acciones definidas dentro de ellos.

La relación entre clases, propiedades y métodos es fundamental para crear interfaces de usuario complejas y dinámicas. Cada componente visual puede ser representado por una clase con sus propias propiedades y métodos específicos, lo que facilita la gestión del estado y el comportamiento del componente en tiempo real.

Además, al trabajar con clases, propiedades y métodos, es importante considerar la encapsulación, un principio de la POO que oculta los detalles internos de una clase y expone solo las funcionalidades necesarias. Esto mejora la seguridad y la mantenibilidad del código, ya que permite cambiar el interior de una clase sin afectar a los objetos que la utilizan.

En este capítulo hemos explorado los conceptos básicos de clases, propiedades y métodos en el contexto de la generación de interfaces de usuario. A medida que avanzamos en nuestro estudio, aprenderemos cómo combinar estos elementos para crear componentes visuales interactivos y funcionales, así como cómo gestionar eventos y asociar acciones a ellos. Estas habilidades son esenciales para desarrollar aplicaciones gráficas eficientes y de alta calidad.

### clase tabla

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JSON → HTML Table</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827ee; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --accent:#38bdf8; /* sky-400 */
      --accent-2:#22d3ee; /* cyan-400 */
      --ring:#1f2937; /* gray-800 */
      --ok:#34d399;
      --warn:#f59e0b;
      --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 1200px at 10% 0%, #0b122c 0%, var(--bg) 40%, #0b122c 100%);
      color:var(--text);
    }
    .wrap{max-width:1200px;margin:32px auto;padding:0 16px}
    h1{font-weight:800;letter-spacing:.4px;margin:0 0 12px;font-size:clamp(20px,3vw,28px)}
    p.subtitle{margin:0 0 18px;color:var(--muted)}

    .controls{display:grid;gap:12px;grid-template-columns:1fr;}
    @media (min-width: 900px){.controls{grid-template-columns: 1fr 320px;}}

    .card{background:linear-gradient(180deg, #0b122c, var(--panel)); border:1px solid var(--ring); border-radius:16px; box-shadow: 0 10px 30px #00000044;}
    .pad{padding:14px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .toolbar .spacer{flex:1}

    textarea{
      width:100%; min-height:200px; border:1px solid var(--ring); border-radius:12px; background:#0b122c; color:var(--text); padding:12px; resize:vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Liberation Mono", Consolas, monospace;
    }
    label{display:block;font-weight:600; margin:8px 0 6px; color:#cbd5e1}
    .hint{color:var(--muted);font-size:12px}

    button, .btn{
      appearance:none; border:1px solid var(--ring); background:#0b122c; color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600; transition:transform .04s ease, border-color .2s ease, background .2s ease; text-decoration:none; display:inline-flex; align-items:center; gap:8px;
    }
    button:hover{border-color:#334155}
    button:active{transform:translateY(1px)}
    .btn-primary{background:linear-gradient(180deg, #0ea5e9, #06b6d4); color:#003244; border:none}
    .btn-primary:hover{filter:brightness(1.05)}

    input[type="file"]{display:none}
    .file-label{border:1px dashed #334155; padding:8px 12px; border-radius:10px; cursor:pointer;}

    .status{font-size:12px}
    .status.ok{color:var(--ok)}
    .status.warn{color:var(--warn)}
    .status.err{color:var(--err)}

    .table-wrap{margin-top:16px; background:linear-gradient(180deg, #0b122c, var(--panel)); border:1px solid var(--ring); border-radius:16px; overflow:hidden}
    .table-scroll{overflow:auto; max-height:60vh}
    table{border-collapse:separate; border-spacing:0; width:100%; min-width:600px}
    thead th{position:sticky; top:0; background:#0b122c; z-index:1;}
    th, td{padding:10px 12px; border-bottom:1px solid #1f2937; text-align:left; vertical-align:top;}
    tbody tr:nth-child(odd){background:#0b122c33}
    tbody tr:hover{background:#0b122c66}
    th.sortable{cursor:pointer; user-select:none}
    th.sortable .dir{opacity:.6; font-size:11px}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #334155;color:#cbd5e1}

    .footer{display:flex;gap:10px;align-items:center;justify-content:space-between;color:var(--muted);padding:10px}
    .search{display:flex;gap:8px;align-items:center}
    .search input{background:#0b122c;border:1px solid var(--ring);border-radius:10px;padding:8px 10px;color:var(--text);min-width:200px}
    .count{font-size:12px}
    .no-data{padding:24px;color:var(--muted)}
    code.inline{background:#0b122c;padding:2px 6px;border:1px solid var(--ring);border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>JSON → HTML Table</h1>
    <p class="subtitle">Paste JSON, upload a file, or use the sample. Nested objects are flattened with dot‑notation; arrays of primitives are joined with commas. Click headers to sort. Export to CSV.</p>

    <div class="controls">
      <div class="card pad">
        <label for="jsonInput">Your JSON</label>
        <textarea id="jsonInput" spellcheck="false" placeholder='Example: [{"id":1,"name":"Ada"},{"id":2,"name":"Linus"}]'></textarea>
        <div class="toolbar" style="margin-top:10px">
          <button id="renderBtn" class="btn-primary">Render ⏎</button>
          <label class="file-label" title="Upload JSON file">
            <input id="fileInput" type="file" accept=".json,application/json" />
            Upload JSON…
          </label>
          <button id="sampleBtn">Load sample</button>
          <div class="spacer"></div>
          <span id="status" class="status">Idle</span>
        </div>
      </div>

      <div class="card pad">
        <label>Quick tips</label>
        <ul style="margin:8px 0 12px 18px; padding:0; color:var(--muted)">
          <li>Top level can be an <code class="inline">Array</code> or an <code class="inline">Object</code>.</li>
          <li>Click a header to sort ascending/descending.</li>
          <li>Use the search box to filter visible rows.</li>
          <li>Download the current view as CSV.</li>
        </ul>
        <div class="pill">Arrays of objects are supported</div>
      </div>
    </div>

    <div class="table-wrap card" id="tableWrap" hidden>
      <div class="pad" style="padding-bottom:0">
        <div class="footer">
          <div class="search">
            <span>Search</span>
            <input id="searchInput" placeholder="type to filter…" />
          </div>
          <div>
            <button id="downloadBtn" title="Download CSV of current rows">Download CSV</button>
            <span class="count" id="count"></span>
          </div>
        </div>
      </div>
      <div class="table-scroll" id="tableScroll">
        <table id="table"></table>
        <div class="no-data" id="noData" hidden>No rows match your filter.</div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const $ = (sel, el=document)=>el.querySelector(sel);
    const $$ = (sel, el=document)=>Array.from(el.querySelectorAll(sel));

    const jsonInput = $('#jsonInput');
    const statusEl = $('#status');
    const tableWrap = $('#tableWrap');
    const tableEl = $('#table');
    const tableScroll = $('#tableScroll');
    const searchInput = $('#searchInput');
    const countEl = $('#count');
    const noDataEl = $('#noData');

    let rows = [];        // flattened data objects
    let columns = [];     // array of keys
    let viewRows = [];    // filtered/sorted slice
    let sortState = { key:null, dir: 1 }; // 1 asc, -1 desc

    // --- Flatten helpers ---
    function isPlainObject(v){
      return Object.prototype.toString.call(v) === '[object Object]';
    }

    function flatten(obj, prefix=''){
      const out = {};
      const stack = [{value: obj, path: prefix}];
      while (stack.length){
        const {value, path} = stack.pop();
        if (Array.isArray(value)){
          // If array of primitives → join
          const allPrimitive = value.every(v => !isPlainObject(v) && !Array.isArray(v));
          if (allPrimitive){
            out[path || 'value'] = value.join(', ');
          } else {
            value.forEach((v,i)=>{
              const p = path ? path + '['+i+']' : '['+i+']';
              if (isPlainObject(v) || Array.isArray(v)) stack.push({value:v, path:p});
              else out[p] = String(v);
            });
          }
        } else if (isPlainObject(value)){
          const keys = Object.keys(value);
          if (keys.length === 0){ out[path || 'value'] = '{}'; continue; }
          keys.forEach(k=>{
            const v = value[k];
            const p = path ? path + '.' + k : k;
            if (isPlainObject(v) || Array.isArray(v)) stack.push({value:v, path:p});
            else out[p] = v == null ? '' : String(v);
          });
        } else {
          out[path || 'value'] = value == null ? '' : String(value);
        }
      }
      return out;
    }

    function collectColumns(list){
      const set = new Set();
      list.forEach(r=>Object.keys(r).forEach(k=>set.add(k)));
      return Array.from(set);
    }

    function renderTable(){
      // Header
      const thead = document.createElement('thead');
      const headRow = document.createElement('tr');
      columns.forEach(k=>{
        const th = document.createElement('th');
        th.textContent = k;
        th.title = 'Sort by '+k;
        th.className = 'sortable';
        th.addEventListener('click', ()=>onSort(k));
        const dirSpan = document.createElement('span');
        dirSpan.className = 'dir'; dirSpan.style.marginLeft = '6px';
        if (sortState.key === k) dirSpan.textContent = sortState.dir === 1 ? '▲' : '▼';
        th.appendChild(dirSpan);
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);

      // Body
      const tbody = document.createElement('tbody');
      if (viewRows.length === 0){
        noDataEl.hidden = false;
      } else {
        noDataEl.hidden = true;
        const frag = document.createDocumentFragment();
        viewRows.forEach(r=>{
          const tr = document.createElement('tr');
          columns.forEach(k=>{
            const td = document.createElement('td');
            const v = r[k];
            td.textContent = v == null ? '' : String(v);
            tr.appendChild(td);
          });
          frag.appendChild(tr);
        });
        tbody.appendChild(frag);
      }

      tableEl.innerHTML = '';
      tableEl.appendChild(thead);
      tableEl.appendChild(tbody);

      countEl.textContent = viewRows.length ? `${viewRows.length} row(s)` : '';
      tableWrap.hidden = false;
    }

    function onSort(key){
      if (sortState.key === key){ sortState.dir *= -1; }
      else { sortState.key = key; sortState.dir = 1; }
      const dir = sortState.dir;
      viewRows.sort((a,b)=>{
        const va = a[key] ?? '';
        const vb = b[key] ?? '';
        const na = Number(va), nb = Number(vb);
        const bothNum = !isNaN(na) && !isNaN(nb);
        if (bothNum){ return (na - nb) * dir; }
        return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'}) * dir;
      });
      renderTable();
    }

    function applyFilter(){
      const q = searchInput.value.trim().toLowerCase();
      if (!q){ viewRows = rows.slice(); return; }
      viewRows = rows.filter(r=>{
        for (const k of columns){
          const v = r[k];
          if (v && String(v).toLowerCase().includes(q)) return true;
        }
        return false;
      });
    }

    function toCSV(cols, data){
      const esc = (s)=>('"' + String(s ?? '').replaceAll('"','""') + '"');
      const lines = [];
      lines.push(cols.map(esc).join(','));
      data.forEach(r=>{
        lines.push(cols.map(c=>esc(r[c])).join(','));
      });
      return lines.join('\n');
    }

    function downloadCSV(){
      const csv = toCSV(columns, viewRows);
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'table.csv';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    function parseTop(json){
      let top = json;
      if (Array.isArray(top)) return top;
      if (isPlainObject(top)){
        // if object with an array property, prefer that
        const firstArrayKey = Object.keys(top).find(k=>Array.isArray(top[k]));
        if (firstArrayKey) return top[firstArrayKey];
        return [top];
      }
      throw new Error('Top-level JSON must be an object or array');
    }

    function renderFromJSON(json){
      const arr = parseTop(json);
      const flat = arr.map(x=>flatten(x));
      rows = flat;
      columns = collectColumns(flat);
      viewRows = rows.slice();
      sortState = {key:null, dir:1};
      applyFilter();
      renderTable();
    }

    // --- Wiring ---
    $('#renderBtn').addEventListener('click', ()=>{
      try{
        statusEl.textContent = 'Parsing…';
        const text = jsonInput.value.trim();
        if (!text) throw new Error('Please paste some JSON');
        const json = JSON.parse(text);
        renderFromJSON(json);
        statusEl.textContent = 'Rendered ✅'; statusEl.className = 'status ok';
      }catch(err){
        console.error(err);
        statusEl.textContent = 'Error: ' + err.message; statusEl.className = 'status err';
      }
    });

    $('#fileInput').addEventListener('change', (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{ jsonInput.value = reader.result; };
      reader.onerror = ()=>{ statusEl.textContent = 'Error reading file'; statusEl.className = 'status err'; };
      reader.readAsText(f);
    });

    $('#sampleBtn').addEventListener('click', ()=>{
      const sample = [
        {
          id: 1,
          name: "Ada Lovelace",
          tags: ["math","programming"],
          contact: { email: "ada@example.com", phones: ["+44 123 456", "+44 987 654"] },
          scores: [{q:"logic",v:9.5},{q:"writing",v:8.7}],
          active: true
        },
        {
          id: 2,
          name: "Linus Torvalds",
          tags: ["linux","git"],
          contact: { email: "linus@example.com" },
          scores: [{q:"kernels",v:10}],
          active: false
        }
      ];
      jsonInput.value = JSON.stringify(sample, null, 2);
      statusEl.textContent = 'Sample loaded'; statusEl.className = 'status';
    });

    $('#downloadBtn').addEventListener('click', downloadCSV);
    searchInput.addEventListener('input', ()=>{ applyFilter(); renderTable(); });

    // small UX: Ctrl/Cmd+Enter to render
    jsonInput.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter'){ $('#renderBtn').click(); }
    });

    // initial state
    tableWrap.hidden = true;
  })();
  </script>
</body>
</html>
```

### simplificar

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JSON → Table (minimal, reusable)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;   /* slate-900 */
      --muted:#475569;  /* slate-600 */
      --line:#e2e8f0;   /* slate-200 */
      --head:#0ea5e9;   /* sky-500 */
      --chip:#f1f5f9;   /* slate-100 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:960px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 8px;font-size:clamp(18px,3.5vw,26px)}
    p{margin:0 0 18px;color:var(--muted)}

    .card{border:1px solid var(--line); border-radius:12px; overflow:hidden}
    .pad{padding:14px}

    table{width:100%; border-collapse:separate; border-spacing:0; font-size:14px}
    thead th{position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--line); text-align:left; font-weight:700; padding:10px 12px}
    tbody td{border-bottom:1px solid var(--line); padding:10px 12px; vertical-align:top}
    tbody tr:nth-child(odd){background:#fafafa}
    .table-scroll{max-height:70vh; overflow:auto; border-top:1px solid var(--line)}

    code.inline{background:var(--chip); padding:2px 6px; border-radius:6px}
    .badge{display:inline-block; background:var(--chip); padding:2px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>JSON → Table</h1>
    <p>Minimal example with a hardcoded sample. The renderer is packaged as <code class="inline">window.renderJSONTable(el, data, options)</code> for reuse.</p>

    <div class="card">
      <div class="pad">
        <span class="badge">Sample data rendered below</span>
      </div>
      <div class="table-scroll">
        <table id="table"></table>
      </div>
    </div>
  </div>

  <script>
  // --- Reusable renderer ------------------------------------------------------
  // window.renderJSONTable(target, data, options)
  //  - target: CSS selector or Element for the <table>
  //  - data: Array of objects OR a single object OR { items: [...] }
  //  - options: { flatten: true, joinArraysWith: ', ' }
  (function(){
    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';

    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value, p:prefix}];
      while (stack.length){
        const {v, p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p || 'value'] = v.join(', '); }
          else v.forEach((x,i)=>{
            const np = p ? `${p}[${i}]` : `[${i}]`;
            if (isPlain(x) || Array.isArray(x)) stack.push({v:x, p:np});
            else out[np] = String(x);
          });
        } else if (isPlain(v)){
          const ks = Object.keys(v);
          if (ks.length === 0){ out[p || 'value'] = '{}'; continue; }
          ks.forEach(k => {
            const nv = v[k]; const np = p ? `${p}.${k}` : k;
            if (isPlain(nv) || Array.isArray(nv)) stack.push({v:nv, p:np});
            else out[np] = nv == null ? '' : String(nv);
          });
        } else {
          out[p || 'value'] = v == null ? '' : String(v);
        }
      }
      return out;
    }

    function normalizeTop(json){
      if (Array.isArray(json)) return json;
      if (isPlain(json)){
        const key = Object.keys(json).find(k=>Array.isArray(json[k]));
        return key ? json[key] : [json];
      }
      return [json];
    }

    function collectColumns(rows){
      const set = new Set();
      rows.forEach(r => Object.keys(r).forEach(k => set.add(k)));
      return Array.from(set);
    }

    function renderJSONTable(target, data, options={}){
      const table = (typeof target === 'string') ? document.querySelector(target) : target;
      if (!table) throw new Error('Target table not found');
      const opts = { flatten:true, joinArraysWith:', ', ...options };

      const arr = normalizeTop(data);
      const flat = opts.flatten ? arr.map(x=>flatten(x)) : arr;
      const cols = collectColumns(flat);

      const thead = document.createElement('thead');
      const hr = document.createElement('tr');
      cols.forEach(c=>{ const th=document.createElement('th'); th.textContent=c; hr.appendChild(th); });
      thead.appendChild(hr);

      const tbody = document.createElement('tbody');
      const frag = document.createDocumentFragment();
      flat.forEach(row => {
        const tr = document.createElement('tr');
        cols.forEach(c => { const td=document.createElement('td'); td.textContent = row[c] ?? ''; tr.appendChild(td); });
        frag.appendChild(tr);
      });
      tbody.appendChild(frag);

      table.innerHTML = '';
      table.appendChild(thead);
      table.appendChild(tbody);

      return { columns: cols, rows: flat };
    }

    // Expose for reuse
    window.renderJSONTable = renderJSONTable;
  })();

  // --- Hardcoded sample -------------------------------------------------------
  const sample = [
    {
      id: 1,
      name: "Ada Lovelace",
      email: "ada@example.com",
      tags: ["math","programming"],
      profile: { role: "Analyst", location: { city: "London", country: "UK" } },
      score: 9.5
    },
    {
      id: 2,
      name: "Linus Torvalds",
      email: "linus@example.com",
      tags: ["linux","git"],
      profile: { role: "Engineer" },
      score: 10
    }
  ];

  // Render on load
  window.addEventListener('DOMContentLoaded', ()=>{
    window.renderJSONTable('#table', sample);
  });
  </script>
</body>
</html>
```

### encappsular

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – Table Renderer (v0)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;   /* slate-900 */
      --muted:#475569;  /* slate-600 */
      --line:#e2e8f0;   /* slate-200 */
      --head:#0ea5e9;   /* sky-500 */
      --chip:#f8fafc;   /* slate-50 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:1000px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 6px;font-size:clamp(18px,3.5vw,26px)}
    p{margin:0 0 14px;color:var(--muted)}

    .card{border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#fff}
    .pad{padding:14px}

    .toolbar{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .search{display:flex; gap:8px; align-items:center}
    .search input{border:1px solid var(--line); border-radius:10px; padding:8px 10px; min-width:220px}
    .badge{display:inline-block; background:var(--chip); padding:2px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted)}

    .table-scroll{max-height:70vh; overflow:auto; border-top:1px solid var(--line)}
    table{width:100%; border-collapse:separate; border-spacing:0; font-size:14px}
    thead th{position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap}
    th.sortable{cursor:pointer; user-select:none}
    th .dir{margin-left:6px; font-size:11px; color:var(--muted)}
    tbody td{border-bottom:1px solid var(--line); padding:10px 12px; vertical-align:top}
    tbody tr:nth-child(odd){background:#fafafa}
    .count{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>jocarsa|ux</h1>
    <p>Lightweight UI kit (v0). For now it ships a table renderer with search and sortable columns. API: <code>new JocarsaUX().tableRenderer(opts)</code>.</p>

    <div class="card">
      <div class="pad">
        <div class="toolbar">
          <span class="badge">Table demo</span>
          <div class="search">
            <label for="searchInput">Search</label>
            <input id="searchInput" placeholder="type to filter…" />
            <span id="count" class="count"></span>
          </div>
        </div>
      </div>
      <div class="table-scroll">
        <table id="table"></table>
      </div>
    </div>
  </div>

  <script>
  // ----------------------------------------------------------------------------
  // jocarsa|ux v0 — core class (table renderer only for now)
  // Public API (stable):
  //   const ux = new JocarsaUX();
  //   ux.tableRenderer({ target, data, flatten=true, onRender });
  //   ux.setFilter(query); ux.sortBy(columnKey, dir=1);
  // ----------------------------------------------------------------------------
  class JocarsaUX{
    constructor(){
      this.state = { columns: [], rows: [], view: [], sort: {key:null, dir:1}, query:'' };
      this._els = { table:null, search:null, count:null };
    }

    // ---- utils ---------------------------------------------------------------
    static _isPlain(v){ return Object.prototype.toString.call(v) === '[object Object]'; }
    static _flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !JocarsaUX._isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else v.forEach((x,i)=>{
            const np = p ? `${p}[${i}]` : `[${i}]`;
            if (JocarsaUX._isPlain(x) || Array.isArray(x)) stack.push({v:x,p:np});
            else out[np] = String(x);
          });
        } else if (JocarsaUX._isPlain(v)){
          const ks = Object.keys(v);
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv = v[k]; const np = p ? `${p}.${k}` : k;
            if (JocarsaUX._isPlain(nv) || Array.isArray(nv)) stack.push({v:nv,p:np});
            else out[np] = nv==null ? '' : String(nv);
          });
        } else {
          out[p||'value'] = v==null ? '' : String(v);
        }
      }
      return out;
    }
    static _normalizeTop(json){
      if (Array.isArray(json)) return json;
      if (JocarsaUX._isPlain(json)){
        const key = Object.keys(json).find(k=>Array.isArray(json[k]));
        return key ? json[key] : [json];
      }
      return [json];
    }
    static _collectColumns(rows){
      const set = new Set(); rows.forEach(r=>Object.keys(r).forEach(k=>set.add(k))); return Array.from(set);
    }

    // ---- core table renderer -------------------------------------------------
    tableRenderer({ target, data, flatten=true, onRender, searchInput, countEl }={}){
      const table = typeof target === 'string' ? document.querySelector(target) : target;
      if (!table) throw new Error('Target table not found');
      this._els.table = table;
      this._els.search = typeof searchInput === 'string' ? document.querySelector(searchInput) : searchInput;
      this._els.count  = typeof countEl === 'string' ? document.querySelector(countEl) : countEl;

      const arr = JocarsaUX._normalizeTop(data);
      const flat = flatten ? arr.map(JocarsaUX._flatten) : arr;
      const cols = JocarsaUX._collectColumns(flat);
      this.state.columns = cols; this.state.rows = flat; this.state.view = flat.slice();
      this.state.sort = {key:null, dir:1}; this.state.query = '';

      // wire search
      if (this._els.search){
        this._els.search.value = '';
        this._els.search.oninput = ()=>{ this.setFilter(this._els.search.value); };
      }

      this._renderTable();
      if (typeof onRender === 'function') onRender({ columns: cols, rows: flat });
      return this; // chainable
    }

    setFilter(query=''){
      this.state.query = String(query).toLowerCase();
      const { rows, columns } = this.state;
      if (!this.state.query){ this.state.view = rows.slice(); }
      else {
        this.state.view = rows.filter(r=>{
          for (const k of columns){ const v = r[k]; if (v && String(v).toLowerCase().includes(this.state.query)) return true; }
          return false;
        });
      }
      this._renderTableBody();
      return this;
    }

    sortBy(key, dir){
      if (!key) return this;
      const s = this.state;
      if (dir == null){
        if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; }
      } else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
      const { view } = s; const d = s.sort.dir;
      view.sort((a,b)=>{
        const va=a[key] ?? '', vb=b[key] ?? '';
        const na=Number(va), nb=Number(vb);
        const bothNum = !isNaN(na) && !isNaN(nb);
        if (bothNum) return (na-nb)*d;
        return String(va).localeCompare(String(vb), undefined, {numeric:true,sensitivity:'base'}) * d;
      });
      this._renderTable();
      return this;
    }

    // ---- internals -----------------------------------------------------------
    _renderTable(){
      const table = this._els.table; const { columns } = this.state;
      // header
      const thead = document.createElement('thead');
      const hr = document.createElement('tr');
      columns.forEach(c=>{
        const th = document.createElement('th');
        th.textContent = c; th.className = 'sortable'; th.title = 'Sort by '+c;
        const dir = document.createElement('span'); dir.className='dir';
        if (this.state.sort.key === c) dir.textContent = this.state.sort.dir===1 ? '▲' : '▼';
        th.appendChild(dir);
        th.addEventListener('click', ()=>this.sortBy(c));
        hr.appendChild(th);
      });
      thead.appendChild(hr);

      // body
      const tbody = this._renderTableBody(true);

      table.innerHTML = '';
      table.appendChild(thead);
      table.appendChild(tbody);
    }

    _renderTableBody(makeNew=false){
      const table = this._els.table; const { columns, view } = this.state;
      let tbody = makeNew ? document.createElement('tbody') : table.querySelector('tbody');
      if (!tbody){ tbody = document.createElement('tbody'); table.appendChild(tbody); }
      const frag = document.createDocumentFragment();
      view.forEach(r=>{
        const tr = document.createElement('tr');
        columns.forEach(c=>{ const td=document.createElement('td'); td.textContent = r[c] ?? ''; tr.appendChild(td); });
        frag.appendChild(tr);
      });
      tbody.innerHTML = ''; tbody.appendChild(frag);

      if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      return tbody;
    }
  }

  // Expose under a friendly brand alias as well
  window.JocarsaUX = JocarsaUX;         // class
  window['jocarsa|ux'] = { UX: JocarsaUX }; // brand handle (object key with pipe)

  // --- Hardcoded sample & demo wiring ----------------------------------------
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({
      target:'#table',
      data: sample,
      searchInput:'#searchInput',
      countEl:'#count',
    });
  });
  </script>
</body>
</html>
```

### namespace

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1)</title>
  <!-- No CSS here on purpose. The class injects a namespaced <style> at runtime. -->
</head>
<body>
  <!-- Minimal host. Everything else is created by JS below. -->
  <div id="app"></div>
  <div id="app2"></div>
  <script>
  // ----------------------------------------------------------------------------
  // jocarsa|ux v0.1
  // - Full CSS namespace (prefix: .jux-*)
  // - All DOM created by JS inside a target element
  // - Table renderer with searchable + sortable columns
  // ----------------------------------------------------------------------------
  (function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`; // e.g., jux-wrap, jux-card

    // Inject namespaced CSS once
    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else v.forEach((x,i)=>{ const np = p ? `${p}[${i}]` : `[${i}]`; if (isPlain(x) || Array.isArray(x)) stack.push({v:x,p:np}); else out[np] = String(x); });
        } else if (isPlain(v)){
          const ks = Object.keys(v); if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{ const nv=v[k]; const np = p ? `${p}.${k}` : k; if (isPlain(nv) || Array.isArray(nv)) stack.push({v:nv,p:np}); else out[np] = nv==null ? '' : String(nv); });
        } else { out[p||'value'] = v==null ? '' : String(v); }
      }
      return out;
    }
    function normalizeTop(json){ if (Array.isArray(json)) return json; if (isPlain(json)){ const key=Object.keys(json).find(k=>Array.isArray(json[k])); return key?json[key]:[json]; } return [json]; }
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      // public API: build UI inside target
      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        // Clear host
        host.innerHTML = '';

        // Build structure
        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        // Save refs
        this._els = { host, table, thead, tbody, search: input, count };

        // Data
        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(flatten) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; this.state.view = flat.slice(); this.state.sort = {key:null, dir:1}; this.state.query='';

        // Wire search
        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        // Initial render
        this._renderHead();
        this._renderBody();
        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      // internals
      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        // Clear tbody (avoids any malformed row carryover)
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag); // rows are DOM‑built; tags are correct and closed by the parser
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    // Helpers
    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    // Expose
    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);

  // --- Demo wiring ------------------------------------------------------------
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: sample });
    ux.tableRenderer({ target: '#app2', data: sample });
  });
  </script>
</body>
</html>
```

### tabla correctamente renderizada

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1)</title>
  <!-- No CSS here on purpose. The class injects a namespaced <style> at runtime. -->
</head>
<body>
  <!-- Minimal host. Everything else is created by JS below. -->
  <div id="app"></div>

  <script>
  // ----------------------------------------------------------------------------
  // jocarsa|ux v0.1
  // - Full CSS namespace (prefix: .jux-*)
  // - All DOM created by JS inside a target element
  // - Table renderer with searchable + sortable columns
  // ----------------------------------------------------------------------------
  (function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`; // e.g., jux-wrap, jux-card

    // Inject namespaced CSS once
    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else v.forEach((x,i)=>{ const np = p ? `${p}[${i}]` : `[${i}]`; if (isPlain(x) || Array.isArray(x)) stack.push({v:x,p:np}); else out[np] = String(x); });
        } else if (isPlain(v)){
          const ks = Object.keys(v); if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{ const nv=v[k]; const np = p ? `${p}.${k}` : k; if (isPlain(nv) || Array.isArray(nv)) stack.push({v:nv,p:np}); else out[np] = nv==null ? '' : String(nv); });
        } else { out[p||'value'] = v==null ? '' : String(v); }
      }
      return out;
    }
    function normalizeTop(json){ if (Array.isArray(json)) return json; if (isPlain(json)){ const key=Object.keys(json).find(k=>Array.isArray(json[k])); return key?json[key]:[json]; } return [json]; }
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      // public API: build UI inside target
      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        // Clear host
        host.innerHTML = '';

        // Build structure
        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        // Save refs
        this._els = { host, table, thead, tbody, search: input, count };

        // Data
        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(flatten) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; this.state.view = flat.slice(); this.state.sort = {key:null, dir:1}; this.state.query='';

        // Wire search
        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        // Initial render
        this._renderHead();
        this._renderBody();
        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      // internals
      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        // Clear tbody (avoids any malformed row carryover)
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag); // rows are DOM‑built; tags are correct and closed by the parser
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    // Helpers
    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    // Expose
    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);

  // --- Demo wiring ------------------------------------------------------------
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: sample });
  });
  </script>
</body>
</html>
```

### renderiza bien

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
</head>
<body>
  <div id="app"></div>

  <script>
  (function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    // Fixed flatten function - only flattens a single object, not arrays of objects
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          // Arrays are joined as comma-separated strings
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            // If array contains objects, just stringify it
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              // Recursively flatten nested objects
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              // Handle arrays as comma-separated strings
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count };

        // Fixed: normalize to array first, THEN flatten each object individually
        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);

  // Demo
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: sample });
  });
  </script>
</body>
</html>
```

### consumo datos externos

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
</head>
<body>
  <div id="app"></div>

  <script>
  (function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    // Fixed flatten function - only flattens a single object, not arrays of objects
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          // Arrays are joined as comma-separated strings
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            // If array contains objects, just stringify it
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              // Recursively flatten nested objects
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              // Handle arrays as comma-separated strings
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count };

        // Fixed: normalize to array first, THEN flatten each object individually
        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);
/*
  // Demo
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: sample });
  });
  */
  
  fetch("api.php")
  .then(function(respuesta){return respuesta.json()})
  .then(function(datos){
    console.log(datos)
  })
  </script>
</body>
</html>
```

### represento la tabla

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
</head>
<body>
  <div id="app"></div>

  <script>
  (function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    // Fixed flatten function - only flattens a single object, not arrays of objects
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          // Arrays are joined as comma-separated strings
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            // If array contains objects, just stringify it
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              // Recursively flatten nested objects
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              // Handle arrays as comma-separated strings
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count };

        // Fixed: normalize to array first, THEN flatten each object individually
        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);
/*
  // Demo
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: sample });
  });
  */
  
  fetch("api.php")
  .then(function(respuesta){return respuesta.json()})
  .then(function(datos){
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: datos });
  })
  </script>
</body>
</html>
```

### externalizacion de prueba

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
</head>
<body>
  <div id="app"></div>
  <script src="pruebalibreria.js"></script>
  <script>
  

  
  fetch("api.php")
  .then(function(respuesta){return respuesta.json()})
  .then(function(datos){
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: datos });
  })
  </script>
</body>
</html>
```

### minisistema

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
</head>
<body>
  <div id="app"></div>
  <script src="pruebalibreria.js"></script>
  <script>
  

  
  fetch("api.php")
  .then(function(respuesta){return respuesta.json()})
  .then(function(datos){
    const ux = new JocarsaUX();
    ux.tableRenderer({ target: '#app', data: datos });
  })
  </script>
</body>
</html>
```

### api2

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;}
    main{flex:8;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script>
    let contenedor = document.querySelector("nav")
     fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
        })
      })
  </script>
</body>
</html>
```

### estilo del nav

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;display:flex;flex-direction:column;gap:10px;padding:20px;}
    nav button{background:white;width:100%;border:none;padding:10px;border-radius:100px;transition:all 1s;border:2px solid white;}
    nav button:hover{background:crimson;color:white;}
    main{flex:8;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script>
    let contenedor = document.querySelector("nav")
     fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
        })
      })
  </script>
</body>
</html>
```

### accion en cada boton

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;display:flex;flex-direction:column;gap:10px;padding:20px;}
    nav button{background:white;width:100%;border:none;padding:10px;border-radius:100px;transition:all 1s;border:2px solid white;}
    nav button:hover{background:crimson;color:white;}
    main{flex:8;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script>
    let contenedor = document.querySelector("nav")
     fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
          boton.onclick = function(){
            console.log("Me has hecho click")
          }
        })
      })
  </script>
</body>
</html>
```

### cargo la tabla

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;display:flex;flex-direction:column;gap:10px;padding:20px;}
    nav button{background:white;width:100%;border:none;padding:10px;border-radius:100px;transition:all 1s;border:2px solid white;}
    nav button:hover{background:crimson;color:white;}
    main{flex:8;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script>
    let contenedor = document.querySelector("nav")
     fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              console.log(datos)
            })
          }
        })
      })
  </script>
</body>
</html>
```

### ahora cargo la tabla que toca

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;display:flex;flex-direction:column;gap:10px;padding:20px;}
    nav button{background:white;width:100%;border:none;padding:10px;border-radius:100px;transition:all 1s;border:2px solid white;}
    nav button:hover{background:crimson;color:white;}
    main{flex:8;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script src="pruebalibreria.js"></script>
  <script>
    const ux = new JocarsaUX();
    let contenedor = document.querySelector("nav")
     fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              ux.tableRenderer({ target: 'main', data: datos });
            })
          }
        })
      })
  </script>
</body>
</html>
```

### ahora formularios

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.1 - Fixed)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;display:flex;flex-direction:column;gap:10px;padding:20px;}
    nav button{background:white;width:100%;border:none;padding:10px;border-radius:100px;transition:all 1s;border:2px solid white;}
    nav button:hover{background:crimson;color:white;}
    main{flex:8;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script src="jocarsaux2.js"></script>
  <script>
    const ux = new JocarsaUX();
    let contenedor = document.querySelector("nav")
     fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              ux.tableRenderer({ target: 'main', data: datos });
            })
          }
        })
      })
      fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        datos.forEach(function(tabla){
          let boton = document.createElement("button")
          boton.textContent = tabla
          contenedor.appendChild(boton)
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              ux.formRenderer({
                target: 'main',
                data: datos,
                title: 'User Registration',
                subtitle: 'Smart form with auto-detected field types',
                onSubmit: (formData) => {
                  console.log('Form submitted:', formData);
                },
                onReset: () => {
                  console.log('Form reset');
                }
              });
            })
          }
        })
      })
  </script>
</body>
</html>
```

### ahora graficas

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – namespaced, JS‑built UI (v0.2)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;background:crimson;display:flex;flex-direction:column;gap:10px;padding:20px;overflow-y:auto;}
    nav h3{color:white;margin:20px 0 10px 0;font-family:system-ui;font-size:14px;text-transform:uppercase;letter-spacing:1px;}
    nav h3:first-child{margin-top:0;}
    nav button{background:white;width:100%;border:none;padding:10px;border-radius:100px;transition:all 0.3s;border:2px solid white;cursor:pointer;font-family:system-ui;font-size:13px;font-weight:500;}
    nav button:hover{background:crimson;color:white;}
    main{flex:8;overflow:auto;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script src="jocarsaux3.js"></script>
  <script>
    const ux = new JocarsaUX();
    let contenedor = document.querySelector("nav");

    // Create section headers
    const tableHeader = document.createElement("h3");
    tableHeader.textContent = "📊 Tables";
    contenedor.appendChild(tableHeader);

    const tableContainer = document.createElement("div");
    contenedor.appendChild(tableContainer);

    const formHeader = document.createElement("h3");
    formHeader.textContent = "📝 Forms";
    contenedor.appendChild(formHeader);

    const formContainer = document.createElement("div");
    contenedor.appendChild(formContainer);

    const chartHeader = document.createElement("h3");
    chartHeader.textContent = "📈 Charts";
    contenedor.appendChild(chartHeader);

    const chartContainer = document.createElement("div");
    contenedor.appendChild(chartContainer);

    // Fetch tables and create buttons for each section
    fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        // TABLE BUTTONS
        datos.forEach(function(tabla){
          let boton = document.createElement("button");
          boton.textContent = tabla;
          tableContainer.appendChild(boton);
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              ux.tableRenderer({ 
                target: 'main', 
                data: datos,
                title: tabla + ' - Table View',
                subtitle: 'Searchable, sortable table with pagination',
                rowsPerPage: 5  // Custom rows per page
              });
            })
          }
        });

        // FORM BUTTONS
        datos.forEach(function(tabla){
          let boton = document.createElement("button");
          boton.textContent = tabla;
          formContainer.appendChild(boton);
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              ux.formRenderer({
                target: 'main',
                data: datos,
                title: tabla + ' - Form View',
                subtitle: 'Smart form with auto-detected field types',
                columns: 2,  // 2-column layout
                onSubmit: (formData) => {
                  console.log('Form submitted:', formData);
                  alert('Form data logged to console!');
                },
                onReset: () => {
                  console.log('Form reset');
                }
              });
            })
          }
        });

        // CHART BUTTONS
        datos.forEach(function(tabla){
          let boton = document.createElement("button");
          boton.textContent = tabla;
          chartContainer.appendChild(boton);
          boton.onclick = function(){
            fetch("api2.php?action=tabla&name="+this.textContent)
            .then(function(respuesta){return respuesta.json()})
            .then(function(datos){
              ux.chartRenderer({
                target: 'main',
                data: datos,
                title: tabla + ' - Chart Analysis',
                subtitle: 'Automatic pie charts for categorical data'
              });
            })
          }
        });
      })
      .catch(function(error){
        console.error('Error loading tables:', error);
        contenedor.innerHTML = '<p style="color:white;padding:10px;font-family:system-ui;font-size:13px;">Error loading data. Please check your API.</p>';
      });
  </script>
</body>
</html>
```

### extendemos todavia mas

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – Enhanced with Grid & Menu (v0.3)</title>
  <style>
    body,html{padding:0px;margin:0px;height:100%;}
    body{display:flex;}
    nav{flex:1;overflow-y:auto;}
    main{flex:8;overflow:auto;}
  </style>
</head>
<body>
  <nav>
  </nav>
  <main>
  </main>
  <script src="jocarsaux4.js"></script>
  <script>
    const ux = new JocarsaUX();
    let contenedor = document.querySelector("nav");
    let mainContainer = document.querySelector("main");

    // Initial welcome message
    mainContainer.innerHTML = `
      <div style="max-width:800px;margin:60px auto;padding:0 20px;font-family:system-ui;text-align:center;">
        <h1 style="font-size:clamp(24px,5vw,42px);margin-bottom:16px;color:#0f172a;">jocarsa|ux Framework</h1>
        <p style="font-size:18px;color:#64748b;margin-bottom:32px;">Version 0.3 - Now with Grid Cards & Menu Components</p>
        <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:32px;text-align:left;">
          <h2 style="font-size:20px;margin-bottom:16px;color:#0f172a;">✨ New Features</h2>
          <ul style="color:#475569;line-height:1.8;margin:0;">
            <li><strong>Grid Card View:</strong> Display data as responsive cards with hover effects</li>
            <li><strong>Menu Component:</strong> Create organized navigation menus with sections</li>
            <li><strong>Table View:</strong> Classic sortable, searchable tables with pagination</li>
            <li><strong>Form View:</strong> Smart forms with auto-detected field types</li>
            <li><strong>Chart View:</strong> Automatic pie charts for categorical data</li>
          </ul>
          <p style="margin-top:24px;color:#64748b;font-size:14px;">👈 Select an option from the menu to get started</p>
        </div>
      </div>
    `;

    // Fetch tables and create menu dynamically
    fetch("api2.php/tablas?action=tablas")
      .then(function(respuesta){return respuesta.json()})
      .then(function(datos){
        
        // Build menu sections
        const menuSections = [
          {
            header: '📊 Tables',
            items: datos.map(tabla => ({
              label: tabla,
              value: tabla,
              onClick: function(item) {
                fetch("api2.php?action=tabla&name="+item.value)
                .then(function(respuesta){return respuesta.json()})
                .then(function(datos){
                  ux.tableRenderer({ 
                    target: 'main', 
                    data: datos,
                    title: item.value + ' - Table View',
                    subtitle: 'Searchable, sortable table with pagination',
                    rowsPerPage: 5
                  });
                })
              }
            }))
          },
          {
            header: '🎴 Grid Cards',
            items: datos.map(tabla => ({
              label: tabla,
              value: tabla,
              onClick: function(item) {
                fetch("api2.php?action=tabla&name="+item.value)
                .then(function(respuesta){return respuesta.json()})
                .then(function(datos){
                  ux.gridRenderer({ 
                    target: 'main', 
                    data: datos,
                    title: item.value + ' - Grid View',
                    subtitle: 'Interactive card layout with search and pagination',
                    cardsPerPage: 6,
                    onCardClick: (row, idx) => {
                      console.log('Card clicked:', row);
                      alert('Card ' + (idx + 1) + ' clicked! Check console for data.');
                    }
                  });
                })
              }
            }))
          },
          {
            header: '📝 Forms',
            items: datos.map(tabla => ({
              label: tabla,
              value: tabla,
              onClick: function(item) {
                fetch("api2.php?action=tabla&name="+item.value)
                .then(function(respuesta){return respuesta.json()})
                .then(function(datos){
                  ux.formRenderer({
                    target: 'main',
                    data: datos,
                    title: item.value + ' - Form View',
                    subtitle: 'Smart form with auto-detected field types',
                    columns: 2,
                    onSubmit: (formData) => {
                      console.log('Form submitted:', formData);
                      alert('Form data logged to console!');
                    },
                    onReset: () => {
                      console.log('Form reset');
                    }
                  });
                })
              }
            }))
          },
          {
            header: '📈 Charts',
            items: datos.map(tabla => ({
              label: tabla,
              value: tabla,
              onClick: function(item) {
                fetch("api2.php?action=tabla&name="+item.value)
                .then(function(respuesta){return respuesta.json()})
                .then(function(datos){
                  ux.chartRenderer({
                    target: 'main',
                    data: datos,
                    title: item.value + ' - Chart Analysis',
                    subtitle: 'Automatic pie charts for categorical data'
                  });
                })
              }
            }))
          }
        ];

        // Render the menu using the new menuRenderer component
        ux.menuRenderer({
          target: 'nav',
          title: 'jocarsa|ux',
          sections: menuSections,
          color: '#dc143c'
        });
      })
      .catch(function(error){
        console.error('Error loading tables:', error);
        
        // If API fails, show demo menu anyway
        const demoSections = [
          {
            header: '📊 Demo Data',
            items: [
              {
                label: 'Sample Table',
                onClick: function() {
                  const sampleData = [
                    {id: 1, name: 'John Doe', email: 'john@example.com', status: 'active'},
                    {id: 2, name: 'Jane Smith', email: 'jane@example.com', status: 'inactive'},
                    {id: 3, name: 'Bob Wilson', email: 'bob@example.com', status: 'active'}
                  ];
                  ux.tableRenderer({ 
                    target: 'main', 
                    data: sampleData,
                    title: 'Sample Data - Table View',
                    subtitle: 'Demo with sample data'
                  });
                }
              },
              {
                label: 'Sample Grid',
                onClick: function() {
                  const sampleData = [
                    {id: 1, name: 'Product A', category: 'Electronics', price: 299},
                    {id: 2, name: 'Product B', category: 'Books', price: 19},
                    {id: 3, name: 'Product C', category: 'Electronics', price: 499}
                  ];
                  ux.gridRenderer({ 
                    target: 'main', 
                    data: sampleData,
                    title: 'Sample Data - Grid View',
                    subtitle: 'Demo with sample data'
                  });
                }
              }
            ]
          },
          {
            header: '⚠️ API Status',
            items: [
              {
                label: 'API Connection Failed',
                onClick: function() {
                  alert('API not available. Using demo data instead.');
                }
              }
            ]
          }
        ];

        ux.menuRenderer({
          target: 'nav',
          title: 'jocarsa|ux',
          sections: demoSections,
          color: '#dc143c'
        });
      });
  </script>
</body>
</html>
```

### api

```
<?php
header('Content-Type: application/json');

// Database configuration
$servername = "localhost";
$username = "crimson";
$password = "crimson";
$dbname = "crimson";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);

// Check connection
if ($conn->connect_error) {
    die(json_encode(["error" => "Connection failed: " . $conn->connect_error]));
}

// SQL query
$sql = "SELECT * FROM clientes";
$result = $conn->query($sql);

$data = array();

if ($result->num_rows > 0) {
    // Fetch all rows as an associative array
    while($row = $result->fetch_assoc()) {
        $data[] = $row;
    }
} else {
    $data = ["message" => "No records found"];
}

// Close connection
$conn->close();

// Return JSON response
echo json_encode($data);
?>
```

### api2

```
<?php
header('Content-Type: application/json');

// Database configuration
$servername = "localhost";
$username = "crimson";
$password = "crimson";
$dbname = "crimson";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);

// Check connection
if ($conn->connect_error) {
    die(json_encode(["error" => "Connection failed: " . $conn->connect_error]));
}

// Get the action from the query string
$action = isset($_GET['action']) ? $_GET['action'] : null;

// Route logic
if ($action === 'tablas') {
    // Get list of tables
    $tables = array();
    $result = $conn->query("SHOW TABLES");
    while ($row = $result->fetch_array()) {
        $tables[] = $row[0];
    }
    echo json_encode($tables);
}
elseif ($action === 'tabla' && isset($_GET['name'])) {
    $table = $_GET['name'];
    // Sanitize table name to prevent SQL injection
    if (!preg_match('/^[a-zA-Z0-9_]+$/', $table)) {
        echo json_encode(["error" => "Invalid table name"]);
        exit;
    }
    // Select all from the specified table
    $sql = "SELECT * FROM `$table`";
    $result = $conn->query($sql);
    $data = array();
    if ($result->num_rows > 0) {
        while ($row = $result->fetch_assoc()) {
            $data[] = $row;
        }
    } else {
        $data = ["message" => "No records found"];
    }
    echo json_encode($data);
}
else {
    echo json_encode(["error" => "Invalid or missing parameters"]);
}

// Close connection
$conn->close();
?>
```

### jocarsaux2

```javascript
(function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
.${NS('form')} { padding:20px }
.${NS('field')} { margin-bottom:20px }
.${NS('label')} { display:block; margin-bottom:6px; font-weight:600; color:var(--jux-text); font-size:13px }
.${NS('input')}, .${NS('textarea')}, .${NS('select')} { width:100%; border:1px solid var(--jux-line); border-radius:8px; padding:10px 12px; font:inherit; color:var(--jux-text); transition:border-color 0.2s }
.${NS('input')}:focus, .${NS('textarea')}:focus, .${NS('select')}:focus { outline:none; border-color:#94a3b8 }
.${NS('textarea')} { min-height:100px; resize:vertical; font-family:inherit }
.${NS('select')} { cursor:pointer }
.${NS('hint')} { display:block; margin-top:4px; font-size:12px; color:var(--jux-muted) }
.${NS('btn-group')} { display:flex; gap:10px; margin-top:24px; padding-top:20px; border-top:1px solid var(--jux-line) }
.${NS('btn')} { padding:10px 20px; border:1px solid var(--jux-line); border-radius:8px; font:inherit; cursor:pointer; transition:all 0.2s }
.${NS('btn-primary')} { background:var(--jux-text); color:#fff; border-color:var(--jux-text) }
.${NS('btn-primary')}:hover { background:#1e293b }
.${NS('btn-secondary')} { background:#fff; color:var(--jux-text) }
.${NS('btn-secondary')}:hover { background:var(--jux-chip) }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    // Analyze field data to determine best input type
    function analyzeField(values){
      const nonEmpty = values.filter(v => v != null && v !== '');
      if (!nonEmpty.length) return { type: 'text' };

      // Check if all numeric
      const allNumeric = nonEmpty.every(v => !isNaN(Number(v)));
      if (allNumeric) return { type: 'number' };

      // Convert to strings
      const strings = nonEmpty.map(v => String(v));
      
      // Check for repetition (select dropdown)
      const unique = [...new Set(strings)];
      const repetitionRatio = unique.length / strings.length;
      if (repetitionRatio < 0.5 && unique.length > 1 && unique.length < 20) {
        return { type: 'select', options: unique.sort() };
      }

      // Check average length
      const avgLength = strings.reduce((sum, s) => sum + s.length, 0) / strings.length;
      if (avgLength > 80) {
        return { type: 'textarea' };
      }

      return { type: 'text' };
    }

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count };

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        return this;
      }

      formRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Form renderer (smart input types)', onSubmit=null, onReset=null }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        const columns = collectColumns(flat);

        // Analyze each field
        const fieldTypes = {};
        columns.forEach(col => {
          const values = flat.map(row => row[col]);
          fieldTypes[col] = analyzeField(values);
        });

        // Create form
        const form = el('form', NS('form'));
        form.onsubmit = (e) => {
          e.preventDefault();
          const formData = {};
          columns.forEach(col => {
            const input = form.elements[col];
            formData[col] = input.value;
          });
          if (onSubmit) onSubmit(formData);
        };

        columns.forEach(col => {
          const fieldDiv = el('div', NS('field'));
          const label = el('label', NS('label'), col);
          label.htmlFor = `${NAMESPACE}-${col}`;

          const fieldInfo = fieldTypes[col];
          let input;

          if (fieldInfo.type === 'select') {
            input = document.createElement('select');
            input.className = NS('select');
            const emptyOption = document.createElement('option');
            emptyOption.value = '';
            emptyOption.textContent = '-- Select --';
            input.appendChild(emptyOption);
            fieldInfo.options.forEach(opt => {
              const option = document.createElement('option');
              option.value = opt;
              option.textContent = opt;
              input.appendChild(option);
            });
            const hint = el('span', NS('hint'), `${fieldInfo.options.length} options available`);
            fieldDiv.append(label, input, hint);
          } else if (fieldInfo.type === 'textarea') {
            input = document.createElement('textarea');
            input.className = NS('textarea');
            const hint = el('span', NS('hint'), 'Long text field');
            fieldDiv.append(label, input, hint);
          } else if (fieldInfo.type === 'number') {
            input = document.createElement('input');
            input.type = 'number';
            input.className = NS('input');
            input.step = 'any';
            const hint = el('span', NS('hint'), 'Numeric field');
            fieldDiv.append(label, input, hint);
          } else {
            input = document.createElement('input');
            input.type = 'text';
            input.className = NS('input');
            const hint = el('span', NS('hint'), 'Text field');
            fieldDiv.append(label, input, hint);
          }

          input.id = `${NAMESPACE}-${col}`;
          input.name = col;
          form.appendChild(fieldDiv);
        });

        // Button group
        const btnGroup = el('div', NS('btn-group'));
        const submitBtn = el('button', `${NS('btn')} ${NS('btn-primary')}`, 'Submit');
        submitBtn.type = 'submit';
        const resetBtn = el('button', `${NS('btn')} ${NS('btn-secondary')}`, 'Reset');
        resetBtn.type = 'button';
        resetBtn.onclick = () => {
          form.reset();
          if (onReset) onReset();
        };
        btnGroup.append(submitBtn, resetBtn);
        form.appendChild(btnGroup);

        card.appendChild(form);
        wrap.append(h1, p, card);
        host.append(wrap);

        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);
```

### jocarsaux3

```javascript
(function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
.${NS('pagination')} { display:flex; gap:8px; align-items:center; justify-content:center; padding:16px; border-top:1px solid var(--jux-line) }
.${NS('page-btn')} { padding:6px 12px; border:1px solid var(--jux-line); border-radius:6px; background:#fff; cursor:pointer; font:inherit; transition:all 0.2s }
.${NS('page-btn')}:hover:not(:disabled) { background:var(--jux-chip) }
.${NS('page-btn')}:disabled { opacity:0.5; cursor:not-allowed }
.${NS('page-btn-active')} { background:var(--jux-text); color:#fff; border-color:var(--jux-text) }
.${NS('page-info')} { font-size:13px; color:var(--jux-muted); margin:0 8px }
.${NS('form')} { padding:20px }
.${NS('form-grid')} { display:grid; gap:20px }
.${NS('field')} { margin-bottom:0 }
.${NS('label')} { display:block; margin-bottom:6px; font-weight:600; color:var(--jux-text); font-size:13px }
.${NS('input')}, .${NS('textarea')}, .${NS('select')} { width:100%; border:1px solid var(--jux-line); border-radius:8px; padding:10px 12px; font:inherit; color:var(--jux-text); transition:border-color 0.2s }
.${NS('input')}:focus, .${NS('textarea')}:focus, .${NS('select')}:focus { outline:none; border-color:#94a3b8 }
.${NS('textarea')} { min-height:100px; resize:vertical; font-family:inherit }
.${NS('select')} { cursor:pointer }
.${NS('hint')} { display:block; margin-top:4px; font-size:12px; color:var(--jux-muted) }
.${NS('btn-group')} { display:flex; gap:10px; margin-top:24px; padding-top:20px; border-top:1px solid var(--jux-line); grid-column:1/-1 }
.${NS('btn')} { padding:10px 20px; border:1px solid var(--jux-line); border-radius:8px; font:inherit; cursor:pointer; transition:all 0.2s }
.${NS('btn-primary')} { background:var(--jux-text); color:#fff; border-color:var(--jux-text) }
.${NS('btn-primary')}:hover { background:#1e293b }
.${NS('btn-secondary')} { background:#fff; color:var(--jux-text) }
.${NS('btn-secondary')}:hover { background:var(--jux-chip) }
.${NS('charts')} { padding:20px }
.${NS('chart-grid')} { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:24px }
.${NS('chart-item')} { text-align:center }
.${NS('chart-title')} { font-weight:600; margin-bottom:12px; color:var(--jux-text) }
.${NS('pie-chart')} { display:inline-block; position:relative }
.${NS('legend')} { margin-top:16px; text-align:left }
.${NS('legend-item')} { display:flex; align-items:center; gap:8px; margin-bottom:6px; font-size:13px }
.${NS('legend-color')} { width:16px; height:16px; border-radius:3px; flex-shrink:0 }
.${NS('legend-label')} { flex:1 }
.${NS('legend-value')} { color:var(--jux-muted); font-weight:600 }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    function analyzeField(values){
      const nonEmpty = values.filter(v => v != null && v !== '');
      if (!nonEmpty.length) return { type: 'text' };

      const allNumeric = nonEmpty.every(v => !isNaN(Number(v)));
      if (allNumeric) return { type: 'number' };

      const strings = nonEmpty.map(v => String(v));
      const unique = [...new Set(strings)];
      const repetitionRatio = unique.length / strings.length;
      if (repetitionRatio < 0.5 && unique.length > 1 && unique.length < 20) {
        return { type: 'select', options: unique.sort() };
      }

      const avgLength = strings.reduce((sum, s) => sum + s.length, 0) / strings.length;
      if (avgLength > 80) {
        return { type: 'textarea' };
      }

      return { type: 'text' };
    }

    function analyzeForChart(values){
      const nonEmpty = values.filter(v => v != null && v !== '');
      if (!nonEmpty.length) return null;

      const strings = nonEmpty.map(v => String(v));
      const unique = [...new Set(strings)];
      
      // Only create chart if data repeats (not all unique) and reasonable number of categories
      if (unique.length === strings.length || unique.length > 12) return null;

      const counts = {};
      strings.forEach(v => counts[v] = (counts[v] || 0) + 1);
      
      return { counts, total: strings.length };
    }

    const CHART_COLORS = [
      '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',
      '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1',
      '#14b8a6', '#a855f7'
    ];

    function createPieChart(data, title){
      const total = data.total;
      const entries = Object.entries(data.counts).sort((a,b) => b[1] - a[1]);
      
      const size = 200;
      const radius = 80;
      const centerX = size / 2;
      const centerY = size / 2;

      let currentAngle = -90;
      const slices = entries.map(([label, count], idx) => {
        const percent = count / total;
        const angle = percent * 360;
        const startAngle = currentAngle;
        const endAngle = currentAngle + angle;
        currentAngle = endAngle;

        const startRad = (startAngle * Math.PI) / 180;
        const endRad = (endAngle * Math.PI) / 180;

        const x1 = centerX + radius * Math.cos(startRad);
        const y1 = centerY + radius * Math.sin(startRad);
        const x2 = centerX + radius * Math.cos(endRad);
        const y2 = centerY + radius * Math.sin(endRad);

        const largeArc = angle > 180 ? 1 : 0;
        const path = `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;

        return {
          path,
          color: CHART_COLORS[idx % CHART_COLORS.length],
          label,
          count,
          percent: (percent * 100).toFixed(1)
        };
      });

      const svg = `<svg viewBox="0 0 ${size} ${size}" width="${size}" height="${size}">${slices.map(s => `<path d="${s.path}" fill="${s.color}" stroke="#fff" stroke-width="2"/>`).join('')}</svg>`;

      return { svg, slices, title };
    }

    class JocarsaUX {
      constructor(){ 
        ensureStyles(); 
        this.state={ 
          columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'',
          page: 1, rowsPerPage: 10
        }; 
        this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null, pagination:null }; 
      }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)', rowsPerPage=10 }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);

        const paginationDiv = el('div', NS('pagination'));
        
        card.append(pad, scroll, paginationDiv);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count, pagination: paginationDiv };

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';
        this.state.page = 1;
        this.state.rowsPerPage = rowsPerPage;

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        this._renderPagination();
        return this;
      }

      formRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Form renderer (smart input types)', columns=1, onSubmit=null, onReset=null }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        const cols = collectColumns(flat);

        const fieldTypes = {};
        cols.forEach(col => {
          const values = flat.map(row => row[col]);
          fieldTypes[col] = analyzeField(values);
        });

        const form = el('form', NS('form'));
        const formGrid = el('div', NS('form-grid'));
        formGrid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
        
        form.onsubmit = (e) => {
          e.preventDefault();
          const formData = {};
          cols.forEach(col => {
            const input = form.elements[col];
            formData[col] = input.value;
          });
          if (onSubmit) onSubmit(formData);
        };

        cols.forEach(col => {
          const fieldDiv = el('div', NS('field'));
          const label = el('label', NS('label'), col);
          label.htmlFor = `${NAMESPACE}-${col}`;

          const fieldInfo = fieldTypes[col];
          let input;

          if (fieldInfo.type === 'select') {
            input = document.createElement('select');
            input.className = NS('select');
            const emptyOption = document.createElement('option');
            emptyOption.value = '';
            emptyOption.textContent = '-- Select --';
            input.appendChild(emptyOption);
            fieldInfo.options.forEach(opt => {
              const option = document.createElement('option');
              option.value = opt;
              option.textContent = opt;
              input.appendChild(option);
            });
            const hint = el('span', NS('hint'), `${fieldInfo.options.length} options available`);
            fieldDiv.append(label, input, hint);
          } else if (fieldInfo.type === 'textarea') {
            input = document.createElement('textarea');
            input.className = NS('textarea');
            const hint = el('span', NS('hint'), 'Long text field');
            fieldDiv.append(label, input, hint);
          } else if (fieldInfo.type === 'number') {
            input = document.createElement('input');
            input.type = 'number';
            input.className = NS('input');
            input.step = 'any';
            const hint = el('span', NS('hint'), 'Numeric field');
            fieldDiv.append(label, input, hint);
          } else {
            input = document.createElement('input');
            input.type = 'text';
            input.className = NS('input');
            const hint = el('span', NS('hint'), 'Text field');
            fieldDiv.append(label, input, hint);
          }

          input.id = `${NAMESPACE}-${col}`;
          input.name = col;
          formGrid.appendChild(fieldDiv);
        });

        const btnGroup = el('div', NS('btn-group'));
        const submitBtn = el('button', `${NS('btn')} ${NS('btn-primary')}`, 'Submit');
        submitBtn.type = 'submit';
        const resetBtn = el('button', `${NS('btn')} ${NS('btn-secondary')}`, 'Reset');
        resetBtn.type = 'button';
        resetBtn.onclick = () => {
          form.reset();
          if (onReset) onReset();
        };
        btnGroup.append(submitBtn, resetBtn);
        formGrid.appendChild(btnGroup);
        form.appendChild(formGrid);

        card.appendChild(form);
        wrap.append(h1, p, card);
        host.append(wrap);

        return this;
      }

      chartRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Chart renderer (auto pie charts)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const chartsDiv = el('div', NS('charts'));
        const chartGrid = el('div', NS('chart-grid'));

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        const cols = collectColumns(flat);

        let chartCount = 0;
        cols.forEach(col => {
          const values = flat.map(row => row[col]);
          const chartData = analyzeForChart(values);
          
          if (chartData) {
            const chart = createPieChart(chartData, col);
            
            const chartItem = el('div', NS('chart-item'));
            const chartTitle = el('div', NS('chart-title'), chart.title);
            const pieChart = el('div', NS('pie-chart'));
            pieChart.innerHTML = chart.svg;
            
            const legend = el('div', NS('legend'));
            chart.slices.forEach(slice => {
              const item = el('div', NS('legend-item'));
              const color = el('div', NS('legend-color'));
              color.style.backgroundColor = slice.color;
              const label = el('span', NS('legend-label'), slice.label);
              const value = el('span', NS('legend-value'), `${slice.count} (${slice.percent}%)`);
              item.append(color, label, value);
              legend.appendChild(item);
            });

            chartItem.append(chartTitle, pieChart, legend);
            chartGrid.appendChild(chartItem);
            chartCount++;
          }
        });

        if (chartCount === 0) {
          const noCharts = el('p', null, 'No chartable data found (all columns have unique values)');
          noCharts.style.padding = '20px';
          noCharts.style.color = 'var(--jux-muted)';
          noCharts.style.textAlign = 'center';
          chartsDiv.appendChild(noCharts);
        } else {
          chartsDiv.appendChild(chartGrid);
        }

        card.appendChild(chartsDiv);
        wrap.append(h1, p, card);
        host.append(wrap);

        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this.state.page = 1;
        this._renderBody();
        this._renderPagination();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      goToPage(page){
        const totalPages = Math.ceil(this.state.view.length / this.state.rowsPerPage);
        this.state.page = Math.max(1, Math.min(page, totalPages));
        this._renderBody();
        this._renderPagination();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view, page, rowsPerPage } = this.state; 
        const tbody = this._els.tbody;
        tbody.innerHTML = '';
        
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = view.slice(start, end);
        
        const frag = document.createDocumentFragment();
        pageData.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }

      _renderPagination(){
        const { view, page, rowsPerPage } = this.state;
        const pagination = this._els.pagination;
        if (!pagination) return;

        pagination.innerHTML = '';
        const totalPages = Math.ceil(view.length / rowsPerPage);
        
        if (totalPages <= 1) return;

        const prevBtn = el('button', NS('page-btn'), '← Previous');
        prevBtn.disabled = page === 1;
        prevBtn.onclick = () => this.goToPage(page - 1);

        const pageInfo = el('span', NS('page-info'), `Page ${page} of ${totalPages}`);

        const pages = [];
        for (let i = 1; i <= totalPages; i++) {
          if (i === 1 || i === totalPages || (i >= page - 1 && i <= page + 1)) {
            const btn = el('button', NS('page-btn'), String(i));
            if (i === page) btn.classList.add(NS('page-btn-active'));
            btn.onclick = () => this.goToPage(i);
            pages.push(btn);
          } else if (pages[pages.length - 1]?.textContent !== '...') {
            pages.push(el('span', NS('page-info'), '...'));
          }
        }

        const nextBtn = el('button', NS('page-btn'), 'Next →');
        nextBtn.disabled = page === totalPages;
        nextBtn.onclick = () => this.goToPage(page + 1);

        pagination.append(prevBtn, ...pages, nextBtn);
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);
```

### jocarsaux4

```javascript
(function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; --jux-accent:#dc143c; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
.${NS('pagination')} { display:flex; gap:8px; align-items:center; justify-content:center; padding:16px; border-top:1px solid var(--jux-line) }
.${NS('page-btn')} { padding:6px 12px; border:1px solid var(--jux-line); border-radius:6px; background:#fff; cursor:pointer; font:inherit; transition:all 0.2s }
.${NS('page-btn')}:hover:not(:disabled) { background:var(--jux-chip) }
.${NS('page-btn')}:disabled { opacity:0.5; cursor:not-allowed }
.${NS('page-btn-active')} { background:var(--jux-text); color:#fff; border-color:var(--jux-text) }
.${NS('page-info')} { font-size:13px; color:var(--jux-muted); margin:0 8px }
.${NS('form')} { padding:20px }
.${NS('form-grid')} { display:grid; gap:20px }
.${NS('field')} { margin-bottom:0 }
.${NS('label')} { display:block; margin-bottom:6px; font-weight:600; color:var(--jux-text); font-size:13px }
.${NS('input')}, .${NS('textarea')}, .${NS('select')} { width:100%; border:1px solid var(--jux-line); border-radius:8px; padding:10px 12px; font:inherit; color:var(--jux-text); transition:border-color 0.2s }
.${NS('input')}:focus, .${NS('textarea')}:focus, .${NS('select')}:focus { outline:none; border-color:#94a3b8 }
.${NS('textarea')} { min-height:100px; resize:vertical; font-family:inherit }
.${NS('select')} { cursor:pointer }
.${NS('hint')} { display:block; margin-top:4px; font-size:12px; color:var(--jux-muted) }
.${NS('btn-group')} { display:flex; gap:10px; margin-top:24px; padding-top:20px; border-top:1px solid var(--jux-line); grid-column:1/-1 }
.${NS('btn')} { padding:10px 20px; border:1px solid var(--jux-line); border-radius:8px; font:inherit; cursor:pointer; transition:all 0.2s }
.${NS('btn-primary')} { background:var(--jux-text); color:#fff; border-color:var(--jux-text) }
.${NS('btn-primary')}:hover { background:#1e293b }
.${NS('btn-secondary')} { background:#fff; color:var(--jux-text) }
.${NS('btn-secondary')}:hover { background:var(--jux-chip) }
.${NS('charts')} { padding:20px }
.${NS('chart-grid')} { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:24px }
.${NS('chart-item')} { text-align:center }
.${NS('chart-title')} { font-weight:600; margin-bottom:12px; color:var(--jux-text) }
.${NS('pie-chart')} { display:inline-block; position:relative }
.${NS('legend')} { margin-top:16px; text-align:left }
.${NS('legend-item')} { display:flex; align-items:center; gap:8px; margin-bottom:6px; font-size:13px }
.${NS('legend-color')} { width:16px; height:16px; border-radius:3px; flex-shrink:0 }
.${NS('legend-label')} { flex:1 }
.${NS('legend-value')} { color:var(--jux-muted); font-weight:600 }
.${NS('grid-container')} { padding:20px }
.${NS('grid-view')} { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:20px }
.${NS('grid-card')} { border:1px solid var(--jux-line); border-radius:12px; padding:16px; background:#fff; transition:all 0.3s; cursor:pointer }
.${NS('grid-card')}:hover { box-shadow:0 4px 12px rgba(0,0,0,0.1); transform:translateY(-2px) }
.${NS('grid-card-title')} { font-weight:700; font-size:16px; margin-bottom:12px; color:var(--jux-text); border-bottom:2px solid var(--jux-line); padding-bottom:8px }
.${NS('grid-card-field')} { margin-bottom:8px; font-size:13px }
.${NS('grid-card-label')} { color:var(--jux-muted); font-weight:600; display:inline-block; min-width:100px }
.${NS('grid-card-value')} { color:var(--jux-text); word-break:break-word }
.${NS('menu')} { display:flex; flex-direction:column; gap:10px; padding:20px; background:var(--jux-accent); overflow-y:auto }
.${NS('menu-header')} { color:white; margin:20px 0 10px 0; font-family:system-ui; font-size:14px; text-transform:uppercase; letter-spacing:1px; font-weight:700 }
.${NS('menu-header')}:first-child { margin-top:0 }
.${NS('menu-section')} { display:flex; flex-direction:column; gap:8px }
.${NS('menu-btn')} { background:white; width:100%; border:none; padding:10px 16px; border-radius:100px; transition:all 0.3s; border:2px solid white; cursor:pointer; font-family:system-ui; font-size:13px; font-weight:500; text-align:left }
.${NS('menu-btn')}:hover { background:var(--jux-accent); color:white }
.${NS('menu-btn-active')} { background:var(--jux-accent); color:white; border-color:white }
.${NS('menu-title')} { color:white; font-size:20px; font-weight:700; margin-bottom:16px; letter-spacing:-0.5px }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    function analyzeField(values){
      const nonEmpty = values.filter(v => v != null && v !== '');
      if (!nonEmpty.length) return { type: 'text' };

      const allNumeric = nonEmpty.every(v => !isNaN(Number(v)));
      if (allNumeric) return { type: 'number' };

      const strings = nonEmpty.map(v => String(v));
      const unique = [...new Set(strings)];
      const repetitionRatio = unique.length / strings.length;
      if (repetitionRatio < 0.5 && unique.length > 1 && unique.length < 20) {
        return { type: 'select', options: unique.sort() };
      }

      const avgLength = strings.reduce((sum, s) => sum + s.length, 0) / strings.length;
      if (avgLength > 80) {
        return { type: 'textarea' };
      }

      return { type: 'text' };
    }

    function analyzeForChart(values){
      const nonEmpty = values.filter(v => v != null && v !== '');
      if (!nonEmpty.length) return null;

      const strings = nonEmpty.map(v => String(v));
      const unique = [...new Set(strings)];
      
      if (unique.length === strings.length || unique.length > 12) return null;

      const counts = {};
      strings.forEach(v => counts[v] = (counts[v] || 0) + 1);
      
      return { counts, total: strings.length };
    }

    const CHART_COLORS = [
      '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',
      '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1',
      '#14b8a6', '#a855f7'
    ];

    function createPieChart(data, title){
      const total = data.total;
      const entries = Object.entries(data.counts).sort((a,b) => b[1] - a[1]);
      
      const size = 200;
      const radius = 80;
      const centerX = size / 2;
      const centerY = size / 2;

      let currentAngle = -90;
      const slices = entries.map(([label, count], idx) => {
        const percent = count / total;
        const angle = percent * 360;
        const startAngle = currentAngle;
        const endAngle = currentAngle + angle;
        currentAngle = endAngle;

        const startRad = (startAngle * Math.PI) / 180;
        const endRad = (endAngle * Math.PI) / 180;

        const x1 = centerX + radius * Math.cos(startRad);
        const y1 = centerY + radius * Math.sin(startRad);
        const x2 = centerX + radius * Math.cos(endRad);
        const y2 = centerY + radius * Math.sin(endRad);

        const largeArc = angle > 180 ? 1 : 0;
        const path = `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;

        return {
          path,
          color: CHART_COLORS[idx % CHART_COLORS.length],
          label,
          count,
          percent: (percent * 100).toFixed(1)
        };
      });

      const svg = `<svg viewBox="0 0 ${size} ${size}" width="${size}" height="${size}">${slices.map(s => `<path d="${s.path}" fill="${s.color}" stroke="#fff" stroke-width="2"/>`).join('')}</svg>`;

      return { svg, slices, title };
    }

    class JocarsaUX {
      constructor(){ 
        ensureStyles(); 
        this.state={ 
          columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'',
          page: 1, rowsPerPage: 10
        }; 
        this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null, pagination:null }; 
      }

      menuRenderer({ target, sections=[], title='Menu', onItemClick=null, color='#dc143c' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; 
        if (!host) throw new Error('Target not found');
        
        host.classList.add(NS('menu'));
        host.style.background = color;
        host.innerHTML = '';

        if (title) {
          const titleEl = el('div', NS('menu-title'), title);
          host.appendChild(titleEl);
        }

        sections.forEach(section => {
          if (section.header) {
            const header = el('h3', NS('menu-header'), section.header);
            host.appendChild(header);
          }

          const sectionDiv = el('div', NS('menu-section'));
          
          if (section.items && Array.isArray(section.items)) {
            section.items.forEach(item => {
              const btn = el('button', NS('menu-btn'), item.label || item);
              
              if (item.active) {
                btn.classList.add(NS('menu-btn-active'));
              }
              
              btn.onclick = () => {
                const allBtns = host.querySelectorAll(`.${NS('menu-btn')}`);
                allBtns.forEach(b => b.classList.remove(NS('menu-btn-active')));
                btn.classList.add(NS('menu-btn-active'));
                
                if (onItemClick) {
                  onItemClick(item.value !== undefined ? item.value : item.label || item, item);
                } else if (item.onClick) {
                  item.onClick(item);
                }
              };
              
              sectionDiv.appendChild(btn);
            });
          }
          
          host.appendChild(sectionDiv);
        });

        return this;
      }

      gridRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Grid card view', cardsPerPage=9, titleField=null, onCardClick=null }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; 
        if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Grid view');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const gridContainer = el('div', NS('grid-container'));
        const gridView = el('div', NS('grid-view'));
        gridContainer.appendChild(gridView);

        const paginationDiv = el('div', NS('pagination'));
        
        card.append(pad, gridContainer, paginationDiv);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, gridView, search: input, count, pagination: paginationDiv };

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.query='';
        this.state.page = 1;
        this.state.rowsPerPage = cardsPerPage;
        this.state.titleField = titleField || this.state.columns[0];
        this.state.onCardClick = onCardClick;

        input.value = '';
        input.oninput = () => this.setGridFilter(input.value);

        this._renderGrid();
        this._renderGridPagination();
        return this;
      }

      setGridFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this.state.page = 1;
        this._renderGrid();
        this._renderGridPagination();
        return this;
      }

      _renderGrid(){
        const { columns, view, page, rowsPerPage, titleField, onCardClick } = this.state;
        const gridView = this._els.gridView;
        gridView.innerHTML = '';

        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = view.slice(start, end);

        pageData.forEach((row, idx) => {
          const card = el('div', NS('grid-card'));
          
          const cardTitle = el('div', NS('grid-card-title'), row[titleField] || `Item ${start + idx + 1}`);
          card.appendChild(cardTitle);

          columns.forEach(col => {
            if (col !== titleField) {
              const fieldDiv = el('div', NS('grid-card-field'));
              const labelSpan = el('span', NS('grid-card-label'), col + ': ');
              const valueSpan = el('span', NS('grid-card-value'), row[col] || '—');
              fieldDiv.append(labelSpan, valueSpan);
              card.appendChild(fieldDiv);
            }
          });

          if (onCardClick) {
            card.onclick = () => onCardClick(row, idx);
          }

          gridView.appendChild(card);
        });

        if (this._els.count) this._els.count.textContent = `${view.length} item(s)`;
      }

      _renderGridPagination(){
        const { view, page, rowsPerPage } = this.state;
        const pagination = this._els.pagination;
        if (!pagination) return;

        pagination.innerHTML = '';
        const totalPages = Math.ceil(view.length / rowsPerPage);
        
        if (totalPages <= 1) return;

        const prevBtn = el('button', NS('page-btn'), '← Previous');
        prevBtn.disabled = page === 1;
        prevBtn.onclick = () => this.goToGridPage(page - 1);

        const pageInfo = el('span', NS('page-info'), `Page ${page} of ${totalPages}`);

        const pages = [];
        for (let i = 1; i <= totalPages; i++) {
          if (i === 1 || i === totalPages || (i >= page - 1 && i <= page + 1)) {
            const btn = el('button', NS('page-btn'), String(i));
            if (i === page) btn.classList.add(NS('page-btn-active'));
            btn.onclick = () => this.goToGridPage(i);
            pages.push(btn);
          } else if (pages[pages.length - 1]?.textContent !== '...') {
            pages.push(el('span', NS('page-info'), '...'));
          }
        }

        const nextBtn = el('button', NS('page-btn'), 'Next →');
        nextBtn.disabled = page === totalPages;
        nextBtn.onclick = () => this.goToGridPage(page + 1);

        pagination.append(prevBtn, ...pages, nextBtn);
      }

      goToGridPage(page){
        const totalPages = Math.ceil(this.state.view.length / this.state.rowsPerPage);
        this.state.page = Math.max(1, Math.min(page, totalPages));
        this._renderGrid();
        this._renderGridPagination();
        return this;
      }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)', rowsPerPage=10 }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);

        const paginationDiv = el('div', NS('pagination'));
        
        card.append(pad, scroll, paginationDiv);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count, pagination: paginationDiv };

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';
        this.state.page = 1;
        this.state.rowsPerPage = rowsPerPage;

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        this._renderPagination();
        return this;
      }

      formRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Form renderer (smart input types)', columns=1, onSubmit=null, onReset=null }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        const cols = collectColumns(flat);

        const fieldTypes = {};
        cols.forEach(col => {
          const values = flat.map(row => row[col]);
          fieldTypes[col] = analyzeField(values);
        });

        const form = el('form', NS('form'));
        const formGrid = el('div', NS('form-grid'));
        formGrid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
        
        form.onsubmit = (e) => {
          e.preventDefault();
          const formData = {};
          cols.forEach(col => {
            const input = form.elements[col];
            formData[col] = input.value;
          });
          if (onSubmit) onSubmit(formData);
        };

        cols.forEach(col => {
          const fieldDiv = el('div', NS('field'));
          const label = el('label', NS('label'), col);
          label.htmlFor = `${NAMESPACE}-${col}`;

          const fieldInfo = fieldTypes[col];
          let input;

          if (fieldInfo.type === 'select') {
            input = document.createElement('select');
            input.className = NS('select');
            const emptyOption = document.createElement('option');
            emptyOption.value = '';
            emptyOption.textContent = '-- Select --';
            input.appendChild(emptyOption);
            fieldInfo.options.forEach(opt => {
              const option = document.createElement('option');
              option.value = opt;
              option.textContent = opt;
              input.appendChild(option);
            });
            const hint = el('span', NS('hint'), `${fieldInfo.options.length} options available`);
            fieldDiv.append(label, input, hint);
          } else if (fieldInfo.type === 'textarea') {
            input = document.createElement('textarea');
            input.className = NS('textarea');
            const hint = el('span', NS('hint'), 'Long text field');
            fieldDiv.append(label, input, hint);
          } else if (fieldInfo.type === 'number') {
            input = document.createElement('input');
            input.type = 'number';
            input.className = NS('input');
            input.step = 'any';
            const hint = el('span', NS('hint'), 'Numeric field');
            fieldDiv.append(label, input, hint);
          } else {
            input = document.createElement('input');
            input.type = 'text';
            input.className = NS('input');
            const hint = el('span', NS('hint'), 'Text field');
            fieldDiv.append(label, input, hint);
          }

          input.id = `${NAMESPACE}-${col}`;
          input.name = col;
          formGrid.appendChild(fieldDiv);
        });

        const btnGroup = el('div', NS('btn-group'));
        const submitBtn = el('button', `${NS('btn')} ${NS('btn-primary')}`, 'Submit');
        submitBtn.type = 'submit';
        const resetBtn = el('button', `${NS('btn')} ${NS('btn-secondary')}`, 'Reset');
        resetBtn.type = 'button';
        resetBtn.onclick = () => {
          form.reset();
          if (onReset) onReset();
        };
        btnGroup.append(submitBtn, resetBtn);
        formGrid.appendChild(btnGroup);
        form.appendChild(formGrid);

        card.appendChild(form);
        wrap.append(h1, p, card);
        host.append(wrap);

        return this;
      }

      chartRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Chart renderer (auto pie charts)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const chartsDiv = el('div', NS('charts'));
        const chartGrid = el('div', NS('chart-grid'));

        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        const cols = collectColumns(flat);

        let chartCount = 0;
        cols.forEach(col => {
          const values = flat.map(row => row[col]);
          const chartData = analyzeForChart(values);
          
          if (chartData) {
            const chart = createPieChart(chartData, col);
            
            const chartItem = el('div', NS('chart-item'));
            const chartTitle = el('div', NS('chart-title'), chart.title);
            const pieChart = el('div', NS('pie-chart'));
            pieChart.innerHTML = chart.svg;
            
            const legend = el('div', NS('legend'));
            chart.slices.forEach(slice => {
              const item = el('div', NS('legend-item'));
              const color = el('div', NS('legend-color'));
              color.style.backgroundColor = slice.color;
              const label = el('span', NS('legend-label'), slice.label);
              const value = el('span', NS('legend-value'), `${slice.count} (${slice.percent}%)`);
              item.append(color, label, value);
              legend.appendChild(item);
            });

            chartItem.append(chartTitle, pieChart, legend);
            chartGrid.appendChild(chartItem);
            chartCount++;
          }
        });

        if (chartCount === 0) {
          const noCharts = el('p', null, 'No chartable data found (all columns have unique values)');
          noCharts.style.padding = '20px';
          noCharts.style.color = 'var(--jux-muted)';
          noCharts.style.textAlign = 'center';
          chartsDiv.appendChild(noCharts);
        } else {
          chartsDiv.appendChild(chartGrid);
        }

        card.appendChild(chartsDiv);
        wrap.append(h1, p, card);
        host.append(wrap);

        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this.state.page = 1;
        this._renderBody();
        this._renderPagination();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      goToPage(page){
        const totalPages = Math.ceil(this.state.view.length / this.state.rowsPerPage);
        this.state.page = Math.max(1, Math.min(page, totalPages));
        this._renderBody();
        this._renderPagination();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view, page, rowsPerPage } = this.state; 
        const tbody = this._els.tbody;
        tbody.innerHTML = '';
        
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = view.slice(start, end);
        
        const frag = document.createDocumentFragment();
        pageData.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }

      _renderPagination(){
        const { view, page, rowsPerPage } = this.state;
        const pagination = this._els.pagination;
        if (!pagination) return;

        pagination.innerHTML = '';
        const totalPages = Math.ceil(view.length / rowsPerPage);
        
        if (totalPages <= 1) return;

        const prevBtn = el('button', NS('page-btn'), '← Previous');
        prevBtn.disabled = page === 1;
        prevBtn.onclick = () => this.goToPage(page - 1);

        const pageInfo = el('span', NS('page-info'), `Page ${page} of ${totalPages}`);

        const pages = [];
        for (let i = 1; i <= totalPages; i++) {
          if (i === 1 || i === totalPages || (i >= page - 1 && i <= page + 1)) {
            const btn = el('button', NS('page-btn'), String(i));
            if (i === page) btn.classList.add(NS('page-btn-active'));
            btn.onclick = () => this.goToPage(i);
            pages.push(btn);
          } else if (pages[pages.length - 1]?.textContent !== '...') {
            pages.push(el('span', NS('page-info'), '...'));
          }
        }

        const nextBtn = el('button', NS('page-btn'), 'Next →');
        nextBtn.disabled = page === totalPages;
        nextBtn.onclick = () => this.goToPage(page + 1);

        pagination.append(prevBtn, ...pages, nextBtn);
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);
```

### pruebalibreria

```javascript
(function(global){
    const NAMESPACE = 'jux';
    const NS = (name) => `${NAMESPACE}-${name}`;

    function ensureStyles(){
      const id = `${NAMESPACE}-styles`; if (document.getElementById(id)) return;
      const css = `
:root { --jux-bg:#ffffff; --jux-text:#0f172a; --jux-muted:#475569; --jux-line:#e2e8f0; --jux-chip:#f8fafc; }
.${NS('root')} { font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--jux-text); }
.${NS('wrap')} { max-width:1000px; margin:32px auto; padding:0 16px; }
.${NS('title')} { margin:0 0 6px; font-size:clamp(18px,3.5vw,26px); }
.${NS('subtitle')} { margin:0 0 14px; color:var(--jux-muted); }
.${NS('card')} { border:1px solid var(--jux-line); border-radius:12px; overflow:hidden; background:#fff }
.${NS('pad')} { padding:14px }
.${NS('toolbar')} { display:flex; gap:10px; align-items:center; justify-content:space-between }
.${NS('badge')} { display:inline-block; background:var(--jux-chip); padding:2px 8px; border:1px solid var(--jux-line); border-radius:999px; font-size:12px; color:var(--jux-muted) }
.${NS('search')} { display:flex; gap:8px; align-items:center }
.${NS('search')} input { border:1px solid var(--jux-line); border-radius:10px; padding:8px 10px; min-width:220px }
.${NS('count')} { font-size:12px; color:var(--jux-muted) }
.${NS('scroll')} { max-height:70vh; overflow:auto; border-top:1px solid var(--jux-line) }
.${NS('table')} { width:100%; border-collapse:separate; border-spacing:0; font-size:14px }
.${NS('thead')} th { position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--jux-line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap }
.${NS('th-sortable')} { cursor:pointer; user-select:none }
.${NS('th-sortable')} .${NS('dir')} { margin-left:6px; font-size:11px; color:var(--jux-muted) }
.${NS('tbody')} td { border-bottom:1px solid var(--jux-line); padding:10px 12px; vertical-align:top }
.${NS('row-odd')} { background:#fafafa }
`;
      const style = document.createElement('style');
      style.id = id; style.textContent = css; document.head.appendChild(style);
    }

    const isPlain = v => Object.prototype.toString.call(v) === '[object Object]';
    
    // Fixed flatten function - only flattens a single object, not arrays of objects
    function flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          // Arrays are joined as comma-separated strings
          const primitives = v.every(x => !isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else {
            // If array contains objects, just stringify it
            out[p||'value'] = v.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
          }
        } else if (isPlain(v)){
          const ks = Object.keys(v); 
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv=v[k]; 
            const np = p ? `${p}.${k}` : k;
            if (isPlain(nv)) {
              // Recursively flatten nested objects
              stack.push({v:nv,p:np});
            } else if (Array.isArray(nv)) {
              // Handle arrays as comma-separated strings
              const primitives = nv.every(x => !isPlain(x) && !Array.isArray(x));
              out[np] = primitives ? nv.join(', ') : nv.map(x => isPlain(x) ? JSON.stringify(x) : String(x)).join(', ');
            } else {
              out[np] = nv==null ? '' : String(nv);
            }
          });
        } else { 
          out[p||'value'] = v==null ? '' : String(v); 
        }
      }
      return out;
    }
    
    function normalizeTop(json){ 
      if (Array.isArray(json)) return json; 
      if (isPlain(json)){ 
        const key=Object.keys(json).find(k=>Array.isArray(json[k])); 
        return key?json[key]:[json]; 
      } 
      return [json]; 
    }
    
    const collectColumns = rows => Array.from(rows.reduce((s,r)=>{ Object.keys(r).forEach(k=>s.add(k)); return s; }, new Set()));

    class JocarsaUX {
      constructor(){ ensureStyles(); this.state={ columns:[], rows:[], view:[], sort:{key:null, dir:1}, query:'' }; this._els={ host:null, table:null, thead:null, tbody:null, search:null, count:null }; }

      tableRenderer({ target, data, flattenObjects=true, title='jocarsa|ux', subtitle='Table renderer (search + sort)' }={}){
        const host = (typeof target==='string') ? document.querySelector(target) : target; if (!host) throw new Error('Target not found');
        this._els.host = host;
        host.classList.add(NS('root'));
        host.innerHTML = '';

        const wrap = el('div', NS('wrap'));
        const h1 = el('h1', NS('title'), title);
        const p = el('p', NS('subtitle'), subtitle);
        const card = el('div', NS('card'));
        const pad = el('div', NS('pad'));
        const toolbar = el('div', NS('toolbar'));
        const badge = el('span', NS('badge'), 'Table demo');
        const searchBox = el('div', NS('search'));
        const label = el('label', null, 'Search'); label.htmlFor = NS('search-input');
        const input = el('input'); input.id = NS('search-input');
        const count = el('span', NS('count'));
        searchBox.append(label, input, count);
        toolbar.append(badge, searchBox);
        pad.append(toolbar);

        const scroll = el('div', NS('scroll'));
        const table = el('table', NS('table'));
        const thead = document.createElement('thead'); thead.className = NS('thead');
        const tbody = document.createElement('tbody'); tbody.className = NS('tbody');
        table.append(thead, tbody);
        scroll.append(table);
        card.append(pad, scroll);
        wrap.append(h1, p, card);
        host.append(wrap);

        this._els = { host, table, thead, tbody, search: input, count };

        // Fixed: normalize to array first, THEN flatten each object individually
        const arr = normalizeTop(data);
        const flat = flattenObjects ? arr.map(obj => flatten(obj)) : arr;
        this.state.columns = collectColumns(flat);
        this.state.rows = flat; 
        this.state.view = flat.slice(); 
        this.state.sort = {key:null, dir:1}; 
        this.state.query='';

        input.value = '';
        input.oninput = () => this.setFilter(input.value);

        this._renderHead();
        this._renderBody();
        return this;
      }

      setFilter(query=''){
        this.state.query = String(query).toLowerCase();
        const { rows, columns } = this.state;
        if (!this.state.query) this.state.view = rows.slice();
        else this.state.view = rows.filter(r=>columns.some(k=>{ const v=r[k]; return v && String(v).toLowerCase().includes(this.state.query); }));
        this._renderBody();
        return this;
      }

      sortBy(key, dir){
        if (!key) return this;
        const s = this.state;
        if (dir == null){ if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; } }
        else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
        const d = s.sort.dir; const k = s.sort.key;
        s.view.sort((a,b)=>{
          const va=a[k] ?? '', vb=b[k] ?? '';
          const na=Number(va), nb=Number(vb);
          const bothNum = !isNaN(na) && !isNaN(nb);
          if (bothNum) return (na-nb)*d;
          return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:'base'})*d;
        });
        this._renderHead();
        this._renderBody();
        return this;
      }

      _renderHead(){
        const { columns, sort } = this.state; const thead = this._els.thead;
        thead.innerHTML = '';
        const tr = document.createElement('tr');
        columns.forEach(c=>{
          const th = document.createElement('th');
          th.className = `${NS('th-sortable')}`; th.title = `Sort by ${c}`; th.textContent = c;
          const dir = el('span', NS('dir'), sort.key===c ? (sort.dir===1 ? '▲' : '▼') : '');
          th.append(dir);
          th.addEventListener('click', ()=>this.sortBy(c));
          tr.append(th);
        });
        thead.append(tr);
      }

      _renderBody(){
        const { columns, view } = this.state; const tbody = this._els.tbody;
        tbody.innerHTML = '';
        const frag = document.createDocumentFragment();
        view.forEach((r, idx)=>{
          const tr = document.createElement('tr');
          if (idx % 2 === 0) tr.classList.add(NS('row-odd'));
          columns.forEach(c=>{
            const td = document.createElement('td');
            td.textContent = r[c] ?? '';
            tr.append(td);
          });
          frag.append(tr);
        });
        tbody.append(frag);
        if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      }
    }

    function el(tag, className, text){ const x=document.createElement(tag); if (className) x.className=className; if (text!=null) x.textContent=text; return x; }

    global.JocarsaUX = JocarsaUX;
    global['jocarsa|ux'] = { UX: JocarsaUX };

  })(window);
```

<a id="eventos-escuchadores"></a>
## Eventos; escuchadores

En el desarrollo de interfaces de usuario (UI), los eventos son un elemento fundamental que permiten a las aplicaciones responder a las acciones del usuario. Un evento es una señal generada por algún objeto o componente cuando ocurre algo relevante. Por ejemplo, al hacer clic en un botón, seleccionar un item en una lista o escribir texto en un campo de entrada, todos estos son eventos que pueden ser capturados y respondidos.

Los escuchadores (o listeners) son objetos que se encargan de manejar los eventos generados. Algunos lenguajes de programación y frameworks proporcionan mecanismos específicos para asociar eventos con sus respectivos escuchadores. Por ejemplo, en Java Swing, puedes agregar un ActionListener a un botón para definir qué debe hacerse cuando el usuario haga clic en él.

La relación entre eventos y escuchadores es crucial porque permite una comunicación bidireccional entre la interfaz del usuario y la lógica de negocio. Cuando se produce un evento, el sistema emite una señal al escuchador asociado, que luego puede ejecutar ciertas acciones en respuesta. Esto facilita la separación de los detalles de la interfaz del usuario de la lógica de negocio, lo que hace que el código sea más modular y fácil de mantener.

Además de los eventos y sus escuchadores, es importante considerar el flujo de control dentro de estos mecanismos. Algunas aplicaciones pueden requerir manejar múltiples eventos simultáneamente o reaccionar a un evento en función del estado actual de la aplicación. En este contexto, las herramientas de programación proporcionan patrones y técnicas para gestionar eficientemente el flujo de control dentro de los escuchadores.

En resumen, los eventos y sus escuchadores son elementos esenciales en el desarrollo de interfaces de usuario. Permiten una comunicación fluida entre la interfaz del usuario y la lógica de negocio, facilitando la creación de aplicaciones interactivas y responsivas. Al comprender cómo trabajar con estos mecanismos, los desarrolladores pueden crear interfaces que ofrezcan una experiencia óptima al usuario, mejorando así la satisfacción del mismo y el éxito general de la aplicación.

<a id="ejercicio-de-final-de-unidad"></a>
## Ejercicio de final de unidad

### ejercicio

```markdown

```


<a id="generacion-de-interfaces-naturales-de-usuario"></a>
# Generación de interfaces naturales de usuario

<a id="herramientas-para-el-aprendizaje-automatico"></a>
## Herramientas para el aprendizaje automático

En el campo del desarrollo de interfaces de usuario, la inteligencia artificial y el aprendizaje automático están revolucionando cómo interactuamos con las aplicaciones. Herramientas como TensorFlow, PyTorch o Scikit-learn permiten a los desarrolladores crear sistemas que pueden aprender patrones complejos en los datos y adaptarse a nuevas situaciones sin necesidad de programación explícita.

Estas herramientas son fundamentales para el desarrollo de interfaces naturales de usuario (INU), donde la intención es hacer que las aplicaciones sean más intuitivas y accesibles. A través del aprendizaje automático, se pueden crear reconocedores de voz, sistemas de recomendación personalizados o incluso interfaces basadas en gestos.

El proceso comienza con el entrenamiento de un modelo. Este puede ser hecho utilizando conjuntos de datos etiquetados que representan las acciones que el sistema debe aprender a reconocer. Por ejemplo, para una aplicación de reconocimiento de voz, se podrían usar grabaciones de diferentes usuarios pronunciando comandos específicos.

Una vez entrenado, el modelo puede ser integrado en la interfaz de usuario. En el caso del reconocimiento de voz, esto implicaría que cada vez que un usuario hable, la aplicación utilizaría el modelo para interpretar su intención y ejecutar las acciones correspondientes. Para sistemas de recomendación, el modelo aprendería a predecir los gustos del usuario basándose en sus interacciones previas.

Es importante destacar que el aprendizaje automático no solo mejora la eficiencia de las interfaces, sino que también amplía su alcance. Por ejemplo, un sistema de reconocimiento facial podría permitir una autenticación segura y rápida sin necesidad de contraseñas tradicionales. Otra aplicación podría ser el análisis del comportamiento del usuario para personalizar la experiencia en tiempo real.

Sin embargo, el uso de aprendizaje automático también plantea desafíos éticos y de privacidad. Es crucial que las aplicaciones basadas en IA respeten los derechos de los usuarios y protejan su información. Esto incluye obtener consentimiento explícito para la recopilación y análisis de datos, así como proporcionar opciones para el usuario para controlar cómo sus datos son utilizados.

En conclusión, el aprendizaje automático está desempeñando un papel crucial en el desarrollo de interfaces naturales de usuario. A través del entrenamiento de modelos basados en datos, es posible crear sistemas que no solo responden a las acciones del usuario, sino que también adaptan su comportamiento para mejorar la experiencia y personalizarla según las preferencias individuales. Sin embargo, es fundamental considerar los aspectos éticos y de privacidad al implementar estas tecnologías en aplicaciones de interfaz de usuario.

### comprobacion de ollama

```markdown
ollama --version

ollama version is 0.11.10

ollama list
josevicente@josevicenteportatil:~$ ollama list
NAME                         ID              SIZE      MODIFIED    
llama3.1:8b-instruct-q4_0    42182419e950    4.7 GB    2 days ago     
qwen2.5-coder:7b             dae161e27b0e    4.7 GB    2 weeks ago    
gpt-oss:20b                  f2b8351c629c    13 GB     6 weeks ago    
josevicente@josevicenteportatil:~$ 

Instalar un nuevo modelo:

ollama pull llama3.1:8b-instruct-q4_0

ollama run llama3.1:8b-instruct-q4_0 "¿Cual es la capital de España?"
```

<a id="interfaces-naturales"></a>
## Interfaces naturales

La generación de interfaces naturales de usuario (INUs) es un campo fascinante dentro del desarrollo de software que busca crear experiencias interactivas y intuitivas para los usuarios finales. Las INUs se centran en la creación de sistemas que pueden ser utilizados sin necesidad de conocimientos técnicos avanzados, lo que las hace accesibles a una audiencia más amplia.

En este contexto, el aprendizaje automático (Machine Learning) juega un papel crucial, ya que permite al software aprender y mejorar su capacidad para entender y responder a los comportamientos del usuario. Herramientas de aprendizaje automático pueden ser utilizadas para reconocer patrones en la interacción del usuario con la interfaz, adaptando así el diseño y las funcionalidades según las preferencias individuales.

Las interfaces naturales también incluyen la capacidad de interactuar a través de múltiples canales, como voz, gestos y movimiento corporal. Estas interfaces permiten una comunicación bidireccional entre el usuario y el sistema, lo que puede ser especialmente útil en entornos donde la entrada manual sea incómoda o imposible.

La realidad aumentada (AR) es otro ejemplo de interfaz natural que integra elementos del mundo físico con información digital. En un contexto de desarrollo de interfaces naturales, la AR podría utilizarse para superponer información relevante sobre el entorno real en una pantalla digital, facilitando la toma de decisiones y la realización de tareas.

La creación de componentes visuales es otro aspecto fundamental del desarrollo de interfaces naturales. Los componentes deben ser intuitivos y fáciles de usar, permitiendo a los usuarios realizar acciones con solo un clic o una acción gestual. Además, estos componentes deben ser accesibles para personas con discapacidades visuales o motoras, lo que implica la implementación de tecnologías como el uso de teclas alternativas y lectores de pantalla.

El diseño de interfaces gráficas es otro aspecto crucial del desarrollo de interfaces naturales. Los diseños deben ser atractivos y fáciles de entender, con una estructura lógica que guíe al usuario hacia la información más relevante. La usabilidad y accesibilidad son factores clave en este proceso, ya que un diseño mal diseñado puede frustrar a los usuarios y hacer que el sistema sea difícil de usar.

La creación de informes es otro aspecto importante del desarrollo de interfaces naturales. Los informes deben ser presentados de manera clara y concisa, utilizando gráficos y tablas para facilitar la comprensión de la información. Además, los informes deben ser personalizables, permitiendo a los usuarios seleccionar las métricas más relevantes y visualizarlas en diferentes formatos.

La documentación de aplicaciones es otro aspecto crucial del desarrollo de interfaces naturales. La documentación debe ser clara y detallada, proporcionando instrucciones sobre cómo usar la aplicación y explicando las funcionalidades principales. Además, la documentación debe estar disponible en múltiples formatos, como texto, videos y tutoriales interactivos.

La distribución de aplicaciones es otro aspecto importante del desarrollo de interfaces naturales. La distribución debe ser sencilla y segura, permitiendo a los usuarios descargar e instalar la aplicación con solo unos pocos clics. Además, la distribución debe incluir opciones para actualizar automáticamente la aplicación cuando sea necesario.

La realización de pruebas es otro aspecto crucial del desarrollo de interfaces naturales. Las pruebas deben ser exhaustivas y abarcar todos los posibles escenarios de uso, asegurando que la interfaz funcione correctamente en todas las situaciones. Además, las pruebas deben incluir pruebas de usabilidad y accesibilidad, para garantizar que la interfaz sea fácil de usar y accesible para todos los usuarios.

En resumen, el desarrollo de interfaces naturales es un campo fascinante dentro del desarrollo de software que busca crear experiencias interactivas y intuitivas para los usuarios finales. Las INUs se centran en la creación de sistemas que pueden ser utilizados sin necesidad de conocimientos técnicos avanzados, lo que las hace accesibles a una audiencia más amplia.

<a id="voz-y-habla"></a>
## Voz y Habla

En el campo de la programación de interfaces de usuario, una de las áreas emergentes es la generación de interfaces naturales de usuario (NUI), que permiten a los usuarios interactuar con sistemas mediante lenguaje natural. En esta subunidad, nos centraremos en uno de los aspectos más innovadores y revolucionarios de NUI: el uso de voz y habla.

El reconocimiento de voz es una tecnología que convierte las palabras pronunciadas en texto digital, lo que permite a los usuarios interactuar con dispositivos electrónicos sin necesidad de usar un teclado o un mouse. Esta capacidad ha sido ampliamente utilizada en aplicaciones como asistentes virtuales y sistemas de control remoto inteligentes.

La sintesis de voz, por otro lado, es el proceso inverso que convierte texto digital en sonido audible. Esta tecnología es fundamental para la generación de interfaces hapticas y visuales basadas en texto, lo que mejora significativamente la experiencia del usuario al permitir una comunicación bidireccional.

La combinación de reconocimiento de voz y sintesis de voz permite crear interfaces de usuario completamente naturales y fluidas. Los usuarios pueden interactuar con dispositivos electrónicos utilizando comandos vocales, lo que facilita el acceso a información y la realización de tareas sin necesidad de moverse o tocar pantallas.

Para implementar estas tecnologías en aplicaciones, se utilizan bibliotecas y frameworks específicamente diseñados para el procesamiento del lenguaje natural. Estas herramientas ofrecen una amplia gama de funciones, desde la detección de palabras clave hasta la interpretación de intenciones y emociones.

Es importante destacar que el desarrollo de interfaces basadas en voz requiere un enfoque cuidadoso para garantizar la accesibilidad y la seguridad. Los sistemas deben estar diseñados para manejar correctamente errores y excepciones, y debe implementarse una política de privacidad robusta para proteger los datos personales de los usuarios.

Además, el diseño de interfaces naturales de usuario basadas en voz implica considerar factores como la fluidez del lenguaje natural, la claridad de las instrucciones y la adaptabilidad a diferentes tipos de usuarios. Esto requiere una comprensión profunda del lenguaje humano y la capacidad para crear experiencias interactivas que sean intuitivas y eficientes.

En conclusión, el uso de voz y habla en interfaces de usuario representa un avance significativo en la interacción humana con tecnología. A través del reconocimiento de voz y la sintesis de voz, se pueden crear experiencias más naturales, accesibles y seguras para los usuarios, lo que abre nuevas posibilidades en el campo de la programación de interfaces de usuario.

### sintesis de voz

```html
<!doctype html>
<html lang="es">
  <meta charset="utf-8" />
  <title>Speech Synthesis (mínimo)</title>
  <textarea id="t" rows="3" style="width:100%">Hola, esto es una prueba de síntesis de voz en español.</textarea>
  <br>
  <button id="s">🔊 Hablar</button>
  <script>
    let voices = [];
    function pickVoice() {
      // intenta una voz española; si no, usa la primera disponible
      const v = voices.find(v => /es-|Spanish/i.test(v.lang)) || voices[0];
      return v || null;
    }
    function loadVoices() {
      voices = speechSynthesis.getVoices();
    }
    loadVoices();
    speechSynthesis.onvoiceschanged = loadVoices;

    document.getElementById('s').onclick = () => {
      const u = new SpeechSynthesisUtterance(document.getElementById('t').value);
      const v = pickVoice();
      if (v) u.voice = v;
      u.lang = (v && v.lang) || 'es-ES';
      speechSynthesis.cancel(); // por si había algo en cola
      speechSynthesis.speak(u);
    };
  </script>
</html>
```

### microfono

```html
<!doctype html>
<html lang="es">
  <meta charset="utf-8" />
  <title>Speech Recognition (mínimo)</title>
  <button id="start">🎙️ Escuchar</button>
  <div id="out"></div>
  <script>
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new SpeechRecognition();
    rec.lang = "es-ES";
    rec.interimResults = false;
    
    rec.onresult = function(e){ 
      document.getElementById("out").textContent = e.results[0][0].transcript;
      
      
    }
    
    document.getElementById("start").onclick = () => rec.start();
  </script>
</html>
```

### fusiono proyectos

```html
<!doctype html>
<html lang="es">
  <meta charset="utf-8" />
  <title>Speech Recognition (mínimo)</title>
  <button id="start">🎙️ Escuchar</button>
  <div id="out"></div>
  <script>
    // Configuración inicial de la sintesis de voz
    let voices = [];
    function pickVoice() {
      // intenta una voz española; si no, usa la primera disponible
      const v = voices.find(v => /es-|Spanish/i.test(v.lang)) || voices[0];
      return v || null;
    }
    function loadVoices() {
      voices = speechSynthesis.getVoices();
    }
    loadVoices();
    speechSynthesis.onvoiceschanged = loadVoices;

    
  
  
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new SpeechRecognition();
    rec.lang = "es-ES";
    rec.interimResults = false;
    
    rec.onresult = function(e){ 
    
      // Primero escribe lo que has oido
      document.getElementById("out").textContent = e.results[0][0].transcript;
      
      // Y ahora hablalo
      const u = new SpeechSynthesisUtterance(e.results[0][0].transcript);
      const v = pickVoice();
      if (v) u.voice = v;
      u.lang = (v && v.lang) || 'es-ES';
      speechSynthesis.cancel(); // por si había algo en cola
      speechSynthesis.speak(u);
      
    }
    
    document.getElementById("start").onclick = () => rec.start();
  </script>
</html>
```

### pinto tabla

```html
<!doctype html>
<html lang="es">
  <meta charset="utf-8" />
  <title>Speech Recognition (mínimo)</title>
  <button id="start">🎙️ Escuchar</button>
  <div id="out"></div>
  <div id="contenedor"></div>
  <script>
    // Datos iniciales
    
    clientes = [
      {"nombre":"jose Vicente","apellidos":"Carratala Sanchis","email":"info@jocarsa.com"},
      {"nombre":"Juan","apellidos":"Garcia","email":"info@jocarsa.com"},
      {"nombre":"Jorge","apellidos":"Lopez","email":"info@jocarsa.com"}
    ]
    
    function pintaTabla(){
      let cadena = "<table><tr><th>Nombre</th><th>Apellidos</th><th>Email</th></tr>"
      clientes.forEach(function(cliente){
        cadena += "<tr><td>"+cliente.nombre+"</td><td>"+cliente.apellidos+"</td><td>"+cliente.email+"</td></tr>"
      })
      cadena += "</table>"
      document.querySelector("#contenedor").innerHTML = cadena
    }
    pintaTabla()
    // Configuración inicial de la sintesis de voz
    let voices = [];
    function pickVoice() {
      // intenta una voz española; si no, usa la primera disponible
      const v = voices.find(v => /es-|Spanish/i.test(v.lang)) || voices[0];
      return v || null;
    }
    function loadVoices() {
      voices = speechSynthesis.getVoices();
    }
    loadVoices();
    speechSynthesis.onvoiceschanged = loadVoices;

    
  
  
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new SpeechRecognition();
    rec.lang = "es-ES";
    rec.interimResults = false;
    
    rec.onresult = function(e){ 
    
      // Primero escribe lo que has oido
      document.getElementById("out").textContent = e.results[0][0].transcript;
      
      // Y ahora hablalo
      const u = new SpeechSynthesisUtterance(e.results[0][0].transcript);
      const v = pickVoice();
      if (v) u.voice = v;
      u.lang = (v && v.lang) || 'es-ES';
      speechSynthesis.cancel(); // por si había algo en cola
      speechSynthesis.speak(u);
      
    }
    
    document.getElementById("start").onclick = () => rec.start();
  </script>
</html>
```

### reacciono a la voz

```html
<!doctype html>
<html lang="es">
  <meta charset="utf-8" />
  <title>Speech Recognition (mínimo)</title>
  <button id="start">🎙️ Escuchar</button>
  <div id="out"></div>
  <div id="contenedor"></div>
  <script>
    // Datos iniciales
    
    clientes = [
      {"nombre":"jose Vicente","apellidos":"Carratala Sanchis","email":"info@jocarsa.com"},
      {"nombre":"Juan","apellidos":"Garcia","email":"info@jocarsa.com"},
      {"nombre":"Jorge","apellidos":"Lopez","email":"info@jocarsa.com"}
    ]
    
    function pintaTabla(){
      let cadena = "<table><tr><th>Nombre</th><th>Apellidos</th><th>Email</th></tr>"
      clientes.forEach(function(cliente){
        cadena += "<tr><td>"+cliente.nombre+"</td><td>"+cliente.apellidos+"</td><td>"+cliente.email+"</td></tr>"
      })
      cadena += "</table>"
      document.querySelector("#contenedor").innerHTML = cadena
    }
    pintaTabla()
    // Configuración inicial de la sintesis de voz
    let voices = [];
    function pickVoice() {
      // intenta una voz española; si no, usa la primera disponible
      const v = voices.find(v => /es-|Spanish/i.test(v.lang)) || voices[0];
      return v || null;
    }
    function loadVoices() {
      voices = speechSynthesis.getVoices();
    }
    loadVoices();
    speechSynthesis.onvoiceschanged = loadVoices;

    
  
  
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new SpeechRecognition();
    rec.lang = "es-ES";
    rec.interimResults = false;
    
    rec.onresult = function(e){ 
      let reconocido = e.results[0][0].transcript
      // Primero escribe lo que has oido
      document.getElementById("out").textContent = reconocido;
      
      // Y ahora hablalo
      const u = new SpeechSynthesisUtterance(reconocido);
      const v = pickVoice();
      if (v) u.voice = v;
      u.lang = (v && v.lang) || 'es-ES';
      speechSynthesis.cancel(); // por si había algo en cola
      speechSynthesis.speak(u);
      var operacion = reconocido.split(" ")[0]
      switch(operacion){
         case "eliminar":
          console.log("Vamos a eliminar");
          let numero = reconocido.split(" ")[1]
          switch(numero){
            case "cero":clientes.splice(0,1);break;
            case "uno":clientes.splice(1,1);break;
            case "dos":clientes.splice(2,1);break;
            case "tres":clientes.splice(3,1);break;
            case "cuatro":clientes.splice(4,1);break;
            case "cinco":clientes.splice(5,1);break;
          }
          pintaTabla()
          break;
         case "insertar":console.log("Vamos a insertar");break;
         case "actualizar":console.log("Vamos a actualizar");break;
         case "leer":console.log("Vamos a leer");break;
      }
      
    }
    
    document.getElementById("start").onclick = () => rec.start();
  </script>
</html>
```

<a id="partes-y-movimientos-del-cuerpo"></a>
## Partes y movimientos del cuerpo

La generación de interfaces naturales de usuario (INU) es un campo fascinante que busca hacer que las interacciones entre los usuarios y los sistemas sean más intuitivas y eficientes. En esta subunidad, nos centraremos en cómo el cuerpo humano puede ser utilizado como una interfaz natural para interactuar con aplicaciones digitales.

El primer paso en la creación de interfaces naturales es entender cómo el cuerpo humano se comunica. El lenguaje corporal, las expresiones faciales y los gestos son formas poderosas de comunicación que pueden transmitir significados complejos sin necesidad de palabras. En una interfaz natural, estos elementos pueden ser utilizados para controlar aplicaciones, realizar acciones o navegar por interfaces gráficas.

La parte del cuerpo que se utiliza más frecuentemente en la INU es el brazo y las manos. Los gestos con los dedos pueden simular clics, desplazar objetos o seleccionar opciones de menú. Además, la capacidad de mover el brazo para realizar acciones precisas puede ser crucial en aplicaciones como control remoto, edición de imágenes o juegos.

Las expresiones faciales también juegan un papel importante en las interfaces naturales. Las sonrisas y los gestos pueden indicar emociones o estados de ánimo, lo que puede ayudar a mejorar la experiencia del usuario al proporcionar retroalimentación visual inmediata. Por ejemplo, una aplicación podría mostrar una expresión de felicidad cuando un usuario realiza una tarea exitosa.

El movimiento del cuerpo también puede ser utilizado para interactuar con interfaces naturales. El movimiento de los ojos puede indicar interés o desinterés en ciertos elementos de la interfaz, mientras que el movimiento de la cabeza puede simular clics o seleccionar opciones. Además, el movimiento del cuerpo completo puede ser utilizado para realizar acciones complejas, como mover un objeto a través de una pantalla.

La INU también implica considerar cómo los usuarios interactuarán con las interfaces en diferentes entornos y situaciones. Por ejemplo, en un entorno público o en condiciones de baja visibilidad, la capacidad de controlar aplicaciones utilizando solo el cuerpo puede ser crucial. Además, en aplicaciones para personas con discapacidades motoras, la INU puede proporcionar una forma accesible de interactuar con sistemas digitales.

La creación de interfaces naturales requiere un enfoque multidisciplinario que combine conocimientos de ingeniería de software, psicología cognitiva y biología humana. Es importante considerar cómo el cuerpo humano se comunica y cómo esta comunicación puede ser utilizada para interactuar con aplicaciones digitales. Además, es crucial probar interfaces naturales en diferentes entornos y situaciones para asegurar que sean accesibles y eficientes.

En conclusión, la generación de interfaces naturales de usuario es un campo emocionante que busca hacer que las interacciones entre los usuarios y los sistemas sean más intuitivas y eficientes. Al considerar cómo el cuerpo humano se comunica y cómo esta comunicación puede ser utilizada para interactuar con aplicaciones digitales, podemos crear interfaces naturales que proporcionen una experiencia de usuario excepcional.

### reconocimiento manos

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MediaPipe Hands – simplest demo</title>
    <style>canvas{max-width:100%;height:auto}</style>
    <!-- MediaPipe (legacy JS CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  </head>
  <body>
    <video class="input_video" autoplay playsinline muted style="display:none"></video>
    <canvas class="output_canvas" width="640" height="480"></canvas>

    <script>
      const video  = document.querySelector('.input_video');
      const canvas = document.querySelector('.output_canvas');
      const ctx    = canvas.getContext('2d');

      function onResults(results){
        ctx.save();
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
        if (results.multiHandLandmarks) {
          for (const landmarks of results.multiHandLandmarks) {
            drawConnectors(ctx, landmarks, HAND_CONNECTIONS);
            drawLandmarks(ctx, landmarks, {radius: 2});
          }
        }
        ctx.restore();
      }

      const hands = new Hands({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
      });
      hands.setOptions({
        maxNumHands: 2,
        modelComplexity: 0,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      hands.onResults(onResults);

      const camera = new Camera(video, {
        onFrame: async () => { await hands.send({image: video}); },
        width: 640, height: 480
      });
      camera.start();
    </script>
  </body>
</html>
```

### acceso a los datos

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MediaPipe Hands – simplest demo</title>
    <style>canvas{max-width:100%;height:auto}</style>
    <!-- MediaPipe (legacy JS CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  </head>
  <body>
    <video class="input_video" autoplay playsinline muted style="display:none"></video>
    <canvas class="output_canvas" width="640" height="480"></canvas>

    <script>
      const video  = document.querySelector('.input_video');
      const canvas = document.querySelector('.output_canvas');
      const ctx    = canvas.getContext('2d');

      function onResults(results){
        ctx.save();
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
        if (results.multiHandLandmarks) {
          for (const landmarks of results.multiHandLandmarks) {
            drawConnectors(ctx, landmarks, HAND_CONNECTIONS);
            drawLandmarks(ctx, landmarks, {radius: 1});
            console.log(landmarks)
          }
        }
        ctx.restore();
      }

      const hands = new Hands({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
      });
      hands.setOptions({
        maxNumHands: 2,
        modelComplexity: 0,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      hands.onResults(onResults);

      const camera = new Camera(video, {
        onFrame: async () => { await hands.send({image: video}); },
        width: 640, height: 480
      });
      camera.start();
    </script>
  </body>
</html>
```

### cara

```html
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MediaPipe FaceMesh — tiniest demo</title>
  <style>canvas{max-width:100%;height:auto}</style>
  <!-- MediaPipe legacy JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <video class="input_video" autoplay playsinline muted style="display:none"></video>
  <canvas class="output_canvas" width="640" height="480"></canvas>

  <script>
    const video  = document.querySelector('.input_video');
    const canvas = document.querySelector('.output_canvas');
    const ctx    = canvas.getContext('2d');

    function onResults(results){
      ctx.save();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

      if (results.multiFaceLandmarks) {
        for (const landmarks of results.multiFaceLandmarks) {
          // Full mesh (triangles)
          drawConnectors(ctx, landmarks, FACEMESH_TESSELATION);
          // Face boundaries/contours (lips, eyes, face oval, etc.)
          drawConnectors(ctx, landmarks, FACEMESH_CONTOURS, {lineWidth: 2});
          // Optional: irises
          if (window.FACEMESH_IRISES)
            drawConnectors(ctx, landmarks, FACEMESH_IRISES, {lineWidth: 2});
        }
      }
      ctx.restore();
    }

    const faceMesh = new FaceMesh({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
    });
    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true,       // enables iris landmarks
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });
    faceMesh.onResults(onResults);

    const camera = new Camera(video, {
      onFrame: async () => { await faceMesh.send({image: video}); },
      width: 640, height: 480
    });
    camera.start();
  </script>
</body>
</html>
```

### cuerpo

```html
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MediaPipe Pose — tiniest demo</title>
  <style>canvas{max-width:100%;height:auto}</style>
  <!-- MediaPipe legacy JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <video class="input_video" autoplay playsinline muted style="display:none"></video>
  <canvas class="output_canvas" width="640" height="480"></canvas>

  <script>
    const video  = document.querySelector('.input_video');
    const canvas = document.querySelector('.output_canvas');
    const ctx    = canvas.getContext('2d');

    function onResults(results){
      ctx.save();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

      if (results.poseLandmarks) {
        drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS,
                       {color: 'aqua', lineWidth: 2});
        drawLandmarks(ctx, results.poseLandmarks,
                      {color: 'red', radius: 3});
      }
      ctx.restore();
    }

    const pose = new Pose({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
    });
    pose.setOptions({
      modelComplexity: 1,
      smoothLandmarks: true,
      enableSegmentation: false,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });
    pose.onResults(onResults);

    const camera = new Camera(video, {
      onFrame: async () => { await pose.send({image: video}); },
      width: 640, height: 480
    });
    camera.start();
  </script>
</body>
</html>
```

<a id="realidad-aumentada"></a>
## Realidad aumentada

La realidad aumentada (RA) es una tecnología que superpone información digital sobre el mundo físico, creando experiencias interactivas y immersive. En este contexto, la generación de interfaces naturales de usuario se vuelve crucial para permitir a los usuarios interactuar eficazmente con estas aplicaciones.

Para desarrollar interfaces naturales en RA, es fundamental entender cómo capturar y procesar datos sensoriales del entorno físico. Los sensores como cámaras, microfonos y acelerómetros juegan un papel vital en recoger información precisa sobre la ubicación, orientación y movimiento del usuario. Utilizando bibliotecas especializadas, estos datos pueden ser analizados para determinar el contexto de interacción del usuario con el entorno.

La creación de interfaces naturales también implica diseñar elementos visuales y auditivos que sean intuitivos y accesibles. Esto puede implicar la utilización de gestos específicos, reconocimiento de voz o incluso la interpretación de movimientos corporales para controlar las acciones dentro del contexto de RA. Herramientas como Unity o Unreal Engine ofrecen funcionalidades avanzadas para implementar estos mecanismos, permitiendo a los desarrolladores crear interfaces que se adapten al entorno físico y personal.

Además de la interacción directa con el usuario, es importante considerar la accesibilidad en RA. Esto incluye proporcionar alternativas para usuarios con discapacidades visuales o auditivas, así como garantizar que las interfaces sean fáciles de usar por personas de todas las edades y niveles de habilidad. La inclusión en RA no solo mejora la experiencia del usuario final sino que también amplía el alcance potencial de las aplicaciones.

La documentación es otro aspecto crucial en el desarrollo de interfaces naturales para RA. Es importante crear guías detalladas que expliquen cómo configurar y utilizar las herramientas necesarias, así como cómo optimizar las interfaces para diferentes entornos físicos. La documentación también debe incluir ejemplos prácticos y tutoriales que ayuden a los desarrolladores a experimentar con nuevas ideas y técnicas.

La distribución de aplicaciones RA requiere consideraciones adicionales en términos de empaquetado y instalación. Los usuarios deben ser capaces de instalar y ejecutar las aplicaciones sin complicaciones, lo que puede implicar la creación de instaladores personalizados o la utilización de plataformas de distribución confiables. La seguridad también es un factor importante en el proceso de distribución, ya que las aplicaciones RA pueden interactuar con información sensible del usuario.

En conclusión, la generación de interfaces naturales para realidad aumentada es una tarea compleja pero gratificante que requiere una combinación de conocimientos técnicos y creatividad. Al considerar aspectos como la captura de datos sensoriales, diseño intuitivo, accesibilidad, documentación y distribución, los desarrolladores pueden crear experiencias RA que sean únicas, interactivas y beneficiosas para el usuario final.

### mediapipe cara

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MediaPipe FaceMesh Example</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #000;
    }
    video, canvas {
      position: absolute;
      width: 640px;
      height: 480px;
      transform: scaleX(-1); /* Mirror for natural selfie view */
    }
  </style>
</head>
<body>

  <video class="input_video" autoplay></video>
  <canvas class="output_canvas" width="640" height="480"></canvas>

  <!-- MediaPipe FaceMesh -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <script>
    const videoElement = document.querySelector('.input_video');
    const canvasElement = document.querySelector('.output_canvas');
    const canvasCtx = canvasElement.getContext('2d');

    // Create FaceMesh instance
    const faceMesh = new FaceMesh({
      locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
      }
    });

    // FaceMesh settings
    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true, // includes iris tracking
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });

    // On each frame result
    faceMesh.onResults((results) => {
      canvasCtx.save();
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

      // Draw the camera image
      canvasCtx.drawImage(
        results.image, 0, 0, canvasElement.width, canvasElement.height);

      // Draw face mesh
      if (results.multiFaceLandmarks) {
        for (const landmarks of results.multiFaceLandmarks) {
          drawConnectors(canvasCtx, landmarks, FACEMESH_TESSELATION,
                         {color: '#C0C0C070', lineWidth: 1});
          drawConnectors(canvasCtx, landmarks, FACEMESH_RIGHT_EYE, {color: '#FF3030'});
          drawConnectors(canvasCtx, landmarks, FACEMESH_LEFT_EYE, {color: '#30FF30'});
          drawConnectors(canvasCtx, landmarks, FACEMESH_LIPS, {color: '#E0E0E0'});
          drawConnectors(canvasCtx, landmarks, FACEMESH_FACE_OVAL, {color: '#FFFFFF'});
        }
      }
      canvasCtx.restore();
    });

    // Set up the camera
    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await faceMesh.send({image: videoElement});
      },
      width: 640,
      height: 480
    });
    camera.start();
  </script>

</body>
</html>
```

### via 3d

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FaceMesh 2D Canvas Texture (no Three.js)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }
    #wrap { position:relative; width:100vw; height:100vh; }
    video, canvas {
      position:absolute; inset:0; margin:auto;
      max-width:min(100vw, 100vh*4/3);
      max-height:min(100vh, 100vw*3/4);
      transform: scaleX(-1); /* selfie view */
    }
    #vid { opacity:.35; }
    #note {
      position:fixed; left:12px; bottom:12px; color:#fff; font:12px/1.2 system-ui, sans-serif; opacity:.85;
      background:rgba(0,0,0,.35); padding:.4rem .6rem; border-radius:.4rem;
    }
  </style>

  <!-- MediaPipe FaceMesh runtime -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <!-- Triangulation indices (defines global: TRIANGULATION) -->
  <script src="https://cdn.jsdelivr.net/npm/face-landmarks-triangulation@0.0.7/dist/triangulation.js"></script>

  <!-- TFJS (minimal) + legacy Facemesh UMD just to read UVs at runtime -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core@3.21.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@3.21.0/dist/tf-converter.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/facemesh@0.0.4/dist/facemesh.js"></script>
</head>
<body>
  <div id="wrap">
    <video id="vid" autoplay muted playsinline></video>
    <canvas id="out"></canvas>
  </div>
  <div id="note">Put a transparent <code>makeup.png</code> next to this file (painted in the canonical UV layout).</div>

  <script>
  // ---------- DOM
  const video  = document.getElementById('vid');
  const canvas = document.getElementById('out');
  const ctx    = canvas.getContext('2d');

  // ---------- Load your texture (must match canonical UV layout)
  const makeupImg = new Image();
  makeupImg.src = 'makeup.png';

  // ---------- Globals
  const VERTS = 468;
  let UVS = null;        // will come from facemesh.getUVCoords()
  let srcTris = null;    // source triangles in texture pixel coords

  // Ask the legacy TFJS Facemesh UMD for canonical UVs
  // (window.facemesh is defined by the UMD bundle we included above)
  (async () => {
    try {
      UVS = await window.facemesh.getUVCoords(); // [[u,v], ...] length 468
      // If texture is already loaded, precompute triangles
      if (makeupImg.complete) buildSrcTriangles();
      else makeupImg.onload = buildSrcTriangles;
    } catch (e) {
      console.error('Failed to get UVs from TFJS facemesh:', e);
    }
  })();

  // Precompute source triangles once UVS + texture ready
  function buildSrcTriangles() {
    if (!UVS) return;
    const w = makeupImg.naturalWidth  || makeupImg.width;
    const h = makeupImg.naturalHeight || makeupImg.height;
    if (!w || !h) return;

    if (!window.TRIANGULATION) {
      console.error('TRIANGULATION not loaded');
      return;
    }
    srcTris = [];
    for (let i = 0; i < TRIANGULATION.length; i += 3) {
      const a = TRIANGULATION[i], b = TRIANGULATION[i+1], c = TRIANGULATION[i+2];
      const [ua, va] = UVS[a], [ub, vb] = UVS[b], [uc, vc] = UVS[c];
      srcTris.push([
        ua*w, (1-va)*h,
        ub*w, (1-vb)*h,
        uc*w, (1-vc)*h
      ]);
    }
  }

  // ---------- Math: affine mapping from source tri -> dest tri (Canvas2D)
  function triToAffine(sx0, sy0, sx1, sy1, sx2, sy2, dx0, dy0, dx1, dy1, dx2, dy2) {
    const denom = sx0*(sy1 - sy2) + sx1*(sy2 - sy0) + sx2*(sy0 - sy1);
    if (Math.abs(denom) < 1e-8) return [1,0,0,1,0,0]; // degenerate
    const m00 = (dx0*(sy1 - sy2) + dx1*(sy2 - sy0) + dx2*(sy0 - sy1)) / denom;
    const m10 = (dy0*(sy1 - sy2) + dy1*(sy2 - sy0) + dy2*(sy0 - sy1)) / denom;
    const m01 = (dx0*(sx2 - sx1) + dx1*(sx0 - sx2) + dx2*(sx1 - sx0)) / denom;
    const m11 = (dy0*(sx2 - sx1) + dy1*(sx0 - sx2) + dy2*(sx1 - sx0)) / denom;
    const m02 = (dx0*(sx1*sy2 - sx2*sy1) + dx1*(sx2*sy0 - sx0*sy2) + dx2*(sx0*sy1 - sx1*sy0)) / denom;
    const m12 = (dy0*(sx1*sy2 - sx2*sy1) + dy1*(sx2*sy0 - sx0*sy2) + dy2*(sx0*sy1 - sx1*sy0)) / denom;
    return [m00, m10, m01, m11, m02, m12]; // a,b,c,d,e,f for ctx.setTransform
  }

  function drawTexturedTriangle(img, s, d) {
    // s: [sx0,sy0, sx1,sy1, sx2,sy2]
    // d: [dx0,dy0, dx1,dy1, dx2,dy2]
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(d[0], d[1]);
    ctx.lineTo(d[2], d[3]);
    ctx.lineTo(d[4], d[5]);
    ctx.closePath();
    ctx.clip();
    const m = triToAffine(
      s[0],s[1], s[2],s[3], s[4],s[5],
      d[0],d[1], d[2],d[3], d[4],d[5]
    );
    ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
    ctx.drawImage(img, 0, 0);
    ctx.restore();
  }

  // Map FaceMesh normalized coords (selfie) to canvas pixels (cover fit + mirror)
  function videoToCanvas(xNorm, yNorm) {
    const vW = video.videoWidth, vH = video.videoHeight;
    const cW = canvas.width,     cH = canvas.height;

    const videoAspect = vW / vH, canvasAspect = cW / cH;
    let scale, offX=0, offY=0;
    if (videoAspect > canvasAspect) {
      scale = cH / vH; offX = (vW*scale - cW) / 2;
    } else {
      scale = cW / vW; offY = (vH*scale - cH) / 2;
    }
    const xVid = (1 - xNorm) * vW;  // mirror
    const yVid = yNorm * vH;

    return [xVid * scale - offX, yVid * scale - offY];
  }

  // ---------- MediaPipe FaceMesh
  const faceMesh = new FaceMesh({
    locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`
  });
  faceMesh.setOptions({
    maxNumFaces: 1,
    refineLandmarks: true,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
  });

  faceMesh.onResults(res => {
    if (!res.multiFaceLandmarks || !makeupImg.complete || !srcTris) return;

    // 1) Draw camera with same cover fit + mirror
    ctx.setTransform(1,0,0,1,0,0);
    const vW = video.videoWidth, vH = video.videoHeight;
    const cW = canvas.width, cH = canvas.height;
    const videoAspect = vW / vH, canvasAspect = cW / cH;
    let dx=0, dy=0, dw=cW, dh=cH;
    if (videoAspect > canvasAspect) {
      dh = cH; dw = vW * (cH / vH); dx = (cW - dw) / 2; dy = 0;
    } else {
      dw = cW; dh = vH * (cW / vW); dx = 0; dy = (cH - dh) / 2;
    }
    ctx.clearRect(0,0,cW,cH);
    ctx.save();
    ctx.translate(cW, 0); ctx.scale(-1, 1);
    ctx.drawImage(video, dx, dy, dw, dh);
    ctx.restore();

    // 2) Cache destination landmark pixels
    const lms = res.multiFaceLandmarks[0];
    const destPts = new Array(VERTS * 2);
    for (let i = 0; i < VERTS; i++) {
      const [x, y] = videoToCanvas(lms[i].x, lms[i].y);
      destPts[i*2]   = x;
      destPts[i*2+1] = y;
    }

    // 3) Warp triangles from texture -> face
    // For grayscale masks you can try: ctx.globalCompositeOperation = 'multiply' or 'soft-light'
    ctx.globalCompositeOperation = 'source-over';
    for (let t = 0, ti = 0; t < srcTris.length; t++, ti += 3) {
      const s = srcTris[t];
      const a = TRIANGULATION[ti], b = TRIANGULATION[ti+1], c = TRIANGULATION[ti+2];
      const d = [
        destPts[a*2], destPts[a*2+1],
        destPts[b*2], destPts[b*2+1],
        destPts[c*2], destPts[c*2+1]
      ];
      drawTexturedTriangle(makeupImg, s, d);
    }
  });

  // ---------- Start camera
  const cam = new Camera(video, {
    onFrame: async () => { await faceMesh.send({ image: video }); },
    width: 640, height: 480
  });
  cam.start();

  // ---------- Keep canvas internal size in sync with its CSS size
  (function syncCanvasSize(){
    const r = canvas.getBoundingClientRect();
    const w = Math.round(r.width), h = Math.round(r.height);
    if (canvas.width !== w || canvas.height !== h) {
      canvas.width = w; canvas.height = h;
    }
    requestAnimationFrame(syncCanvasSize);
  })();
  </script>
</body>
</html>
```

### arjs

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR.js + A‑Frame — Minimal HIRO Demo</title>

    <!-- A‑Frame core -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- AR.js for A‑Frame build (marker‑based AR over the webcam) -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <style>
      html, body { margin: 0; height: 100%; }
      .hint {
        position: fixed; left: 0; right: 0; bottom: 0; padding: 10px 14px;
        background: rgba(0,0,0,.55); color: #fff; font-family: system-ui, sans-serif;
        text-align: center; z-index: 10; font-size: 14px; line-height: 1.35;
      }
      .brand { position: fixed; left: 10px; top: 10px; color: #fff; font: 600 12px/1 system-ui, sans-serif; letter-spacing: .08em; text-transform: uppercase; background: rgba(0,0,0,.45); padding: 6px 8px; border-radius: 10px; }
    </style>
  </head>
  <body>
    <div class="brand">AR.js + A‑Frame</div>
    <div class="hint">Allow the camera, then point it to a <strong>HIRO</strong> marker. Search “AR.js HIRO marker” to print it. Tip: good light & steady hands.</div>

    <!--
      The scene runs in "embedded" mode so it sits under our hint overlay.
      arjs attributes: sourceType webcam, no debug UI, and best tracking method.
    -->
    <a-scene
      embedded
      renderer="colorManagement: true; physicallyCorrectLights: true"
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">

      <!-- A soft ambient + directional light for nicer shading -->
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

      <!-- Track the preset HIRO marker; contents become visible when the marker is detected -->
      <a-marker preset="hiro">
        <!-- A simple animated cube sitting on the marker -->
        <a-box depth="0.5" height="0.5" width="0.5" color="#4CC3D9" position="0 0.25 0"
               animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear"></a-box>
        <!-- A ring to outline the marker origin -->
        <a-ring rotation="-90 0 0" radius-inner="0.15" radius-outer="0.2" color="#FFC65D"></a-ring>
        <!-- A text label that faces the camera -->
        <a-entity position="0 0.8 0" rotation="0 0 0"
                  text="value: ¡Hola AR.js!; align: center; color: #FFF; width: 2"></a-entity>
      </a-marker>

      <!-- Required to get the video feed in the background -->
      <a-entity camera></a-entity>
    </a-scene>

    <!--
      OPTIONAL: Use your own custom pattern marker.
      1) Train a marker to .patt with AR.js marker trainer.
      2) Host the .patt file and point the url attribute below to it.

      <a-marker type="pattern" url="./pattern-marker.patt">
        <a-sphere radius="0.25" color="#EF2D5E" position="0 0.25 0"></a-sphere>
      </a-marker>
    -->
  </body>
</html>
```

### proyectomelanie

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MediaPipe FaceMesh · AR Makeup (Lips/Eyeliner)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; background:#111; color:#eee; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .wrap { position:relative; display:grid; place-items:center; min-height:100vh; }
    video, canvas { max-width: min(96vw, 960px); width:100%; height:auto; border-radius:12px; }
    video { display:none; } /* we paint the video onto the canvas */
    .hud {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background: rgba(0,0,0,.55); color:#fff; padding:10px 12px; border-radius: 12px; backdrop-filter: blur(6px);
      font-size: 14px;
    }
    .hud label { display:flex; align-items:center; gap:8px; }
    .hud input[type="color"] { width: 28px; height: 28px; border: none; padding: 0; background: transparent; }
    .badge { position: fixed; top: 12px; left: 12px; background: rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px; }
  </style>

  <!-- MediaPipe legacy UMD JS (globals) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="badge">FaceMesh · AR Makeup</div>
    <video id="input_video" autoplay playsinline muted></video>
    <canvas id="output_canvas" width="640" height="480"></canvas>

    <div class="hud">
      <label>
        Effect:
        <select id="effect">
          <option value="lips" selected>Lipstick</option>
          <option value="eyeliner">Eyeliner</option>
        </select>
      </label>
      <label id="colorWrap">
        Color: <input id="color" type="color" value="#ff2a88" />
      </label>
      <label id="opacityWrap">
        Opacity: <input id="opacity" type="range" min="0" max="1" step="0.02" value="0.45" />
      </label>
      <label id="thicknessWrap" style="display:none">
        Thickness: <input id="thickness" type="range" min="1" max="16" step="1" value="6" />
      </label>
      <label>
        Smooth: <input id="smooth" type="range" min="0" max="1" step="0.1" value="0.5" />
      </label>
      <label>
        Mirror: <input id="mirror" type="checkbox" checked />
      </label>
    </div>
  </div>

  <script>
    // ---- DOM ----
    const video  = document.getElementById('input_video');
    const canvas = document.getElementById('output_canvas');
    const ctx    = canvas.getContext('2d');

    const ui = {
      effect:   document.getElementById('effect'),
      color:    document.getElementById('color'),
      opacity:  document.getElementById('opacity'),
      thick:    document.getElementById('thickness'),
      smooth:   document.getElementById('smooth'),
      mirror:   document.getElementById('mirror'),
      opacityWrap:   document.getElementById('opacityWrap'),
      thicknessWrap: document.getElementById('thicknessWrap'),
      colorWrap:     document.getElementById('colorWrap'),
    };

    // Toggle UI per effect
    function updateUI(){
      const lips = ui.effect.value === 'lips';
      ui.opacityWrap.style.display   = lips ? '' : 'none';
      ui.thicknessWrap.style.display = lips ? 'none' : '';
      ui.colorWrap.style.display     = ''; // both use color
    }
    ui.effect.addEventListener('change', updateUI);
    updateUI();

    // ---- Option helpers ----
    function hexToRgba(hex, a=1){
      const h = hex.replace('#','');
      const n = parseInt(h,16);
      const r = h.length===3 ? ((n>>8)&0xF)*17 : (n>>16)&255;
      const g = h.length===3 ? ((n>>4)&0xF)*17 : (n>>8)&255;
      const b = h.length===3 ? (n&0xF)*17     :  n&255;
      return `rgba(${r},${g},${b},${a})`;
    }

    // ---- Smoothing (simple lerp per landmark) ----
    let prevLandmarks = null;
    const lerp = (a,b,t)=>a+(b-a)*t;
    function smoothLandmarks(curr, t){
      if (!prevLandmarks || prevLandmarks.length !== curr.length) {
        prevLandmarks = curr.map(p=>({...p}));
        return curr;
      }
      const sm = curr.map((p,i)=>({
        x: lerp(prevLandmarks[i].x, p.x, t),
        y: lerp(prevLandmarks[i].y, p.y, t),
        z: lerp(prevLandmarks[i].z, p.z, t),
      }));
      prevLandmarks = sm.map(p=>({...p}));
      return sm;
    }

    // ---- Landmark index sets ----
    // Lips (outer & inner)
    const LIPS_OUTER = [61,146,91,181,84,17,314,405,321,375,291];
    const LIPS_INNER = [78,95,88,178,87,14,317,402,318,324,308];
    // Eyeliner (upper eyelids)
    const RIGHT_EYE_UPPER = [33,7,163,144,145,153,154,155,133];
    const LEFT_EYE_UPPER  = [263,249,390,373,374,380,381,382,362];

    // ---- Drawing helpers ----
    function drawVideoFrame(img, mirror){
      ctx.save();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (mirror) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      ctx.restore();
    }

    function buildPathFromIndices(landmarks, indices){
      ctx.beginPath();
      indices.forEach((idx,i)=>{
        const p = landmarks[idx];
        const x = p.x * canvas.width;
        const y = p.y * canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
    }

    function fillLipsOuterMinusInner(landmarks, colorRGBA){
      // Try modern evenodd fill (outer + inner as a compound path)
      ctx.save();
      ctx.fillStyle = colorRGBA;
      ctx.beginPath();
      // Outer
      LIPS_OUTER.forEach((idx,i)=>{
        const p = landmarks[idx], x=p.x*canvas.width, y=p.y*canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
      // Inner (as hole)
      LIPS_INNER.forEach((idx,i)=>{
        const p = landmarks[idx], x=p.x*canvas.width, y=p.y*canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();

      // Prefer evenodd if supported
      if (typeof ctx.fill === 'function') {
        try { ctx.fill('evenodd'); ctx.restore(); return; } catch(e) { /* fallback below */ }
      }
      // Fallback: paint outer then punch inner
      ctx.fill(); // fills both, then remove inner
      ctx.globalCompositeOperation = 'destination-out';
      buildPathFromIndices(landmarks, LIPS_INNER);
      ctx.fill();
      ctx.restore();
      // Reset comp-op
      ctx.globalCompositeOperation = 'source-over';
      // Repaint outer tint on top (clean edges after punch)
      ctx.save();
      ctx.fillStyle = colorRGBA;
      buildPathFromIndices(landmarks, LIPS_OUTER);
      ctx.fill();
      ctx.restore();
    }

    function strokeIndices(landmarks, indices, thickness, color){
      ctx.save();
      ctx.lineJoin = 'round';
      ctx.lineCap  = 'round';
      ctx.lineWidth = thickness;
      ctx.strokeStyle = color;
      ctx.beginPath();
      indices.forEach((idx,i)=>{
        const p = landmarks[idx], x=p.x*canvas.width, y=p.y*canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();
      ctx.restore();
    }

    // ---- FaceMesh constructor (robust across UMD variants) ----
    const FaceMeshCtor = (window.FaceMesh && window.FaceMesh.FaceMesh) || window.FaceMesh;
    if (!FaceMeshCtor) {
      console.error('FaceMesh constructor not found on window.FaceMesh');
    }

    const faceMesh = new FaceMeshCtor({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
    });
    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.5
    });

    // ---- Results handler ----
    faceMesh.onResults((results)=>{
      // Draw camera frame to canvas (mirrored if selected)
      drawVideoFrame(results.image, ui.mirror.checked);

      const faces = results.multiFaceLandmarks;
      if (!faces || !faces.length) return;

      const t = parseFloat(ui.smooth.value || '0.5');
      const lm = smoothLandmarks(faces[0], t);

      if (ui.effect.value === 'lips') {
        const rgba = hexToRgba(ui.color.value, parseFloat(ui.opacity.value || '0.45'));
        fillLipsOuterMinusInner(lm, rgba);
      } else {
        const thick = parseFloat(ui.thick.value || '6');
        const col   = ui.color.value;
        ctx.save();
        ctx.globalAlpha = 0.95;
        strokeIndices(lm, RIGHT_EYE_UPPER, thick, col);
        strokeIndices(lm, LEFT_EYE_UPPER,  thick, col);
        ctx.restore();
      }
    });

    // ---- Camera (global UMD) ----
    const camera = new Camera(video, {
      onFrame: async () => { await faceMesh.send({ image: video }); },
      width:  640,
      height: 480
    });
    camera.start().catch(err=>{
      console.error(err);
      alert('Camera error. Use https or localhost and allow camera permissions.');
    });
  </script>
</body>
</html>
```

### melanieavanzado

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MediaPipe FaceMesh · AR Makeup + Face PNG Overlay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; background:#111; color:#eee; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .wrap { position:relative; display:grid; place-items:center; min-height:100vh; }
    video, canvas { max-width: min(96vw, 960px); width:100%; height:auto; border-radius:12px; }
    video { display:none; } /* video is painted onto the canvas */
    .hud {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background: rgba(0,0,0,.55); color:#fff; padding:10px 12px; border-radius: 12px; backdrop-filter: blur(6px);
      font-size: 14px;
    }
    .hud label { display:flex; align-items:center; gap:8px; }
    .hud input[type="color"] { width: 28px; height: 28px; border: none; padding: 0; background: transparent; }
    .badge { position: fixed; top: 12px; left: 12px; background: rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px; }
    .file { padding:4px 8px; background:#222; border-radius:8px; }
    select, input[type="range"] { accent-color:#ff2a88; }
  </style>

  <!-- MediaPipe legacy UMD JS (globals) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="badge">FaceMesh · AR Makeup + Face PNG</div>
    <video id="input_video" autoplay playsinline muted></video>
    <canvas id="output_canvas" width="640" height="480"></canvas>

    <div class="hud">
      <label>
        Effect:
        <select id="effect">
          <option value="lips">Lipstick</option>
          <option value="eyeliner">Eyeliner</option>
          <option value="facepng" selected>Face PNG overlay</option>
        </select>
      </label>

      <!-- Shared -->
      <label>
        Smooth: <input id="smooth" type="range" min="0" max="1" step="0.1" value="0.5" />
      </label>
      <label>
        Mirror: <input id="mirror" type="checkbox" checked />
      </label>

      <!-- Lips -->
      <label id="colorWrap" style="display:none">
        Color: <input id="color" type="color" value="#ff2a88" />
      </label>
      <label id="opacityWrap" style="display:none">
        Opacity: <input id="opacity" type="range" min="0" max="1" step="0.02" value="0.45" />
      </label>

      <!-- Eyeliner -->
      <label id="thicknessWrap" style="display:none">
        Thickness: <input id="thickness" type="range" min="1" max="16" step="1" value="6" />
      </label>

      <!-- Face PNG -->
      <label id="fileWrap" class="file">
        PNG: <input id="pngfile" type="file" accept="image/png" />
      </label>
      <label id="blendWrap">
        Blend:
        <select id="blend">
          <option>source-over</option>
          <option>multiply</option>
          <option>screen</option>
          <option>overlay</option>
          <option>soft-light</option>
          <option>hard-light</option>
          <option>color-dodge</option>
          <option>color-burn</option>
          <option>lighten</option>
          <option>darken</option>
        </select>
      </label>
      <label id="pngAlphaWrap">
        Alpha: <input id="pngAlpha" type="range" min="0" max="1" step="0.02" value="0.9" />
      </label>
      <label id="scaleWrap">
        Scale: <input id="scale" type="range" min="0.5" max="2" step="0.01" value="1.2" />
      </label>
      <label id="rotWrap">
        Rotate°: <input id="rot" type="range" min="-40" max="40" step="1" value="0" />
      </label>
      <label id="offxWrap">
        Off X: <input id="offx" type="range" min="-200" max="200" step="1" value="0" />
      </label>
      <label id="offyWrap">
        Off Y: <input id="offy" type="range" min="-200" max="200" step="1" value="10" />
      </label>
    </div>
  </div>

  <script>
    // ---- DOM ----
    const video  = document.getElementById('input_video');
    const canvas = document.getElementById('output_canvas');
    const ctx    = canvas.getContext('2d');

    const ui = {
      effect:   document.getElementById('effect'),
      color:    document.getElementById('color'),
      opacity:  document.getElementById('opacity'),
      thick:    document.getElementById('thickness'),
      smooth:   document.getElementById('smooth'),
      mirror:   document.getElementById('mirror'),

      // face png
      file:     document.getElementById('pngfile'),
      blend:    document.getElementById('blend'),
      pngAlpha: document.getElementById('pngAlpha'),
      scale:    document.getElementById('scale'),
      rot:      document.getElementById('rot'),
      offx:     document.getElementById('offx'),
      offy:     document.getElementById('offy'),

      // wrappers
      colorWrap:     document.getElementById('colorWrap'),
      opacityWrap:   document.getElementById('opacityWrap'),
      thicknessWrap: document.getElementById('thicknessWrap'),
      fileWrap:      document.getElementById('fileWrap'),
      blendWrap:     document.getElementById('blendWrap'),
      pngAlphaWrap:  document.getElementById('pngAlphaWrap'),
      scaleWrap:     document.getElementById('scaleWrap'),
      rotWrap:       document.getElementById('rotWrap'),
      offxWrap:      document.getElementById('offxWrap'),
      offyWrap:      document.getElementById('offyWrap'),
    };

    // Toggle UI per effect
    function updateUI(){
      const lips     = ui.effect.value === 'lips';
      const eyeliner = ui.effect.value === 'eyeliner';
      const facepng  = ui.effect.value === 'facepng';

      ui.colorWrap.style.display     = lips ? '' : 'none';
      ui.opacityWrap.style.display   = lips ? '' : 'none';
      ui.thicknessWrap.style.display = eyeliner ? '' : 'none';

      [ui.fileWrap, ui.blendWrap, ui.pngAlphaWrap, ui.scaleWrap,
       ui.rotWrap, ui.offxWrap, ui.offyWrap].forEach(el=>{
         el.style.display = facepng ? '' : 'none';
       });
    }
    ui.effect.addEventListener('change', updateUI);
    updateUI();

    // ---- Option helpers ----
    function hexToRgba(hex, a=1){
      const h = hex.replace('#','');
      const n = parseInt(h,16);
      const r = h.length===3 ? ((n>>8)&0xF)*17 : (n>>16)&255;
      const g = h.length===3 ? ((n>>4)&0xF)*17 : (n>>8)&255;
      const b = h.length===3 ? (n&0xF)*17     :  n&255;
      return `rgba(${r},${g},${b},${a})`;
    }

    // ---- Smoothing (simple lerp per landmark) ----
    let prevLandmarks = null;
    const lerp = (a,b,t)=>a+(b-a)*t;
    function smoothLandmarks(curr, t){
      if (!prevLandmarks || prevLandmarks.length !== curr.length) {
        prevLandmarks = curr.map(p=>({...p}));
        return curr;
      }
      const sm = curr.map((p,i)=>({
        x: lerp(prevLandmarks[i].x, p.x, t),
        y: lerp(prevLandmarks[i].y, p.y, t),
        z: lerp(prevLandmarks[i].z, p.z, t),
      }));
      prevLandmarks = sm.map(p=>({...p}));
      return sm;
    }

    // ---- Landmark index sets ----
    // Lips (outer & inner)
    const LIPS_OUTER = [61,146,91,181,84,17,314,405,321,375,291];
    const LIPS_INNER = [78,95,88,178,87,14,317,402,318,324,308];
    // Eyeliner (upper eyelids)
    const RIGHT_EYE_UPPER = [33,7,163,144,145,153,154,155,133];
    const LEFT_EYE_UPPER  = [263,249,390,373,374,380,381,382,362];
    // Face oval (ordered polygon)
    const FACE_OVAL = [10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109];

    // ---- Drawing helpers ----
    function drawVideoFrame(img, mirror){
      ctx.save();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (mirror) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      ctx.restore();
    }

    function buildPathFromIndices(landmarks, indices){
      ctx.beginPath();
      indices.forEach((idx,i)=>{
        const p = landmarks[idx];
        const x = p.x * canvas.width;
        const y = p.y * canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
    }

    function fillLipsOuterMinusInner(landmarks, colorRGBA){
      ctx.save();
      ctx.fillStyle = colorRGBA;
      ctx.beginPath();
      LIPS_OUTER.forEach((idx,i)=>{
        const p = landmarks[idx], x=p.x*canvas.width, y=p.y*canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
      LIPS_INNER.forEach((idx,i)=>{
        const p = landmarks[idx], x=p.x*canvas.width, y=p.y*canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.closePath();
      try { ctx.fill('evenodd'); }
      catch(e){
        ctx.fill();
        ctx.globalCompositeOperation = 'destination-out';
        buildPathFromIndices(landmarks, LIPS_INNER);
        ctx.fill();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = colorRGBA;
        buildPathFromIndices(landmarks, LIPS_OUTER);
        ctx.fill();
      }
      ctx.restore();
    }

    function strokeIndices(landmarks, indices, thickness, color){
      ctx.save();
      ctx.lineJoin = 'round';
      ctx.lineCap  = 'round';
      ctx.lineWidth = thickness;
      ctx.strokeStyle = color;
      ctx.beginPath();
      indices.forEach((idx,i)=>{
        const p = landmarks[idx], x=p.x*canvas.width, y=p.y*canvas.height;
        if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();
      ctx.restore();
    }

    // ---- Face PNG state ----
    let faceImg = null;
    ui.file.addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = ()=>{ faceImg = img; URL.revokeObjectURL(url); };
      img.src = url;
    });

    // Helper: draw PNG overlay aligned to face
    function drawFacePNG(landmarks){
      if (!faceImg) return;

      // Key points
      const L = landmarks[33];   // left eye outer
      const R = landmarks[263];  // right eye outer
      const N = landmarks[1];    // nose tip
      const M = landmarks[13];   // mouth center

      // Convert to pixels
      const toPx = p => ({ x: p.x*canvas.width, y: p.y*canvas.height });
      const pL = toPx(L), pR = toPx(R), pN = toPx(N), pM = toPx(M);

      // Pose: angle by eye line
      const eyeDx = pR.x - pL.x;
      const eyeDy = pR.y - pL.y;
      const angle = Math.atan2(eyeDy, eyeDx);

      // Base scale: distance between eyes, expand to cover face height
      const eyeDist = Math.hypot(eyeDx, eyeDy);
      // Estimate face height (chin ~152, forehead ~10)
      const chin = toPx(landmarks[152]);
      const forehead = toPx(landmarks[10]);
      const faceH = Math.hypot(chin.x-forehead.x, chin.y-forehead.y);

      const userScale = parseFloat(ui.scale.value || '1');
      const imgW = faceImg.width, imgH = faceImg.height;

      // We want the PNG height ~ faceH * factor (covers forehead to chin)
      const targetH = faceH * 1.05 * userScale;
      const scale = targetH / imgH;
      const drawW = imgW * scale;
      const drawH = imgH * scale;

      // Anchor: mid between eyes pushed slightly toward nose/mouth
      const midEyes = { x: (pL.x+pR.x)/2, y:(pL.y+pR.y)/2 };
      const anchor  = {
        x: (midEyes.x*0.5 + pN.x*0.3 + pM.x*0.2),
        y: (midEyes.y*0.5 + pN.y*0.35 + pM.y*0.15),
      };

      // Offsets and rotation from UI
      const offx = parseFloat(ui.offx.value||'0');
      const offy = parseFloat(ui.offy.value||'0');
      const rot  = (parseFloat(ui.rot.value||'0') * Math.PI) / 180;

      // Clip to face oval for realism
      ctx.save();
      buildPathFromIndices(landmarks, FACE_OVAL);
      ctx.clip();

      // Blend + alpha
      ctx.globalCompositeOperation = ui.blend.value || 'source-over';
      ctx.globalAlpha = parseFloat(ui.pngAlpha.value||'0.9');

      // Apply transform so that image center aligns to anchor
      ctx.translate(anchor.x, anchor.y);
      ctx.rotate(angle + rot);

      // Slight 2.5D parallax by yaw approximation using z around eyes
      // (optional, subtle skew)
      const zL = L.z, zR = R.z;
      const yawSkew = Math.max(-0.2, Math.min(0.2, (zL - zR))); // clamp
      ctx.transform(1, 0, yawSkew, 1, 0, 0);

      // Draw centered
      ctx.drawImage(faceImg, -drawW/2 + offx, -drawH*0.45 + offy, drawW, drawH);

      // Restore
      ctx.restore();

      // Reset blend/alpha
      ctx.globalCompositeOperation = 'source-over';
      ctx.globalAlpha = 1;
    }

    // ---- FaceMesh constructor (robust across UMD variants) ----
    const FaceMeshCtor = (window.FaceMesh && window.FaceMesh.FaceMesh) || window.FaceMesh;
    if (!FaceMeshCtor) {
      console.error('FaceMesh constructor not found on window.FaceMesh');
    }

    const faceMesh = new FaceMeshCtor({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
    });
    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.5
    });

    // ---- Results handler ----
    faceMesh.onResults((results)=>{
      // Draw camera frame to canvas (mirrored if selected)
      drawVideoFrame(results.image, ui.mirror.checked);

      const faces = results.multiFaceLandmarks;
      if (!faces || !faces.length) return;

      const t = parseFloat(ui.smooth.value || '0.5');
      const lm = smoothLandmarks(faces[0], t);

      if (ui.effect.value === 'lips') {
        const rgba = hexToRgba(ui.color.value, parseFloat(ui.opacity.value || '0.45'));
        fillLipsOuterMinusInner(lm, rgba);
      } else if (ui.effect.value === 'eyeliner') {
        const thick = parseFloat(ui.thick.value || '6');
        const col   = ui.color.value || '#ffffff';
        ctx.save();
        ctx.globalAlpha = 0.95;
        strokeIndices(lm, RIGHT_EYE_UPPER, thick, col);
        strokeIndices(lm, LEFT_EYE_UPPER,  thick, col);
        ctx.restore();
      } else if (ui.effect.value === 'facepng') {
        drawFacePNG(lm);
      }
    });

    // ---- Camera (global UMD) ----
    const camera = new Camera(video, {
      onFrame: async () => { await faceMesh.send({ image: video }); },
      width:  640,
      height: 480
    });
    camera.start().catch(err=>{
      console.error(err);
      alert('Camera error. Use https or localhost and allow camera permissions.');
    });
  </script>
</body>
</html>
```

### melaniemejorado

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MediaPipe FaceMesh · Face PNG Overlay (fixed mirror/projection)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; background:#111; color:#eee; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .wrap { position:relative; display:grid; place-items:center; min-height:100vh; }
    video, canvas { max-width: min(96vw, 960px); width:100%; height:auto; border-radius:12px; }
    video { display:none; } /* we paint the video onto the canvas */
    .hud {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background: rgba(0,0,0,.55); color:#fff; padding:10px 12px; border-radius: 12px; backdrop-filter: blur(6px);
      font-size: 14px;
    }
    .hud label { display:flex; align-items:center; gap:8px; }
    .badge { position: fixed; top: 12px; left: 12px; background: rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px; }
    .file { padding:4px 8px; background:#222; border-radius:8px; }
    select, input[type="range"] { accent-color:#ff2a88; }
  </style>

  <!-- MediaPipe legacy UMD JS (globals) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="badge">FaceMesh · Face PNG Overlay</div>
    <video id="input_video" autoplay playsinline muted></video>
    <canvas id="output_canvas" width="640" height="480"></canvas>

    <div class="hud">
      <label class="file">PNG: <input id="pngfile" type="file" accept="image/png" /></label>
      <label>
        Smooth: <input id="smooth" type="range" min="0" max="1" step="0.1" value="0.5" />
      </label>
      <label>
        Mirror: <input id="mirror" type="checkbox" checked />
      </label>
      <label>
        Blend:
        <select id="blend">
          <option>source-over</option>
          <option selected>soft-light</option>
          <option>overlay</option>
          <option>multiply</option>
          <option>screen</option>
          <option>lighten</option>
          <option>darken</option>
        </select>
      </label>
      <label>
        Alpha: <input id="pngAlpha" type="range" min="0" max="1" step="0.02" value="0.9" />
      </label>
      <label>
        Scale: <input id="scale" type="range" min="0.5" max="2" step="0.01" value="1.2" />
      </label>
      <label>
        Rotate°: <input id="rot" type="range" min="-40" max="40" step="1" value="0" />
      </label>
      <label>
        Off X: <input id="offx" type="range" min="-200" max="200" step="1" value="0" />
      </label>
      <label>
        Off Y: <input id="offy" type="range" min="-200" max="200" step="1" value="10" />
      </label>
    </div>
  </div>

  <script>
    // ---- DOM ----
    const video  = document.getElementById('input_video');
    const canvas = document.getElementById('output_canvas');
    const ctx    = canvas.getContext('2d');
    const ui = {
      file:     document.getElementById('pngfile'),
      smooth:   document.getElementById('smooth'),
      mirror:   document.getElementById('mirror'),
      blend:    document.getElementById('blend'),
      pngAlpha: document.getElementById('pngAlpha'),
      scale:    document.getElementById('scale'),
      rot:      document.getElementById('rot'),
      offx:     document.getElementById('offx'),
      offy:     document.getElementById('offy'),
    };

    // ---- Smoothing ----
    let prevLandmarks = null;
    const lerp = (a,b,t)=>a+(b-a)*t;
    function smoothLandmarks(curr, t){
      if (!prevLandmarks || prevLandmarks.length !== curr.length) {
        prevLandmarks = curr.map(p=>({...p}));
        return curr;
      }
      const sm = curr.map((p,i)=>({
        x: lerp(prevLandmarks[i].x, p.x, t),
        y: lerp(prevLandmarks[i].y, p.y, t),
        z: lerp(prevLandmarks[i].z ?? 0, p.z ?? 0, t),
      }));
      prevLandmarks = sm.map(p=>({...p}));
      return sm;
    }

    // ---- Landmark index sets ----
    const FACE_OVAL = [10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109];

    // ---- Drawing helpers ----
    function drawVideoFrame(img, mirror){
      ctx.save();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (mirror) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      ctx.restore();
    }

    function toPx(p, mirror){
      const x = (mirror ? (1 - p.x) : p.x) * canvas.width; // mirror-aware X
      const y = p.y * canvas.height;
      return { x, y };
    }

    function pathPolygonFromIndices(landmarks, indices, mirror){
      ctx.beginPath();
      indices.forEach((idx,i)=>{
        const p = toPx(landmarks[idx], mirror);
        if (i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);
      });
      ctx.closePath();
    }

    // ---- Face PNG state ----
    let faceImg = null;
    ui.file.addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = ()=>{ faceImg = img; URL.revokeObjectURL(url); };
      img.src = url;
    });

    // ---- Overlay drawing (fixed mirror/projection) ----
    function drawFacePNG(landmarks, mirror){
      if (!faceImg) return;

      // Key points (MediaPipe indices)
      const L = landmarks[33];   // left eye outer (subject's left)
      const R = landmarks[263];  // right eye outer
      const N = landmarks[1];    // nose tip
      const M = landmarks[13];   // mouth center

      // Convert to pixels (mirror-aware)
      const pL = toPx(L, mirror), pR = toPx(R, mirror), pN = toPx(N, mirror), pM = toPx(M, mirror);

      // Rotation from eye line (computed AFTER mirroring => correct sign)
      const eyeDx = pR.x - pL.x;
      const eyeDy = pR.y - pL.y;
      const angle = Math.atan2(eyeDy, eyeDx);

      // Scale from face height (forehead to chin)
      const chin = toPx(landmarks[152], mirror);
      const forehead = toPx(landmarks[10], mirror);
      const faceH = Math.hypot(chin.x-forehead.x, chin.y-forehead.y);

      const userScale = parseFloat(ui.scale.value || '1');
      const imgW = faceImg.width, imgH = faceImg.height;
      const targetH = faceH * 1.05 * userScale;
      const scale = targetH / imgH;
      const drawW = imgW * scale;
      const drawH = imgH * scale;

      // Anchor: weighted mix (eyes, nose, mouth)
      const midEyes = { x: (pL.x+pR.x)/2, y:(pL.y+pR.y)/2 };
      const anchor  = {
        x: (midEyes.x*0.5 + pN.x*0.3 + pM.x*0.2),
        y: (midEyes.y*0.5 + pN.y*0.35 + pM.y*0.15),
      };

      // User controls
      const offx = parseFloat(ui.offx.value||'0');
      const offy = parseFloat(ui.offy.value||'0');
      const rot  = (parseFloat(ui.rot.value||'0') * Math.PI) / 180;

      // Clip to face oval (mirror-aware)
      ctx.save();
      pathPolygonFromIndices(landmarks, FACE_OVAL, mirror);
      ctx.clip();

      // Blend + alpha
      ctx.globalCompositeOperation = ui.blend.value || 'source-over';
      ctx.globalAlpha = parseFloat(ui.pngAlpha.value||'0.9');

      // Transform: translate to anchor, rotate, tiny yaw skew from z-depths
      ctx.translate(anchor.x, anchor.y);
      ctx.rotate(angle + rot);

      // Subtle 2.5D: yaw skew sign corrected for mirror
      const yawSign = mirror ? -1 : 1;
      const zL = L.z ?? 0, zR = R.z ?? 0;
      const yawSkew = yawSign * Math.max(-0.2, Math.min(0.2, (zL - zR)));
      ctx.transform(1, 0, yawSkew, 1, 0, 0);

      // Draw centered (slightly up toward forehead)
      ctx.drawImage(faceImg, -drawW/2 + offx, -drawH*0.45 + offy, drawW, drawH);

      // Restore
      ctx.restore();
      ctx.globalCompositeOperation = 'source-over';
      ctx.globalAlpha = 1;
    }

    // ---- FaceMesh setup ----
    const FaceMeshCtor = (window.FaceMesh && window.FaceMesh.FaceMesh) || window.FaceMesh;
    const faceMesh = new FaceMeshCtor({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
    });
    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.5
    });

    faceMesh.onResults((results)=>{
      const mirror = ui.mirror.checked;

      // Background video (mirrored visually if requested)
      drawVideoFrame(results.image, mirror);

      const faces = results.multiFaceLandmarks;
      if (!faces || !faces.length) return;

      const t = parseFloat(ui.smooth.value || '0.5');
      const lm = smoothLandmarks(faces[0], t);

      // Draw the PNG overlay with mirror-aware projection
      drawFacePNG(lm, mirror);
    });

    // ---- Camera ----
    const camera = new Camera(video, {
      onFrame: async () => { await faceMesh.send({ image: video }); },
      width:  640,
      height: 480
    });
    camera.start().catch(err=>{
      console.error(err);
      alert('Camera error. Use https or localhost and allow camera permissions.');
    });
  </script>
</body>
</html>
```

### realidad aumentada geometria propia

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR.js + A‑Frame — Minimal HIRO Demo</title>

    <!-- A‑Frame core -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- AR.js for A‑Frame build (marker‑based AR over the webcam) -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <style>
      html, body { margin: 0; height: 100%; }
      .hint {
        position: fixed; left: 0; right: 0; bottom: 0; padding: 10px 14px;
        background: rgba(0,0,0,.55); color: #fff; font-family: system-ui, sans-serif;
        text-align: center; z-index: 10; font-size: 14px; line-height: 1.35;
      }
      .brand { position: fixed; left: 10px; top: 10px; color: #fff; font: 600 12px/1 system-ui, sans-serif; letter-spacing: .08em; text-transform: uppercase; background: rgba(0,0,0,.45); padding: 6px 8px; border-radius: 10px; }
    </style>
  </head>
  <body>
    <div class="brand">AR.js + A‑Frame</div>
    <div class="hint">Allow the camera, then point it to a <strong>HIRO</strong> marker. Search “AR.js HIRO marker” to print it. Tip: good light & steady hands.</div>

    <!--
      The scene runs in "embedded" mode so it sits under our hint overlay.
      arjs attributes: sourceType webcam, no debug UI, and best tracking method.
    -->
    <a-scene
      embedded
      renderer="colorManagement: true; physicallyCorrectLights: true"
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">

      <!-- A soft ambient + directional light for nicer shading -->
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

      <!-- Track the preset HIRO marker; contents become visible when the marker is detected -->
      <a-marker preset="hiro">
        <!-- A simple animated cube sitting on the marker -->
        <a-box depth="0.5" height="0.5" width="0.5" color="#4CC3D9" position="0 0.25 0"
               animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear"></a-box>
        <!-- A ring to outline the marker origin -->
        <a-ring rotation="-90 0 0" radius-inner="0.15" radius-outer="0.2" color="#FFC65D"></a-ring>
        <!-- A text label that faces the camera -->
        <a-entity position="0 0.8 0" rotation="0 0 0"
                  text="value: ¡Hola AR.js!; align: center; color: #FFF; width: 2"></a-entity>
      </a-marker>

      <!-- Required to get the video feed in the background -->
      <a-entity camera></a-entity>
    </a-scene>

    <!--
      OPTIONAL: Use your own custom pattern marker.
      1) Train a marker to .patt with AR.js marker trainer.
      2) Host the .patt file and point the url attribute below to it.

      <a-marker type="pattern" url="./pattern-marker.patt">
        <a-sphere radius="0.25" color="#EF2D5E" position="0 0.25 0"></a-sphere>
      </a-marker>
    -->
  </body>
</html>
```

### suzanne sencillo

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR.js + A‑Frame — Suzanne Model</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>html,body{margin:0;height:100%;overflow:hidden}</style>
  </head>
  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-marker preset="hiro">
        <a-entity gltf-model="suzanne.glb" scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
```

### nave sencilllo

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR.js + A‑Frame — Suzanne Model</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>html,body{margin:0;height:100%;overflow:hidden}</style>
  </head>
  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-marker preset="hiro">
        <a-entity gltf-model="nave.glb" scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
```

### proyecto melanie con claude

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MediaPipe FaceMesh · Face PNG Overlay (Dense UV Mapping)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; background:#111; color:#eee; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .wrap { position:relative; display:grid; place-items:center; min-height:100vh; }
    video, canvas { max-width: min(96vw, 960px); width:100%; height:auto; border-radius:12px; }
    video { display:none; }
    .hud {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background: rgba(0,0,0,.55); color:#fff; padding:10px 12px; border-radius: 12px; backdrop-filter: blur(6px);
      font-size: 14px;
    }
    .hud label { display:flex; align-items:center; gap:8px; }
    .badge { position: fixed; top: 12px; left: 12px; background: rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px; }
    .file { padding:4px 8px; background:#222; border-radius:8px; }
    select, input[type="range"] { accent-color:#ff2a88; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="badge">FaceMesh · Dense UV Texture Mapping</div>
    <video id="input_video" autoplay playsinline muted></video>
    <canvas id="output_canvas" width="640" height="480"></canvas>

    <div class="hud">
      <label class="file">PNG: <input id="pngfile" type="file" accept="image/png" /></label>
      <label>
        Smooth: <input id="smooth" type="range" min="0" max="1" step="0.1" value="0.5" />
      </label>
      <label>
        Mirror: <input id="mirror" type="checkbox" checked />
      </label>
      <label>
        Blend:
        <select id="blend">
          <option>source-over</option>
          <option selected>soft-light</option>
          <option>overlay</option>
          <option>multiply</option>
          <option>screen</option>
          <option>lighten</option>
          <option>darken</option>
        </select>
      </label>
      <label>
        Alpha: <input id="pngAlpha" type="range" min="0" max="1" step="0.02" value="0.9" />
      </label>
      <label>
        Scale: <input id="scale" type="range" min="0.5" max="2" step="0.01" value="1.0" />
      </label>
      <label>
        Rotate°: <input id="rot" type="range" min="-40" max="40" step="1" value="0" />
      </label>
      <label>
        Off X: <input id="offx" type="range" min="-100" max="100" step="1" value="0" />
      </label>
      <label>
        Off Y: <input id="offy" type="range" min="-100" max="100" step="1" value="0" />
      </label>
    </div>
  </div>

  <script>
    const video  = document.getElementById('input_video');
    const canvas = document.getElementById('output_canvas');
    const ctx    = canvas.getContext('2d');
    const ui = {
      file:     document.getElementById('pngfile'),
      smooth:   document.getElementById('smooth'),
      mirror:   document.getElementById('mirror'),
      blend:    document.getElementById('blend'),
      pngAlpha: document.getElementById('pngAlpha'),
      scale:    document.getElementById('scale'),
      rot:      document.getElementById('rot'),
      offx:     document.getElementById('offx'),
      offy:     document.getElementById('offy'),
    };

    let prevLandmarks = null;
    const lerp = (a,b,t)=>a+(b-a)*t;
    function smoothLandmarks(curr, t){
      if (!prevLandmarks || prevLandmarks.length !== curr.length) {
        prevLandmarks = curr.map(p=>({...p}));
        return curr;
      }
      const sm = curr.map((p,i)=>({
        x: lerp(prevLandmarks[i].x, p.x, t),
        y: lerp(prevLandmarks[i].y, p.y, t),
        z: lerp(prevLandmarks[i].z ?? 0, p.z ?? 0, t),
      }));
      prevLandmarks = sm.map(p=>({...p}));
      return sm;
    }

    const FACE_OVAL = [10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109];

    // Complete MediaPipe FACEMESH_TESSELATION (468 landmarks, triangulated)
    const TRIANGULATION = [127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,39,0,267,269,270,291,409,408,375,321,405,321,375,291,185,40,39,76,77,90,160,33,246,161,246,160,246,33,7,52,53,65,65,55,52,65,52,66,107,69,67,9,107,108,151,108,107,48,115,131,130,131,115,194,204,211,202,211,204,216,206,205,187,207,206,216,186,92,2,97,167,141,125,241,164,167,37,72,38,12,38,37,72,121,128,110,47,121,228,116,123,234,93,234,127,21,54,162,54,103,67,109,103,67,162,54,21,139,127,162,139,162,21,234,93,127,162,127,139,127,34,234,227,234,34,127,139,34,227,34,234,21,162,127,54,21,103,103,54,67,109,67,103,109,103,54,67,109,54];

    function drawVideoFrame(img, mirror){
      ctx.save();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (mirror) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      ctx.restore();
    }

    function toPx(p, mirror){
      const x = (mirror ? (1 - p.x) : p.x) * canvas.width;
      const y = p.y * canvas.height;
      return { x, y };
    }

    function pathPolygonFromIndices(landmarks, indices, mirror){
      ctx.beginPath();
      indices.forEach((idx,i)=>{
        const p = toPx(landmarks[idx], mirror);
        if (i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);
      });
      ctx.closePath();
    }

    let faceImg = null;
    ui.file.addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = ()=>{ faceImg = img; URL.revokeObjectURL(url); };
      img.src = url;
    });

    function drawFacePNG(landmarks, mirror){
      if (!faceImg) return;

      const xs = landmarks.map(p => toPx(p, mirror).x);
      const ys = landmarks.map(p => toPx(p, mirror).y);
      const minX = Math.min(...xs), maxX = Math.max(...xs);
      const minY = Math.min(...ys), maxY = Math.max(...ys);
      const faceW = maxX - minX;
      const faceH = maxY - minY;

      const userScale = parseFloat(ui.scale.value || '1');
      const offx = parseFloat(ui.offx.value||'0') / faceW;
      const offy = parseFloat(ui.offy.value||'0') / faceH;
      const rot  = (parseFloat(ui.rot.value||'0') * Math.PI) / 180;
      
      const centerX = (minX + maxX) / 2;
      const centerY = (minY + maxY) / 2;

      ctx.save();
      
      pathPolygonFromIndices(landmarks, FACE_OVAL, mirror);
      ctx.clip();

      ctx.globalCompositeOperation = ui.blend.value || 'source-over';
      ctx.globalAlpha = parseFloat(ui.pngAlpha.value||'0.9');

      // Draw triangulated mesh
      for (let i = 0; i < TRIANGULATION.length; i += 3) {
        const idx0 = TRIANGULATION[i];
        const idx1 = TRIANGULATION[i + 1];
        const idx2 = TRIANGULATION[i + 2];

        const p0 = toPx(landmarks[idx0], mirror);
        const p1 = toPx(landmarks[idx1], mirror);
        const p2 = toPx(landmarks[idx2], mirror);
        
        // Calculate UV coordinates normalized to face bounds
        const u0 = ((p0.x - minX) / faceW - 0.5) * userScale + 0.5 + offx;
        const v0 = ((p0.y - minY) / faceH - 0.5) * userScale + 0.5 + offy;
        const u1 = ((p1.x - minX) / faceW - 0.5) * userScale + 0.5 + offx;
        const v1 = ((p1.y - minY) / faceH - 0.5) * userScale + 0.5 + offy;
        const u2 = ((p2.x - minX) / faceW - 0.5) * userScale + 0.5 + offx;
        const v2 = ((p2.y - minY) / faceH - 0.5) * userScale + 0.5 + offy;

        // Apply rotation
        const rp0 = rotatePoint(p0, centerX, centerY, rot);
        const rp1 = rotatePoint(p1, centerX, centerY, rot);
        const rp2 = rotatePoint(p2, centerX, centerY, rot);

        drawTexturedTriangle(
          rp0.x, rp0.y, u0, v0,
          rp1.x, rp1.y, u1, v1,
          rp2.x, rp2.y, u2, v2
        );
      }

      ctx.restore();
      ctx.globalCompositeOperation = 'source-over';
      ctx.globalAlpha = 1;
    }

    function rotatePoint(p, cx, cy, angle) {
      const cos = Math.cos(angle);
      const sin = Math.sin(angle);
      const dx = p.x - cx;
      const dy = p.y - cy;
      return {
        x: cx + dx * cos - dy * sin,
        y: cy + dx * sin + dy * cos
      };
    }

    function drawTexturedTriangle(x0, y0, u0, v0, x1, y1, u1, v1, x2, y2, u2, v2) {
      u0 = Math.max(0, Math.min(1, u0));
      v0 = Math.max(0, Math.min(1, v0));
      u1 = Math.max(0, Math.min(1, u1));
      v1 = Math.max(0, Math.min(1, v1));
      u2 = Math.max(0, Math.min(1, u2));
      v2 = Math.max(0, Math.min(1, v2));

      const imgW = faceImg.width;
      const imgH = faceImg.height;

      ctx.save();
      ctx.beginPath();
      ctx.moveTo(x0, y0);
      ctx.lineTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.closePath();
      ctx.clip();

      const deltaU1 = u1 - u0, deltaV1 = v1 - v0;
      const deltaU2 = u2 - u0, deltaV2 = v2 - v0;
      const deltaX1 = x1 - x0, deltaY1 = y1 - y0;
      const deltaX2 = x2 - x0, deltaY2 = y2 - y0;

      const det = deltaU1 * deltaV2 - deltaU2 * deltaV1;
      if (Math.abs(det) < 1e-10) {
        ctx.restore();
        return;
      }

      const a = (deltaX1 * deltaV2 - deltaX2 * deltaV1) / det;
      const b = (deltaY1 * deltaV2 - deltaY2 * deltaV1) / det;
      const c = (deltaU1 * deltaX2 - deltaU2 * deltaX1) / det;
      const d = (deltaU1 * deltaY2 - deltaU2 * deltaY1) / det;
      const e = x0 - (a * u0 + c * v0);
      const f = y0 - (b * u0 + d * v0);

      ctx.transform(a, b, c, d, e, f);
      ctx.drawImage(faceImg, 0, 0, imgW, imgH);
      ctx.restore();
    }

    const FaceMeshCtor = (window.FaceMesh && window.FaceMesh.FaceMesh) || window.FaceMesh;
    const faceMesh = new FaceMeshCtor({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
    });
    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.5
    });

    faceMesh.onResults((results)=>{
      const mirror = ui.mirror.checked;
      drawVideoFrame(results.image, mirror);

      const faces = results.multiFaceLandmarks;
      if (!faces || !faces.length) return;

      const t = parseFloat(ui.smooth.value || '0.5');
      const lm = smoothLandmarks(faces[0], t);

      drawFacePNG(lm, mirror);
    });

    const camera = new Camera(video, {
      onFrame: async () => { await faceMesh.send({ image: video }); },
      width:  640,
      height: 480
    });
    camera.start().catch(err=>{
      console.error(err);
      alert('Camera error. Use https or localhost and allow camera permissions.');
    });
  </script>
</body>
</html>
```

<a id="ejercicio-de-final-de-unidad-1"></a>
## Ejercicio de final de unidad

### ejercicio

```markdown

```


<a id="creacion-de-componentes-visuales"></a>
# Creación de componentes visuales

<a id="concepto-de-componente"></a>
## Concepto de componente

En el mundo digital actual, los componentes visuales son una pieza fundamental del desarrollo de interfaces de usuario (UI). Un componente visual es un elemento reutilizable que puede ser integrado en diferentes partes de la interfaz para realizar funciones específicas. Estos pueden variar desde botones y etiquetas hasta más complejos elementos como gráficos, tablas o incluso ventanas emergentes.

La idea detrás del concepto de componente visual es promover la modularidad y la reutilización del código. Al definir un componente, se encapsula una funcionalidad específica que puede ser utilizada en múltiples lugares dentro de la aplicación sin necesidad de duplicar el mismo código. Esto no solo facilita el mantenimiento y la actualización del software, sino que también acelera el desarrollo al permitir la creación rápida de interfaces complejas a partir de piezas predefinidas.

Un componente visual típicamente consta de varias partes: propiedades, atributos y métodos. Las propiedades son valores que definen el estado del componente, como su tamaño o color. Los atributos son los parámetros que se pasan al crear una instancia del componente, permitiendo personalizar su comportamiento según las necesidades específicas de la interfaz. Los métodos son funciones asociadas con el componente que pueden ser llamados para realizar acciones, como cambiar su estado o interactuar con otros componentes.

La creación y gestión de componentes visuales requiere una buena planificación y diseño. Es crucial definir una API clara y consistente que permita a los desarrolladores usar estos componentes de manera eficiente. Además, es importante considerar la accesibilidad y la usabilidad del componente, asegurándose de que sea fácilmente comprensible y funcional para todos los usuarios.

En el contexto del desarrollo moderno, muchas herramientas y frameworks proporcionan soporte nativo para la creación y gestión de componentes visuales. Estos ofrecen una gama de características avanzadas como enlace de datos, eventos y persistencia del estado, lo que facilita su uso en aplicaciones complejas.

La utilización de componentes visuales no solo mejora la eficiencia del desarrollo, sino que también impulsa la consistencia visual entre diferentes partes de una aplicación. Esto es especialmente importante en proyectos grandes o de largas duraciones, donde mantener un diseño uniforme puede ser desafiante sin el uso de componentes reutilizables.

En resumen, los componentes visuales son una herramienta poderosa y flexible para el desarrollo de interfaces de usuario. Al entender y aplicar correctamente este concepto, se pueden crear aplicaciones más eficientes, mantenibles y accesibles. La modularidad y la reutilización del código son fundamentales en el desarrollo moderno, y los componentes visuales representan una forma efectiva de implementar estas prácticas en las interfaces de usuario.

<a id="propiedades-atributos-y-metodos"></a>
## Propiedades, atributos y métodos

En el mundo digital actual, la creación de componentes visuales es una habilidad fundamental para desarrolladores que buscan crear interfaces de usuario (UI) atractivas y funcionales. Un componente visual puede ser cualquier elemento gráfico o interactivo en una interfaz, desde un botón hasta un formulario completo. En esta subunidad, nos centraremos en las propiedades, atributos y métodos que definen y controlan el comportamiento de estos componentes.

Las propiedades son características inherentes a los componentes visuales que determinan su apariencia y comportamiento. Por ejemplo, la propiedad `Color` puede definir el color de fondo o del texto de un botón, mientras que la propiedad `Visible` controla si el componente es visible en la interfaz. Cada componente tiene una serie de propiedades predefinidas que pueden ser modificadas para personalizar su apariencia y funcionalidad.

Los atributos son valores adicionales que se pueden asignar a las propiedades de un componente. Atributos como `MaxLength` en un campo de texto limitan el número de caracteres que puede ingresar el usuario, mientras que `AutoComplete` sugiere opciones automáticamente mientras el usuario escribe. Algunos componentes también admiten atributos personalizados, lo que permite agregar funcionalidades adicionales sin modificar el código fuente del componente.

Métodos son funciones asociadas a los componentes visuales que permiten realizar acciones específicas o manipular su estado. Por ejemplo, el método `Click` se ejecuta cuando un usuario hace clic en un botón, mientras que el método `ShowDialog` muestra un cuadro de diálogo modal. Algunos métodos también pueden recibir parámetros para personalizar su comportamiento. Por ejemplo, el método `SetFocus` puede tomar como argumento el nombre del componente al que se desea establecer el foco.

La manipulación de propiedades, atributos y métodos es esencial para crear interfaces de usuario dinámicas y interactivas. Al modificar estas características, los desarrolladores pueden personalizar la apariencia y funcionalidad de los componentes visuales según las necesidades específicas del proyecto. Además, el uso inteligente de propiedades, atributos y métodos puede mejorar la eficiencia del código y facilitar su mantenimiento a largo plazo.

En resumen, las propiedades, atributos y métodos son herramientas poderosas para definir y controlar los componentes visuales en una interfaz de usuario. Al comprender cómo trabajar con estas características, los desarrolladores pueden crear interfaces que sean no solo estéticamente atractivas, sino también funcionales y eficientes. Esta subunidad ha proporcionado una introducción básica a estos conceptos, pero es importante recordar que la manipulación avanzada de propiedades, atributos y métodos puede requerir un conocimiento más profundo de los componentes visuales y del lenguaje de programación utilizado en el proyecto.

<a id="eventos-asociacion-de-acciones-a-eventos"></a>
## Eventos; asociación de acciones a eventos

En el desarrollo de interfaces visuales, los eventos son un elemento fundamental que permiten a las aplicaciones interactuar con los usuarios. Un evento es una acción o suceso que ocurre dentro del entorno gráfico, como hacer clic en un botón, escribir texto en un campo de entrada o mover el ratón sobre una imagen. Estos eventos desencadenan acciones específicas dentro de la aplicación, lo que permite una comunicación dinámica entre los usuarios y la interfaz.

La asociación de acciones a eventos es un proceso crucial para definir cómo se responderá la aplicación a diferentes interacciones del usuario. Por ejemplo, cuando un usuario hace clic en un botón, el sistema debe ejecutar cierto código para realizar alguna acción, como mostrar una nueva pantalla o guardar los datos ingresados. Esta asociación se realiza mediante el uso de manejadores de eventos, que son funciones o métodos que se ejecutan en respuesta a un evento específico.

Para implementar la asociación de acciones a eventos, es común utilizar bibliotecas y frameworks específicos para cada plataforma o lenguaje de programación. Estas herramientas proporcionan mecanismos para vincular eventos con las acciones correspondientes de manera sencilla y eficiente. Por ejemplo, en Java Swing, se pueden asociar eventos como el clic de un botón con métodos que manejan dichos eventos.

Es importante destacar que la gestión adecuada de los eventos es clave para crear interfaces intuitivas y responsivas. Un buen diseño debe anticipar las acciones del usuario y proporcionar respuestas inmediatas y coherentes. Esto implica no solo asociar eventos a acciones, sino también considerar el flujo de control y la lógica detrás de cada interacción.

Además de la asociación directa entre eventos y acciones, es común utilizar patrones de diseño para mejorar la estructura y mantenibilidad del código relacionado con los eventos. Por ejemplo, el patrón Observer permite que un objeto (el sujeto) notifique a otros objetos (observadores) sobre cambios en su estado sin tener conocimiento directo de ellos. Este patrón es especialmente útil en aplicaciones donde varios componentes deben responder a la misma acción.

La creación y gestión de eventos también implica considerar aspectos como la propagación, que se refiere al flujo del evento desde el origen hasta los objetos que lo manejan. Algunas bibliotecas permiten controlar la propagación de eventos para evitar comportamientos inesperados o para implementar comportamientos personalizados.

En resumen, la asociación de acciones a eventos es un componente esencial en el desarrollo de interfaces visuales, permitiendo una comunicación dinámica y interactiva entre los usuarios y la aplicación. A través del uso de manejadores de eventos y patrones de diseño adecuados, se pueden crear interfaces que respondan eficazmente a las acciones del usuario, mejorando así la experiencia del usuario final.

### focus y blur

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <input type="text" id="campo">
    <script>
      let entrada = document.querySelector("input")
      entrada.onfocus = function(){
        console.log("Has entrado")
      }
      entrada.onblur = function(){
        console.log("Has salido")
      }
      
    </script>
  </body>
</html>
```

### y si cambia

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <input type="text" id="campo">
    <script>
      let entrada = document.querySelector("input")
      let valor;
      entrada.onfocus = function(){
        console.log("Has entrado")
        valor = this.value
      }
      entrada.onblur = function(){
        console.log("Has salido")
        if(valor != this.value){
          console.log("Ha habido un cambio")
        }else{
          console.log("No ha habido un cambio")
        }
      }
      
    </script>
  </body>
</html>
```

### integracion de onchange

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <input type="text" id="campo">
    <script>
      let entrada = document.querySelector("input")
      entrada.onfocus = function(){
        console.log("Has entrado")
      }
      entrada.onblur = function(){
        console.log("Has salido")
      }
      entrada.onchange = function(){
        console.log("Ha habido un cambio")
      }
      
    </script>
  </body>
</html>
```

### eventos boton

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.onclick = function(){
        console.log("Has hecho click")
      }
      
    </script>
  </body>
</html>
```

### doble click

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.ondblclick = function(){
        console.log("Has hecho doble click")
      }
      
    </script>
  </body>
</html>
```

### mouse down

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.onmousedown = function(){
        console.log("Has hecho click")
      }
      
    </script>
  </body>
</html>
```

### mouseup

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.onmouseup = function(){
        console.log("Has hecho click")
      }
      
    </script>
  </body>
</html>
```

### mouseenter

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.onmouseenter = function(){
        console.log("Has realizado acción")
      }
      
    </script>
  </body>
</html>
```

### mouse leave

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.onmouseleave = function(){
        console.log("Has realizado acción")
      }
      
    </script>
  </body>
</html>
```

### mouse over

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.onmouseover = function(){
        console.log("Has realizado acción")
      }
      
    </script>
  </body>
</html>
```

### menu contextual

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let boton = document.querySelector("button")
      boton.oncontextmenu = function(){
        
        console.log("Has realizado acción")
        return false
      }
      
    </script>
  </body>
</html>
```

### mousemove

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let mapadecalor = []
      document.onmousemove = function(event){
        mapadecalor.push([event.pageX,event.pageY])
      }
      document.onclick = function(){
        console.log(mapadecalor);
      }
      
    </script>
  </body>
</html>
```

### mostrar mapa de calor

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let lienzo;
      let mapadecalor = []
      document.onmousemove = function(event){
        mapadecalor.push([event.pageX,event.pageY])
      }
      document.onclick = function(){
        try{
          lienzo.remove()
        }catch(Exception){}
        lienzo = document.createElement("canvas")
        lienzo.width = window.innerWidth
        lienzo.height = window.innerHeight
        lienzo.style.position = "absolute"
        lienzo.style.top = "0px"
        lienzo.style.left = "0px"
        let contexto = lienzo.getContext("2d")
        contexto.fillStyle = "rgba(255,0,0,0.1)"
        mapadecalor.forEach(function(punto){
          contexto.fillRect(punto[0],punto[1],5,5)
        })
        document.querySelector("body").appendChild(lienzo)
      }
      document.oncontextmenu = function(){
        try{
          lienzo.remove()
          return false
        }catch(Exception){}
      }
      
    </script>
  </body>
</html>
```

### circulos

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <button>Pulsame</button>
    <script>
      let lienzo;
      let mapadecalor = []
      document.onmousemove = function(event){
        mapadecalor.push([event.pageX,event.pageY])
      }
      document.onclick = function(){
        try{
          lienzo.remove()
        }catch(Exception){}
        lienzo = document.createElement("canvas")
        lienzo.width = window.innerWidth
        lienzo.height = window.innerHeight
        lienzo.style.position = "absolute"
        lienzo.style.top = "0px"
        lienzo.style.left = "0px"
        let contexto = lienzo.getContext("2d")
        contexto.fillStyle = "rgba(255,0,0,0.02)"
        mapadecalor.forEach(function(punto){
          contexto.beginPath()
          contexto.arc(punto[0],punto[1],20,0,Math.PI*2)
          contexto.fill()
        })
        document.querySelector("body").appendChild(lienzo)
      }
      document.oncontextmenu = function(){
        try{
          lienzo.remove()
          return false
        }catch(Exception){}
      }
      
    </script>
  </body>
</html>
```

### eventos teclado keypress

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <input type="text">
    <script>
      let entrada = document.querySelector("input");
      entrada.onkeypress = function(event){
        console.log(event.key)
      }
    </script>
  </body>
</html>
```

### evento keyup

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <input type="text">
    <script>
      let entrada = document.querySelector("input");
      entrada.onkeyup = function(event){
        console.log(event.key)
      }
    </script>
  </body>
</html>
```

### onkeydown

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <input type="text">
    <script>
      let entrada = document.querySelector("input");
      entrada.onkeydown = function(event){
        console.log(event.key)
      }
    </script>
  </body>
</html>
```

### eventos de portatpapeles

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <p>Este es un texto de muestra</p>
    <script>
      document.oncopy = function(){
        console.log("Has copiado algo")
      }
    </script>
  </body>
</html>
```

### prohibir la copia

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <p>Este es un texto de muestra</p>
    <script>
      document.oncopy = function(){
      alert("Copia no permitida")
        return false;
        
      }
    </script>
  </body>
</html>
```

### cortar

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <p contenteditable>Este es un texto de muestra</p>
    <script>
      document.oncut = function(){
        console.log("Has cortado")
        
      }
    </script>
  </body>
</html>
```

### pegar

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <p contenteditable>Este es un texto de muestra</p>
    <script>
      document.onpaste = function(){
        console.log("Has pegado")
        
      }
    </script>
  </body>
</html>
```

### carga

```html
<!doctype html>
<html>
  <head>
    <script>
      window.onload = function(){
        let contenido = document.querySelector("p").textContent
        console.log(contenido)
      }
    </script>
  </head>
  <body>
    <p>Este es un texto de muestra</p>
  </body>
</html>
```

### cambio de tamaño

```html
<!doctype html>
<html>
  <head>
    <script>
      window.onresize = function(){
        console.log("La ventana se ha redimensionado")
      }
    </script>
  </head>
  <body>
    <p>Este es un texto de muestra</p>
  </body>
</html>
```

### scroll

```html
<!doctype html>
<html>
  <head>
    <script>
      document.onscroll = function(){
        console.log("Has hecho scroll")
      }
    </script>
  </head>
  <body>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><br><br>
  </body>
</html>
```

### detecto cambio de conexion

```html
<!doctype html>
<html>
  <head>
    <script>
      function actualizar(){
        if(navigator.offLine){
          console.log("Has perdido la conexion, te guardo los datos en local")
        }
        if(navigator.onLine){
          console.log("Has recuperado la conexion, me comunico con el servidor")
        }
      }
      window.addEventListener("online", actualizar);
      window.addEventListener("offline", actualizar);
    </script>
  </head>
  <body>
   
  </body>
</html>
```

### drag and drop

```html
<!doctype html>
<html>
  <head>
    <style>
      #arrastrable{width:100px;height:100px;background:red;}
      #objetivo{width:100px;height:100px;background:green;}
    </style>
  </head>
  <body>
    <div id="arrastrable" draggable="true">
    </div>
    <div id="objetivo" droppable="true">
    </div>
   <script>
      let arrastrable = document.querySelector("#arrastrable")
      let objetivo = document.querySelector("#objetivo")
      arrastrable.ondragstart = function(){
        console.log("has comenzado a arrastrar")
      }
      arrastrable.ondrag = function(){
        console.log("arrastras")
      }
      arrastrable.ondragend = function(){
        console.log("ya no lo arrastras")
      }
      objetivo.ondrop = function(){
        console.log("lo has soltado")
      }
      
      objetivo.ondragenter = function(){
        console.log("ya puedes soltarlo")
      }
      objetivo.ondragover = function(){
        console.log("ya puedes soltarlo pero que ya")
      }
    </script>
  </body>
</html>
```

### arrastro el original

```html
<!doctype html>
<html>
  <head>
    <style>
      #arrastrable {
        width: 100px;
        height: 100px;
        background: red;
        position: absolute;
        left: 50px;
        top: 50px;
        cursor: grab;
      }
      #objetivo {
        width: 100px;
        height: 100px;
        background: green;
        position: absolute;
        left: 300px;
        top: 100px;
      }
    </style>
  </head>
  <body>
    <div id="arrastrable"></div>
    <div id="objetivo"></div>

    <script>
      const arrastrable = document.querySelector("#arrastrable");
      const objetivo = document.querySelector("#objetivo");

      let offsetX = 0, offsetY = 0;
      let arrastrando = false;

      arrastrable.addEventListener("mousedown", e => {
        arrastrando = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        arrastrable.style.cursor = "grabbing";
      });

      document.addEventListener("mousemove", e => {
        if (arrastrando) {
          arrastrable.style.left = (e.pageX - offsetX) + "px";
          arrastrable.style.top = (e.pageY - offsetY) + "px";
        }
      });

      document.addEventListener("mouseup", e => {
        if (arrastrando) {
          arrastrando = false;
          arrastrable.style.cursor = "grab";

          const rectA = arrastrable.getBoundingClientRect();
          const rectB = objetivo.getBoundingClientRect();

          if (!(rectA.right < rectB.left || rectA.left > rectB.right || rectA.bottom < rectB.top || rectA.top > rectB.bottom)) {
            console.log("✅ lo has soltado sobre el objetivo");
          } else {
            console.log("❌ lo has soltado fuera");
          }
        }
      });
    </script>
  </body>
</html>
```

### mejora de la libreria heatmap

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Heatmap con botón toggle</title>
    <style>
      /* Solo estilos del botón; todo lo demás se crea por JS */
      .heatmap-toggle {
        position: fixed;
        right: 16px;
        bottom: 16px;
        z-index: 999999; /* por encima del canvas */
        padding: 10px 14px;
        border: 0;
        border-radius: 8px;
        background: #111;
        color: #fff;
        font: 14px/1 system-ui, Arial, sans-serif;
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(0,0,0,.25);
      }
      .heatmap-toggle:active { transform: translateY(1px); }
    </style>
  </head>
  <body>
    <div style="height:2000px;padding:24px">
      <h1>Desplázate y mueve el ratón</h1>
      <p>Este contenido es de demostración para que haya scroll.</p>
    </div>

    <script>
      // ======= Estado y utilidades =======
      let lienzo = null;
      let ctx = null;
      const mapaDeCalor = [];

      // Tamaño completo del documento (no solo viewport)
      function docSize() {
        const d = document.documentElement, b = document.body;
        const width = Math.max(
          d.scrollWidth, d.offsetWidth, d.clientWidth,
          b ? b.scrollWidth : 0, b ? b.offsetWidth : 0
        );
        const height = Math.max(
          d.scrollHeight, d.offsetHeight, d.clientHeight,
          b ? b.scrollHeight : 0, b ? b.offsetHeight : 0
        );
        return { width, height };
      }

      // Crea (o reajusta) el canvas para cubrir toda la página
      function ensureCanvas() {
        const { width, height } = docSize();
        if (!lienzo) {
          lienzo = document.createElement('canvas');
          lienzo.style.position = 'absolute';
          lienzo.style.top = '0';
          lienzo.style.left = '0';
          lienzo.style.zIndex = '9999'; // debajo del botón (que tiene 999999)
          lienzo.style.pointerEvents = 'none'; // no bloquear interacciones de la página
          document.body.appendChild(lienzo);
          ctx = lienzo.getContext('2d');
        }
        // Solo si cambia el tamaño para no borrar el contenido innecesariamente
        if (lienzo.width !== width || lienzo.height !== height) {
          lienzo.width = width;
          lienzo.height = height;
        }
      }

      // Dibuja todo el heatmap actual
      function drawAll() {
        if (!lienzo || !ctx) return;
        ctx.clearRect(0, 0, lienzo.width, lienzo.height);
        ctx.fillStyle = 'rgba(255,0,0,0.02)';
        for (const [x, y] of mapaDeCalor) {
          ctx.beginPath();
          ctx.arc(x, y, 20, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      // Dibujo incremental (cuando el canvas está visible)
      function drawPoint(x, y) {
        if (!lienzo || !ctx) return;
        ctx.fillStyle = 'rgba(255,0,0,0.02)';
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, Math.PI * 2);
        ctx.fill();
      }

      // ======= Captura de movimientos =======
      // pageX / pageY YA incluyen desplazamiento (scroll) del documento.
      document.addEventListener('mousemove', (event) => {
        const x = event.pageX;
        const y = event.pageY;
        mapaDeCalor.push([x, y]);
        // Si el lienzo está visible, dibujamos incrementalmente
        if (lienzo) {
          drawPoint(x, y);
        }
      });

      // Si cambia el tamaño del documento (resize/DOM), reajustamos y redibujamos
      window.addEventListener('resize', () => {
        if (lienzo) {
          ensureCanvas();
          drawAll();
        }
      });

      // (Opcional) Reajuste periódico por si el contenido dinamicamente cambia altura
      const autoResizeInterval = setInterval(() => {
        if (lienzo) {
          const { width, height } = docSize();
          if (lienzo.width !== width || lienzo.height !== height) {
            ensureCanvas();
            drawAll();
          }
        }
      }, 1000);

      // ======= Botón toggle creado dinámicamente =======
      const boton = document.createElement('button');
      boton.className = 'heatmap-toggle';
      boton.type = 'button';
      boton.textContent = 'Mostrar mapa de calor';
      document.body.appendChild(boton);

      function showHeatmap() {
        ensureCanvas();
        drawAll();
        boton.textContent = 'Ocultar mapa de calor';
      }

      function hideHeatmap() {
        if (lienzo && lienzo.parentNode) {
          lienzo.parentNode.removeChild(lienzo);
        }
        lienzo = null;
        ctx = null;
        boton.textContent = 'Mostrar mapa de calor';
      }

      boton.addEventListener('click', () => {
        if (lienzo) {
          hideHeatmap();
        } else {
          showHeatmap();
        }
      });

      // (Opcional) limpiar al salir
      window.addEventListener('beforeunload', () => clearInterval(autoResizeInterval));
    </script>
  </body>
</html>
```

### mas mejoras

```html
<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Heatmap library demo</title></head>
  <body style="min-height:200vh;padding:24px">
    <h1>Desplázate y mueve el ratón (scroll para probar altura total)</h1>

    <script>
/* ===========================================================
   HeatmapTracker — Vanilla JS heatmap overlay (library-style)
   - Captura mousemove con coordenadas absolutas (pageX/Y)
   - Canvas del tamaño COMPLETO del documento (no solo viewport)
   - Acumula densidad en un canvas offscreen y coloriza con LUT
   - Botón flotante (toggle) inyectado desde JS (sin CSS externo)
   - API: init(opts), start(), stop(), show(), hide(), toggle(), clear()
   =========================================================== */
(function (global){
  const defaultGradient = [
    [0.00, "#0000ff"], // azul
    [0.25, "#00ffff"], // cian
    [0.50, "#00ff00"], // verde
    [0.75, "#ffff00"], // amarillo
    [1.00, "#ff0000"]  // rojo
  ];

  const HeatmapTracker = {
    _enabled: false,
    _visible: false,
    _btn: null,
    _accum: null,     // offscreen canvas (acumulado en escala de grises)
    _accumCtx: null,
    _view: null,      // canvas visible colorizado
    _viewCtx: null,
    _rafScheduled: false,
    _lastRedraw: 0,
    _gradientLUT: null, // Uint8ClampedArray length 256*4
    _opts: {
      radius: 24,          // radio de influencia de cada punto
      pointAlpha: 0.07,    // alpha por trazo (más alto = más “tinta”)
      zIndex: 9999,
      buttonZ: 999999,
      buttonPosition: "bottom-right", // "bottom-right" | "bottom-left" | "top-right" | "top-left"
      buttonTextShow: "Mostrar mapa de calor",
      buttonTextHide: "Ocultar mapa de calor",
      gradient: defaultGradient,
      colorizeIntervalMs: 80, // throttle de colorización
      autoButton: true
    },

    init(opts={}){
      // Mezcla opciones
      Object.assign(this._opts, opts);

      // Inyecta estilos del botón (sin CSS externo)
      this._injectStyles();

      // Prepara LUT de gradiente
      this._gradientLUT = this._buildGradientLUT(this._opts.gradient);

      // Listeners
      this._onMouseMove = this._onMouseMove.bind(this);
      this._onResizeMaybe = this._onResizeMaybe.bind(this);

      // Crear botón si procede
      if (this._opts.autoButton) this._ensureButton();

      // Arranca captura (invisible por defecto)
      this.start();
      return this;
    },

    start(){
      if (this._enabled) return;
      this._enabled = true;
      document.addEventListener('mousemove', this._onMouseMove, {passive:true});
      window.addEventListener('resize', this._onResizeMaybe);
      this._ensureCanvases(); // prepara tamaños aunque esté oculto
    },

    stop(){
      if (!this._enabled) return;
      this._enabled = false;
      document.removeEventListener('mousemove', this._onMouseMove);
      window.removeEventListener('resize', this._onResizeMaybe);
      this.hide();
    },

    show(){
      if (this._visible) return;
      this._visible = true;
      this._ensureCanvases();
      // Dibujo inicial (colorizar todo lo acumulado)
      this._colorizeAll(true);
      this._updateButtonText();
    },

    hide(){
      if (!this._visible) return;
      this._visible = false;
      if (this._view && this._view.parentNode) this._view.parentNode.removeChild(this._view);
      this._view = null;
      this._viewCtx = null;
      this._updateButtonText();
    },

    toggle(){
      if (this._visible) this.hide(); else this.show();
    },

    clear(){
      if (this._accumCtx) {
        this._accumCtx.clearRect(0,0,this._accum.width, this._accum.height);
      }
      if (this._visible && this._viewCtx) {
        this._viewCtx.clearRect(0,0,this._view.width, this._view.height);
      }
    },

    /* ============ Internals ============ */
    _injectStyles(){
      const s = document.createElement('style');
      s.textContent = `
        .hm-toggle-btn {
          position: fixed;
          padding: 10px 14px;
          border: 0;
          border-radius: 10px;
          background: #111;
          color: #fff;
          font: 14px/1 system-ui, Arial, sans-serif;
          cursor: pointer;
          box-shadow: 0 8px 24px rgba(0,0,0,.25);
          user-select: none;
        }
        .hm-toggle-btn:active { transform: translateY(1px); }
        .hm-toggle-bottom-right { right: 16px; bottom: 16px; }
        .hm-toggle-bottom-left  { left: 16px; bottom: 16px; }
        .hm-toggle-top-right    { right: 16px; top: 16px; }
        .hm-toggle-top-left     { left: 16px; top: 16px; }
      `;
      document.head.appendChild(s);
    },

    _ensureButton(){
      if (this._btn) return;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = `hm-toggle-btn hm-toggle-${this._posClass()}`;
      btn.style.zIndex = String(this._opts.buttonZ);
      btn.textContent = this._opts.buttonTextShow;
      btn.addEventListener('click', () => this.toggle());
      this._btn = btn;
      document.body.appendChild(btn);
    },

    _posClass(){
      switch(this._opts.buttonPosition){
        case 'bottom-left': return 'bottom-left';
        case 'top-right': return 'top-right';
        case 'top-left': return 'top-left';
        default: return 'bottom-right';
      }
    },

    _docSize(){
      const d = document.documentElement, b = document.body;
      const width = Math.max(
        d.scrollWidth, d.offsetWidth, d.clientWidth,
        b ? b.scrollWidth : 0, b ? b.offsetWidth : 0
      );
      const height = Math.max(
        d.scrollHeight, d.offsetHeight, d.clientHeight,
        b ? b.scrollHeight : 0, b ? b.offsetHeight : 0
      );
      return {width, height};
    },

    _ensureCanvases(){
      const {width, height} = this._docSize();

      // Offscreen (acumulación)
      if (!this._accum) {
        this._accum = document.createElement('canvas');
        this._accum.width = width;
        this._accum.height = height;
        this._accumCtx = this._accum.getContext('2d', { willReadFrequently: true });
      } else {
        if (this._accum.width !== width || this._accum.height !== height) {
          // Redimensionar manteniendo contenido
          const tmp = document.createElement('canvas');
          tmp.width = width; tmp.height = height;
          const tctx = tmp.getContext('2d');
          tctx.drawImage(this._accum, 0, 0);
          this._accum.width = width; this._accum.height = height;
          this._accumCtx = this._accum.getContext('2d', { willReadFrequently: true });
          this._accumCtx.drawImage(tmp, 0, 0);
        }
      }

      // Visible (colorizado)
      if (this._visible) {
        if (!this._view) {
          this._view = document.createElement('canvas');
          this._view.width = width;
          this._view.height = height;
          const v = this._view.style;
          v.position = 'absolute';
          v.top = '0'; v.left = '0';
          v.zIndex = String(this._opts.zIndex);
          v.pointerEvents = 'none';
          document.body.appendChild(this._view);
          this._viewCtx = this._view.getContext('2d');
        } else if (this._view.width !== width || this._view.height !== height) {
          const tmp2 = document.createElement('canvas');
          tmp2.width = width; tmp2.height = height;
          const t2 = tmp2.getContext('2d');
          t2.drawImage(this._view, 0, 0);
          this._view.width = width; this._view.height = height;
          this._viewCtx = this._view.getContext('2d');
          this._viewCtx.drawImage(tmp2, 0, 0);
        }
      }
    },

    _onMouseMove(e){
      if (!this._enabled) return;
      const x = e.pageX, y = e.pageY; // incluye scroll
      // Dibujo “gaussiano” aproximado usando un radialGradient
      const r = this._opts.radius;
      const g = this._accumCtx.createRadialGradient(x, y, 0, x, y, r);
      // núcleo más opaco en el centro, desvanecido al borde
      const a = this._opts.pointAlpha;
      g.addColorStop(0, `rgba(0,0,0,${a})`);
      g.addColorStop(1, `rgba(0,0,0,0)`);
      this._accumCtx.fillStyle = g;
      this._accumCtx.beginPath();
      this._accumCtx.arc(x, y, r, 0, Math.PI*2);
      this._accumCtx.fill();

      // Si es visible, programar colorización (throttled)
      if (this._visible) this._scheduleColorize();
    },

    _onResizeMaybe(){
      // Si cambia tamaño del doc, reacomodar y recolorizar
      if (!this._enabled) return;
      const wasVisible = this._visible;
      this._ensureCanvases();
      if (wasVisible) this._colorizeAll(true);
    },

    _scheduleColorize(){
      const now = performance.now();
      if (this._rafScheduled) return;
      if (now - this._lastRedraw < this._opts.colorizeIntervalMs) {
        this._rafScheduled = true;
        requestAnimationFrame(() => {
          this._rafScheduled = false;
          this._colorizeAll(false);
        });
      } else {
        this._colorizeAll(false);
      }
    },

    _buildGradientLUT(stops){
      // Crea LUT de 256 RGBA a partir de stops [t,color]
      // color puede ser "#rrggbb" o "rgb(...)"
      const lut = new Uint8ClampedArray(256*4);
      // Normaliza y ordena stops
      const s = stops.slice().sort((a,b)=>a[0]-b[0]).map(([t,c])=>[Math.min(1,Math.max(0,t)), _parseColor(c)]);
      for (let i=0;i<256;i++){
        const t = i/255;
        // busca segmento
        let j=0;
        while (j < s.length-1 && t > s[j+1][0]) j++;
        const [t1,c1] = s[Math.max(0,j)];
        const [t2,c2] = s[Math.min(s.length-1, j+1)];
        const local = (t2[0] - t1[0]) > 1e-6 ? (t - t1[0])/(t2[0]-t1[0]) : 0;
        lut[i*4+0] = _lerp(c1[0], c2[0], local);
        lut[i*4+1] = _lerp(c1[1], c2[1], local);
        lut[i*4+2] = _lerp(c1[2], c2[2], local);
        lut[i*4+3] = 255;
      }
      return lut;

      function _parseColor(col){
        if (col.startsWith('#')){
          const n = col.length===4
            ? col.replace(/#/,'').split('').map(h=>h+h).join('')
            : col.replace('#','');
          const r = parseInt(n.slice(0,2),16);
          const g = parseInt(n.slice(2,4),16);
          const b = parseInt(n.slice(4,6),16);
          return [r,g,b];
        } else if (col.startsWith('rgb')){
          const m = col.match(/(\d+\.?\d*)/g).map(Number);
          return [m[0]|0, m[1]|0, m[2]|0];
        }
        // fallback a negro
        return [0,0,0];
      }
      function _lerp(a,b,t){ return (a + (b-a)*t) | 0; }
    },

    _colorizeAll(force){
      if (!this._visible || !this._viewCtx) return;
      this._lastRedraw = performance.now();

      // Copiamos acumulado a ImageData y colorizamos por intensidad
      const w = this._accum.width, h = this._accum.height;
      const src = this._accumCtx.getImageData(0,0,w,h);  // RGBA en escala de grises (hemos pintado negro con alpha)
      const dst = this._viewCtx.createImageData(w,h);
      const S = src.data, D = dst.data, LUT = this._gradientLUT;

      // Determinar intensidad: usamos canal A (acumulado por trazos), si no, la luminancia
      // Nota: por cómo pintamos, el alpha resultante suele ser 255 si se satura; aún así,
      // usamos el canal rojo como fallback (idéntico a g/b al ser gris).
      for (let i=0;i<S.length;i+=4){
        // Escoger mayor entre A y R como "densidad"
        const a = S[i+3];     // alpha
        const r = S[i];       // rojo (gris)
        const v = a || r;     // 0..255
        if (v>0){
          const j = v<<2;     // v*4
          D[i]   = LUT[j  ];
          D[i+1] = LUT[j+1];
          D[i+2] = LUT[j+2];
          // transparencia suave para ver solapamientos: escalar alpha con v
          D[i+3] = Math.min(255, 40 + (v)); // base 40 + densidad
        } else {
          // transparente
          D[i] = D[i+1] = D[i+2] = 0;
          D[i+3] = 0;
        }
      }

      this._viewCtx.putImageData(dst, 0, 0);
    },

    _updateButtonText(){
      if (!this._btn) return;
      this._btn.textContent = this._visible ? this._opts.buttonTextHide : this._opts.buttonTextShow;
    }
  };

  // Exponer global
  global.HeatmapTracker = HeatmapTracker;
})(window);

// --- Ejemplo de uso inmediato ---
HeatmapTracker.init({
  // radius: 28,
  // pointAlpha: 0.08,
  // gradient: [
  //   [0.00,"#000033"], [0.2,"#0000ff"], [0.4,"#00ffff"],
  //   [0.6,"#00ff00"], [0.8,"#ffff00"], [1.00,"#ff0000"]
  // ],
});
    </script>
  </body>
</html>
```

### carga externa

```html
<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Heatmap library demo</title></head>
  <body style="min-height:200vh;padding:24px">
    <h1>Desplázate y mueve el ratón (scroll para probar altura total)</h1>
<script src="https://jocarsa.github.io/mapadecalor/mapadecalor.js"></script>
    <script>

// --- Ejemplo de uso inmediato ---
HeatmapTracker.init({
  // radius: 28,
  // pointAlpha: 0.08,
  // gradient: [
  //   [0.00,"#000033"], [0.2,"#0000ff"], [0.4,"#00ffff"],
  //   [0.6,"#00ff00"], [0.8,"#ffff00"], [1.00,"#ff0000"]
  // ],
});
    </script>
  </body>
</html>
```

<a id="persistencia-del-componente"></a>
## Persistencia del componente

La persistencia del componente es un concepto fundamental en la creación de interfaces visuales, ya que permite a los desarrolladores almacenar y recuperar el estado actual de los componentes entre diferentes sesiones de uso. Este proceso es crucial para mantener la interactividad y la coherencia de las aplicaciones.

Cuando se habla de persistencia del componente, nos referimos a la capacidad de guardar en un lugar seguro todos los datos relevantes que definen el estado actual del componente. Esto puede incluir propiedades visuales como el tamaño, la posición y el color, así como cualquier otro dato relevante para su funcionamiento.

Para implementar la persistencia del componente, se utilizan mecanismos específicos dependiendo de la plataforma o framework en uso. En muchos casos, esto implica utilizar clases o objetos que proporcionen métodos para guardar y cargar el estado del componente. Por ejemplo, en un entorno basado en JavaScript, podríamos usar objetos JSON para serializar el estado del componente y luego almacenarlo en el almacenamiento local del navegador.

La persistencia del componente no solo facilita la experiencia del usuario al mantener su interacción con la aplicación entre sesiones, sino que también es esencial para la depuración y el mantenimiento del código. Al tener acceso a todos los datos relevantes, los desarrolladores pueden identificar rápidamente problemas o realizar cambios sin perder el contexto de cómo estaba el componente antes.

Es importante destacar que la persistencia del componente debe ser manejada con cuidado para evitar problemas de seguridad. Los datos sensibles deben ser encriptados y almacenados de manera segura, y se debe implementar un mecanismo adecuado para su recuperación cuando sea necesario.

Además, la persistencia del componente puede ser utilizada para crear funcionalidades avanzadas como el guardado de preferencias del usuario o la creación de copias de seguridad de los componentes. Esto permite a los usuarios personalizar sus interfaces y mantenerlas consistentes incluso si cambian de dispositivo o actualizan su software.

En resumen, la persistencia del componente es un aspecto crucial en la creación de interfaces visuales, ya que proporciona una forma de guardar y recuperar el estado actual de los componentes entre diferentes sesiones. Implementada correctamente, esta funcionalidad mejora significativamente la experiencia del usuario y facilita el mantenimiento del código.

### plantilla

```html
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <div id="contenedor">
      
    </div>
    
    
    <template id="plantillaboton">
      <button class="miboton">Pulsame</button>
      <div id="tooltip">Hola</div>
    </template>
    <script>
      var contenedor = document.querySelector("#contenedor");
      var plantilla = document.querySelector("#plantillaboton");
      
      var clon = plantilla.content.cloneNode(true);
      contenedor.appendChild(clon)
    </script>
  </body>
</html>
```

### estilo

```html
<!doctype html>
<html>
  <head>
    <style>
      .contenedorplantillaboton{
        position:relative;
        display:inline-block;
        margin:20px;
      }
      .contenedorplantillaboton .tooltip{
        background:black;
        color:white;
        padding:5px;
        border-radius:0px 5px 5px 5px;
        width:30px;
        height:10px;
        font-size:10px;
        text-align:center;
        line-height:10px;
        position:absolute;
        bottom: -8px;
        right: -23px;
      }
    </style>
  </head>
  <body>
    <div id="contenedor">
      
    </div>
    
    
    <template id="plantillaboton">
      <div class="contenedorplantillaboton">
        <button class="miboton">Pulsame</button>
        <div class="tooltip">Hola</div>
      </div>
    </template>
    <script>
      var contenedor = document.querySelector("#contenedor");
      var plantilla = document.querySelector("#plantillaboton");
      
      var clon1 = plantilla.content.cloneNode(true);
      contenedor.appendChild(clon1)
      
      var clon2 = plantilla.content.cloneNode(true);
      contenedor.appendChild(clon2)
      
    </script>
  </body>
</html>
```

### solo cuando se muestra por encina

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      .contenedorplantillaboton {
        position: relative;
        display: inline-block;
        margin: 20px;
      }

      .contenedorplantillaboton .tooltip {
        background: black;
        color: white;
        padding: 5px;
        border-radius: 0px 5px 5px 5px;
        width: 30px;
        height: 10px;
        font-size: 10px;
        text-align: center;
        line-height: 10px;
        position: absolute;
        bottom: -8px;
        right: -23px;
        display: none; /* Oculto por defecto */
      }

      /* Mostrar solo cuando se pasa el ratón por encima del botón */
      .contenedorplantillaboton:hover .tooltip {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="contenedor"></div>

    <template id="plantillaboton">
      <div class="contenedorplantillaboton">
        <button class="miboton">Púlsame</button>
        <div class="tooltip">Hola</div>
      </div>
    </template>

    <script>
      const contenedor = document.querySelector("#contenedor");
      const plantilla = document.querySelector("#plantillaboton");

      const clon1 = plantilla.content.cloneNode(true);
      contenedor.appendChild(clon1);

      const clon2 = plantilla.content.cloneNode(true);
      contenedor.appendChild(clon2);
    </script>
  </body>
</html>
```

### componentizacion

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (encapsulado)</title>
  </head>
  <body>
    <!-- Instancias -->
    <boton-tooltip></boton-tooltip>
    <boton-tooltip></boton-tooltip>

    <!-- ÚNICO template: contiene HTML + CSS; el JS solo sirve para instanciar el template en Shadow DOM -->
    <template id="plantillaboton">
      <style>
        :host {
          position: relative;
          display: inline-block;
          margin: 20px;
          font-family: system-ui, sans-serif;
        }
        button.miboton {
          padding: 6px 12px;
          border: 1px solid #ccc;
          border-radius: 6px;
          background: #f5f5f5;
          cursor: pointer;
        }
        .tooltip {
          position: absolute;
          bottom: -8px;
          right: -23px;
          background: black;
          color: white;
          padding: 5px;
          border-radius: 0px 5px 5px 5px;
          width: 30px;
          height: 10px;
          font-size: 10px;
          text-align: center;
          line-height: 10px;
          display: none; /* Oculto por defecto */
          pointer-events: none;
          z-index: 1;
        }
        /* Mostrar solo cuando se pasa el ratón por encima del host (o del botón) */
        :host(:hover) .tooltip,
        button.miboton:hover + .tooltip {
          display: block;
        }
      </style>

      <button class="miboton">Púlsame</button>
      <div class="tooltip">Hola</div>
    </template>

    <script type="module">
      class BotonTooltip extends HTMLElement {
        constructor() {
          super();
          const tpl = document.getElementById('plantillaboton');
          const shadow = this.attachShadow({ mode: 'open' });
          shadow.appendChild(tpl.content.cloneNode(true));
        }
      }
      customElements.define('boton-tooltip', BotonTooltip);
    </script>
  </body>
</html>
```

### externalizacion

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
    <script type="module" src="boton-tooltip.js"></script>
  </head>
  <body>
    <boton-tooltip></boton-tooltip>
    <boton-tooltip></boton-tooltip>
  </body>
</html>
```

### parametrizacion

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip parametrizable</title>
    <script type="module" src="boton-tooltip.js"></script>
  </head>
  <body>
    <boton-tooltip tooltip="Mensaje de ayuda">Púlsame</boton-tooltip>
    <boton-tooltip tooltip="Guardar los cambios">Guardar</boton-tooltip>
    <boton-tooltip tooltip="Eliminar el registro">🗑️ Eliminar</boton-tooltip>
  </body>
</html>
```

### select con busqueda

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
  </head>
  <body>
    <div id="contenedor">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        <!-- ANDALUCÍA -->
        <optgroup label="Andalucía">
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        </optgroup>

        <!-- ARAGÓN -->
        <optgroup label="Aragón">
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
        </optgroup>

        <!-- ASTURIAS -->
        <optgroup label="Asturias">
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        </optgroup>

        <!-- BALEARES -->
        <optgroup label="Islas Baleares">
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        </optgroup>

        <!-- CANARIAS -->
        <optgroup label="Islas Canarias">
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        </optgroup>

        <!-- CANTABRIA -->
        <optgroup label="Cantabria">
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
        </optgroup>

        <!-- CASTILLA Y LEÓN -->
        <optgroup label="Castilla y León">
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        </optgroup>

        <!-- CASTILLA-LA MANCHA -->
        <optgroup label="Castilla-La Mancha">
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
        </optgroup>

        <!-- CATALUÑA -->
        <optgroup label="Cataluña">
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
        </optgroup>

        <!-- EXTREMADURA -->
        <optgroup label="Extremadura">
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        </optgroup>

        <!-- GALICIA -->
        <optgroup label="Galicia">
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
        </optgroup>

        <!-- MADRID -->
        <optgroup label="Comunidad de Madrid">
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        </optgroup>

        <!-- MURCIA -->
        <optgroup label="Región de Murcia">
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        </optgroup>

        <!-- NAVARRA -->
        <optgroup label="Navarra">
          <option>Pamplona</option>
          <option>Tudela</option>
        </optgroup>

        <!-- PAÍS VASCO -->
        <optgroup label="País Vasco / Euskadi">
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
        </optgroup>

        <!-- LA RIOJA -->
        <optgroup label="La Rioja">
          <option>Logroño</option>
          <option>Calahorra</option>
        </optgroup>

        <!-- COMUNIDAD VALENCIANA -->
        <optgroup label="Comunitat Valenciana">
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
        </optgroup>

        <!-- CEUTA Y MELILLA -->
        <optgroup label="Ciudades Autónomas">
          <option>Ceuta</option>
          <option>Melilla</option>
        </optgroup>
      </select>

    </div>
  </body>
</html>
```

### le añado buscador

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
  </head>
  <body>
    <div id="contenedor">
      <input type="search" id="buscador">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        <!-- ANDALUCÍA -->
        <optgroup label="Andalucía">
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        </optgroup>

        <!-- ARAGÓN -->
        <optgroup label="Aragón">
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
        </optgroup>

        <!-- ASTURIAS -->
        <optgroup label="Asturias">
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        </optgroup>

        <!-- BALEARES -->
        <optgroup label="Islas Baleares">
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        </optgroup>

        <!-- CANARIAS -->
        <optgroup label="Islas Canarias">
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        </optgroup>

        <!-- CANTABRIA -->
        <optgroup label="Cantabria">
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
        </optgroup>

        <!-- CASTILLA Y LEÓN -->
        <optgroup label="Castilla y León">
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        </optgroup>

        <!-- CASTILLA-LA MANCHA -->
        <optgroup label="Castilla-La Mancha">
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
        </optgroup>

        <!-- CATALUÑA -->
        <optgroup label="Cataluña">
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
        </optgroup>

        <!-- EXTREMADURA -->
        <optgroup label="Extremadura">
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        </optgroup>

        <!-- GALICIA -->
        <optgroup label="Galicia">
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
        </optgroup>

        <!-- MADRID -->
        <optgroup label="Comunidad de Madrid">
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        </optgroup>

        <!-- MURCIA -->
        <optgroup label="Región de Murcia">
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        </optgroup>

        <!-- NAVARRA -->
        <optgroup label="Navarra">
          <option>Pamplona</option>
          <option>Tudela</option>
        </optgroup>

        <!-- PAÍS VASCO -->
        <optgroup label="País Vasco / Euskadi">
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
        </optgroup>

        <!-- LA RIOJA -->
        <optgroup label="La Rioja">
          <option>Logroño</option>
          <option>Calahorra</option>
        </optgroup>

        <!-- COMUNIDAD VALENCIANA -->
        <optgroup label="Comunitat Valenciana">
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
        </optgroup>

        <!-- CEUTA Y MELILLA -->
        <optgroup label="Ciudades Autónomas">
          <option>Ceuta</option>
          <option>Melilla</option>
        </optgroup>
      </select>

    </div>
  </body>
</html>
```

### un poco de css

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
    <style>
      #contenedor{
        display:flex;
        flex-direction:column;
      }
    </style>
  </head>
  <body>
    <div id="contenedor">
      <input type="search" id="buscador">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        <!-- ANDALUCÍA -->
        <optgroup label="Andalucía">
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        </optgroup>

        <!-- ARAGÓN -->
        <optgroup label="Aragón">
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
        </optgroup>

        <!-- ASTURIAS -->
        <optgroup label="Asturias">
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        </optgroup>

        <!-- BALEARES -->
        <optgroup label="Islas Baleares">
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        </optgroup>

        <!-- CANARIAS -->
        <optgroup label="Islas Canarias">
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        </optgroup>

        <!-- CANTABRIA -->
        <optgroup label="Cantabria">
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
        </optgroup>

        <!-- CASTILLA Y LEÓN -->
        <optgroup label="Castilla y León">
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        </optgroup>

        <!-- CASTILLA-LA MANCHA -->
        <optgroup label="Castilla-La Mancha">
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
        </optgroup>

        <!-- CATALUÑA -->
        <optgroup label="Cataluña">
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
        </optgroup>

        <!-- EXTREMADURA -->
        <optgroup label="Extremadura">
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        </optgroup>

        <!-- GALICIA -->
        <optgroup label="Galicia">
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
        </optgroup>

        <!-- MADRID -->
        <optgroup label="Comunidad de Madrid">
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        </optgroup>

        <!-- MURCIA -->
        <optgroup label="Región de Murcia">
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        </optgroup>

        <!-- NAVARRA -->
        <optgroup label="Navarra">
          <option>Pamplona</option>
          <option>Tudela</option>
        </optgroup>

        <!-- PAÍS VASCO -->
        <optgroup label="País Vasco / Euskadi">
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
        </optgroup>

        <!-- LA RIOJA -->
        <optgroup label="La Rioja">
          <option>Logroño</option>
          <option>Calahorra</option>
        </optgroup>

        <!-- COMUNIDAD VALENCIANA -->
        <optgroup label="Comunitat Valenciana">
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
        </optgroup>

        <!-- CEUTA Y MELILLA -->
        <optgroup label="Ciudades Autónomas">
          <option>Ceuta</option>
          <option>Melilla</option>
        </optgroup>
      </select>

    </div>
  </body>
</html>
```

### empezamos con js

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
    <style>
      #contenedor{
        display:flex;
        flex-direction:column;
      }
    </style>
  </head>
  <body>
    <div id="contenedor">
      <input type="search" id="buscador">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
       
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
       
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
       
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
    
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
       
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        
          <option>Pamplona</option>
          <option>Tudela</option>
       
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
       

     
          <option>Logroño</option>
          <option>Calahorra</option>
       

       
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
      

   
          <option>Ceuta</option>
          <option>Melilla</option>
       
      </select>

    </div>
    <script> 
      let opciones = document.querySelectorAll("select option");
      console.log(opciones)
      let opcionesfiltradas = []
      
      let entrada = document.querySelector("#buscador");
      entrada.onkeyup = function(event){
        console.log(entrada.value)
        // Vamos a hacer un match
        opciones.forEach(function(opcion){
          if(opcion.text.includes(entrada.value)){
            console.log("coincide")
          }
        })
      }
    </script>
  </body>
</html>
```

### matcheando

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
    <style>
      #contenedor{
        display:flex;
        flex-direction:column;
      }
    </style>
  </head>
  <body>
    <div id="contenedor">
      <input type="search" id="buscador">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
       
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
       
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
       
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
    
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
       
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        
          <option>Pamplona</option>
          <option>Tudela</option>
       
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
       

     
          <option>Logroño</option>
          <option>Calahorra</option>
       

       
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
      

   
          <option>Ceuta</option>
          <option>Melilla</option>
       
      </select>

    </div>
    <script> 
      let opciones = document.querySelectorAll("select option");
      console.log(opciones)
      let opcionesfiltradas = []
      
      let entrada = document.querySelector("#buscador");
      entrada.onkeyup = function(event){
        console.log(entrada.value)
        // Vamos a hacer un match
        opciones.forEach(function(opcion){
          if(opcion.text.includes(entrada.value)){
            console.log("coincide")
          }
        })
      }
    </script>
  </body>
</html>
```

### lleno el array de coincidencias

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
    <style>
      #contenedor{
        display:flex;
        flex-direction:column;
      }
    </style>
  </head>
  <body>
    <div id="contenedor">
      <input type="search" id="buscador">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
       
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
       
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
       
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
    
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
       
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        
          <option>Pamplona</option>
          <option>Tudela</option>
       
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
       

     
          <option>Logroño</option>
          <option>Calahorra</option>
       

       
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
      

   
          <option>Ceuta</option>
          <option>Melilla</option>
       
      </select>

    </div>
    <script> 
      let opciones = document.querySelectorAll("select option");
      console.log(opciones)
      let opcionesfiltradas = []
      
      let entrada = document.querySelector("#buscador");
      entrada.onkeyup = function(event){
        console.log(entrada.value)
        opcionesfiltradas = []
        // Vamos a hacer un match
        opciones.forEach(function(opcion){
          if(opcion.text.includes(entrada.value)){
            console.log("coincide")
            opcionesfiltradas.push(opcion.text)
          }
        })
        console.log(opcionesfiltradas)
      }
    </script>
  </body>
</html>
```

### repintar solo las que toca

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Botón con tooltip (componente externo)</title>
    <style>
      #contenedor{
        display:flex;
        flex-direction:column;
      }
    </style>
  </head>
  <body>
    <div id="contenedor">
      <input type="search" id="buscador">
      <select name="city" id="city">
        <option value="">-- Selecciona una ciudad --</option>
        
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
        
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
       
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
        
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
        
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
        
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
       
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
        
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
       
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
    
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
        
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
       
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
        
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
        
          <option>Pamplona</option>
          <option>Tudela</option>
       
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
       

     
          <option>Logroño</option>
          <option>Calahorra</option>
       

       
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
      

   
          <option>Ceuta</option>
          <option>Melilla</option>
       
      </select>

    </div>
    <script> 
      let selector = document.querySelector("select");
      let opciones = document.querySelectorAll("select option");
      console.log(opciones)
      let opcionesfiltradas = []
      
      let entrada = document.querySelector("#buscador");
      entrada.onkeyup = function(event){
        console.log(entrada.value)
        opcionesfiltradas = []
        // Vamos a hacer un match
        opciones.forEach(function(opcion){
          if(opcion.text.includes(entrada.value)){
            console.log("coincide")
            opcionesfiltradas.push(opcion.text)
          }
        })
        console.log(opcionesfiltradas)
        selector.innerHTML = ""
        opcionesfiltradas.forEach(function(opcion){
          let elementoopcion = document.createElement("option")
          elementoopcion.text = opcion
          selector.appendChild(elementoopcion)
        })
      }
    </script>
  </body>
</html>
```

### select personalizado

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Buscar y seleccionar (select estático + dropdown)</title>
    <style>
      :root { --b: #ddd; --bg: #fff; --hover: #f2f2f2; }
      body { font-family: system-ui, sans-serif; margin: 1.5rem; }
      #contenedor { position: relative; width: 420px; display: grid; gap: .5rem; }

      /* El <select> nativo: permanece en el DOM para el backend, pero no estorba */
      #city {
        position: absolute;
        left: -9999px;       /* oculto pero presente (se enviará en el form) */
        width: 0; height: 0; /* no ocupa espacio */
      }

      #buscador {
        padding: .6rem .7rem;
        border: 1px solid var(--b);
        border-radius: .5rem;
        width: 100%;
        box-sizing: border-box;
      }

      .dropdown {
        position: relative;
      }
      .dropdown-panel {
        position: absolute;
        top: 100%;
        left: 0; right: 0;
        background: var(--bg);
        border: 1px solid var(--b);
        border-radius: .5rem;
        margin-top: .25rem;
        max-height: 260px;
        overflow: auto;
        display: block;             /* siempre “desplegado” mientras escribes */
        z-index: 10;
      }
      .opcion {
        padding: .55rem .7rem;
        cursor: pointer;
        user-select: none;
        line-height: 1.2;
      }
      .opcion:hover,
      .opcion[aria-selected="true"] {
        background: var(--hover);
      }
      .no-results {
        padding: .55rem .7rem;
        color: #666;
      }
    </style>
  </head>
  <body>
    <!-- Ejemplo de formulario real -->
    <form id="form-ciudad" action="/procesar.php" method="post">
      <div id="contenedor">
        <input type="search" id="buscador" autocomplete="off" placeholder="Escribe para filtrar ciudades…" />

        <!-- Select nativo: MANTENIDO tal cual (estático) -->
        <select name="city" id="city">
          <option value="">-- Selecciona una ciudad --</option>
          <option>Almería</option>
          <option>Cádiz</option>
          <option>Córdoba</option>
          <option>Granada</option>
          <option>Huelva</option>
          <option>Jaén</option>
          <option>Málaga</option>
          <option>Sevilla</option>
          <option>Jerez de la Frontera (Cádiz)</option>
          <option>Marbella (Málaga)</option>
          <option>Algeciras (Cádiz)</option>
          <option>Dos Hermanas (Sevilla)</option>
          <option>Estepona (Málaga)</option>
          <option>Roquetas de Mar (Almería)</option>
          <option>Motril (Granada)</option>
          <option>Zaragoza</option>
          <option>Huesca</option>
          <option>Teruel</option>
          <option>Calatayud (Zaragoza)</option>
          <option>Monzón (Huesca)</option>
          <option>Ejea de los Caballeros (Zaragoza)</option>
          <option>Oviedo</option>
          <option>Gijón</option>
          <option>Avilés</option>
          <option>Mieres</option>
          <option>Langreo</option>
          <option>Palma de Mallorca</option>
          <option>Ibiza</option>
          <option>Manacor (Mallorca)</option>
          <option>Inca (Mallorca)</option>
          <option>Ciutadella de Menorca</option>
          <option>Las Palmas de Gran Canaria</option>
          <option>Santa Cruz de Tenerife</option>
          <option>La Laguna (Tenerife)</option>
          <option>Arrecife (Lanzarote)</option>
          <option>Puerto del Rosario (Fuerteventura)</option>
          <option>San Bartolomé de Tirajana (Gran Canaria)</option>
          <option>Santander</option>
          <option>Torrelavega</option>
          <option>Castro-Urdiales</option>
          <option>Valladolid</option>
          <option>Salamanca</option>
          <option>León</option>
          <option>Burgos</option>
          <option>Ávila</option>
          <option>Palencia</option>
          <option>Segovia</option>
          <option>Soria</option>
          <option>Zamora</option>
          <option>Ponferrada (León)</option>
          <option>Aranda de Duero (Burgos)</option>
          <option>Albacete</option>
          <option>Ciudad Real</option>
          <option>Cuenca</option>
          <option>Guadalajara</option>
          <option>Toledo</option>
          <option>Talavera de la Reina (Toledo)</option>
          <option>Puertollano (Ciudad Real)</option>
          <option>Barcelona</option>
          <option>Tarragona</option>
          <option>Lleida</option>
          <option>Girona</option>
          <option>Sabadell (Barcelona)</option>
          <option>Terrassa (Barcelona)</option>
          <option>L’Hospitalet de Llobregat (Barcelona)</option>
          <option>Badalona (Barcelona)</option>
          <option>Reus (Tarragona)</option>
          <option>Manresa (Barcelona)</option>
          <option>Badajoz</option>
          <option>Cáceres</option>
          <option>Mérida</option>
          <option>Plasencia</option>
          <option>Santiago de Compostela (A Coruña)</option>
          <option>A Coruña</option>
          <option>Vigo (Pontevedra)</option>
          <option>Ourense</option>
          <option>Lugo</option>
          <option>Pontevedra</option>
          <option>Ferrol (A Coruña)</option>
          <option>Madrid</option>
          <option>Alcalá de Henares</option>
          <option>Móstoles</option>
          <option>Fuenlabrada</option>
          <option>Getafe</option>
          <option>Leganés</option>
          <option>Alcorcón</option>
          <option>Torrejón de Ardoz</option>
          <option>Murcia</option>
          <option>Cartagena</option>
          <option>Lorca</option>
          <option>Yecla</option>
          <option>Pamplona</option>
          <option>Tudela</option>
          <option>Bilbao (Bizkaia)</option>
          <option>San Sebastián / Donostia (Gipuzkoa)</option>
          <option>Vitoria-Gasteiz (Álava)</option>
          <option>Barakaldo (Bizkaia)</option>
          <option>Getxo (Bizkaia)</option>
          <option>Irun (Gipuzkoa)</option>
          <option>Logroño</option>
          <option>Calahorra</option>
          <option>Valencia</option>
          <option>Alicante</option>
          <option>Castellón de la Plana</option>
          <option>Elche (Alicante)</option>
          <option>Torrevieja (Alicante)</option>
          <option>Gandía (Valencia)</option>
          <option>Benidorm (Alicante)</option>
          <option>Orihuela (Alicante)</option>
          <option>Paterna (Valencia)</option>
          <option>Vila-real (Castellón)</option>
          <option>Alcoy (Alicante)</option>
          <option>Sagunto (Valencia)</option>
          <option>Denia (Alicante)</option>
          <option>Torrent (Valencia)</option>
          <option>Ceuta</option>
          <option>Melilla</option>
        </select>

        <!-- Panel custom que “permanece desplegado” mientras escribes -->
        <div class="dropdown">
          <div id="dropdown-panel" class="dropdown-panel" role="listbox" aria-label="Ciudades"></div>
        </div>
      </div>

      <p style="margin-top:1rem">
        <button type="submit">Enviar</button>
        <span id="seleccion" style="margin-left:.5rem;color:#555"></span>
      </p>
    </form>

    <script>
      const selectEl  = document.getElementById("city");
      const buscador  = document.getElementById("buscador");
      const panel     = document.getElementById("dropdown-panel");
      const lblSel    = document.getElementById("seleccion");

      // Extrae opciones del <select> estático (sin modificarlo)
      const opciones = Array.from(selectEl.querySelectorAll("option"))
        .map(o => o.text.trim())
        .filter(t => t && !t.startsWith("-- ")); // quita el placeholder

      // Normaliza texto para búsqueda sin acentos
      const norm = s => s.normalize("NFD").replace(/\p{Diacritic}/gu, "").toLowerCase();

      let indiceActivo = -1; // para navegación con teclado

      // Render inicial (todas las opciones)
      render(opciones);

      // Mantener el panel visible al enfocar o escribir
      buscador.addEventListener("focus", () => { panel.style.display = "block"; });
      buscador.addEventListener("input", () => {
        const q = norm(buscador.value);
        const filtradas = opciones.filter(txt => norm(txt).includes(q));
        indiceActivo = -1;
        render(filtradas);
        panel.style.display = "block"; // permanece "desplegado" mientras escribes
      });

      // Navegación con teclado (↑ ↓ Enter Esc)
      buscador.addEventListener("keydown", (e) => {
        const items = Array.from(panel.querySelectorAll(".opcion"));
        if (!items.length) return;

        if (e.key === "ArrowDown") {
          e.preventDefault();
          indiceActivo = (indiceActivo + 1) % items.length;
          marcar(items);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          indiceActivo = (indiceActivo - 1 + items.length) % items.length;
          marcar(items);
        } else if (e.key === "Enter") {
          if (indiceActivo >= 0) {
            e.preventDefault();
            items[indiceActivo].click();
          }
        } else if (e.key === "Escape") {
          panel.style.display = "none";
        }
      });

      // Sincroniza si alguien cambia el <select> nativo (por JS externo)
      selectEl.addEventListener("change", () => {
        const val = selectEl.value || "";
        buscador.value = val;
        lblSel.textContent = val ? `Seleccionado: ${val}` : "";
      });

      // Clic fuera: opcionalmente cierra (puedes comentar si prefieres SIEMPRE visible)
      document.addEventListener("click", (e) => {
        const cont = document.getElementById("contenedor");
        if (!cont.contains(e.target)) panel.style.display = "none";
      });

      function render(lista) {
        panel.innerHTML = "";
        if (!lista.length) {
          panel.innerHTML = `<div class="no-results">Sin coincidencias</div>`;
          return;
        }
        lista.forEach((texto, idx) => {
          const div = document.createElement("div");
          div.className = "opcion";
          div.setAttribute("role", "option");
          div.textContent = texto;
          div.addEventListener("click", () => seleccionar(texto));
          panel.appendChild(div);
        });
      }

      function seleccionar(texto) {
        // Refleja en input visible
        buscador.value = texto;
        // Refleja en <select> estático (sin tocar sus opciones)
        const opt = Array.from(selectEl.options).find(o => o.text.trim() === texto);
        if (opt) {
          selectEl.value = opt.value || opt.text; // por si no hay 'value' explícito
          // Lanza evento change por si otros scripts escuchan
          selectEl.dispatchEvent(new Event("change", { bubbles: true }));
        }
        lblSel.textContent = `Seleccionado: ${texto}`;
        // Mantén el panel abierto si quieres seguir escribiendo:
        // panel.style.display = "block";
        // O ciérralo al seleccionar:
        panel.style.display = "none";
      }

      function marcar(items) {
        items.forEach((el, i) => el.setAttribute("aria-selected", i === indiceActivo ? "true" : "false"));
        if (indiceActivo >= 0) {
          items[indiceActivo].scrollIntoView({ block: "nearest" });
        }
      }
    </script>
  </body>
</html>
```

### a componente

```html
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SearchableSelect (reusable, keeps native select)</title>
  <style>
    :root { --b:#ddd; --bg:#fff; --hover:#f2f2f2; }

    body { font-family: system-ui, sans-serif; margin: 1.5rem; display:grid; gap:2rem; }

    /* Container for each instance */
    .ssx { position: relative; width: 420px; display: grid; gap: .5rem; }

    /* Keep native select in DOM, hidden visually (still submits with form) */
    .ssx select[data-ssx-select]{
      position: absolute; left: -9999px; width:0; height:0;
    }

    .ssx input[data-ssx-input]{
      padding:.6rem .7rem; border:1px solid var(--b); border-radius:.5rem; width:100%; box-sizing:border-box;
    }

    .ssx .ssx-dropdown {
      position:absolute; left:0; right:0; top: calc(100% + .25rem);
      background:var(--bg); border:1px solid var(--b); border-radius:.5rem;
      max-height:260px; overflow:auto; z-index:10;
      display:none; /* Enhancement #1: hidden on load */
    }

    .ssx .ssx-item{
      padding:.55rem .7rem; cursor:pointer; user-select:none; line-height:1.2;
    }
    .ssx .ssx-item:hover,
    .ssx .ssx-item[aria-selected="true"]{ background:var(--hover); }

    .ssx .ssx-empty{ padding:.55rem .7rem; color:#666; }
    .ssx .ssx-status{ color:#555; font-size:.9rem; }
  </style>
</head>
<body>

  <!-- Instance 1 -->
  <form action="/procesar.php" method="post" class="ssx" data-ssx>
    <input type="search" data-ssx-input placeholder="Escribe para filtrar ciudades…" autocomplete="off">
    <select name="city" data-ssx-select>
      <option value="">-- Selecciona una ciudad --</option>
      <option>Almería</option><option>Cádiz</option><option>Córdoba</option><option>Granada</option>
      <option>Huelva</option><option>Jaén</option><option>Málaga</option><option>Sevilla</option>
      <option>Jerez de la Frontera (Cádiz)</option><option>Marbella (Málaga)</option>
      <option>Valencia</option><option>Alicante</option><option>Castellón de la Plana</option>
      <option>Madrid</option><option>Barcelona</option><option>Bilbao (Bizkaia)</option>
      <option>San Sebastián / Donostia (Gipuzkoa)</option><option>Vitoria-Gasteiz (Álava)</option>
      <option>Torrent (Valencia)</option><option>Ceuta</option><option>Melilla</option>
    </select>
    <div class="ssx-dropdown" data-ssx-panel></div>
    <div class="ssx-status" data-ssx-status></div>
    <button type="submit">Enviar</button>
  </form>

  <!-- Instance 2 (demonstrates reuse with another select) -->
  <form action="/otro.php" method="post" class="ssx" data-ssx>
    <input type="search" data-ssx-input placeholder="Busca provincias…" autocomplete="off">
    <select name="province" data-ssx-select>
      <option value="">-- Selecciona una provincia --</option>
      <option>Álava</option><option>Albacete</option><option>Alicante</option><option>Almería</option>
      <option>Asturias</option><option>Ávila</option><option>Badajoz</option><option>Barcelona</option>
      <option>Burgos</option><option>Cáceres</option><option>Cádiz</option><option>Cantabria</option>
      <option>Castellón</option><option>Ciudad Real</option><option>Córdoba</option><option>Cuenca</option>
    </select>
    <div class="ssx-dropdown" data-ssx-panel></div>
    <div class="ssx-status" data-ssx-status></div>
    <button type="submit">Enviar</button>
  </form>

  <script>
    class SearchableSelect {
      /**
       * @param {HTMLElement} root - container element with:
       *   - input[data-ssx-input]
       *   - select[data-ssx-select] (native, static)
       *   - div[data-ssx-panel] (dropdown panel)
       *   - [optional] div[data-ssx-status] (status text)
       * @param {Object} opts
       * @param {boolean} opts.keepOpenWhileTyping - keep dropdown open on input focus/typing
       */
      constructor(root, { keepOpenWhileTyping = true } = {}) {
        this.root = root;
        this.input = root.querySelector('[data-ssx-input]');
        this.select = root.querySelector('[data-ssx-select]');
        this.panel = root.querySelector('[data-ssx-panel]');
        this.status = root.querySelector('[data-ssx-status]');
        this.keepOpenWhileTyping = keepOpenWhileTyping;

        if (!this.input || !this.select || !this.panel) {
          throw new Error('SearchableSelect: missing required elements in root');
        }

        // Build dataset from native select (without touching it)
        this.allTexts = Array.from(this.select.options)
          .map(o => o.text.trim())
          .filter(t => t && !t.startsWith('-- '));

        this.activeIndex = -1;
        this.render(this.allTexts);

        // Enhancement #1: hidden on load, show only on focus
        this.input.addEventListener('focus', () => this.showPanel(true));
        this.input.addEventListener('input', () => this.handleFilter());
        this.input.addEventListener('keydown', (e) => this.handleKeys(e));

        // Keep in sync if external code changes native select
        this.select.addEventListener('change', () => {
          const val = this.select.value || '';
          this.input.value = val;
          this.setStatus(val ? `Seleccionado: ${val}` : '');
        });

        // Close when clicking outside
        document.addEventListener('click', (e) => {
          if (!this.root.contains(e.target)) this.showPanel(false);
        });
      }

      norm(s) {
        return s.normalize('NFD').replace(/\p{Diacritic}/gu, '').toLowerCase();
      }

      handleFilter() {
        const q = this.norm(this.input.value);
        const list = this.allTexts.filter(t => this.norm(t).includes(q));
        this.activeIndex = -1;
        this.render(list);
        if (this.keepOpenWhileTyping) this.showPanel(true);
      }

      handleKeys(e) {
        const items = Array.from(this.panel.querySelectorAll('.ssx-item'));
        if (e.key === 'ArrowDown' && items.length) {
          e.preventDefault();
          this.activeIndex = (this.activeIndex + 1) < items.length ? this.activeIndex + 1 : 0;
          this.mark(items);
        } else if (e.key === 'ArrowUp' && items.length) {
          e.preventDefault();
          this.activeIndex = (this.activeIndex - 1) >= 0 ? this.activeIndex - 1 : items.length - 1;
          this.mark(items);
        } else if (e.key === 'Enter' && this.activeIndex >= 0) {
          e.preventDefault();
          items[this.activeIndex].click();
        } else if (e.key === 'Escape') {
          this.showPanel(false);
        }
      }

      render(list) {
        this.panel.innerHTML = '';
        if (!list.length) {
          this.panel.innerHTML = `<div class="ssx-empty">Sin coincidencias</div>`;
          return;
        }
        list.forEach(text => {
          const div = document.createElement('div');
          div.className = 'ssx-item';
          div.setAttribute('role', 'option');
          div.textContent = text;
          div.addEventListener('click', () => this.selectText(text));
          this.panel.appendChild(div);
        });
      }

      selectText(text) {
        // mirror in visible input
        this.input.value = text;

        // mirror in native select (use value if present, fallback to text)
        const opt = Array.from(this.select.options).find(o => o.text.trim() === text);
        if (opt) {
          this.select.value = opt.value || opt.text;
          this.select.dispatchEvent(new Event('change', { bubbles: true }));
        }
        this.setStatus(`Seleccionado: ${text}`);
        this.showPanel(false); // close after selection (change to true if you prefer staying open)
      }

      mark(items) {
        items.forEach((el, i) => el.setAttribute('aria-selected', i === this.activeIndex ? 'true' : 'false'));
        if (this.activeIndex >= 0) items[this.activeIndex].scrollIntoView({ block: 'nearest' });
      }

      showPanel(show) {
        this.panel.style.display = show ? 'block' : 'none';
      }

      setStatus(msg) {
        if (this.status) this.status.textContent = msg;
      }
    }

    // Instantiate for all .ssx blocks (Enhancement #2: reusable component)
    document.querySelectorAll('[data-ssx]').forEach(root => {
      new SearchableSelect(root, { keepOpenWhileTyping: true });
    });
  </script>
</body>
</html>
```

### llamada a componente

```html
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Demostración | jocarsaui.SearchableSelect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #fafafa;
      margin: 3rem auto;
      max-width: 700px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      font-weight: 600;
      margin-bottom: 2rem;
      color: #333;
    }
    section {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 14px rgba(0,0,0,.05);
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    button {
      width: fit-content;
      padding: .6rem 1rem;
      border: none;
      border-radius: .5rem;
      background: #0078ff;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: background .2s;
    }
    button:hover {
      background: #005fcc;
    }
    footer {
      text-align: center;
      margin-top: 2rem;
      color: #777;
      font-size: .9rem;
    }
  </style>
</head>
<body>
  <h1>🎯 Demostración de <code>jocarsaui.SearchableSelect</code></h1>

  <section>
    <p>
      Escribe el nombre de una ciudad española para filtrar.  
      El componente mantiene el <code>&lt;select&gt;</code> original oculto y sincronizado, 
      por lo que al enviar el formulario se enviará su valor normalmente.
    </p>

    <form action="#" method="post" id="form-ciudades">
      <label for="city">Ciudad</label>

      <!-- Select nativo (queda estático, pero será mejorado por la librería) -->
      <select id="city" name="city" data-jui="searchable">
        <option value="">-- Selecciona una ciudad --</option>
        <option>Almería</option><option>Cádiz</option><option>Córdoba</option><option>Granada</option>
        <option>Huelva</option><option>Jaén</option><option>Málaga</option><option>Sevilla</option>
        <option>Jerez de la Frontera (Cádiz)</option><option>Marbella (Málaga)</option><option>Algeciras (Cádiz)</option>
        <option>Dos Hermanas (Sevilla)</option><option>Roquetas de Mar (Almería)</option><option>Motril (Granada)</option>
        <option>Zaragoza</option><option>Huesca</option><option>Teruel</option><option>Calatayud (Zaragoza)</option>
        <option>Oviedo</option><option>Gijón</option><option>Avilés</option><option>Mieres</option><option>Langreo</option>
        <option>Palma de Mallorca</option><option>Ibiza</option><option>Manacor (Mallorca)</option><option>Inca (Mallorca)</option>
        <option>Las Palmas de Gran Canaria</option><option>Santa Cruz de Tenerife</option><option>La Laguna (Tenerife)</option>
        <option>Arrecife (Lanzarote)</option><option>Puerto del Rosario (Fuerteventura)</option>
        <option>Santander</option><option>Torrelavega</option><option>Castro-Urdiales</option>
        <option>Valladolid</option><option>Salamanca</option><option>León</option><option>Burgos</option>
        <option>Ávila</option><option>Palencia</option><option>Segovia</option><option>Soria</option>
        <option>Zamora</option><option>Ponferrada (León)</option><option>Aranda de Duero (Burgos)</option>
        <option>Toledo</option><option>Talavera de la Reina (Toledo)</option><option>Puertollano (Ciudad Real)</option>
        <option>Barcelona</option><option>Tarragona</option><option>Lleida</option><option>Girona</option>
        <option>Sabadell (Barcelona)</option><option>Terrassa (Barcelona)</option><option>L’Hospitalet de Llobregat (Barcelona)</option>
        <option>Badalona (Barcelona)</option><option>Reus (Tarragona)</option><option>Manresa (Barcelona)</option>
        <option>Madrid</option><option>Alcalá de Henares</option><option>Móstoles</option><option>Fuenlabrada</option>
        <option>Getafe</option><option>Leganés</option><option>Alcorcón</option><option>Torrejón de Ardoz</option>
        <option>Murcia</option><option>Cartagena</option><option>Lorca</option><option>Yecla</option>
        <option>Pamplona</option><option>Tudela</option>
        <option>Bilbao (Bizkaia)</option><option>San Sebastián / Donostia (Gipuzkoa)</option>
        <option>Vitoria-Gasteiz (Álava)</option><option>Barakaldo (Bizkaia)</option><option>Getxo (Bizkaia)</option>
        <option>Irun (Gipuzkoa)</option>
        <option>Logroño</option><option>Calahorra</option>
        <option>Valencia</option><option>Alicante</option><option>Castellón de la Plana</option>
        <option>Elche (Alicante)</option><option>Torrevieja (Alicante)</option><option>Gandía (Valencia)</option>
        <option>Benidorm (Alicante)</option><option>Orihuela (Alicante)</option><option>Paterna (Valencia)</option>
        <option>Vila-real (Castellón)</option><option>Alcoy (Alicante)</option><option>Sagunto (Valencia)</option>
        <option>Denia (Alicante)</option><option>Torrent (Valencia)</option>
        <option>Ceuta</option><option>Melilla</option>
      </select>

      <button type="submit">Enviar</button>
    </form>

    <p style="margin-top:1rem;color:#666">
      Prueba a escribir por ejemplo: <code>Gran</code>, <code>Mal</code> o <code>Valen</code>.
    </p>
  </section>

  <footer>
    <p>© 2025 jocarsaui · Jose Vicente Carratalá Sanchis</p>
  </footer>

  <script src="jocarsaui.js"></script>
  <link rel="stylesheet" href="jocarsaui.css">
</body>
</html>
```

### carga externa

```html
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Demostración | jocarsaui.SearchableSelect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #fafafa;
      margin: 3rem auto;
      max-width: 700px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      font-weight: 600;
      margin-bottom: 2rem;
      color: #333;
    }
    section {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 14px rgba(0,0,0,.05);
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    button {
      width: fit-content;
      padding: .6rem 1rem;
      border: none;
      border-radius: .5rem;
      background: #0078ff;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: background .2s;
    }
    button:hover {
      background: #005fcc;
    }
    footer {
      text-align: center;
      margin-top: 2rem;
      color: #777;
      font-size: .9rem;
    }
  </style>
</head>
<body>
  <h1>🎯 Demostración de <code>jocarsaui.SearchableSelect</code></h1>

  <section>
    <p>
      Escribe el nombre de una ciudad española para filtrar.  
      El componente mantiene el <code>&lt;select&gt;</code> original oculto y sincronizado, 
      por lo que al enviar el formulario se enviará su valor normalmente.
    </p>

    <form action="#" method="post" id="form-ciudades">
      <label for="city">Ciudad</label>

      <!-- Select nativo (queda estático, pero será mejorado por la librería) -->
      <select id="city" name="city" data-jui="searchable">
        <option value="">-- Selecciona una ciudad --</option>
        <option>Almería</option><option>Cádiz</option><option>Córdoba</option><option>Granada</option>
        <option>Huelva</option><option>Jaén</option><option>Málaga</option><option>Sevilla</option>
        <option>Jerez de la Frontera (Cádiz)</option><option>Marbella (Málaga)</option><option>Algeciras (Cádiz)</option>
        <option>Dos Hermanas (Sevilla)</option><option>Roquetas de Mar (Almería)</option><option>Motril (Granada)</option>
        <option>Zaragoza</option><option>Huesca</option><option>Teruel</option><option>Calatayud (Zaragoza)</option>
        <option>Oviedo</option><option>Gijón</option><option>Avilés</option><option>Mieres</option><option>Langreo</option>
        <option>Palma de Mallorca</option><option>Ibiza</option><option>Manacor (Mallorca)</option><option>Inca (Mallorca)</option>
        <option>Las Palmas de Gran Canaria</option><option>Santa Cruz de Tenerife</option><option>La Laguna (Tenerife)</option>
        <option>Arrecife (Lanzarote)</option><option>Puerto del Rosario (Fuerteventura)</option>
        <option>Santander</option><option>Torrelavega</option><option>Castro-Urdiales</option>
        <option>Valladolid</option><option>Salamanca</option><option>León</option><option>Burgos</option>
        <option>Ávila</option><option>Palencia</option><option>Segovia</option><option>Soria</option>
        <option>Zamora</option><option>Ponferrada (León)</option><option>Aranda de Duero (Burgos)</option>
        <option>Toledo</option><option>Talavera de la Reina (Toledo)</option><option>Puertollano (Ciudad Real)</option>
        <option>Barcelona</option><option>Tarragona</option><option>Lleida</option><option>Girona</option>
        <option>Sabadell (Barcelona)</option><option>Terrassa (Barcelona)</option><option>L’Hospitalet de Llobregat (Barcelona)</option>
        <option>Badalona (Barcelona)</option><option>Reus (Tarragona)</option><option>Manresa (Barcelona)</option>
        <option>Madrid</option><option>Alcalá de Henares</option><option>Móstoles</option><option>Fuenlabrada</option>
        <option>Getafe</option><option>Leganés</option><option>Alcorcón</option><option>Torrejón de Ardoz</option>
        <option>Murcia</option><option>Cartagena</option><option>Lorca</option><option>Yecla</option>
        <option>Pamplona</option><option>Tudela</option>
        <option>Bilbao (Bizkaia)</option><option>San Sebastián / Donostia (Gipuzkoa)</option>
        <option>Vitoria-Gasteiz (Álava)</option><option>Barakaldo (Bizkaia)</option><option>Getxo (Bizkaia)</option>
        <option>Irun (Gipuzkoa)</option>
        <option>Logroño</option><option>Calahorra</option>
        <option>Valencia</option><option>Alicante</option><option>Castellón de la Plana</option>
        <option>Elche (Alicante)</option><option>Torrevieja (Alicante)</option><option>Gandía (Valencia)</option>
        <option>Benidorm (Alicante)</option><option>Orihuela (Alicante)</option><option>Paterna (Valencia)</option>
        <option>Vila-real (Castellón)</option><option>Alcoy (Alicante)</option><option>Sagunto (Valencia)</option>
        <option>Denia (Alicante)</option><option>Torrent (Valencia)</option>
        <option>Ceuta</option><option>Melilla</option>
      </select>

      <button type="submit">Enviar</button>
    </form>

    <p style="margin-top:1rem;color:#666">
      Prueba a escribir por ejemplo: <code>Gran</code>, <code>Mal</code> o <code>Valen</code>.
    </p>
  </section>

  <footer>
    <p>© 2025 jocarsaui · Jose Vicente Carratalá Sanchis</p>
  </footer>

  <script src="https://jocarsa.github.io/jocarsaui/jocarsaui.js"></script>
  <link rel="stylesheet" href="https://jocarsa.github.io/jocarsaui/jocarsaui.css">
</body>
</html>
```

### boton-tooltip

```javascript
const template = document.createElement('template');
template.innerHTML = `
  <style>
    :host {
      position: relative;
      display: inline-block;
      margin: 20px;
      font-family: system-ui, sans-serif;
    }
    button.miboton {
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #f5f5f5;
      cursor: pointer;
    }
    .tooltip {
      position: absolute;
      bottom: -8px;
      right: -23px;
      background: black;
      color: white;
      padding: 5px;
      border-radius: 0px 5px 5px 5px;
      width: max-content;
      min-width: 30px;
      height: auto;
      font-size: 10px;
      text-align: center;
      line-height: 10px;
      display: none;
      pointer-events: none;
      z-index: 1;
    }
    :host(:hover) .tooltip,
    button.miboton:hover + .tooltip {
      display: block;
    }
  </style>

  <button class="miboton"></button>
  <div class="tooltip"></div>
`;

class BotonTooltip extends HTMLElement {
  static get observedAttributes() {
    return ['tooltip'];
  }

  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.appendChild(template.content.cloneNode(true));
    this.button = this.shadowRoot.querySelector('button.miboton');
    this.tooltip = this.shadowRoot.querySelector('.tooltip');
  }

  connectedCallback() {
    this._updateButtonText();
    this._updateTooltip();
  }

  attributeChangedCallback(name, oldValue, newValue) {
    if (name === 'tooltip') {
      this._updateTooltip();
    }
  }

  _updateButtonText() {
    this.button.textContent = this.textContent.trim() || 'Púlsame';
  }

  _updateTooltip() {
    this.tooltip.textContent = this.getAttribute('tooltip') || 'Tooltip';
  }
}

customElements.define('boton-tooltip', BotonTooltip);
```

### jocarsaui

```css
/* jocarsaui – UI Library v0.1.0
   Component: SearchableSelect
   Author: Jose Vicente Carratalá Sanchis
*/
:root{
  --jui-border:#ddd;
  --jui-bg:#fff;
  --jui-hover:#f5f5f5;
  --jui-radius:.5rem;
  --jui-shadow:0 6px 18px rgba(0,0,0,.06);
  --jui-z:9999;
  --jui-font:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif;
}

.jui { font-family:var(--jui-font); position:relative; }

.jui-hidden-native {
  position:absolute !important; left:-9999px !important;
  width:0 !important; height:0 !important;
}

.jui-input {
  width:100%; box-sizing:border-box;
  padding:.6rem .7rem; border:1px solid var(--jui-border);
  border-radius:var(--jui-radius); background:var(--jui-bg);
  outline:none; font-size:1rem;
}
.jui-input:focus { box-shadow:0 0 0 3px rgba(0,128,255,.2); }

.jui-panel {
  position:absolute; inset-inline:0; top:calc(100% + .25rem);
  background:var(--jui-bg); border:1px solid var(--jui-border);
  border-radius:var(--jui-radius); box-shadow:var(--jui-shadow);
  max-height:260px; overflow:auto; display:none; z-index:var(--jui-z);
}
.jui-item {
  padding:.55rem .7rem; cursor:pointer; user-select:none; line-height:1.2;
}
.jui-item:hover, .jui-item[aria-selected="true"] { background:var(--jui-hover); }
.jui-empty { padding:.55rem .7rem; color:#666; }

.jui-status { margin-top:.4rem; color:#555; font-size:.9rem; }

.jui--open .jui-panel { display:block; }
```

### jocarsaui

```javascript
/*!
 * jocarsaui – UI Library v0.1.0
 * Component: SearchableSelect
 * Namespace: jocarsaui
 * Author: Jose Vicente Carratalá Sanchis
 */
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    define([], factory);
  } else if (typeof module === 'object' && module.exports) {
    module.exports = factory();
  } else {
    root.jocarsaui = factory();
  }
}(typeof self !== 'undefined' ? self : this, function () {
  'use strict';

  /** Utility functions **/
  const normalize = (s, noDiacritics=true) =>
    noDiacritics ? s.normalize('NFD').replace(/\p{Diacritic}/gu, '').toLowerCase() : s.toLowerCase();

  const defaultOpts = {
    placeholder: 'Escribe para filtrar…',
    keepOpenWhileTyping: true,
    closeOnSelect: true,
    minChars: 0,
    diacriticsInsensitive: true,
    status: true
  };

  /** =======================================================
   * Component: SearchableSelect
   * ======================================================= */
  class SearchableSelect {
    constructor(selectEl, options = {}) {
      if (!selectEl || selectEl.tagName !== 'SELECT') {
        throw new Error('jocarsaui.SearchableSelect: must receive a <select> element');
      }

      this.select = selectEl;
      this.opts = { ...defaultOpts, ...options };
      this.activeIndex = -1;
      this.items = [];

      this._setup();
      this._bind();
    }

    _setup() {
      // Wrap select in container
      this.root = document.createElement('div');
      this.root.className = 'jui';
      this.select.parentNode.insertBefore(this.root, this.select);
      this.root.appendChild(this.select);

      // Hide native select visually
      this.select.classList.add('jui-hidden-native');

      // Create input
      this.input = document.createElement('input');
      this.input.type = 'search';
      this.input.className = 'jui-input';
      this.input.placeholder = this.opts.placeholder;
      this.root.insertBefore(this.input, this.select.nextSibling);

      // Create panel
      this.panel = document.createElement('div');
      this.panel.className = 'jui-panel';
      this.panel.setAttribute('role', 'listbox');
      this.root.insertBefore(this.panel, this.input.nextSibling);

      // Optional status
      if (this.opts.status) {
        this.status = document.createElement('div');
        this.status.className = 'jui-status';
        this.root.appendChild(this.status);
      }

      // Extract options text
      this.allItems = Array.from(this.select.options)
        .map(o => ({ text: o.text.trim(), value: (o.value ?? o.text).trim() }))
        .filter(o => o.text && !/^--\s/.test(o.text));

      this._render(this.allItems);
    }

    _bind() {
      this.input.addEventListener('focus', () => this.open());
      this.input.addEventListener('input', () => this._filter());
      this.input.addEventListener('keydown', (e) => this._handleKeys(e));

      this.select.addEventListener('change', () => {
        const val = this.select.value || '';
        this.input.value = val;
        this._setStatus(val ? `Seleccionado: ${val}` : '');
      });

      // outside click
      document.addEventListener('click', (e) => {
        if (!this.root.contains(e.target)) this.close();
      });
    }

    _filter() {
      const q = this.input.value;
      const normQ = normalize(q, this.opts.diacriticsInsensitive);
      const list = q.length < this.opts.minChars
        ? this.allItems
        : this.allItems.filter(i => normalize(i.text, this.opts.diacriticsInsensitive).includes(normQ));
      this.activeIndex = -1;
      this._render(list);
      if (this.opts.keepOpenWhileTyping) this.open();
    }

    _handleKeys(e) {
      const items = Array.from(this.panel.querySelectorAll('.jui-item'));
      if (!items.length) return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        this.activeIndex = (this.activeIndex + 1) % items.length;
        this._mark(items);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        this.activeIndex = (this.activeIndex - 1 + items.length) % items.length;
        this._mark(items);
      } else if (e.key === 'Enter') {
        if (this.activeIndex >= 0) {
          e.preventDefault();
          items[this.activeIndex].click();
        }
      } else if (e.key === 'Escape') {
        this.close();
      }
    }

    _render(list) {
      this.panel.innerHTML = '';
      if (!list.length) {
        const empty = document.createElement('div');
        empty.className = 'jui-empty';
        empty.textContent = 'Sin coincidencias';
        this.panel.appendChild(empty);
        return;
      }

      list.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'jui-item';
        div.setAttribute('role', 'option');
        div.textContent = item.text;
        div.addEventListener('click', () => this._select(item));
        this.panel.appendChild(div);
      });
      this.items = list;
    }

    _select(item) {
      this.input.value = item.text;

      const found = Array.from(this.select.options).find(o => o.text.trim() === item.text);
      if (found) {
        this.select.value = found.value || found.text;
        this.select.dispatchEvent(new Event('change', { bubbles: true }));
      }

      this._setStatus(`Seleccionado: ${item.text}`);
      if (this.opts.closeOnSelect) this.close(); else this.open();
    }

    _mark(items) {
      items.forEach((el, i) => el.setAttribute('aria-selected', i === this.activeIndex ? 'true' : 'false'));
      if (this.activeIndex >= 0) items[this.activeIndex].scrollIntoView({ block: 'nearest' });
    }

    _setStatus(msg) {
      if (this.status) this.status.textContent = msg;
    }

    // Public API
    open() { this.root.classList.add('jui--open'); }
    close() { this.root.classList.remove('jui--open'); }
    focus() { this.input.focus(); }
    value() { return this.select.value; }
    destroy() {
      this.select.classList.remove('jui-hidden-native');
      this.root.parentNode.insertBefore(this.select, this.root);
      this.root.remove();
    }
  }

  /** Auto-init on data-attribute */
  function autoInit() {
    document.querySelectorAll('select[data-jui="searchable"]').forEach(sel => {
      if (!sel.__juiInstance) sel.__juiInstance = new SearchableSelect(sel);
    });
  }
  if (typeof document !== 'undefined') {
    if (document.readyState === 'loading')
      document.addEventListener('DOMContentLoaded', autoInit);
    else
      autoInit();
  }

  // Export namespace
  return { SearchableSelect };
}));
```

<a id="herramientas-para-desarrollo-de-componentes-visuales"></a>
## Herramientas para desarrollo de componentes visuales

En el mundo digital actual, la creación de componentes visuales es una habilidad fundamental para desarrolladores que buscan optimizar la experiencia del usuario en las aplicaciones web y móviles. Esta subunidad se centra específicamente en las herramientas disponibles para facilitar este proceso, proporcionando a los estudiantes un panorama completo de las opciones disponibles y cómo utilizarlas eficazmente.

La primera herramienta que esenciales para el desarrollo de componentes visuales es la utilización de **IDEs (Entornos de Desarrollo Integrados)**. Estas plataformas integran varios elementos en una sola interfaz, facilitando la edición de código fuente, depuración y ejecución del programa. IDEs como Visual Studio Code, IntelliJ IDEA o Eclipse ofrecen funcionalidades avanzadas que permiten a los desarrolladores crear componentes visuales de manera rápida y eficiente.

Además de las IDEs, existen **librerías y frameworks** específicamente diseñados para facilitar la creación de componentes visuales. Por ejemplo, React, Angular o Vue.js son herramientas populares que permiten a los desarrolladores construir interfaces de usuario complejas utilizando componentes reutilizables. Estos frameworks ofrecen una estructura sólida y una gran comunidad de usuarios, lo que facilita el aprendizaje y la solución de problemas comunes.

La creación de componentes visuales también puede ser optimizada mediante el uso de **herramientas gráficas**. Herramientas como Sketch, Figma o Adobe XD permiten a los diseñadores crear prototipos interactivos y visualizar cómo se verán los componentes en diferentes dispositivos y contextos. Estas herramientas facilitan la colaboración entre diseñadores y desarrolladores, asegurando que el componente final cumpla con las expectativas de usuario.

Además de estas herramientas gráficas, es importante conocer **herramientas de automatización** como Gulp o Grunt. Estas herramientas permiten a los desarrolladores automatizar tareas repetitivas, como la compilación de archivos CSS y JavaScript, lo que libera tiempo para enfocarse en el desarrollo de componentes visuales.

La creación de componentes visuales también puede ser facilitada mediante el uso de **herramientas de gestión de versiones**. Herramientas como Git permiten a los desarrolladores colaborar en proyectos de manera eficiente, asegurando que todos tengan acceso a las últimas versiones del código y puedan trabajar juntos sin conflictos.

La creación de componentes visuales también puede ser optimizada mediante el uso de **herramientas de monitorización**. Herramientas como Lighthouse o WebPageTest permiten a los desarrolladores evaluar la eficiencia y la accesibilidad de sus componentes, identificando áreas para mejorar y asegurando que cumplen con las mejores prácticas del diseño web.

La creación de componentes visuales también puede ser facilitada mediante el uso de **herramientas de pruebas unitarias**. Herramientas como Jest o Mocha permiten a los desarrolladores probar sus componentes de manera eficiente, asegurando que funcionen correctamente y cumpliendo con las expectativas del usuario.

La creación de componentes visuales también puede ser optimizada mediante el uso de **herramientas de documentación**. Herramientas como Storybook o Docsify permiten a los desarrolladores crear documentación detallada de sus componentes, facilitando la comprensión y el mantenimiento del código.

La creación de componentes visuales también puede ser optimizada mediante el uso de **herramientas de distribución**. Herramientas como npm o yarn permiten a los desarrolladores compartir y distribuir sus componentes con otros desarrolladores, facilitando la reutilización y la colaboración en proyectos.

En conclusión, la creación de componentes visuales es una habilidad fundamental para desarrolladores que buscan optimizar la experiencia del usuario en las aplicaciones web y móviles. Esta subunidad ha proporcionado un panorama completo de las herramientas disponibles para facilitar este proceso, proporcionando a los estudiantes un conjunto de conocimientos prácticos y útiles para mejorar su capacidad para crear componentes visuales eficientemente.

<a id="prueba-de-los-componentes"></a>
## Prueba de los componentes

La creación de componentes visuales es un aspecto fundamental del desarrollo de interfaces de usuario (UI), permitiendo a los desarrolladores construir elementos gráficos reutilizables que encapsulan funcionalidades específicas. Al diseñar y implementar componentes, se busca no solo mejorar la eficiencia en el proceso de construcción, sino también garantizar una mayor consistencia y coherencia en la apariencia final del producto.

Para probar los componentes visuales, es crucial seguir un enfoque sistemático que aborde tanto su funcionalidad como su aspecto visual. Los desarrolladores deben comenzar por verificar que cada componente se comporte correctamente en diferentes estados y situaciones, asegurándose de que responde adecuadamente a eventos y cambios de estado. Esto implica realizar pruebas unitarias para evaluar las funciones internas del componente, así como pruebas de integración para comprobar cómo interactúa con otros elementos de la interfaz.

Además de la funcionalidad, es igualmente importante probar el aspecto visual de los componentes. Esto incluye verificar que los estilos y colores se apliquen correctamente en diferentes contextos, como pantallas de alta resolución o dispositivos móviles. Herramientas gráficas y simuladores pueden ser útiles para realizar estas pruebas visuales de manera consistente.

La prueba de los componentes también debe abordar la accesibilidad y la usabilidad. Esto implica verificar que los componentes sean fáciles de usar para usuarios con diferentes habilidades, como aquellos que utilizan teclados alternativos o pantallas táctiles. Además, se deben realizar pruebas de rendimiento para asegurar que los componentes no causen problemas de carga o retraso en la interfaz.

Durante el proceso de prueba, es importante documentar todos los resultados y fallos encontrados. Esto permite identificar rápidamente áreas que requieren mejora y facilita la comunicación entre diferentes equipos del proyecto. Además, mantener una buena documentación de las pruebas realizadas ayuda a garantizar que los componentes visuales sigan cumpliendo con los requisitos establecidos durante el desarrollo.

La prueba continua es un aspecto crucial en el ciclo de vida de los componentes visuales. A medida que se realiza la evolución del producto, es necesario adaptar y mejorar los componentes para mantener su relevancia y eficacia. Esto implica realizar pruebas regulares y ajustar las estrategias de prueba según sea necesario.

En conclusión, probar los componentes visuales es un proceso integral en el desarrollo de interfaces de usuario. Al enfocarse tanto en la funcionalidad como en el aspecto visual, y considerando la accesibilidad y la usabilidad, se puede garantizar que los componentes sean confiables, eficientes y atractivos para los usuarios finales. La documentación detallada y la práctica de pruebas continuas son herramientas esenciales para mantener un alto estándar en el desarrollo de interfaces visuales.

<a id="empaquetado-de-componentes"></a>
## Empaquetado de componentes

La empaquetado de componentes es un paso crucial en el desarrollo de interfaces visuales, ya que permite organizar y distribuir los elementos gráficos de manera eficiente. Este proceso implica preparar los componentes para su uso en diferentes contextos, asegurando que sean fáciles de integrar y reutilizar. Para lograr esto, se utilizan herramientas específicas que generan paquetes o archivos que contienen todo lo necesario para la instalación y ejecución del componente.

El empaquetado comienza con la definición de los metadatos del componente, como su nombre, versión y dependencias. Estos datos son esenciales para que otros desarrolladores comprendan qué hace el componente y cómo debe ser utilizado. A continuación, se incluyen todos los archivos necesarios para la ejecución del componente, lo que puede variar desde scripts de configuración hasta recursos visuales como imágenes o hojas de estilo.

Es importante destacar que el empaquetado no solo prepara el componente para su uso en diferentes proyectos, sino que también facilita su distribución. Esto significa que los componentes pueden ser compartidos fácilmente entre equipos y organizaciones, promoviendo la reutilización del código y reduciendo el tiempo de desarrollo.

Además del empaquetado, es común realizar pruebas para asegurar que el componente funcione correctamente en diferentes entornos. Esto puede incluir pruebas de instalación, pruebas de funcionamiento y pruebas de desinstalación. Las herramientas de empaquetado suelen integrar estas pruebas, lo que facilita la verificación del estado del componente antes de su distribución.

El proceso de empaquetado también implica la creación de documentación detallada. Esta documentación debe incluir instrucciones sobre cómo instalar y configurar el componente, así como ejemplos de uso. La calidad de esta documentación es crucial para que los usuarios puedan aprovechar al máximo el componente.

Finalmente, el empaquetado puede implicar la creación de canales de distribución específicos. Esto puede ser a través de tiendas de aplicaciones, repositorios internos o incluso a través de sistemas de control de versiones. La elección del canal de distribución depende de las necesidades del proyecto y del público objetivo.

En resumen, el empaquetado de componentes es un proceso integral en el desarrollo de interfaces visuales que facilita la reutilización, distribución y mantenimiento de los elementos gráficos. A través de herramientas específicas y pruebas rigurosas, se asegura que los componentes sean fáciles de integrar y funcionen correctamente en diferentes contextos, lo que contribuye a un desarrollo más eficiente y productivo.

### libreria

```css
/* minstrap.css — tiny, classless UI styling for forms & buttons
   Drop this <link> in your <head> and native controls look good automatically. */

/* ---------- Design tokens ---------- */
:root {
  --font-sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  --radius: 10px;
  --radius-sm: 8px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,.06), 0 1px 1px rgba(0,0,0,.04);
  --shadow-md: 0 8px 20px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.04);
  --speed: 140ms;

  /* light */
  --bg: #ffffff;
  --text: #0f172a;           /* slate-900 */
  --muted: #475569;          /* slate-600 */
  --border: #e2e8f0;         /* slate-200 */
  --fill: #f8fafc;           /* slate-50 */
  --ring: #93c5fd;           /* blue-300 */
  --accent: #2563eb;         /* blue-600 */
  --accent-contrast: #ffffff;
  --accent-hover: #1e40af;   /* blue-800 */
  --destructive: #dc2626;    /* red-600 */
  --success: #16a34a;        /* green-600 */
  --warning: #d97706;        /* amber-600 */
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0b1020;
    --text: #e5e7eb;         /* slate-200 */
    --muted: #9ca3af;        /* gray-400 */
    --border: #273041;       /* slate-800 */
    --fill: #0f172a;         /* slate-900 */
    --ring: #60a5fa;         /* blue-400 */
    --accent: #3b82f6;       /* blue-500 */
    --accent-contrast: #0b1020;
    --accent-hover: #1d4ed8; /* blue-700 */
    --destructive: #ef4444;  /* red-500 */
    --success: #22c55e;      /* green-500 */
    --warning: #f59e0b;      /* amber-500 */
  }
}

/* ---------- Base reset ---------- */
*,
*::before,
*::after { box-sizing: border-box; }
html { -webkit-text-size-adjust: 100%; }
body {
  margin: 0;
  font-family: var(--font-sans);
  line-height: 1.5;
  color: var(--text);
  background: var(--bg);
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}
img, svg, video, canvas { display:block; max-width:100%; }
:focus { outline: none; }

/* ---------- Form + button defaults (classless) ---------- */
button,
input[type="button"],
input[type="submit"],
input[type="reset"] {
  appearance: none;
  -webkit-appearance: none;
  border: 1px solid var(--border);
  background: var(--accent);
  color: var(--accent-contrast);
  padding: .65rem 1rem;
  border-radius: var(--radius);
  font-weight: 600;
  letter-spacing: .2px;
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: transform var(--speed) ease, box-shadow var(--speed) ease, background var(--speed) ease, border-color var(--speed) ease, color var(--speed) ease;
}

button:hover,
input[type="button"]:hover,
input[type="submit"]:hover,
input[type="reset"]:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

button:active,
input[type="button"]:active,
input[type="submit"]:active,
input[type="reset"]:active {
  transform: translateY(0);
  box-shadow: var(--shadow-sm);
}

button:disabled,
input[type="button"]:disabled,
input[type="submit"]:disabled,
input[type="reset"]:disabled {
  opacity: .5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Neutral button style for plain <button> with data-variant or type=button can be overridden below */

/* Inputs */
input:not([type="button"]):not([type="submit"]):not([type="reset"]),
select,
textarea {
  appearance: none;
  -webkit-appearance: none;
  width: 100%;
  border: 1px solid var(--border);
  background: var(--fill);
  color: var(--text);
  padding: .65rem .8rem;
  border-radius: var(--radius);
  transition: border-color var(--speed) ease, box-shadow var(--speed) ease, background var(--speed) ease;
  box-shadow: inset 0 0 0 0 rgba(0,0,0,0);
}

textarea { min-height: 7rem; resize: vertical; }

input::placeholder,
textarea::placeholder { color: var(--muted); opacity: .8; }

input:focus,
select:focus,
textarea:focus {
  border-color: var(--ring);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--ring) 35%, transparent);
  background: color-mix(in oklab, var(--fill) 85%, var(--ring));
}

/* Field group helpers (optional) */
label { display:block; margin: .25rem 0 .35rem; font-weight: 600; color: var(--muted); }
.help { font-size: .875rem; color: var(--muted); margin-top: .35rem; }

/* Inline controls look tidy */
input[type="checkbox"],
input[type="radio"] {
  inline-size: 1.1rem;
  block-size: 1.1rem;
  margin: 0 .5rem 0 0;
  vertical-align: middle;
}

/* Custom checkbox & radio (accessible, keyboard focus visible) */
input[type="checkbox"],
input[type="radio"] { appearance: none; border-radius: var(--radius-sm); background: var(--fill); border: 1px solid var(--border); position: relative; }

input[type="radio"] { border-radius: 999px; }

input[type="checkbox"]:focus,
input[type="radio"]:focus {
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--ring) 35%, transparent);
  border-color: var(--ring);
}

input[type="checkbox"]::after {
  content: "";
  position: absolute; inset: 0;
  background: conic-gradient(from 45deg, transparent 0 25%, currentColor 0 50%, transparent 0 100%);
  transform: scale(0) rotate(10deg);
  transition: transform var(--speed) ease;
  color: var(--accent);
  clip-path: polygon(28% 52%, 42% 66%, 74% 32%, 82% 40%, 42% 82%, 20% 60%);
}

input[type="checkbox"]:checked { border-color: var(--accent); background: color-mix(in oklab, var(--accent) 8%, var(--fill)); }
input[type="checkbox"]:checked::after { transform: scale(1) rotate(0deg); }

input[type="radio"]::after {
  content:"";
  position:absolute; inset: 3px;
  border-radius: 999px;
  background: var(--accent);
  transform: scale(0);
  transition: transform var(--speed) ease;
}
input[type="radio"]:checked { border-color: var(--accent); background: color-mix(in oklab, var(--accent) 8%, var(--fill)); }
input[type="radio"]:checked::after { transform: scale(1); }

/* Select arrow */
select {
  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%),
    linear-gradient(to right, transparent, transparent);
  background-position:
    calc(100% - 18px) calc(50% - 3px),
    calc(100% - 13px) calc(50% - 3px),
    calc(100% - 2.2rem) 0;
  background-size: 5px 5px, 5px 5px, 1px 100%;
  background-repeat: no-repeat;
  padding-right: 2.2rem;
}

/* Input sizes (opt-in via data-size or class) */
[data-size="sm"], .is-sm { padding: .45rem .65rem; font-size: .9rem; border-radius: var(--radius-sm); }
[data-size="lg"], .is-lg { padding: .85rem 1.15rem; font-size: 1.05rem; }

/* Button variants (optional) */
button[data-variant="neutral"],
input[type="button"][data-variant="neutral"],
button.neutral,
input.neutral[type="button"] {
  background: var(--fill);
  color: var(--text);
  border-color: var(--border);
}

button[data-variant="outline"],
input[type="button"][data-variant="outline"],
button.outline,
input.outline[type="button"] {
  background: transparent;
  color: var(--accent);
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

button[data-variant="ghost"],
input[type="button"][data-variant="ghost"],
button.ghost,
input.ghost[type="button"] {
  background: transparent;
  color: var(--text);
  border-color: transparent;
  box-shadow: none;
}

button[data-variant="success"], .success { background: var(--success); }
button[data-variant="warning"], .warning { background: var(--warning); color: #111827; }
button[data-variant="danger"],  .danger  { background: var(--destructive); }

/* Grouped inputs (e.g., input + button) */
.input-group {
  display: flex; width: 100%;
}
.input-group > :is(input, select, textarea, button) {
  border-radius: 0;
}
.input-group > :first-child { border-top-left-radius: var(--radius); border-bottom-left-radius: var(--radius); }
.input-group > :last-child  { border-top-right-radius: var(--radius); border-bottom-right-radius: var(--radius); }
.input-group > * + * { margin-left: -1px; } /* collapse borders */

/* Simple container & spacing utilities (optional niceties) */
.container { max-width: 960px; margin-inline: auto; padding: 1.25rem; }
.stack > * + * { margin-top: 1rem; }
.grid { display:grid; gap:1rem; }
.grid.cols-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
.grid.cols-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }

/* Cards (for nice demos) */
.card {
  background: var(--fill);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1rem;
  box-shadow: var(--shadow-sm);
}

/* Focus-visible for keyboard users */
:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}
```

### ejemplo

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minstrap — Classless UI Demo</title>
  <link rel="stylesheet" href="001-libreria.css">
  <style>
    body { padding: 2rem; }
    h1, h2 { margin-top: 2rem; }
  </style>
</head>
<body>
  <div class="container stack">
    <h1>🎨 Minstrap UI Demo</h1>
    <p>A minimal, classless UI library for HTML — just include <code>minstrap.css</code> and everything looks modern automatically.</p>

    <h2>Buttons</h2>
    <div class="stack">
      <div>
        <button>Primary (default)</button>
        <button data-variant="neutral">Neutral</button>
        <button class="outline">Outline</button>
        <button class="ghost">Ghost</button>
      </div>
      <div>
        <button class="success">Success</button>
        <button class="warning">Warning</button>
        <button class="danger">Danger</button>
        <button disabled>Disabled</button>
      </div>
    </div>

    <h2>Inputs</h2>
    <div class="grid cols-2">
      <div>
        <label>Email</label>
        <input type="email" placeholder="you@example.com">
      </div>
      <div>
        <label>Password</label>
        <input type="password" placeholder="••••••••">
      </div>
    </div>

    <h2>Textarea</h2>
    <textarea placeholder="Write something here..."></textarea>

    <h2>Select</h2>
    <select>
      <option>Choose an option</option>
      <option>Option A</option>
      <option>Option B</option>
      <option>Option C</option>
    </select>

    <h2>Checkboxes & Radios</h2>
    <div>
      <label><input type="checkbox" checked> Receive newsletter</label><br>
      <label><input type="checkbox"> Enable notifications</label>
    </div>
    <div>
      <label><input type="radio" name="r" checked> Option A</label><br>
      <label><input type="radio" name="r"> Option B</label>
    </div>

    <h2>Input Group</h2>
    <div class="input-group">
      <input type="text" placeholder="Search...">
      <button data-variant="neutral">Go</button>
    </div>

    <h2>Cards and Layout</h2>
    <div class="grid cols-3">
      <div class="card">
        <h3>Card title</h3>
        <p>This is a card with text content.</p>
        <button>Action</button>
      </div>
      <div class="card">
        <h3>Another card</h3>
        <p>Cards automatically adapt to dark mode too!</p>
        <button class="outline">More info</button>
      </div>
      <div class="card">
        <h3>Success card</h3>
        <p>Cards can contain any elements, including inputs.</p>
        <input placeholder="Try typing here...">
      </div>
    </div>

    <h2>Sizes</h2>
    <div class="stack">
      <button class="is-sm">Small button</button>
      <button>Normal button</button>
      <button class="is-lg">Large button</button>
    </div>

    <footer style="margin-top:3rem; font-size:.9rem; color:var(--muted);">
      <p>Built with <strong>minstrap.css</strong> — a classless UI micro-framework.</p>
    </footer>
  </div>
</body>
</html>
```

### cssreset

```css
/* ======= Modern CSS Reset (unopinionated + sensible defaults) ======= */
/* Box sizing */
*, *::before, *::after {
  box-sizing: border-box;
}

/* Remove default margins */
* {
  margin: 0;
}

/* Full-height layout baseline */
html, body {
  height: 100%;
}

/* Improve text rendering and baseline typography without setting a font */
html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

body {
  line-height: 1.5;
  font-synthesis-weight: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;   /* WebKit */
  -moz-osx-font-smoothing: grayscale;    /* Firefox on macOS */
}

/* Media elements: make responsive by default */
img, picture, video, canvas, svg {
  display: block;
  max-width: 100%;
}

/* Reset form element fonts and basics */
input, button, textarea, select {
  font: inherit;
  color: inherit;
}

/* Remove default padding/list-style on lists */
ul, ol {
  list-style: none;
  padding: 0;
}

/* Anchor defaults */
a {
  color: inherit;
  text-decoration: none;
  text-decoration-skip-ink: auto;
}

/* Headings and text: prevent overflow issues */
p, h1, h2, h3, h4, h5, h6 {
  overflow-wrap: break-word;
}

/* Tables */
table {
  border-collapse: collapse;
  border-spacing: 0;
}

/* Forms: normalize borders and background (minimal) */
button, input, select, textarea {
  background-color: transparent;
  border: 0;
  padding: 0;
}

/* Remove default button styles for consistency */
button, [type="button"], [type="reset"], [type="submit"] {
  -webkit-appearance: button;
  appearance: button;
  cursor: pointer;
}

/* Remove built-in form outlines only when not keyboard-focused */
:focus:not(:focus-visible) {
  outline: none;
}

/* Fieldset/legend clean-up */
fieldset {
  border: 0;
  margin: 0;
  padding: 0;
}
legend {
  padding: 0;
}

/* Abbr and code elements */
abbr[title] {
  text-decoration: underline dotted;
}
code, kbd, samp, pre {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 1em;
}

/* HR: remove default look; make it a simple divider */
hr {
  height: 0;
  border: 0;
  border-top: 1px solid currentColor;
  opacity: .2;
}

/* Dialog/base stacking context for React/Vue root apps */
#root, #__next {
  isolation: isolate;
  min-height: 100%;
}

/* Forms: number inputs without spinners (WebKit) */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Forms: search inputs (WebKit) */
input[type="search"] {
  -webkit-appearance: textfield;
  outline-offset: -2px;
}
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

/* Remove default details summary marker (optional) */
details > summary {
  list-style: none;
}
details > summary::-webkit-details-marker {
  display: none;
}

/* Images without alt should not be announced as decorative by default */
img[alt=""] {
  role: presentation;
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  html:focus-within {
    scroll-behavior: auto;
  }
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Optional: honor user color scheme without forcing one */
/* :root { color-scheme: light dark; } */
```

### html de reinicio

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSS Reset Demo</title>
  <link rel="stylesheet" href="003-cssreset.css">
  <style>
    /* Demo styles (to visualize after reset) */
    body {
      font-family: system-ui, sans-serif;
      padding: 2rem;
      background: #f7f7f7;
      color: #333;
    }

    h1 {
      margin-bottom: 1rem;
      font-size: 2rem;
      color: steelblue;
    }

    a {
      color: darkred;
    }

    button {
      background: steelblue;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: background 0.3s;
    }
    button:hover {
      background: mediumseagreen;
    }

    ul {
      margin-top: 1rem;
      padding-left: 1.5rem;
      list-style: disc;
    }

    table {
      margin-top: 1rem;
      border: 1px solid #ccc;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>Demo: External CSS Reset</h1>
  <p>This page loads a full CSS reset from an external file named <code>reset.css</code>.</p>

  <p>
    <a href="#">This is a link</a>, and here’s a <button>button</button>.
  </p>

  <ul>
    <li>List item one</li>
    <li>List item two</li>
    <li>List item three</li>
  </ul>

  <table>
    <thead>
      <tr><th>Item</th><th>Value</th></tr>
    </thead>
    <tbody>
      <tr><td>Apples</td><td>10</td></tr>
      <tr><td>Oranges</td><td>5</td></tr>
    </tbody>
  </table>
</body>
</html>
```

### carga desde GitHub

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSS Reset Demo</title>
  <link rel="stylesheet" href="https://jocarsa.github.io/cssreset/cssreset.css">
  <style>
    /* Demo styles (to visualize after reset) */
    body {
      font-family: system-ui, sans-serif;
      padding: 2rem;
      background: #f7f7f7;
      color: #333;
    }

    h1 {
      margin-bottom: 1rem;
      font-size: 2rem;
      color: steelblue;
    }

    a {
      color: darkred;
    }

    button {
      background: steelblue;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: background 0.3s;
    }
    button:hover {
      background: mediumseagreen;
    }

    ul {
      margin-top: 1rem;
      padding-left: 1.5rem;
      list-style: disc;
    }

    table {
      margin-top: 1rem;
      border: 1px solid #ccc;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>Demo: External CSS Reset</h1>
  <p>This page loads a full CSS reset from an external file named <code>reset.css</code>.</p>

  <p>
    <a href="#">This is a link</a>, and here’s a <button>button</button>.
  </p>

  <ul>
    <li>List item one</li>
    <li>List item two</li>
    <li>List item three</li>
  </ul>

  <table>
    <thead>
      <tr><th>Item</th><th>Value</th></tr>
    </thead>
    <tbody>
      <tr><td>Apples</td><td>10</td></tr>
      <tr><td>Oranges</td><td>5</td></tr>
    </tbody>
  </table>
</body>
</html>
```

<a id="ejercicio-de-final-de-unidad-2"></a>
## Ejercicio de final de unidad

### ejercicio

```markdown

```

<a id="examen-final"></a>
## Examen final

### crear tablas

```sql
CREATE DATABASE portafolioceac;

USE portafolioceac;


CREATE TABLE Piezas(
  Identificador INT auto_increment PRIMARY KEY,
  titulo VARCHAR(255),
  descripcion VARCHAR(255),
  imagen VARCHAR(255),
  url VARCHAR(255),
  id_categoria INT
);

CREATE TABLE Categorias(
  Identificador INT auto_increment PRIMARY KEY,
  titulo VARCHAR(255),
  descripcion VARCHAR(255)
);
```

### insertar

```sql
INSERT INTO Categorias VALUES(
  NULL,
  'General',
  'Esta es la categoria general'
);

INSERT INTO Piezas VALUES(
  NULL,
  'Primera pieza',
  'Esta es la descripcion de la primera pieza',
  'josevicente.jpg',
  'https://jocarsa.com',
  1
);
```

### fk

```sql
ALTER TABLE Piezas
ADD CONSTRAINT fk_piezas_categorias
FOREIGN KEY (id_categoria) REFERENCES Categorias(identificador)
ON DELETE CASCADE
ON UPDATE CASCADE;
```

### selecciones

```sql
SELECT * FROM Categorias;

SELECT * FROM Piezas;
```

### left join

```sql
SELECT 
* 
FROM Piezas
LEFT JOIN Categorias
ON Piezas.id_categoria = Categorias.Identificador;
```

### ahora creo la vista

```sql
CREATE VIEW piezas_y_categorias AS 
SELECT 
Categorias.titulo AS categoriatitulo,
Categorias.descripcion AS categoriadescripcion,
Piezas.titulo AS piezatitulo,
Piezas.descripcion AS piezadescripcion,
imagen,
url
FROM Piezas
LEFT JOIN Categorias
ON Piezas.id_categoria = Categorias.Identificador;

SELECT * FROM piezas_y_categorias;
```

### usuario

```sql
-- crea usuario nuevo con contraseña
-- creamos el nombre de usuario que queramos
CREATE USER 
'portafolioceac'@'localhost' 
IDENTIFIED  BY 'portafolioceac';

-- permite acceso a ese usuario
GRANT USAGE ON *.* TO 'portafolioceac'@'localhost';
--[tuservidor] == localhost
-- La contraseña puede requerir Mayus, minus, numeros, caracteres, min len

-- quitale todos los limites que tenga
ALTER USER 'portafolioceac'@'localhost' 
REQUIRE NONE 
WITH MAX_QUERIES_PER_HOUR 0 
MAX_CONNECTIONS_PER_HOUR 0 
MAX_UPDATES_PER_HOUR 0 
MAX_USER_CONNECTIONS 0;

-- dale acceso a la base de datos empresadam
GRANT ALL PRIVILEGES ON portafolioceac.* 
TO 'portafolioceac'@'localhost';

-- recarga la tabla de privilegios
FLUSH PRIVILEGES;
```


<a id="diseno-de-interfaces-graficas"></a>
# Diseño de interfaces gráficas

<a id="usabilidad-y-accesibilidad"></a>
## Usabilidad y accesibilidad

En la subunidad "Usabilidad y accesibilidad" del desarrollo de interfaces gráficas, se aborda el aspecto crucial que determinará la eficacia y el éxito de cualquier aplicación. La usabilidad se refiere a la facilidad con que los usuarios pueden interactuar con una interfaz, mientras que la accesibilidad se centra en la capacidad de todos los usuarios, incluidos aquellos con discapacidades, para utilizarla sin dificultades.

La usabilidad es un factor fundamental en el diseño de interfaces gráficas porque afecta directamente a la satisfacción del usuario y su eficiencia al interactuar con la aplicación. Un diseño intuitivo y fácil de usar puede reducir significativamente el tiempo necesario para aprender cómo utilizar una interfaz, lo que aumenta la retención de los usuarios y reduce las tasas de abandono.

La accesibilidad es otro aspecto igualmente importante, pero a menudo menos reconocido. Aunque todos los usuarios desean una experiencia sin problemas, no todos tienen las mismas capacidades físicas o mentales. Por lo tanto, el diseño de interfaces accesibles es esencial para garantizar que todos puedan utilizar la aplicación de manera eficiente y segura.

Para mejorar la usabilidad y accesibilidad de una interfaz gráfica, se deben seguir varias pautas fundamentales. La simplicidad en la disposición de los elementos es clave, ya que un diseño complejo puede confundir a los usuarios. Además, el uso de colores contrastantes y fuentes legibles es crucial para garantizar que todos puedan leer la información sin dificultades.

La accesibilidad también implica considerar a los usuarios con discapacidades visuales o auditivas. Por ejemplo, se debe proporcionar texto alternativo para imágenes y utilizar tecnologías de lectura de pantalla para facilitar el acceso a contenido audiovisual. Además, es importante garantizar que la interfaz sea navegable por teclado, lo que permite a los usuarios sin habilidad motora usar la aplicación con solamente su teclado.

Además de estas consideraciones técnicas, también es fundamental realizar pruebas de usabilidad y accesibilidad en diferentes contextos y con diferentes tipos de usuarios. Esto puede implicar el uso de personas reales para probar la interfaz y recoger sus comentarios, así como el empleo de herramientas y tecnologías específicas para evaluar la accesibilidad.

La implementación de estas pautas no solo mejora la experiencia del usuario final, sino que también puede tener beneficios adicionales. Por ejemplo, un diseño accesible puede facilitar el uso por personas mayores o con discapacidades motoras, lo que puede expandir el alcance de usuarios potenciales de una aplicación.

En conclusión, la usabilidad y accesibilidad son aspectos fundamentales en el desarrollo de interfaces gráficas. Al seguir pautas específicas y realizar pruebas adecuadas, se pueden crear interfaces que sean eficientes, seguras y accesibles para todos los usuarios, lo que es crucial en un mundo cada vez más digitalizado donde la experiencia del usuario puede determinar su satisfacción y lealtad a una aplicación.

### Definiciones

```markdown
Usabilidad - el usuario debe encontrar la información que está buscando
1.-Con el menor tiempo posible
2.-Con la mayor facilidad posible

Usabilidad = quiere decir que el contenido sea práctico
No quiere decir que el contenido sea bonito
Una cosa no está reñida con la otra - si se pueden lograr las dos a la vez, mejor
```

### Modelos mentales

```markdown
Modelo mental:
La idea preconcebida (en base a nuestra educación) de cómo son las cosas
No como realmente son, sino como nosotros las percibimos en base a nuestra experiencia previa

Cuando entramos en una habitación, los interruptores suelen estar:
1.-Cerca de la puerta
2.-A un metro-metro veinte de altura

Tiene lógica, pero desconocemos esa lógica
Buscamos los interruptores donde siempre los hemos encontrado

El modelo mental es "como funcionan las cosas" no en base a la comprensión, sino en base a la experiencia

Si nuestro usuario tiene un modelo mental preconcebido, y nosotros cambiamos las reglas, confundiremos al usuario
```

### la atención del usuario

```markdown
La atención del usuario es muy breve
Internet es un medio muy cruel
El usuario sabe que si no se aclara con nuestra web, habrá otras mcuhas

Si el usuario no encuentra lo que está buscando, o no sabe como funciona nuestra web, se irá a otra web

No es solo que hay que captar la atención del usuario
Hay que comunicar mucho con poco esfuerzo
El usuario debe saber utilizar nuestra web de forma intuitiva

Nuestra web o aplicación no tiene que ser "un escape room"
```

### competencia y influenciadores

```markdown
Un usuario cuando llega a tu web ha pasado incontables horas en otras webs
Ese usuario está "educado" con respecto a lo que ha encontrado en otras webs

Espera encontrar en tu web un lenguaje visual y funcional similar al que hay otras webs
```

### Consistencia

```markdown
Mediante la consistencia lo que queremos proporcionar es una experiencia continua y consistente al usuario por ejemplo si un botón dentro de nuestra aplicación tiene una forma todo el resto de botones dentro de nuestra aplicación tienen que tener esa misma forma color fondo tipografía lo que sea 

Cuando diseñamos componentes de sitios web debemos mantener una consistencia y no me refiero específicamente ahora a una cuestión de mantenimiento de la identidad corporativa que probablemente también sino crear un lenguaje visual y funcional y mantener ese lenguaje visual durante toda la operativa de la aplicación 
```

### contenido fuera de la zona de scroll

```markdown
Debemos tener en cuenta que la gran mayoría de los usuarios aproximadamente el 80%, no hace scroll para ver los contenidos que hay bajo de lo que se llama el over the fold es decir la parte inferior de la página web cuando cargamos la página web y por lo tanto el contenido todo aquel contenido que pongamos debe ser llamativo es decir el contenido que ponemos en esa parte visible de la web cuando la cargamos por primera vez 
```

### anchura de la página

```markdown
A día de hoy existen tantos dispositivos y tantas censuras de página y además hay que tener en cuenta que se acerca la era de las gafas inteligentes que es imposible acertar con la anchura de la página del visitante entonces qué es lo mejor que podemos hacer a este respecto pues lo mejor que podemos hacer es instalar una herramienta de analítica para analizar cuáles son las anchuras de pantalla más frecuentes por parte de nuestros usuarios para evidentemente adaptar la anchura de nuestra aplicación a la anchura o las anchuras más frecuentes por parte de los usuarios reales de la aplicación 
```

### ubicacion de los elementos

```markdown
Donde espera encontrar el usuario los elementos pues por ejemplo si hablamos del logotipo pues el logotipo dentro de una página web por ejemplo se encuentra siempre arriba a la izquierda poner el logotipo en otra ubicación es arriesgado porque no le estaremos comunicando al usuario correctamente donde está aquello que espera encontrar

 por ejemplo otro caso práctico con respecto al menú de navegación así como por ejemplo en los años 90 los menús de navegación se encontraban en el lateral izquierdo algo parecido a lo que ocurre con el panel de control de WordPress pero para cualquier página web pues a día de hoy por ejemplo los menús de navegación se encuentran de forma horizontal en la parte superior de la página que es lo que tenemos que hacer pues poner elementos tales como el menú de navegación donde el usuario espera encontrarlos

 podemos cambiarlos de sitio nosotros no es decir Google tiene el poder y el potencial de cambiar el menú por defecto y hacer que la gente se acostumbre a una nueva posición pero nosotros no tenemos la posición el poder que tiene Google para cambiar eh digamos las costumbres de los usuarios 
```

### buscadores

```markdown
Las personas están acostumbradas a utilizar buscadores es decir muchas veces articulamos una aplicación en base a menús jerárquicos pero lo cierto es que todo el mundo utiliza buscadores y a día de hoy incluso todo el mundo empieza a utilizar inteligencia artificial por tanto si tu sitio tiene mucho contenido pon directamente un buscador por supuesto también por menús jerárquicos pero con un buscador y en el caso de la inteligencia artificial aunque también sabemos que colocar herramientas de Inteligencia Artificial pues es más costoso en cuanto a que requieren más computación pero si es necesario pon digamos por decirlo de alguna forma un micro chat GPT e insertado en bebido dentro de nuestra página web 
```

### banners o heroes

```markdown
El banner principal de una web que generalmente se denomina héroe es lo primero que ve un usuario al visitar la web así que lo primero y lo principal que hay que cuidar cuando creamos un sitio web en el próximo día estaremos haciendo ejemplos de todo esto que hoy estoy comentando en la teoría lo primero que tenemos que hacer es cuidar lo que comunica tanto la imagen como el texto del banner o del héroe 
```

### tipografías

```markdown
Las tipografías es decir las familias tipográficas de las fuentes y de las letras comunican una serie de cosas por ejemplo las tipografías de palo son más fáciles de leer y comunican seriedad y empresarialidad las tipografías con serifas son más elegantes y son más propias de la literatura o el periodismo las tipografías artísticas son más propias de páginas artísticas y las tipografías basadas en la escritura a mano comunican digamos eh infantilidad algo así estarían eh orientadas hacia negocios basados con guarderías y similares así que en definitiva escoge las tipografías que sean correctas para el tipo de negocio sobre el que vas a trabajar 
```

### formularios

```markdown
Siempre intenta que los formularios sean lo más sencillos y lo más cortos posibles porque todos odiamos los formularios

 pide cuantos menos datos mejor

 siempre que sea posible automatiza los campos mediante campos de tipo SELECT

Ofrece al usuario opciones para autocompletar para que el usuario tenga que rellenar cuanta menos información posible

 utiliza tecnologías asíncronas siempre que sea posible para realizar peticiones al servidor y por lo tanto por ejemplo si el usuario escogido un nombre de usuario que no está disponible pues no le hagas esperar hasta la siguiente página para informarle de esa eventualidad es decir si tienes que informarle infórmale dentro de la misma página

 avisa de la política de privacidad con respecto a la toma de datos

 proporciona premios en el sentido de que cuando el usuario rellena correctamente un campo un premio simplemente es poner un piloto rojo o un piloto verde o poner un subrayado verde simplemente para que el usuario sepa que ese campo está rellenado correctamente a eso solo me refiero con dar premios o recompensas

 y hay que tener en cuenta que en el diseño de formularios cuanto menos mejor 
```

### accesibilidad

```markdown
En cuanto a cuestiones de accesibilidad ofrece al usuario herramientas tales como por ejemplo aumentar o disminuir el tamaño de la tipografía ya que hay personas que pueden tener dificultades visuales que pueden acceder a tu web si puedes por un ampliador

 otra herramienta interesante es una herramienta de cambio dinámico de CSS que en un momento dado te puede permitir cambiar un CSS por otro por ejemplo creando un CSS de alto contraste 
```

<a id="medidas-de-usabilidad-y-accesibilidad-de-las-aplicaciones"></a>
## Medidas de usabilidad y accesibilidad de las aplicaciones

En el desarrollo de interfaces gráficas, la medición de usabilidad y accesibilidad es un aspecto crucial que no debe ser subestimado. La usabilidad se refiere a la facilidad con la que los usuarios pueden interactuar con una aplicación, mientras que la accesibilidad se centra en la capacidad de dichos usuarios para usar la interfaz sin restricciones. Ambas son fundamentales para crear experiencias de usuario satisfactorias y seguras.

La medición de usabilidad implica evaluar cómo los usuarios interactúan con la interfaz, identificando tanto las acciones exitosas como las fallidas. Esto puede realizarse mediante pruebas de usuario, donde se observa directamente cómo los usuarios utilizan la aplicación en un entorno controlado. Los resultados pueden incluir tiempos de respuesta, errores cometidos y preferencias de navegación. A partir de estas observaciones, se pueden identificar áreas para mejorar la interfaz.

La accesibilidad es una cuestión de diseño que permite a todos los usuarios, independientemente de sus capacidades físicas o mentales, utilizar la aplicación sin dificultades. Esto incluye considerar factores como el tamaño del texto, las opciones de color y la capacidad de navegar por la interfaz con teclas del teclado. La accesibilidad no solo beneficia a usuarios con discapacidades, sino que también puede mejorar la experiencia general para todos los usuarios.

Para medir la usabilidad y accesibilidad, se pueden utilizar herramientas específicas como el Análisis de Usabilidad (Usability Testing) y las pruebas de accesibilidad. Estas herramientas proporcionan datos objetivos sobre cómo los usuarios interactúan con la interfaz y cuáles son sus dificultades. Además, es importante realizar pruebas iterativas para identificar problemas y mejorar constantemente el diseño.

La medición de usabilidad y accesibilidad no debe ser un proceso estacionario, sino una etapa continua en el ciclo de vida del desarrollo de interfaces gráficas. Es crucial que los diseñadores y desarrolladores trabajen en conjunto para integrar estas medidas desde el principio del proyecto, asegurando que la interfaz sea tanto fácil de usar como accesible para todos los usuarios.

En conclusión, la medición de usabilidad y accesibilidad es un aspecto fundamental del diseño de interfaces gráficas. Al considerar estos factores desde el inicio del proceso de desarrollo, se pueden crear aplicaciones que no solo sean eficientes en su uso, sino también inclusivas y seguras para todos los usuarios.

### analisis de necesidades de una app empresarial

```markdown
Backoffice

1.-Login
2.-Navegacion+contenido
3.-Dashboard
4.-Vista de tabla
5.-Vista de formulario
6.-Vista de fichas
7.-Vista de informe


Front (visto por los clientes)
1.-Home
2.-Contacto
3.-Listado de X (productos)
4.-Página informativa
5.-Layouts
6.-Footer
7.-Header
```

### plantilla maestra

```html
<!doctype html>
<html lang="es">
  <head>
    <title></title>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
</html>
```

### plantilla login

```html
  <style>
    #login{
      width:400px;
      height:400px;
      background:white;
      padding:20px;
      box-shadow:0px 10px 20px black;
      border-radius:10px;
    }
  </style>
  
  <section id="login">
    <input type="text" id="usuario">
    <input type="text" id="contraseña">
    <button>Enviar</button>
  </section>
  
  <script>
    let boton = document.querySelector("#login button")
    boton.onclick = function(){
      console.log("click")
    }
  </script>
```

### traigo el login

```
<!doctype html>
<html lang="es">
  <head>
    <title></title>
    <meta charset="utf-8">
  </head>
  <body>
    <?php include "003-plantilla login.html"; ?>
  </body>
  
</html>
```

### maestro

```
<!doctype html>
<html lang="es">
  <head>
    <title></title>
    <meta charset="utf-8">
  </head>
  <body>
    <?php include "componentes/layout.php"; ?>
  </body>
  
</html>
```

### parametros url

```
<!doctype html>
<html lang="es">
  <head>
    <title></title>
    <meta charset="utf-8">
  </head>
  <body>
    <script>
      const parametros = new URLSearchParams(window.location.search);
      const nombre = parametros.get("nombre");
      console.log(nombre);
    </script>
  </body>
  
</html>
```

### maestro

```
<!doctype html>
<html lang="es">
  <head>
    <title></title>
    <meta charset="utf-8">
  </head>
  <body>
    <?php include "componentes/layout.php"; ?>
  </body>
  
</html>
```

<a id="b-esquemas-wireframes-y-maquetas-mockups"></a>
## b-Esquemas (Wireframes) y Maquetas (Mockups)

En el mundo digital actual, la creación de interfaces gráficas es un aspecto crucial del desarrollo de aplicaciones. Las interfaces son las primeras interacciones que los usuarios tienen con cualquier software o sistema, por lo que su diseño debe ser cuidadoso y centrado en el usuario. En esta subunidad, nos adentramos en la creación de esquemas (wireframes) y maquetas (mockups), dos herramientas fundamentales para diseñar interfaces gráficas.

Los wireframes son representaciones simples y abstractas de una interfaz gráfica, que muestran la estructura y el flujo de los elementos sin preocuparse por su apariencia visual. Son esencialmente un esbozo rápido y funcional que permite a los diseñadores e ingenieros entender cómo se organizarán los componentes de la interfaz. Los wireframes pueden ser creados con herramientas digitales como Sketch, Adobe XD o incluso con software de edición gráfica tradicional como Photoshop.

Las maquetas, por otro lado, son versiones más detalladas y atractivas de los wireframes. Mientras que los wireframes se enfocan en la funcionalidad y el flujo de la interfaz, las maquetas incorporan elementos visuales y gráficos para dar forma final al diseño. Las maquetas suelen ser creadas con herramientas especializadas como Figma o Adobe XD, que ofrecen una gran variedad de opciones para diseñar interfaces atractivas y funcionales.

La creación de wireframes y maquetas es un proceso iterativo. A menudo, los diseñadores comienzan con un wireframe básico y luego lo refinan en una maqueta más detallada. Este proceso puede implicar varias versiones y modificaciones hasta que se logre un diseño final que cumpla con las necesidades del usuario y las expectativas del proyecto.

Además de la creación de wireframes y maquetas, es importante considerar otros aspectos en el diseño de interfaces gráficas. La usabilidad y accesibilidad son elementos fundamentales que deben ser tenidos en cuenta desde el principio del proceso de diseño. Esto implica asegurarse de que la interfaz sea fácil de usar para todos los usuarios, incluyendo aquellos con discapacidades visuales o motoras.

La creación de wireframes y maquetas es un paso crucial en el desarrollo de interfaces gráficas, ya que permite a los diseñadores e ingenieros visualizar y validar la estructura y el diseño de una interfaz antes de pasar al desarrollo detallado. Este proceso no solo facilita la comunicación entre diferentes equipos del proyecto, sino que también ayuda a identificar problemas potenciales en el diseño temprano en el ciclo de vida del proyecto.

En conclusión, la creación de wireframes y maquetas es una habilidad esencial para cualquier profesional del desarrollo de interfaces gráficas. A través de estos procesos, los diseñadores pueden crear interfaces que sean funcionales, atractivas y accesibles para todos los usuarios. Al seguir un enfoque iterativo y centrado en el usuario, se puede asegurar que las interfaces finales cumplan con las necesidades del proyecto y proporcionen una experiencia óptima al usuario final.

### dashboard

```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ERP Formación - Dashboard</title>
  <link rel="stylesheet" href="css/erp.css" />
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-brand">
        <img src="logo-ensensyem-240x52.png" alt="Logo" />
        <div class="sidebar-brand-text">
          <span>ERP</span>
          <strong>Formación</strong>
        </div>
      </div>

      <div class="sidebar-section-title">Módulos</div>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item active">
          <span class="icon">📚</span>
          <span>SIS Académico</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">📈</span>
          <span>Marketing</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">👥</span>
          <span>CRM</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">💶</span>
          <span>Facturación</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">⚙️</span>
          <span>Común</span>
        </li>
      </ul>

      <div class="sidebar-section-title">Entidades</div>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item" onclick="openEntityTable()">
          <span class="icon">👨‍🎓</span>
          <span>Alumnos</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">🏢</span>
          <span>Empresas</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">🧑‍🏫</span>
          <span>Profesores</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">📆</span>
          <span>Grupos / Ediciones</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">🏫</span>
          <span>Aulas</span>
        </li>
      </ul>

      <div class="sidebar-footer">
        <div>Sesión: <strong>Administrador</strong></div>
        <div><a href="modules.html">Cambiar de módulo</a></div>
      </div>
    </aside>

    <main class="main">
      <header class="main-header">
        <div class="main-header-left">
          <h1>Resumen del módulo SIS</h1>
          <span>Visión general de cursos, matrículas y ocupación de aulas.</span>
        </div>
        <div class="main-header-right">
          <button class="btn btn-secondary">Hoy</button>
          <button class="btn btn-secondary">Este mes</button>
          <button class="btn btn-primary">Nueva edición de curso</button>
        </div>
      </header>

      <section class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-label">Cursos activos</div>
          <div class="kpi-value">18</div>
          <div class="kpi-trend">+3 vs. mes anterior</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Alumnos matriculados</div>
          <div class="kpi-value">247</div>
          <div class="kpi-trend">+12,5%</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Ocupación presencial</div>
          <div class="kpi-value">78%</div>
          <div class="kpi-trend">+5% vs. media</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Grupos bonificados</div>
          <div class="kpi-value">11</div>
          <div class="kpi-trend">+2 este mes</div>
        </div>
      </section>

      <section class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <div class="chart-title">Matrículas por curso</div>
              <div class="chart-subtitle">Top 4 cursos activos</div>
            </div>
            <select>
              <option>Últimos 30 días</option>
              <option>Últimos 90 días</option>
              <option>Año actual</option>
            </select>
          </div>
          <div class="chart-body">
            <div class="chart-bar" style="height: 72%;">
              <span>Revit</span>
            </div>
            <div class="chart-bar" style="height: 60%;">
              <span>AutoCAD</span>
            </div>
            <div class="chart-bar" style="height: 48%;">
              <span>SketchUp</span>
            </div>
            <div class="chart-bar" style="height: 35%;">
              <span>Office</span>
            </div>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <div>
              <div class="chart-title">Canales de captación</div>
              <div class="chart-subtitle">Distribución de altas de alumnos</div>
            </div>
          </div>
          <div class="chart-pie">
            <div class="chart-pie-circle"></div>
          </div>
          <div class="chart-legend">
            <div class="chart-legend-item">
              <div class="chart-legend-dot" style="background: var(--color-primary);"></div>
              Web / SEO (40%)
            </div>
            <div class="chart-legend-item">
              <div class="chart-legend-dot" style="background: var(--color-accent);"></div>
              Empresas (25%)
            </div>
            <div class="chart-legend-item">
              <div class="chart-legend-dot" style="background: #e2e8f0;"></div>
              Otros / Recomendaciones (35%)
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    function openEntityTable() {
      window.location.href = "entity-table.html";
    }
  </script>
</body>
</html>
```

### entity-table

```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ERP Formación - Alumnos</title>
  <link rel="stylesheet" href="css/erp.css" />
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-brand">
        <img src="logo-ensensyem-240x52.png" alt="Logo" />
        <div class="sidebar-brand-text">
          <span>ERP</span>
          <strong>Formación</strong>
        </div>
      </div>

      <div class="sidebar-section-title">Módulos</div>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item active">
          <span class="icon">📚</span>
          <span>SIS Académico</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">📈</span>
          <span>Marketing</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">👥</span>
          <span>CRM</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">💶</span>
          <span>Facturación</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">⚙️</span>
          <span>Común</span>
        </li>
      </ul>

      <div class="sidebar-section-title">Entidades</div>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item active">
          <span class="icon">👨‍🎓</span>
          <span>Alumnos</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">🏢</span>
          <span>Empresas</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">🧑‍🏫</span>
          <span>Profesores</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">📆</span>
          <span>Grupos / Ediciones</span>
        </li>
        <li class="sidebar-nav-item">
          <span class="icon">🏫</span>
          <span>Aulas</span>
        </li>
      </ul>

      <div class="sidebar-footer">
        <div>Sesión: <strong>Administrador</strong></div>
        <div><a href="dashboard.html">Volver al dashboard</a></div>
      </div>
    </aside>

    <main class="main">
      <header class="table-header">
        <div class="table-title">
          <h1>Alumnos</h1>
          <span>
            Listado simulado de alumnos del ERP. Aquí luego iría el CRUD real
            y filtros avanzados.
          </span>
        </div>
        <div class="table-actions">
          <button class="btn btn-secondary">Exportar Excel</button>
          <button class="btn btn-primary">Nuevo alumno</button>
        </div>
      </header>

      <section class="table-filters">
        <div style="min-width: 180px;">
          <input type="text" placeholder="Buscar por nombre, email, empresa..." />
        </div>
        <div style="min-width: 150px;">
          <select>
            <option>Todos los cursos</option>
            <option>Revit Avanzado</option>
            <option>AutoCAD Intensivo</option>
            <option>SketchUp Básico</option>
          </select>
        </div>
        <div style="min-width: 150px;">
          <select>
            <option>Estado de matrícula</option>
            <option>Pendiente de pago</option>
            <option>Confirmado</option>
            <option>Baja</option>
          </select>
        </div>
        <div style="min-width: 150px;">
          <select>
            <option>Tipo de cliente</option>
            <option>Particular</option>
            <option>Empresa</option>
          </select>
        </div>
      </section>

      <section class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Alumno</th>
              <th>Correo</th>
              <th>Empresa</th>
              <th>Curso / Grupo</th>
              <th>Tipo</th>
              <th>Bonificación</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Laura Martínez</td>
              <td>laura.martinez@example.com</td>
              <td>Particular</td>
              <td>Revit Avanzado · Grupo R24-03</td>
              <td>
                <span class="badge badge-info badge-pill">
                  <span class="badge-dot"></span> Alumna
                </span>
              </td>
              <td>
                <span class="badge badge-warning badge-pill">
                  <span class="badge-dot"></span> No bonificado
                </span>
              </td>
              <td>
                <span class="badge badge-success badge-pill">
                  <span class="badge-dot"></span> Confirmado
                </span>
              </td>
            </tr>
            <tr>
              <td>Carlos Pérez</td>
              <td>c.perez@acme.com</td>
              <td>ACME Ingeniería</td>
              <td>Revit Avanzado · Grupo R24-03</td>
              <td>
                <span class="badge badge-info badge-pill">
                  <span class="badge-dot"></span> Empresa
                </span>
              </td>
              <td>
                <span class="badge badge-success badge-pill">
                  <span class="badge-dot"></span> Bonificado
                </span>
              </td>
              <td>
                <span class="badge badge-success badge-pill">
                  <span class="badge-dot"></span> Confirmado
                </span>
              </td>
            </tr>
            <tr>
              <td>María López</td>
              <td>m.lopez@acme.com</td>
              <td>ACME Ingeniería</td>
              <td>Revit Avanzado · Grupo R24-03</td>
              <td>
                <span class="badge badge-info badge-pill">
                  <span class="badge-dot"></span> Empresa
                </span>
              </td>
              <td>
                <span class="badge badge-success badge-pill">
                  <span class="badge-dot"></span> Bonificado
                </span>
              </td>
              <td>
                <span class="badge badge-warning badge-pill">
                  <span class="badge-dot"></span> Pend. documentación
                </span>
              </td>
            </tr>
            <tr>
              <td>Javier Ruiz</td>
              <td>j.ruiz@constructora-x.com</td>
              <td>Constructora X</td>
              <td>AutoCAD Intensivo · Grupo A24-02</td>
              <td>
                <span class="badge badge-info badge-pill">
                  <span class="badge-dot"></span> Empresa
                </span>
              </td>
              <td>
                <span class="badge badge-warning badge-pill">
                  <span class="badge-dot"></span> No bonificado
                </span>
              </td>
              <td>
                <span class="badge badge-success badge-pill">
                  <span class="badge-dot"></span> Confirmado
                </span>
              </td>
            </tr>
            <tr>
              <td>Andrea Gómez</td>
              <td>andrea.gomez@example.com</td>
              <td>Particular</td>
              <td>SketchUp Básico · Grupo S24-01</td>
              <td>
                <span class="badge badge-info badge-pill">
                  <span class="badge-dot"></span> Alumna
                </span>
              </td>
              <td>
                <span class="badge badge-success badge-pill">
                  <span class="badge-dot"></span> Bonificado</span>
              </td>
              <td>
                <span class="badge badge-warning badge-pill">
                  <span class="badge-dot"></span> Pend. pago
                </span>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="table-footer">
          <div>Mostrando 5 de 32 alumnos</div>
          <div class="pagination">
            <button>&laquo;</button>
            <button class="active">1</button>
            <button>2</button>
            <button>3</button>
            <button>&raquo;</button>
          </div>
        </div>
      </section>
    </main>
  </div>
</body>
</html>
```

### index

```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ERP Formación - Login</title>
  <link rel="stylesheet" href="css/erp.css" />
</head>
<body>
  <div class="login-page">
    <section class="login-hero">
      <div class="login-hero-bg"></div>
      <header class="topbar" style="position: static; background: transparent; border-bottom: none; padding: 0; margin-bottom: 32px;">
        <div class="topbar-brand">
          <!-- Sustituir LOGO_URL_AQUI por el logo real -->
          <img src="logo-ensensyem-240x52.png" alt="Logo" />
          <span>ERP Formación</span>
        </div>
      </header>

      <div class="login-hero-title">
        <h1>Centraliza tus cursos, alumnos y empresas en un solo lugar.</h1>
        <p>Gestión académica, CRM, facturación y FUNDAE bajo el mismo panel, con automatizaciones y reportes en tiempo real.</p>
      </div>

      <div class="login-hero-metrics">
        <div class="login-hero-metric">
          <span>Cursos activos</span>
          <strong>18</strong>
        </div>
        <div class="login-hero-metric">
          <span>Matrículas este mes</span>
          <strong>124</strong>
        </div>
        <div class="login-hero-metric">
          <span>Empresas bonificando</span>
          <strong>9</strong>
        </div>
      </div>

      <div class="login-illustration">
        <div class="login-illustration-bar">
          <div></div><div></div><div></div><div></div>
        </div>
      </div>
    </section>

    <section class="login-form-wrapper">
      <div class="login-form-card card">
        <h2>Accede a tu ERP</h2>
        <p class="login-form-subtitle">Introduce tus credenciales para continuar.</p>

        <form action="modules.html" method="get">
          <div class="form-group">
            <label for="email">Correo electrónico</label>
            <input id="email" type="email" required placeholder="tucorreo@empresa.com" />
          </div>

          <div class="form-group">
            <label for="password">Contraseña</label>
            <input id="password" type="password" required placeholder="••••••••" />
          </div>

          <div class="form-inline">
            <label class="login-remember">
              <input type="checkbox" />
              <span>Recordar sesión</span>
            </label>
            <a href="#" class="btn-link">¿Has olvidado la contraseña?</a>
          </div>

          <button type="submit" class="btn btn-primary" style="width:100%;">
            Entrar al ERP
          </button>

          <p class="login-footer-note">
            Acceso restringido al equipo interno. Si necesitas ayuda, contacta con
            soporte.
          </p>
        </form>
      </div>
    </section>
  </div>
</body>
</html>
```

### modules

```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ERP Formación - Selección de módulos</title>
  <link rel="stylesheet" href="css/erp.css" />
</head>
<body>
  <div class="modules-page">
    <header class="topbar">
      <div class="topbar-brand">
        <img src="logo-ensensyem-240x52.png" alt="Logo" />
        <span>ERP Formación</span>
      </div>
      <div class="topbar-user">
        <span>Administrador</span>
        <div class="topbar-avatar">AD</div>
      </div>
    </header>

    <main class="modules-main">
      <section class="modules-header">
        <div class="modules-header-text">
          <h1>Selecciona un módulo</h1>
          <p>
            Elige qué área quieres gestionar: SIS académico, CRM, marketing,
            facturación o configuración común.
          </p>
        </div>
        <div class="modules-filters">
          <button class="btn btn-secondary">Vista compacta</button>
          <button class="btn btn-primary">Ir al último módulo</button>
        </div>
      </section>

      <section class="modules-grid">
        <a href="dashboard.html" class="module-card">
          <span class="module-chip">Módulo</span>
          <div class="module-name">SIS Académico</div>
          <div class="module-meta">
            <div><span class="module-status-dot"></span>Activo</div>
            <div>Gestión de cursos, grupos, aulas y alumnos.</div>
          </div>
        </a>

        <a href="dashboard.html" class="module-card">
          <span class="module-chip">Módulo</span>
          <div class="module-name">Marketing</div>
          <div class="module-meta">
            <div><span class="module-status-dot"></span>Activo</div>
            <div>Campañas, embudos y automatizaciones.</div>
          </div>
        </a>

        <a href="dashboard.html" class="module-card">
          <span class="module-chip">Módulo</span>
          <div class="module-name">CRM</div>
          <div class="module-meta">
            <div><span class="module-status-dot"></span>Activo</div>
            <div>Leads, empresas y seguimiento comercial.</div>
          </div>
        </a>

        <a href="dashboard.html" class="module-card">
          <span class="module-chip">Módulo</span>
          <div class="module-name">Facturación</div>
          <div class="module-meta">
            <div><span class="module-status-dot"></span>Activo</div>
            <div>Facturas, productos y bonificación FUNDAE.</div>
          </div>
        </a>

        <a href="dashboard.html" class="module-card">
          <span class="module-chip">Módulo</span>
          <div class="module-name">Común / Configuración</div>
          <div class="module-meta">
            <div><span class="module-status-dot"></span>Activo</div>
            <div>Personas, permisos, integraciones y ajustes.</div>
          </div>
        </a>
      </section>
    </main>
  </div>
</body>
</html>
```

<a id="esquemas-wireframes-y-maquetas-mockups"></a>
## Esquemas (Wireframes) y Maquetas (Mockups)

En el mundo digital actual, la creación de interfaces gráficas es un aspecto crucial del desarrollo de aplicaciones. Las interfaces son las primeras interacciones que los usuarios tienen con cualquier software o sistema, por lo que su diseño debe ser cuidadoso y centrado en el usuario. En esta subunidad, nos adentramos en la creación de esquemas (wireframes) y maquetas (mockups), dos herramientas fundamentales para diseñar interfaces gráficas.

Los wireframes son representaciones simples y abstractas de una interfaz gráfica, que muestran la estructura y el flujo de los elementos sin preocuparse por su apariencia visual. Son esencialmente un esbozo rápido y funcional que permite a los diseñadores e ingenieros entender cómo se organizarán los componentes de la interfaz. Los wireframes pueden ser creados con herramientas digitales como Sketch, Adobe XD o incluso con software de edición gráfica tradicional como Photoshop.

Las maquetas, por otro lado, son versiones más detalladas y atractivas de los wireframes. Mientras que los wireframes se enfocan en la funcionalidad y el flujo de la interfaz, las maquetas incorporan elementos visuales y gráficos para dar forma final al diseño. Las maquetas suelen ser creadas con herramientas especializadas como Figma o Adobe XD, que ofrecen una gran variedad de opciones para diseñar interfaces atractivas y funcionales.

La creación de wireframes y maquetas es un proceso iterativo. A menudo, los diseñadores comienzan con un wireframe básico y luego lo refinan en una maqueta más detallada. Este proceso puede implicar varias versiones y modificaciones hasta que se logre un diseño final que cumpla con las necesidades del usuario y las expectativas del proyecto.

Además de la creación de wireframes y maquetas, es importante considerar otros aspectos en el diseño de interfaces gráficas. La usabilidad y accesibilidad son elementos fundamentales que deben ser tenidos en cuenta desde el principio del proceso de diseño. Esto implica asegurarse de que la interfaz sea fácil de usar para todos los usuarios, incluyendo aquellos con discapacidades visuales o motoras.

La creación de wireframes y maquetas es un paso crucial en el desarrollo de interfaces gráficas, ya que permite a los diseñadores e ingenieros visualizar y validar la estructura y el diseño de una interfaz antes de pasar al desarrollo detallado. Este proceso no solo facilita la comunicación entre diferentes equipos del proyecto, sino que también ayuda a identificar problemas potenciales en el diseño temprano en el ciclo de vida del proyecto.

En conclusión, la creación de wireframes y maquetas es una habilidad esencial para cualquier profesional del desarrollo de interfaces gráficas. A través de estos procesos, los diseñadores pueden crear interfaces que sean funcionales, atractivas y accesibles para todos los usuarios. Al seguir un enfoque iterativo y centrado en el usuario, se puede asegurar que las interfaces finales cumplan con las necesidades del proyecto y proporcionen una experiencia óptima al usuario final.

### estilo

```css
/* 
  Estilos globales de toda la web
  Los estilos de cada componente se encuentran dentro de los componentes
*/

body,html{
  padding:0px;
  margin:0px;
  font-family:sans-serif;
}
main{
  width:800px;
  margin:auto;
  padding:20px;
}
```

### index

```
<!doctype html>
<html lang="es">
  <head>
    <title>Poetica 2.0</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="estilo.css">
  </head>
  <body>
    <?php include "componentes/cabecera.php" ?>
    <?php
      if(!isset($_GET['p'])){
        include "componentes/home.php";
      }else{
        switch($_GET['p']){
          case "poemas":
            include "componentes/poemas.php";
            break;
          case "poema":
            include "componentes/poema.php";
            break;
          case "actores":
            include "componentes/actores.php";
            break;
          default:
            include "componentes/404.php";
        }
      }
    ?>  
    <?php include "componentes/piedepagina.php" ?>
  </body>
</html>
```

<a id="pautas-de-diseno-de-la-estructura-de-la-interfaz-de-usuario"></a>
## Pautas de diseño de la estructura de la interfaz de usuario

El diseño de interfaces gráficas es un aspecto fundamental del desarrollo de aplicaciones, ya que afecta directamente la experiencia del usuario final. En esta subunidad, nos centraremos en las pautas de diseño de la estructura de la interfaz de usuario, entendiendo cómo crear interfaces intuitivas y eficientes.

La estructura de una interfaz de usuario debe ser coherente y predecible para que los usuarios puedan navegar fácilmente a través del sistema. Una buena práctica es seguir un enfoque jerárquico, donde los elementos más importantes están al principio y los menos importantes se colocan hacia abajo. Esta organización permite que los usuarios encuentren rápidamente lo que buscan sin necesidad de desplazarse por toda la interfaz.

Además, la disposición de los elementos en la pantalla debe ser lógica y coherente con el flujo de trabajo del usuario. Por ejemplo, si una aplicación es utilizada para gestionar tareas diarias, es probable que los elementos relacionados con las tareas estén agrupados juntos en un área separada. Esta organización facilita la comprensión y uso de la interfaz.

La simplicidad es clave en el diseño de interfaces gráficas. Evitar demasiado contenido o elementos complicados puede hacer que la interfaz sea confusa y difíciles de usar. En su lugar, se debe enfocarse en presentar solo los elementos esenciales y permitir que los usuarios accedan a las funcionalidades adicionales cuando lo deseen.

La consistencia en el diseño también es fundamental. Esto incluye no solo la disposición de los elementos en la pantalla, sino también las características comunes entre diferentes pantallas o secciones del sistema. Por ejemplo, si una aplicación utiliza un menú desplegable para navegar por las diferentes opciones, este diseño debe ser consistente en todas las partes de la interfaz.

El uso de colores y tipografías adecuados es otro aspecto importante del diseño de interfaces gráficas. Los colores pueden ayudar a destacar elementos importantes o categorizar información, mientras que las fuentes legibles facilitan la lectura y comprensión del contenido. Es crucial elegir una paleta de colores y tipografías que sean amigables para el usuario y que no interfieran con su capacidad para interactuar con la interfaz.

La accesibilidad es un aspecto cada vez más importante en el diseño de interfaces gráficas, especialmente cuando se considera a usuarios con discapacidades visuales o motoras. Esto incluye proporcionar alternativas de texto para imágenes, asegurarse de que los elementos sean accesibles mediante teclado y garantizar que la interfaz sea legible en diferentes tamaños de pantalla.

El diseño responsivo es otro concepto clave en el desarrollo moderno de interfaces gráficas. Este enfoque permite que las aplicaciones se adapten a diferentes dispositivos y tamaños de pantalla, desde pantallas de escritorio hasta teléfonos móviles. Una interfaz diseñada de manera responsiva asegura una buena experiencia de usuario independientemente del dispositivo utilizado.

La retroalimentación visual es un elemento importante en el diseño de interfaces gráficas. Al permitir que los usuarios vean claramente cómo interactúan con la aplicación, se facilita la comprensión y uso de las funcionalidades. Esto puede incluir efectos visuales como resaltado de elementos seleccionados o animaciones que indican el progreso en una tarea.

En conclusión, el diseño de interfaces gráficas es un proceso integral que requiere consideración cuidadosa en todas sus fases. Al seguir pautas de diseño coherente y lógica, mantener la simplicidad, asegurar la consistencia, utilizar colores y tipografías adecuadas, considerar la accesibilidad y el diseño responsivo, y proporcionar retroalimentación visual efectiva, se puede crear interfaces gráficas que no solo sean estéticamente atractivas, sino también funcionales y eficientes para los usuarios.

### maestro

```
<!doctype html>
<html lang="es">
  <head>
    <title></title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="estilo.php">
  </head>
  <body>
    <?php include "componentes/cabecera.php"; ?>
    <?php include "componentes/layout.php"; ?>
  </body>
  
</html>
```

### estilo

```
<?php include "funcionescss.php" ?>
:root {
  --colorprincipal:           <?= $baseHex ?>;
  --colorprincipal_claro:     <?= $baseLightHex ?>;
  --colorprincipal_claro2:    <?= $baseLighterHex ?>;
  --colorprincipal_oscuro:    <?= $baseDarkHex ?>;
  --colorprincipal_oscuro2:   <?= $baseDarkerHex ?>;

  --complementario:               <?= $compHex ?>;
  --complementario_suave:         <?= $compSoftHex ?>;
  --complementario_suave2:        <?= $compSofterHex ?>;
  --complementario_luminoso:      <?= $compBrightHex ?>;
  --complementario_oscuro:        <?= $compDarkHex ?>;
  --complementario_oscuro2:       <?= $compDarkerHex ?>;

  --hueco: 15px;
  
  --radio_empalme: 10px;
}

@import url('https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap');
body,html{
  padding:0px;
  margin:0px;
  width:100%;
  height:100%;
  font-family:ubuntu,sans-serif;
  background:var(--colorprincipal);
}
button{
  border:0px;
  border-radius:var(--radio_empalme);
  padding:5px;
  min-width:80px;
}
```

### funcionescss

```
<?php
// Enlaza este archivo como si fuera un CSS:
// <link rel="stylesheet" href="colores.php?color=008080">
header("Content-Type: text/css; charset=utf-8");

// Color por defecto (teal) si no se pasa nada o es inválido
$inputColor = isset($_GET['color']) ? $_GET['color'] : '#B0C4DE';

// ========================
// Helpers básicos
// ========================
function normalizeHexColor($hex) {
    $hex = trim($hex);
    if ($hex[0] != '#') {
        $hex = '#'.$hex;
    }
    // 3 dígitos → 6 dígitos
    if (strlen($hex) == 4) {
        $r = str_repeat($hex[1], 2);
        $g = str_repeat($hex[2], 2);
        $b = str_repeat($hex[3], 2);
        $hex = '#'.$r.$g.$b;
    }
    // Validar
    if (!preg_match('/^#[0-9A-Fa-f]{6}$/', $hex)) {
        return '#008080'; // teal por defecto
    }
    return strtoupper($hex);
}

function hexToRgb($hex) {
    $hex = ltrim($hex, '#');
    return [
        'r' => hexdec(substr($hex, 0, 2)),
        'g' => hexdec(substr($hex, 2, 2)),
        'b' => hexdec(substr($hex, 4, 2)),
    ];
}

function rgbToHex($r, $g, $b) {
    return sprintf("#%02X%02X%02X", $r, $g, $b);
}

// ========================
// RGB ↔ HSL
// ========================
function rgbToHsl($r, $g, $b) {
    $r /= 255;
    $g /= 255;
    $b /= 255;

    $max = max($r, $g, $b);
    $min = min($r, $g, $b);
    $h = $s = $l = ($max + $min) / 2;

    if ($max == $min) {
        $h = $s = 0; // gris
    } else {
        $d = $max - $min;
        $s = $l > 0.5 ? $d / (2 - $max - $min) : $d / ($max + $min);

        if ($max == $r) {
            $h = ($g - $b) / $d + ($g < $b ? 6 : 0);
        } elseif ($max == $g) {
            $h = ($b - $r) / $d + 2;
        } else {
            $h = ($r - $g) / $d + 4;
        }
        $h /= 6;
    }

    return [
        'h' => $h * 360,     // 0–360
        's' => $s * 100,     // 0–100
        'l' => $l * 100      // 0–100
    ];
}

function hslToRgb($h, $s, $l) {
    $h /= 360;
    $s /= 100;
    $l /= 100;

    $r = $g = $b = 0;

    if ($s == 0) {
        $r = $g = $b = $l; // gris
    } else {
        $q = $l < 0.5 ? $l * (1 + $s) : $l + $s - $l * $s;
        $p = 2 * $l - $q;

        $r = hueToRgb($p, $q, $h + 1/3);
        $g = hueToRgb($p, $q, $h);
        $b = hueToRgb($p, $q, $h - 1/3);
    }

    return [
        'r' => round($r * 255),
        'g' => round($g * 255),
        'b' => round($b * 255)
    ];
}

function hueToRgb($p, $q, $t) {
    if ($t < 0) $t += 1;
    if ($t > 1) $t -= 1;
    if ($t < 1/6) return $p + ($q - $p) * 6 * $t;
    if ($t < 1/2) return $q;
    if ($t < 2/3) return $p + ($q - $p) * (2/3 - $t) * 6;
    return $p;
}

// ========================
// Helpers HSL
// ========================
function clamp($value, $min, $max) {
    return max($min, min($max, $value));
}

function adjustLightness($hsl, $deltaL) {
    $hsl['l'] = clamp($hsl['l'] + $deltaL, 0, 100);
    return $hsl;
}

function adjustSaturation($hsl, $deltaS) {
    $hsl['s'] = clamp($hsl['s'] + $deltaS, 0, 100);
    return $hsl;
}

// ========================
// Cálculos de colores
// ========================
$baseHex = normalizeHexColor($inputColor);
$baseRgb = hexToRgb($baseHex);
$baseHsl = rgbToHsl($baseRgb['r'], $baseRgb['g'], $baseRgb['b']);

// Complementario: hue + 180º
$compHsl = $baseHsl;
$compHsl['h'] = fmod($compHsl['h'] + 180, 360);

// Matices principal
$baseLightHsl      = adjustLightness($baseHsl, +15); // claro
$baseLighterHsl    = adjustLightness($baseHsl, +30); // más claro
$baseDarkHsl       = adjustLightness($baseHsl, -15); // oscuro
$baseDarkerHsl     = adjustLightness($baseHsl, -30); // más oscuro

// Complementarios suaves/luminosos y más tonos
$compSoftHsl       = adjustLightness(adjustSaturation($compHsl, -15), +10);
$compSofterHsl     = adjustLightness(adjustSaturation($compHsl, -25), +20);
$compBrightHsl     = adjustLightness(adjustSaturation($compHsl, -25), +35);
$compDarkHsl       = adjustLightness($compHsl, -20);
$compDarkerHsl     = adjustLightness($compHsl, -35);

// Convertir todo a RGB
$compRgb           = hslToRgb($compHsl['h'],       $compHsl['s'],       $compHsl['l']);
$baseLightRgb      = hslToRgb($baseLightHsl['h'],  $baseLightHsl['s'],  $baseLightHsl['l']);
$baseLighterRgb    = hslToRgb($baseLighterHsl['h'],$baseLighterHsl['s'],$baseLighterHsl['l']);
$baseDarkRgb       = hslToRgb($baseDarkHsl['h'],   $baseDarkHsl['s'],   $baseDarkHsl['l']);
$baseDarkerRgb     = hslToRgb($baseDarkerHsl['h'], $baseDarkerHsl['s'], $baseDarkerHsl['l']);
$compSoftRgb       = hslToRgb($compSoftHsl['h'],   $compSoftHsl['s'],   $compSoftHsl['l']);
$compSofterRgb     = hslToRgb($compSofterHsl['h'], $compSofterHsl['s'], $compSofterHsl['l']);
$compBrightRgb     = hslToRgb($compBrightHsl['h'], $compBrightHsl['s'], $compBrightHsl['l']);
$compDarkRgb       = hslToRgb($compDarkHsl['h'],   $compDarkHsl['s'],   $compDarkHsl['l']);
$compDarkerRgb     = hslToRgb($compDarkerHsl['h'], $compDarkerHsl['s'], $compDarkerHsl['l']);

// Convertir todo a HEX
$compHex           = rgbToHex($compRgb['r'],       $compRgb['g'],       $compRgb['b']);
$baseLightHex      = rgbToHex($baseLightRgb['r'],  $baseLightRgb['g'],  $baseLightRgb['b']);
$baseLighterHex    = rgbToHex($baseLighterRgb['r'],$baseLighterRgb['g'],$baseLighterRgb['b']);
$baseDarkHex       = rgbToHex($baseDarkRgb['r'],   $baseDarkRgb['g'],   $baseDarkRgb['b']);
$baseDarkerHex     = rgbToHex($baseDarkerRgb['r'], $baseDarkerRgb['g'], $baseDarkerRgb['b']);
$compSoftHex       = rgbToHex($compSoftRgb['r'],   $compSoftRgb['g'],   $compSoftRgb['b']);
$compSofterHex     = rgbToHex($compSofterRgb['r'], $compSofterRgb['g'], $compSofterRgb['b']);
$compBrightHex     = rgbToHex($compBrightRgb['r'], $compBrightRgb['g'], $compBrightRgb['b']);
$compDarkHex       = rgbToHex($compDarkRgb['r'],   $compDarkRgb['g'],   $compDarkRgb['b']);
$compDarkerHex     = rgbToHex($compDarkerRgb['r'], $compDarkerRgb['g'], $compDarkerRgb['b']);

?>
```

<a id="pautas-de-diseno-del-aspecto-de-la-interfaz-de-usuario"></a>
## Pautas de diseño del aspecto de la interfaz de usuario

En el diseño de interfaces gráficas, un aspecto crucial es la pauta del aspecto de la interfaz de usuario (UI). Esta fase se centra en cómo los elementos visuales interactúan con el usuario, influyendo significativamente en la experiencia y la eficiencia de la misma. Comenzamos por entender que la UI debe ser intuitiva y atractiva, lo que significa que los usuarios deben poder entender fácilmente qué hacer sin necesidad de instrucciones adicionales.

La pauta del aspecto de la interfaz de usuario implica el uso de colores, fuentes, tamaños de texto y estilos gráficos que sean coherentes y atractivos. Los colores juegan un papel fundamental en la percepción del usuario, ya que pueden transmitir emociones y estados de ánimo. Por ejemplo, los tonos cálidos como el rojo y el amarillo pueden dar sensación de energía o urgencia, mientras que los tonos fríos como el azul y el verde pueden sugerir tranquilidad y confianza.

Las fuentes elegidas también son cruciales, ya que deben ser legibles y agradables al ojo. Es importante seleccionar fuentes que sean fáciles de leer en diferentes tamaños y contextos, considerando tanto la estética como la accesibilidad para usuarios con discapacidades visuales.

El tamaño de los elementos gráficos y el espacio entre ellos también son pautas importantes. Un diseño bien estructurado con suficiente espacio entre los elementos facilita la navegación y mejora la comprensión del usuario. Además, el uso de tamaños uniformes para los botones, etiquetas y campos de entrada contribuye a una sensación de coherencia y profesionalismo.

La pauta del aspecto también incluye la consideración de la accesibilidad. Esto significa diseñar interfaces que sean utilizables por personas con diferentes capacidades sensoriales y motoras. Por ejemplo, el uso de contraste suficiente entre los colores de fondo y texto, la posibilidad de cambiar las fuentes y tamaños, y la inclusión de opciones para leer el contenido a voz alta son aspectos clave de la accesibilidad.

Además, es importante considerar la adaptabilidad del diseño. Las interfaces gráficas deben ser flexibles y funcionar bien en diferentes dispositivos y tamaños de pantalla. Esto implica utilizar técnicas como la responsividad web y el diseño adaptable para asegurar que la interfaz sea visualmente atractiva y funcional en pantallas pequeñas, medianas y grandes.

La pauta del aspecto también aborda la consistencia en el diseño. Los usuarios esperan que los elementos de una interfaz sean consistentes con lo que ya conocen, para evitar confusiones y mejorar la eficiencia. Esto significa usar un conjunto uniforme de colores, fuentes, estilos y iconos a lo largo de toda la aplicación.

Por último, pero no menos importante, la pauta del aspecto de la interfaz de usuario debe ser centrada en el usuario. El diseño debe ser intuitivo y fácil de usar, sin necesidad de instrucciones adicionales. Los usuarios deben poder entender qué hacer simplemente observando la interfaz, lo que facilita su adquisición de habilidades y mejora su experiencia general con la aplicación.

En resumen, la pauta del aspecto de la interfaz de usuario es un componente fundamental del diseño gráfico, influenciando significativamente la experiencia del usuario. Al seguir las mejores prácticas en esta área, se pueden crear interfaces que sean atractivas, intuitivas y accesibles, mejorando así la satisfacción del usuario y la eficiencia de la aplicación.

### index

```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jocarsa | dia - Editor de diagramas</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="toolbar">
        <div class="brand">
            <span class="brand-main">jocarsa</span>
            <span class="brand-separator">|</span>
            <span class="brand-variant">dia</span>
        </div>

        <div class="toolbar-section-label">Formas</div>
        <div class="tool" draggable="true" data-shape="rectangle">Rectángulo</div>
        <div class="tool" draggable="true" data-shape="pill">Píldora</div>
        <div class="tool" draggable="true" data-shape="circle">Círculo</div>

        <div class="toolbar-section-label">Conexiones</div>
        <div class="tool" data-shape="arrow">Flecha →</div>
        <div class="tool" data-shape="bidirectional">↔ Bidireccional</div>

        <div class="toolbar-section-label">Diagrama</div>
        <button id="saveBtn">Guardar diagrama</button>
        <button id="uploadBtn" class="secondary">Cargar diagrama</button>
        <input type="file" id="uploadInput" accept=".json" style="display: none;">
    </div>

    <div class="stage-wrapper">
        <div class="stage-header">
            <span class="stage-title">Lienzo</span>
            <span class="stage-subtitle">Arrastra, conecta y anota tus ideas</span>
        </div>
        <div class="stage" id="stage"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
```

### script

```javascript
document.addEventListener('DOMContentLoaded', () => {
    const stage = document.getElementById('stage');
    const tools = document.querySelectorAll('.tool');
    const saveBtn = document.getElementById('saveBtn');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadInput = document.getElementById('uploadInput');

    // Contenedor interno para poder aplicar transform (pan/zoom)
    const stageInner = document.createElement('div');
    stageInner.classList.add('stage-inner');
    stage.appendChild(stageInner);

    let modoFlechaActivo = false;
    let tipoFlecha = 'simple'; // 'simple' | 'doble'
    let formaInicioSeleccionada = null;
    let formaFinSeleccionada = null;
    let flechas = [];
    let contadorFormas = 0;

    // Pan / zoom del lienzo
    let stageScale = 1;
    let stageOffsetX = 0;
    let stageOffsetY = 0;
    const stageMinScale = 0.2;
    const stageMaxScale = 3;

    let isPanning = false;
    let panStartX = 0;
    let panStartY = 0;
    let panStartOffsetX = 0;
    let panStartOffsetY = 0;

    // Selección para borrado
    let elementoSeleccionado = null;

    function updateStageTransform() {
        stageInner.style.transform =
            `translate(${stageOffsetX}px, ${stageOffsetY}px) scale(${stageScale})`;
    }

    function generarIdForma() {
        return `forma-${++contadorFormas}`;
    }

    /* ===== Herramientas ===== */

    tools.forEach(tool => {
        // Arrastre de formas
        tool.addEventListener('dragstart', (e) => {
            const shape = tool.dataset.shape;
            if (shape === 'rectangle' || shape === 'pill' || shape === 'circle') {
                e.dataTransfer.setData('shape', shape);
            }
        });

        // Clic en herramienta
        tool.addEventListener('click', () => {
            tools.forEach(t => t.classList.remove('active'));
            const shapeType = tool.dataset.shape;

            if (shapeType === 'arrow' || shapeType === 'bidirectional') {
                modoFlechaActivo = true;
                tipoFlecha = (shapeType === 'bidirectional') ? 'doble' : 'simple';
                stage.style.cursor = 'crosshair';
                tool.classList.add('active');

                formaInicioSeleccionada = null;
                formaFinSeleccionada = null;
                document.querySelectorAll('.shape').forEach(forma => {
                    forma.classList.remove('selected');
                });
            } else {
                modoFlechaActivo = false;
                stage.style.cursor = 'grab';
            }
        });
    });

    /* ===== Selección de formas y flechas + conexión ===== */

    stage.addEventListener('click', (e) => {
        const formaClicada = e.target.closest('.shape');
        const flechaClicada = e.target.closest('.arrow');

        if (modoFlechaActivo) {
            // Modo conexión: seleccionar dos formas y crear flecha
            if (!formaClicada) return;

            if (!formaInicioSeleccionada) {
                formaInicioSeleccionada = formaClicada;
                formaClicada.classList.add('selected');
            } else if (!formaFinSeleccionada && formaClicada !== formaInicioSeleccionada) {
                formaFinSeleccionada = formaClicada;
                formaClicada.classList.add('selected');

                crearFlecha(formaInicioSeleccionada, formaFinSeleccionada, tipoFlecha);

                formaInicioSeleccionada.classList.remove('selected');
                formaFinSeleccionada.classList.remove('selected');
                formaInicioSeleccionada = null;
                formaFinSeleccionada = null;

                // Salir de modo flecha después de crear una
                modoFlechaActivo = false;
                stage.style.cursor = 'grab';
                tools.forEach(t => t.classList.remove('active'));
            }
            return;
        }

        // Modo normal: selección para borrar
        limpiarSeleccion();
        if (formaClicada) {
            elementoSeleccionado = formaClicada;
            formaClicada.classList.add('selected');
        } else if (flechaClicada) {
            elementoSeleccionado = flechaClicada;
            flechaClicada.classList.add('selected');
        } else {
            elementoSeleccionado = null;
        }
    });

    function limpiarSeleccion() {
        document.querySelectorAll('.shape.selected, .arrow.selected')
            .forEach(el => el.classList.remove('selected'));
    }

    /* ===== Creación y actualización de flechas ===== */

    function crearFlecha(formaInicio, formaFin, tipo = 'simple') {
        const flecha = document.createElement('div');
        flecha.classList.add('arrow');
        if (tipo === 'doble') {
            flecha.classList.add('arrow-double');
        }

        stageInner.appendChild(flecha);

        const objFlecha = {
            flecha,
            formaInicio,
            formaFin,
            tipo,
            manejadorMovimiento: null
        };

        const manejadorMovimiento = () =>
            actualizarPosicionFlecha(objFlecha.flecha, objFlecha.formaInicio, objFlecha.formaFin);

        objFlecha.manejadorMovimiento = manejadorMovimiento;
        flechas.push(objFlecha);

        formaInicio.manejadoresMovimiento = formaInicio.manejadoresMovimiento || [];
        formaFin.manejadoresMovimiento = formaFin.manejadoresMovimiento || [];
        formaInicio.manejadoresMovimiento.push(manejadorMovimiento);
        formaFin.manejadoresMovimiento.push(manejadorMovimiento);

        actualizarPosicionFlecha(flecha, formaInicio, formaFin);
    }

    // Calcula el punto en el borde de un rectángulo en la dirección (haciaX, haciaY)
    function puntoEnBorde(cx, cy, rectWidth, rectHeight, tx, ty) {
        const dx = tx - cx;
        const dy = ty - cy;
        const absDx = Math.abs(dx);
        const absDy = Math.abs(dy);

        if (absDx === 0 && absDy === 0) {
            return { x: cx, y: cy };
        }

        const halfW = rectWidth / 2;
        const halfH = rectHeight / 2;

        const scale = 1 / Math.max(absDx / halfW, absDy / halfH);
        return {
            x: cx + dx * scale,
            y: cy + dy * scale
        };
    }

    function actualizarPosicionFlecha(flecha, formaInicio, formaFin) {
        const rectInicio = formaInicio.getBoundingClientRect();
        const rectFin = formaFin.getBoundingClientRect();
        const rectStage = stage.getBoundingClientRect();

        // Coordenadas de centro en pantalla relativas al stage
        const centroInicioScreenX = rectInicio.left + rectInicio.width / 2 - rectStage.left;
        const centroInicioScreenY = rectInicio.top + rectInicio.height / 2 - rectStage.top;
        const centroFinScreenX = rectFin.left + rectFin.width / 2 - rectStage.left;
        const centroFinScreenY = rectFin.top + rectFin.height / 2 - rectStage.top;

        // Pasar a coordenadas "mundo" (stageInner antes de transform)
        const centroInicioX = (centroInicioScreenX - stageOffsetX) / stageScale;
        const centroInicioY = (centroInicioScreenY - stageOffsetY) / stageScale;
        const centroFinX = (centroFinScreenX - stageOffsetX) / stageScale;
        const centroFinY = (centroFinScreenY - stageOffsetY) / stageScale;

        const anchoInicio = rectInicio.width / stageScale;
        const altoInicio = rectInicio.height / stageScale;
        const anchoFin = rectFin.width / stageScale;
        const altoFin = rectFin.height / stageScale;

        const bordeInicio = puntoEnBorde(
            centroInicioX,
            centroInicioY,
            anchoInicio,
            altoInicio,
            centroFinX,
            centroFinY
        );

        const bordeFin = puntoEnBorde(
            centroFinX,
            centroFinY,
            anchoFin,
            altoFin,
            centroInicioX,
            centroInicioY
        );

        const dx = bordeFin.x - bordeInicio.x;
        const dy = bordeFin.y - bordeInicio.y;
        const longitud = Math.sqrt(dx * dx + dy * dy);

        if (longitud === 0) {
            flecha.style.width = '0px';
            return;
        }

        const angulo = Math.atan2(dy, dx);

        flecha.style.left = `${bordeInicio.x}px`;
        flecha.style.top = `${bordeInicio.y}px`;
        flecha.style.width = `${longitud}px`;
        flecha.style.transform = `rotate(${angulo}rad)`;
    }

    /* ===== Lienzo: soltar formas ===== */

    stage.addEventListener('dragover', (e) => {
        e.preventDefault();
    });

    stage.addEventListener('drop', (e) => {
        e.preventDefault();
        if (modoFlechaActivo) return;

        const tipoForma = e.dataTransfer.getData('shape');
        if (!tipoForma) return;

        const rectStage = stage.getBoundingClientRect();
        const sx = e.clientX - rectStage.left;
        const sy = e.clientY - rectStage.top;

        // Convertir a coordenadas mundo (antes de transform)
        const worldX = (sx - stageOffsetX) / stageScale;
        const worldY = (sy - stageOffsetY) / stageScale;

        const forma = document.createElement('div');
        forma.id = generarIdForma();
        forma.classList.add('shape', tipoForma);

        // Los 70/35 originales como "semi-tamaño" de la forma
        forma.style.left = `${worldX - 70}px`;
        forma.style.top = `${worldY - 35}px`;
        forma.contentEditable = 'false';

        stageInner.appendChild(forma);
        hacerArrastrable(forma);
        prepararEdicionTexto(forma);
    });

    function prepararEdicionTexto(forma) {
        forma.addEventListener('dblclick', () => {
            forma.contentEditable = 'true';
            forma.focus();
        });

        forma.addEventListener('blur', () => {
            forma.contentEditable = 'false';
        });
    }

    /* ===== Arrastre de formas ===== */

    function hacerArrastrable(elemento) {
        let offsetX, offsetY, arrastrando = false;

        elemento.addEventListener('mousedown', (e) => {
            if (e.target === elemento && !modoFlechaActivo) {
                arrastrando = true;
                const rect = elemento.getBoundingClientRect();
                offsetX = e.clientX - rect.left;  // pantalla
                offsetY = e.clientY - rect.top;   // pantalla
                elemento.style.cursor = 'grabbing';
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (!arrastrando) return;
            const rectStage = stage.getBoundingClientRect();
            const sx = e.clientX - rectStage.left;
            const sy = e.clientY - rectStage.top;

            // Pasar a mundo, compensando pan/zoom y el offset de ratón
            const worldX = ((sx - stageOffsetX) / stageScale) - (offsetX / stageScale);
            const worldY = ((sy - stageOffsetY) / stageScale) - (offsetY / stageScale);

            elemento.style.left = `${worldX}px`;
            elemento.style.top = `${worldY}px`;

            if (elemento.manejadoresMovimiento) {
                elemento.manejadoresMovimiento.forEach(fn => fn());
            }
        });

        document.addEventListener('mouseup', () => {
            if (arrastrando) {
                arrastrando = false;
                elemento.style.cursor = 'move';
            }
        });
    }

    /* ===== Pan del stage ===== */

    stage.addEventListener('mousedown', (e) => {
        // Si se ha hecho clic en una forma o flecha, no pan
        if (e.target.closest('.shape') || e.target.closest('.arrow')) return;
        // Si estamos en modo flecha, tampoco pan
        if (modoFlechaActivo) return;

        isPanning = true;
        stage.classList.add('panning');
        panStartX = e.clientX;
        panStartY = e.clientY;
        panStartOffsetX = stageOffsetX;
        panStartOffsetY = stageOffsetY;
    });

    document.addEventListener('mousemove', (e) => {
        if (!isPanning) return;
        const dx = e.clientX - panStartX;
        const dy = e.clientY - panStartY;
        stageOffsetX = panStartOffsetX + dx;
        stageOffsetY = panStartOffsetY + dy;
        updateStageTransform();
    });

    document.addEventListener('mouseup', () => {
        if (isPanning) {
            isPanning = false;
            stage.classList.remove('panning');
        }
    });

    /* ===== Zoom con rueda ===== */

    stage.addEventListener('wheel', (e) => {
        e.preventDefault();

        const rectStage = stage.getBoundingClientRect();
        const sx = e.clientX - rectStage.left;
        const sy = e.clientY - rectStage.top;

        const delta = e.deltaY < 0 ? 0.1 : -0.1;
        let newScale = stageScale + delta;
        newScale = Math.max(stageMinScale, Math.min(stageMaxScale, newScale));
        if (newScale === stageScale) return;

        // Punto del mundo bajo el cursor antes del zoom
        const worldX = (sx - stageOffsetX) / stageScale;
        const worldY = (sy - stageOffsetY) / stageScale;

        stageScale = newScale;

        // Reajustar offset para mantener el punto bajo el cursor
        stageOffsetX = sx - worldX * stageScale;
        stageOffsetY = sy - worldY * stageScale;

        updateStageTransform();
        // Recalcular flechas después del zoom
        flechas.forEach(f =>
            actualizarPosicionFlecha(f.flecha, f.formaInicio, f.formaFin)
        );
    });

    /* ===== Borrado con tecla Supr/Delete ===== */

    document.addEventListener('keydown', (e) => {
        if (e.key !== 'Delete') return;
        if (!elementoSeleccionado) return;

        // Si es una flecha
        if (elementoSeleccionado.classList.contains('arrow')) {
            const obj = flechas.find(f => f.flecha === elementoSeleccionado);
            if (obj) {
                eliminarFlecha(obj);
            } else {
                elementoSeleccionado.remove();
            }
            elementoSeleccionado = null;
            return;
        }

        // Si es una forma
        if (elementoSeleccionado.classList.contains('shape')) {
            // Eliminar flechas asociadas
            const relacionadas = flechas.filter(f =>
                f.formaInicio === elementoSeleccionado ||
                f.formaFin === elementoSeleccionado
            );
            relacionadas.forEach(eliminarFlecha);

            elementoSeleccionado.remove();
            elementoSeleccionado = null;
        }
    });

    function eliminarFlecha(objFlecha) {
        const { flecha, formaInicio, formaFin, manejadorMovimiento } = objFlecha;
        flecha.remove();

        // eliminar manejadores de movimiento asociados
        if (formaInicio.manejadoresMovimiento) {
            formaInicio.manejadoresMovimiento =
                formaInicio.manejadoresMovimiento.filter(fn => fn !== manejadorMovimiento);
        }
        if (formaFin.manejadoresMovimiento) {
            formaFin.manejadoresMovimiento =
                formaFin.manejadoresMovimiento.filter(fn => fn !== manejadorMovimiento);
        }

        flechas = flechas.filter(f => f !== objFlecha);
    }

    /* ===== Guardar diagrama ===== */

    saveBtn.addEventListener('click', () => {
        const formas = [];
        stageInner.querySelectorAll('.shape').forEach(el => {
            const forma = {
                id: el.id,
                tipo: Array.from(el.classList).find(cls => ['rectangle', 'pill', 'circle'].includes(cls)),
                left: el.style.left,
                top: el.style.top,
                width: el.style.width,
                height: el.style.height,
                texto: el.textContent
            };
            formas.push(forma);
        });

        const datosFlechas = flechas.map(f => ({
            idInicio: f.formaInicio.id,
            idFin: f.formaFin.id,
            tipo: f.tipo || 'simple'
        }));

        const datos = JSON.stringify({ formas, flechas: datosFlechas }, null, 2);
        const blob = new Blob([datos], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'diagrama.json';
        a.click();
        URL.revokeObjectURL(url);
    });

    /* ===== Cargar diagrama ===== */

    uploadBtn.addEventListener('click', () => {
        uploadInput.click();
    });

    uploadInput.addEventListener('change', (e) => {
        const archivo = e.target.files[0];
        if (!archivo) return;

        const reader = new FileReader();
        reader.onload = (evento) => {
            const { formas, flechas: datosFlechas } = JSON.parse(evento.target.result);
            stageInner.innerHTML = '';
            flechas = [];
            contadorFormas = 0;
            elementoSeleccionado = null;
            formaInicioSeleccionada = null;
            formaFinSeleccionada = null;

            const mapaFormas = {};

            formas.forEach(forma => {
                const el = document.createElement('div');
                el.id = forma.id || generarIdForma();
                el.classList.add('shape', forma.tipo);
                el.style.left = forma.left;
                el.style.top = forma.top;
                if (forma.width) el.style.width = forma.width;
                if (forma.height) el.style.height = forma.height;
                el.textContent = forma.texto || '';
                stageInner.appendChild(el);
                hacerArrastrable(el);
                prepararEdicionTexto(el);

                mapaFormas[el.id] = el;
            });

            if (Array.isArray(datosFlechas)) {
                datosFlechas.forEach(df => {
                    const formaInicio = mapaFormas[df.idInicio];
                    const formaFin = mapaFormas[df.idFin];
                    const tipo = df.tipo || 'simple';
                    if (formaInicio && formaFin) {
                        crearFlecha(formaInicio, formaFin, tipo);
                    }
                });
            }

            // Restaurar transform por si se había pan/zoom
            stageScale = 1;
            stageOffsetX = 0;
            stageOffsetY = 0;
            updateStageTransform();
        };
        reader.readAsText(archivo);
    });

    // Inicializar transform
    updateStageTransform();
});
```

### styles

```css
:root {
    /* Identidad monocromática jocarsa | dia */
    --dia-bg: #f3f4f6;
    --dia-panel: #ffffff;
    --dia-border-subtle: #d1d5db;
    --dia-border-strong: #111827;

    --dia-primary: #111827;      /* casi negro */
    --dia-primary-soft: #e5e7eb;

    --dia-text-primary: #111827;
    --dia-text-muted: #6b7280;

    --dia-shape-bg: #ffffff;
    --dia-shape-border-rect: #111827;
    --dia-shape-border-pill: #111827;
    --dia-shape-border-circle: #111827;

    --dia-shadow-soft: 0 14px 35px rgba(15, 23, 42, 0.14);
}

/* Reset básico */
*,
*::before,
*::after {
    box-sizing: border-box;
}

body {
    margin: 0;
    height: 100vh;
    display: flex;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: var(--dia-text-primary);
    background:
        radial-gradient(circle at top left, #e5e7eb 0, transparent 55%),
        radial-gradient(circle at bottom right, #d1d5db 0, transparent 50%),
        linear-gradient(135deg, #f3f4f6, #f9fafb);
}

/* Barra lateral */

.toolbar {
    width: 230px;
    padding: 18px 16px;
    border-right: 1px solid var(--dia-border-subtle);
    background: var(--dia-panel);
    box-shadow: 8px 0 30px rgba(15, 23, 42, 0.06);
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* Branding jocarsa | dia */

.brand {
    display: flex;
    align-items: baseline;
    gap: 4px;
    margin-bottom: 12px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--dia-border-subtle);
}

.brand-main {
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    font-size: 0.92rem;
    color: var(--dia-text-primary);
}

.brand-separator {
    color: var(--dia-text-muted);
}

.brand-variant {
    font-size: 0.9rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--dia-text-muted);
}

.toolbar-section-label {
    margin-top: 8px;
    margin-bottom: 4px;
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--dia-text-muted);
}

/* Herramientas */

.tool {
    padding: 8px 10px;
    margin: 2px 0;
    background: #f9fafb;
    border-radius: 999px;
    border: 1px solid var(--dia-border-subtle);
    cursor: grab;
    text-align: left;
    font-size: 0.85rem;
    color: var(--dia-text-primary);
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition:
        background 0.12s ease,
        border-color 0.12s ease,
        box-shadow 0.12s ease,
        transform 0.08s ease;
}

.tool::after {
    content: "⋯";
    font-size: 0.78rem;
    color: var(--dia-text-muted);
}

.tool[data-shape="arrow"],
.tool[data-shape="bidirectional"] {
    cursor: pointer;
    background: #f3f4f6;
}

.tool:hover {
    background: #ffffff;
    border-color: var(--dia-border-strong);
    box-shadow: 0 0 0 1px rgba(17, 24, 39, 0.1);
    transform: translateY(-1px);
}

.tool.active {
    background: #ffffff;
    border-color: var(--dia-border-strong);
    box-shadow: 0 0 0 1px rgba(17, 24, 39, 0.22);
}

/* Contenedor del lienzo */

.stage-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 18px 18px 18px 12px;
}

.stage-header {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid var(--dia-border-subtle);
    background: #ffffff;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
}

.stage-title {
    font-size: 0.9rem;
    font-weight: 600;
}

.stage-subtitle {
    font-size: 0.75rem;
    color: var(--dia-text-muted);
}

/* Lienzo */

.stage {
    flex: 1;
    border-radius: 16px;
    border: 1px solid var(--dia-border-subtle);
    position: relative;
    overflow: hidden;
    box-shadow: var(--dia-shadow-soft);
    background-color: #f9fafb;
    background-image:
        linear-gradient(to right, #e5e7eb 1px, transparent 1px),
        linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
    background-size: 28px 28px;
}

/* Formas */

.shape {
    position: absolute;
    cursor: move;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--dia-text-primary);
    font-size: 2rem; /* texto más grande */
    font-weight:bold;
    padding: 4px 10px;
    background: var(--dia-shape-bg);
    box-shadow:
        0 10px 25px rgba(15, 23, 42, 0.12),
        0 0 0 1px rgba(209, 213, 219, 0.9);
}

.rectangle {
    width: 180px;
    height: 70px;
    border-radius: 14px;
    border: 2px solid var(--dia-shape-border-rect);
}

.pill {
    width: 200px;
    height: 60px;
    border-radius: 999px;
    border: 2px solid var(--dia-shape-border-pill);
}

.circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 2px solid var(--dia-shape-border-circle);
}

.shape.selected {
    outline: 2px dashed var(--dia-border-strong);
    outline-offset: 4px;
}

/* Flechas */

.arrow {
    position: absolute;
    height: 2px;
    background: var(--dia-primary);
    transform-origin: 0 50%;
    z-index: 1;
    pointer-events: none;
}

/* Punta para flecha simple (extremo derecho) */
.arrow::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 9px solid var(--dia-primary);
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
}

/* Segunda punta para flecha bidireccional (extremo izquierdo) */
.arrow.arrow-double::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-right: 9px solid var(--dia-primary);
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
}

/* Botones */

button {
    padding: 8px 10px;
    margin-top: 6px;
    border-radius: 999px;
    border: 1px solid var(--dia-border-subtle);
    background: #f9fafb;
    color: var(--dia-text-primary);
    cursor: pointer;
    font-size: 0.8rem;
    text-align: left;
    transition:
        background 0.12s ease,
        border-color 0.12s ease,
        transform 0.08s ease,
        box-shadow 0.12s ease;
}

button.secondary {
    background: #ffffff;
}

button:hover {
    border-color: var(--dia-border-strong);
    box-shadow: 0 0 0 1px rgba(17, 24, 39, 0.16);
    transform: translateY(-1px);
}
.stage {
    position: relative;
    overflow: hidden;
    background: #f7f7f7;
    border-radius: 12px;
    cursor: grab;
}

/* Contenedor interno que se pan/zoomea */
.stage-inner {
    position: relative;
    width: 5000px;   /* "mundo" grande para moverse */
    height: 5000px;
    transform-origin: 0 0;
}

/* Flechas y formas deben ser absolutely-positioned dentro de stage-inner */
.shape {
    position: absolute;
    cursor: move;
    /* resto de estilos que ya tuvieras (tamaño, colores, etc.) */
}

.arrow {
    position: absolute;
    height: 2px;
    background: #333;
    transform-origin: 0 50%;
}

/* Resaltado de selección para eliminar */
.shape.selected,
.arrow.selected {
    outline: 2px solid #007bff;
}

/* Mientras se hace pan */
.stage.panning {
    cursor: grabbing;
}
```

<a id="pautas-de-diseno"></a>
## Pautas de diseño

El diseño de interfaces gráficas es una etapa crucial en la creación de aplicaciones que proporcionan una experiencia óptima al usuario. En esta subunidad, exploraremos las pautas fundamentales para diseñar interfaces gráficas efectivas, centrándonos en aspectos como la usabilidad y la accesibilidad.

La usabilidad es un factor clave en el diseño de interfaces gráficas, ya que debe ser intuitiva y fácil de usar. Esto significa que los usuarios deben poder entender cómo interactuar con la interfaz sin necesidad de instrucciones detalladas. Para lograr esto, se recomienda seguir principios como la simplicidad, la consistencia y la coherencia en el diseño.

La accesibilidad es otro aspecto fundamental del diseño de interfaces gráficas. Es importante que las interfaces sean accesibles para todos los usuarios, incluyendo aquellos con discapacidades visuales o motoras. Esto puede implicar utilizar colores contrastantes, proporcionar opciones de texto legible y permitir la navegación por teclado.

La simplicidad es una pauta clave en el diseño de interfaces gráficas. Una interfaz simple es más fácil de usar y menos propensa a errores. Es importante evitar sobrecargar la interfaz con demasiados elementos, manteniendo siempre un equilibrio entre funcionalidad y simplicidad.

La consistencia es otra pauta importante en el diseño de interfaces gráficas. Los usuarios deben sentirse cómodos al navegar por diferentes partes de la aplicación porque los patrones y las convenciones utilizadas deben ser coherentes. Esto incluye el uso de colores, fuentes, iconos y elementos de interfaz.

La coherencia es un aspecto relacionado con la consistencia, pero enfocado en cómo se presentan los datos y cómo se manejan las acciones del usuario. Una interfaz gráfica coherente permite a los usuarios predecir el comportamiento de la aplicación basándose en su experiencia previa.

La legibilidad es crucial en el diseño de interfaces gráficas, especialmente cuando se trata de texto. Es importante utilizar fuentes legibles y tamaños de fuente adecuados para que todos los usuarios puedan leer fácilmente la información presentada.

El uso de colores es otro aspecto importante del diseño de interfaces gráficas. Los colores pueden ser utilizados para destacar elementos importantes, indicar estados o crear un tono visual coherente en la interfaz. Es importante utilizar una paleta de colores que sea agradable al ojo y que no cause conflictos visuales.

La disposición de los elementos en la interfaz gráfica es otro factor clave. Los elementos deben estar organizados de manera lógica y fácilmente accesible, permitiendo a los usuarios encontrar rápidamente lo que buscan. Es importante utilizar un diseño jerárquico para destacar los elementos más importantes.

La interacción del usuario es una pauta fundamental en el diseño de interfaces gráficas. Los usuarios deben sentirse cómodos al interactuar con la interfaz, utilizando controles intuitivos y respondiendo a las acciones del usuario de manera inmediata y predecible.

En conclusión, el diseño de interfaces gráficas es un proceso que requiere una combinación de principios teóricos y conocimientos prácticos. Al seguir pautas como la usabilidad, la accesibilidad, la simplicidad, la consistencia, la coherencia, la legibilidad, el uso de colores y la disposición de los elementos, se pueden crear interfaces gráficas efectivas que proporcionen una experiencia óptima al usuario.

### punto de partida

```html
<!doctype html>
<html>
  <head>
    <style>
      body,html{
        margin:0;
        padding:0;
        background:#ffffff;
        font-family: sans-serif;
      }
      #controls{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
      }
      #controls label{
        display:block;
        margin-bottom:4px;
      }
      #controls input[type=range]{
        width:150px;
      }
      #controls span.value{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <label>
        Min thickness
        <input id="minThickness" type="range" min="1" max="10" value="1">
        <span id="minThicknessValue" class="value">1</span>
      </label>
      <label>
        Max thickness
        <input id="maxThickness" type="range" min="1" max="20" value="6">
        <span id="maxThicknessValue" class="value">6</span>
      </label>
    </div>

    <canvas></canvas>

    <script>
      function distance2D(x1, y1, x2, y2) {
        const dx = x2 - x1;
        const dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
      }

      // Simple hash function for strings
      function hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0; // keep in 32 bits
        }
        return Math.abs(hash);
      }

      let anchura = window.innerWidth;
      let altura = window.innerHeight;
      let lienzo = document.querySelector("canvas");
      let contexto = lienzo.getContext("2d");
      lienzo.width = anchura;
      lienzo.height = altura;
      contexto.textAlign = "center";
      contexto.textBaseline = "middle";

      // Global line thickness controls
      let minLineThickness = 1;
      let maxLineThickness = 6;

      const minSlider = document.getElementById("minThickness");
      const maxSlider = document.getElementById("maxThickness");
      const minValueSpan = document.getElementById("minThicknessValue");
      const maxValueSpan = document.getElementById("maxThicknessValue");

      minSlider.addEventListener("input", () => {
        minLineThickness = parseFloat(minSlider.value);
        minValueSpan.textContent = minSlider.value;

        // Ensure min <= max
        if (minLineThickness > maxLineThickness) {
          maxLineThickness = minLineThickness;
          maxSlider.value = maxLineThickness;
          maxValueSpan.textContent = maxLineThickness;
        }
      });

      maxSlider.addEventListener("input", () => {
        maxLineThickness = parseFloat(maxSlider.value);
        maxValueSpan.textContent = maxSlider.value;

        // Ensure max >= min
        if (maxLineThickness < minLineThickness) {
          minLineThickness = maxLineThickness;
          minSlider.value = minLineThickness;
          minValueSpan.textContent = minLineThickness;
        }
      });

      let particulas = [];
      let numeroparticulas = 0;

      class Particula{
        // persona: { nombre, hobbie }
        constructor(x,y,a,persona){
          this.x = x;
          this.y = y;
          this.v = 0.5;        // velocidad base inicial

          // velocidad inicial a partir del ángulo
          this.vx = Math.cos(a) * this.v;
          this.vy = Math.sin(a) * this.v;

          // aceleración (fuerzas acumuladas)
          this.ax = 0;
          this.ay = 0;

          this.nombre = persona.nombre;
          this.hobbie = persona.hobbie;

          // control de estabilidad
          this.fija = false;
          this.estableFrames = 0;
        }

        dibuja(){
          contexto.lineWidth = 1;
          contexto.lineCap = "butt";
          let anchopastilla = 35;
          let altopastilla = 12;
          contexto.strokeStyle = "black";
          contexto.beginPath();
          contexto.moveTo(this.x-anchopastilla,this.y-altopastilla);
          contexto.lineTo(this.x+anchopastilla,this.y-altopastilla);
          contexto.arc(this.x+anchopastilla,this.y,altopastilla,0-Math.PI/2,Math.PI-Math.PI/2);
          contexto.lineTo(this.x-anchopastilla,this.y+altopastilla);
          contexto.arc(this.x-anchopastilla,this.y,altopastilla,Math.PI-Math.PI/2,0-Math.PI/2);
          contexto.fillStyle = "white";
          contexto.strokeStyle = "black";
          contexto.fill();
          contexto.stroke();
          contexto.fillStyle = "black";

          // primera línea: nombre
          contexto.font = "12px sans-serif";
          contexto.fillText(this.nombre, this.x, this.y - 5);
          // segunda línea: hobbie
          contexto.font = "10px sans-serif";
          contexto.fillText(this.hobbie, this.x, this.y + 7);
        }

        lineas(){
          // Thickness varies smoothly along each connection:
          // maxLineThickness at the ends, minLineThickness at the middle.
          contexto.lineCap = "round";

          for(let i = 0; i < numeroparticulas; i++){
            const p = particulas[i];
            if (p === this) continue;

            const d = distance2D(this.x, this.y, p.x, p.y);
            if (d < 160){

              const mismoNombre = (p.nombre === this.nombre);
              const mismoHobbie = (p.hobbie === this.hobbie);

              // Tipo de relación -> key
              let key = "ninguno";
              if (mismoNombre && mismoHobbie) key = "ambos";
              else if (mismoNombre)          key = "nombre";
              else if (mismoHobbie)          key = "hobbie";

              // hash → color hue
              const h = hashString(key) % 360;
              const alpha = 0.30 + 0.5 * (1 - d / 160); // más cerca -> más opaco
              contexto.strokeStyle = `hsla(${h}, 70%, 50%, ${alpha})`;

              // Coordenadas de extremo a extremo
              const x1 = this.x;
              const y1 = this.y;
              const x2 = p.x;
              const y2 = p.y;

              // Número de segmentos para el gradiente de grosor
              const segments = 20; // sube/baja para más/menos suavidad

              for (let s = 0; s < segments; s++) {
                const t1 = s / segments;
                const t2 = (s + 1) / segments;

                // puntos extremos del segmento [t1, t2]
                const sx1 = x1 + (x2 - x1) * t1;
                const sy1 = y1 + (y2 - y1) * t1;
                const sx2 = x1 + (x2 - x1) * t2;
                const sy2 = y1 + (y2 - y1) * t2;

                // t central del segmento
                const tc = (t1 + t2) / 2;

                // Grosor: max en los extremos (t≈0 o t≈1), min en el centro (t≈0.5)
                // f(tc) = 4*(tc-0.5)^2 va de 1 en extremos a 0 en el centro
                const factor = 4 * (tc - 0.5) * (tc - 0.5); // [0,1]
                const w = minLineThickness + (maxLineThickness - minLineThickness) * factor;

                contexto.lineWidth = w;
                contexto.beginPath();
                contexto.moveTo(sx1, sy1);
                contexto.lineTo(sx2, sy2);
                contexto.stroke();
              }
            }
          }
        }


        interacciones(particulas) {
          if (this.fija) {
            this.ax = 0;
            this.ay = 0;
            return;
          }

          // radio de búsqueda: toda la pantalla (diagonal)
          let rangoGlobal = Math.sqrt(anchura*anchura + altura*altura);

          // parámetros de interacción
          let distanciaObjetivo = 120;         // distancia "ideal" entre iguales
          let distanciaMinima = 70;            // distancia mínima para evitar solapamiento
          let distanciaRepulsionDistinto = 220; // hasta aquí repelen distinto

          // factores según coincidencia
          let kAtraccionFuerte = 0.0015;  // mismo nombre + mismo hobbie
          let kAtraccionMedia  = 0.0009;  // mismo nombre o mismo hobbie
          let kRepulsionDistinto = 0.001; // repulsión suave entre distintos
          let kRepulsionCorta = 0.06;     // repulsión fuerte muy cercana

          let fx = 0;
          let fy = 0;

          for (let p of particulas) {
            if (p === this) continue;

            let d = distance2D(this.x, this.y, p.x, p.y);
            if (d === 0 || d > rangoGlobal) continue;

            let dx = p.x - this.x;
            let dy = p.y - this.y;

            let ux = dx / d;
            let uy = dy / d;

            // repulsión fuerte para evitar solapamiento
            if (d < distanciaMinima) {
              let intensidad = (distanciaMinima - d) * kRepulsionCorta;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              continue;
            }

            const mismoNombre = (p.nombre === this.nombre);
            const mismoHobbie = (p.hobbie === this.hobbie);

            if (mismoNombre && mismoHobbie) {
              // máxima atracción hacia una distancia objetivo
              let delta = d - distanciaObjetivo;
              fx += ux * delta * kAtraccionFuerte;
              fy += uy * delta * kAtraccionFuerte;

            } else if (mismoNombre || mismoHobbie) {
              // atracción media (comparten al menos un factor)
              let delta = d - distanciaObjetivo;
              fx += ux * delta * kAtraccionMedia;
              fy += uy * delta * kAtraccionMedia;

            } else {
              // repulsión entre completamente distintos
              if (d < distanciaRepulsionDistinto) {
                let intensidad = (distanciaRepulsionDistinto - d) * kRepulsionDistinto;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
              }
            }
          }

          // limitar la fuerza total
          const maxForce = 0.05;
          let fmag = Math.sqrt(fx*fx + fy*fy);
          if (fmag > maxForce) {
            fx = fx / fmag * maxForce;
            fy = fy / fmag * maxForce;
          }

          this.ax = fx;
          this.ay = fy;
        }

        mueve(){
          if (this.fija) return;

          this.vx += this.ax;
          this.vy += this.ay;

          const friccion = 0.93;
          this.vx *= friccion;
          this.vy *= friccion;

          this.x += this.vx;
          this.y += this.vy;

          const speed  = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
          const fuerza = Math.sqrt(this.ax*this.ax + this.ay*this.ay);

          if (speed < 0.02 && fuerza < 0.002) {
            this.estableFrames++;
            if (this.estableFrames > 60) {
              this.fija = true;
              this.vx = 0;
              this.vy = 0;
            }
          } else {
            this.estableFrames = 0;
          }
        }

        rebote(){
          if (this.fija) return;

          const reboteFactor = -0.5;

          if (this.x > anchura) {
            this.x = anchura;
            this.vx *= reboteFactor;
          }
          if (this.x < 0) {
            this.x = 0;
            this.vx *= reboteFactor;
          }

          if (this.y > altura) {
            this.y = altura;
            this.vy *= reboteFactor;
          }
          if (this.y < 0) {
            this.y = 0;
            this.vy *= reboteFactor;
          }
        }
      }

      function bucle(){
        contexto.clearRect(0,0,anchura,altura);

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].interacciones(particulas);
        }

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].mueve();
          particulas[i].rebote();
        }

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].lineas();
        }
        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].dibuja();
        }

        requestAnimationFrame(bucle);
      }

      // Cargar JSON y, cuando esté listo, crear partículas y arrancar simulación
      fetch("personas.json")
        .then(respuesta => respuesta.json())
        .then(personas => {
          particulas = [];
          numeroparticulas = personas.length;

          for (let i = 0; i < personas.length; i++) {
            let persona = personas[i];
            particulas.push(
              new Particula(
                Math.random()*anchura,
                Math.random()*altura,
                Math.random()*Math.PI*2,
                persona
              )
            );
          }

          requestAnimationFrame(bucle);
        })
        .catch(error => {
          console.error("Error al cargar personas.json:", error);
        });
    </script>
  </body>
</html>
```

### activar o desactivar propiedades

```html
<!doctype html>
<html>
  <head>
    <style>
      body,html{
        margin:0;
        padding:0;
        background:#ffffff;
        font-family: sans-serif;
      }
      #controls{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
      }
      #controls label{
        display:block;
        margin-bottom:4px;
      }
      #controls input[type=range]{
        width:150px;
      }
      #controls span.value{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controls .row{
        margin-top:4px;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <label>
        Min thickness
        <input id="minThickness" type="range" min="1" max="10" value="1">
        <span id="minThicknessValue" class="value">1</span>
      </label>
      <label>
        Max thickness
        <input id="maxThickness" type="range" min="1" max="20" value="6">
        <span id="maxThicknessValue" class="value">6</span>
      </label>

      <div class="row">
        <label><input id="chkNameRelation" type="checkbox" checked> Use name relation</label>
        <label><input id="chkHobbyRelation" type="checkbox" checked> Use hobby relation</label>
      </div>
      <div class="row">
        <label><input id="chkShowName" type="checkbox" checked> Show name</label>
        <label><input id="chkShowHobby" type="checkbox" checked> Show hobby</label>
        <label><input id="chkShowLines" type="checkbox" checked> Show connections</label>
      </div>
    </div>

    <canvas></canvas>

    <script>
      function distance2D(x1, y1, x2, y2) {
        const dx = x2 - x1;
        const dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
      }

      // Simple hash function for strings
      function hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0; // keep in 32 bits
        }
        return Math.abs(hash);
      }

      let anchura = window.innerWidth;
      let altura = window.innerHeight;
      let lienzo = document.querySelector("canvas");
      let contexto = lienzo.getContext("2d");
      lienzo.width = anchura;
      lienzo.height = altura;
      contexto.textAlign = "center";
      contexto.textBaseline = "middle";

      // Global line thickness controls
      let minLineThickness = 1;
      let maxLineThickness = 6;

      // Global property toggles
      let useNameRelation  = true;
      let useHobbyRelation = true;
      let showName         = true;
      let showHobby        = true;
      let showLines        = true;

      const minSlider = document.getElementById("minThickness");
      const maxSlider = document.getElementById("maxThickness");
      const minValueSpan = document.getElementById("minThicknessValue");
      const maxValueSpan = document.getElementById("maxThicknessValue");

      const chkNameRelation  = document.getElementById("chkNameRelation");
      const chkHobbyRelation = document.getElementById("chkHobbyRelation");
      const chkShowName      = document.getElementById("chkShowName");
      const chkShowHobby     = document.getElementById("chkShowHobby");
      const chkShowLines     = document.getElementById("chkShowLines");

      minSlider.addEventListener("input", () => {
        minLineThickness = parseFloat(minSlider.value);
        minValueSpan.textContent = minSlider.value;

        // Ensure min <= max
        if (minLineThickness > maxLineThickness) {
          maxLineThickness = minLineThickness;
          maxSlider.value = maxLineThickness;
          maxValueSpan.textContent = maxLineThickness;
        }
      });

      maxSlider.addEventListener("input", () => {
        maxLineThickness = parseFloat(maxSlider.value);
        maxValueSpan.textContent = maxSlider.value;

        // Ensure max >= min
        if (maxLineThickness < minLineThickness) {
          minLineThickness = maxLineThickness;
          minSlider.value = minLineThickness;
          minValueSpan.textContent = minLineThickness;
        }
      });

      chkNameRelation.addEventListener("change", () => {
        useNameRelation = chkNameRelation.checked;
      });
      chkHobbyRelation.addEventListener("change", () => {
        useHobbyRelation = chkHobbyRelation.checked;
      });
      chkShowName.addEventListener("change", () => {
        showName = chkShowName.checked;
      });
      chkShowHobby.addEventListener("change", () => {
        showHobby = chkShowHobby.checked;
      });
      chkShowLines.addEventListener("change", () => {
        showLines = chkShowLines.checked;
      });

      let particulas = [];
      let numeroparticulas = 0;

      class Particula{
        // persona: { nombre, hobbie }
        constructor(x,y,a,persona){
          this.x = x;
          this.y = y;
          this.v = 0.5;        // velocidad base inicial

          // velocidad inicial a partir del ángulo
          this.vx = Math.cos(a) * this.v;
          this.vy = Math.sin(a) * this.v;

          // aceleración (fuerzas acumuladas)
          this.ax = 0;
          this.ay = 0;

          this.nombre = persona.nombre;
          this.hobbie = persona.hobbie;

          // control de estabilidad
          this.fija = false;
          this.estableFrames = 0;
        }

        dibuja(){
          contexto.lineWidth = 1;
          contexto.lineCap = "butt";
          let anchopastilla = 35;
          let altopastilla = 12;
          contexto.strokeStyle = "black";
          contexto.beginPath();
          contexto.moveTo(this.x-anchopastilla,this.y-altopastilla);
          contexto.lineTo(this.x+anchopastilla,this.y-altopastilla);
          contexto.arc(this.x+anchopastilla,this.y,altopastilla,0-Math.PI/2,Math.PI-Math.PI/2);
          contexto.lineTo(this.x-anchopastilla,this.y+altopastilla);
          contexto.arc(this.x-anchopastilla,this.y,altopastilla,Math.PI-Math.PI/2,0-Math.PI/2);
          contexto.fillStyle = "white";
          contexto.strokeStyle = "black";
          contexto.fill();
          contexto.stroke();
          contexto.fillStyle = "black";

          // textos según flags
          let baseY = this.y;
          let offset = 0;

          contexto.font = "12px sans-serif";
          if (showName) {
            contexto.fillText(this.nombre, this.x, baseY - 4);
            offset += 6;
          }
          if (showHobby) {
            contexto.font = "10px sans-serif";
            const yHobbie = showName ? (baseY + 7) : baseY + 2;
            contexto.fillText(this.hobbie, this.x, yHobbie);
          }
        }

        lineas(){
          if (!showLines) return;

          contexto.lineCap = "round";

          for(let i = 0; i < numeroparticulas; i++){
            const p = particulas[i];
            if (p === this) continue;
            const d = distance2D(this.x, this.y, p.x, p.y);
            if(d < 160){

              // coincidencias, condicionadas por los toggles
              const mismoNombre = useNameRelation  && (p.nombre === this.nombre);
              const mismoHobbie = useHobbyRelation && (p.hobbie === this.hobbie);

              // claves de relación
              let key = "ninguno";
              if (mismoNombre && mismoHobbie) key = "ambos";
              else if (mismoNombre)          key = "nombre";
              else if (mismoHobbie)          key = "hobbie";

              // hash → color hue
              const h = hashString(key) % 360;
              const alpha = 0.30 + 0.5 * (1 - d / 160); // más cerca -> más opaco
              contexto.strokeStyle = `hsla(${h}, 70%, 50%, ${alpha})`;

              // Coordenadas de extremo a extremo
              const x1 = this.x;
              const y1 = this.y;
              const x2 = p.x;
              const y2 = p.y;

              // Número de segmentos para el gradiente de grosor
              const segments = 20; // sube/baja para más/menos suavidad

              for (let s = 0; s < segments; s++) {
                const t1 = s / segments;
                const t2 = (s + 1) / segments;

                // puntos extremos del segmento [t1, t2]
                const sx1 = x1 + (x2 - x1) * t1;
                const sy1 = y1 + (y2 - y1) * t1;
                const sx2 = x1 + (x2 - x1) * t2;
                const sy2 = y1 + (y2 - y1) * t2;

                // t central del segmento
                const tc = (t1 + t2) / 2;

                // Grosor: max en los extremos (t≈0 o t≈1), min en el centro (t≈0.5)
                // f(tc) = 4*(tc-0.5)^2 va de 1 en extremos a 0 en el centro
                const factor = 4 * (tc - 0.5) * (tc - 0.5); // [0,1]
                const w = minLineThickness + (maxLineThickness - minLineThickness) * factor;

                contexto.lineWidth = w;
                contexto.beginPath();
                contexto.moveTo(sx1, sy1);
                contexto.lineTo(sx2, sy2);
                contexto.stroke();
              }
            }
          }
        }

        interacciones(particulas) {
          if (this.fija) {
            this.ax = 0;
            this.ay = 0;
            return;
          }

          // radio de búsqueda: toda la pantalla (diagonal)
          let rangoGlobal = Math.sqrt(anchura*anchura + altura*altura);

          // parámetros de interacción
          let distanciaObjetivo = 120;         // distancia "ideal" entre iguales
          let distanciaMinima = 70;            // distancia mínima para evitar solapamiento
          let distanciaRepulsionDistinto = 220; // hasta aquí repelen distinto

          // factores según coincidencia
          let kAtraccionFuerte = 0.0015;  // mismo nombre + mismo hobbie
          let kAtraccionMedia  = 0.0009;  // mismo nombre o mismo hobbie
          let kRepulsionDistinto = 0.001; // repulsión suave entre distintos
          let kRepulsionCorta = 0.06;     // repulsión fuerte muy cercana

          let fx = 0;
          let fy = 0;

          for (let p of particulas) {
            if (p === this) continue;

            let d = distance2D(this.x, this.y, p.x, p.y);
            if (d === 0 || d > rangoGlobal) continue;

            let dx = p.x - this.x;
            let dy = p.y - this.y;

            let ux = dx / d;
            let uy = dy / d;

            // repulsión fuerte para evitar solapamiento
            if (d < distanciaMinima) {
              let intensidad = (distanciaMinima - d) * kRepulsionCorta;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              continue;
            }

            const mismoNombre = useNameRelation  && (p.nombre === this.nombre);
            const mismoHobbie = useHobbyRelation && (p.hobbie === this.hobbie);

            if (mismoNombre && mismoHobbie) {
              // máxima atracción hacia una distancia objetivo
              let delta = d - distanciaObjetivo;
              fx += ux * delta * kAtraccionFuerte;
              fy += uy * delta * kAtraccionFuerte;

            } else if (mismoNombre || mismoHobbie) {
              // atracción media (comparten al menos un factor activo)
              let delta = d - distanciaObjetivo;
              fx += ux * delta * kAtraccionMedia;
              fy += uy * delta * kAtraccionMedia;

            } else {
              // repulsión entre completamente distintos (o cuando ambos factores están desactivados)
              if (d < distanciaRepulsionDistinto) {
                let intensidad = (distanciaRepulsionDistinto - d) * kRepulsionDistinto;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
              }
            }
          }

          // limitar la fuerza total
          const maxForce = 0.05;
          let fmag = Math.sqrt(fx*fx + fy*fy);
          if (fmag > maxForce) {
            fx = fx / fmag * maxForce;
            fy = fy / fmag * maxForce;
          }

          this.ax = fx;
          this.ay = fy;
        }

        mueve(){
          if (this.fija) return;

          this.vx += this.ax;
          this.vy += this.ay;

          const friccion = 0.93;
          this.vx *= friccion;
          this.vy *= friccion;

          this.x += this.vx;
          this.y += this.vy;

          const speed  = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
          const fuerza = Math.sqrt(this.ax*this.ax + this.ay*this.ay);

          if (speed < 0.02 && fuerza < 0.002) {
            this.estableFrames++;
            if (this.estableFrames > 60) {
              this.fija = true;
              this.vx = 0;
              this.vy = 0;
            }
          } else {
            this.estableFrames = 0;
          }
        }

        rebote(){
          if (this.fija) return;

          const reboteFactor = -0.5;

          if (this.x > anchura) {
            this.x = anchura;
            this.vx *= reboteFactor;
          }
          if (this.x < 0) {
            this.x = 0;
            this.vx *= reboteFactor;
          }

          if (this.y > altura) {
            this.y = altura;
            this.vy *= reboteFactor;
          }
          if (this.y < 0) {
            this.y = 0;
            this.vy *= reboteFactor;
          }
        }
      }

      function bucle(){
        contexto.clearRect(0,0,anchura,altura);

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].interacciones(particulas);
        }

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].mueve();
          particulas[i].rebote();
        }

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].lineas();
        }
        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].dibuja();
        }

        requestAnimationFrame(bucle);
      }

      // Cargar JSON y, cuando esté listo, crear partículas y arrancar simulación
      fetch("personas.json")
        .then(respuesta => respuesta.json())
        .then(personas => {
          particulas = [];
          numeroparticulas = personas.length;

          for (let i = 0; i < personas.length; i++) {
            let persona = personas[i];
            particulas.push(
              new Particula(
                Math.random()*anchura,
                Math.random()*altura,
                Math.random()*Math.PI*2,
                persona
              )
            );
          }

          requestAnimationFrame(bucle);
        })
        .catch(error => {
          console.error("Error al cargar personas.json:", error);
        });
    </script>
  </body>
</html>
```

### dinamico

```html
<!doctype html>
<html>
  <head>
    <style>
      body,html{
        margin:0;
        padding:0;
        background:#ffffff;
        font-family: sans-serif;
      }
      #controls{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
      }
      #controls label{
        display:block;
        margin-bottom:4px;
      }
      #controls input[type=range]{
        width:150px;
      }
      #controls span.value{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controls .row{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propControls .prop-block{
        border-top:1px solid #ddd;
        margin-top:4px;
        padding-top:4px;
      }
      #propControls .prop-title{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propControls label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <label>
        Min thickness
        <input id="minThickness" type="range" min="1" max="10" value="1">
        <span id="minThicknessValue" class="value">1</span>
      </label>
      <label>
        Max thickness
        <input id="maxThickness" type="range" min="1" max="20" value="6">
        <span id="maxThicknessValue" class="value">6</span>
      </label>

      <div class="row">
        <label><input id="chkShowLines" type="checkbox" checked> Show connections</label>
      </div>

      <div class="row">
        <div><strong>Properties</strong> (auto from JSON)</div>
        <div id="propControls"></div>
      </div>
    </div>

    <canvas></canvas>

    <script>
      function distance2D(x1, y1, x2, y2) {
        const dx = x2 - x1;
        const dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
      }

      // Simple hash function for strings
      function hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0; // keep in 32 bits
        }
        return Math.abs(hash);
      }

      let anchura = window.innerWidth;
      let altura = window.innerHeight;
      let lienzo = document.querySelector("canvas");
      let contexto = lienzo.getContext("2d");
      lienzo.width = anchura;
      lienzo.height = altura;
      contexto.textAlign = "center";
      contexto.textBaseline = "middle";

      // Global line thickness controls
      let minLineThickness = 1;
      let maxLineThickness = 6;

      // Dynamic properties (filled after loading JSON)
      let propertyKeys = [];           // list of property names
      let relationProps = {};          // {propName: boolean} -> use in physics
      let showProps = {};              // {propName: boolean} -> show in label

      // Other toggles
      let showLines = true;

      const minSlider = document.getElementById("minThickness");
      const maxSlider = document.getElementById("maxThickness");
      const minValueSpan = document.getElementById("minThicknessValue");
      const maxValueSpan = document.getElementById("maxThicknessValue");
      const chkShowLines = document.getElementById("chkShowLines");
      const propControlsDiv = document.getElementById("propControls");

      minSlider.addEventListener("input", () => {
        minLineThickness = parseFloat(minSlider.value);
        minValueSpan.textContent = minSlider.value;
        if (minLineThickness > maxLineThickness) {
          maxLineThickness = minLineThickness;
          maxSlider.value = maxLineThickness;
          maxValueSpan.textContent = maxLineThickness;
        }
      });

      maxSlider.addEventListener("input", () => {
        maxLineThickness = parseFloat(maxSlider.value);
        maxValueSpan.textContent = maxSlider.value;
        if (maxLineThickness < minLineThickness) {
          minLineThickness = maxLineThickness;
          minSlider.value = minLineThickness;
          minValueSpan.textContent = minLineThickness;
        }
      });

      chkShowLines.addEventListener("change", () => {
        showLines = chkShowLines.checked;
      });

      function createPropertyControls(keys) {
        propControlsDiv.innerHTML = "";
        propertyKeys = keys.slice();

        propertyKeys.forEach(prop => {
          // by default: use in relation and show in label
          if (!(prop in relationProps)) relationProps[prop] = true;
          if (!(prop in showProps))     showProps[prop] = true;

          const block = document.createElement("div");
          block.className = "prop-block";

          const title = document.createElement("div");
          title.className = "prop-title";
          title.textContent = prop;
          block.appendChild(title);

          const labelUse = document.createElement("label");
          const chkUse = document.createElement("input");
          chkUse.type = "checkbox";
          chkUse.checked = relationProps[prop];
          chkUse.addEventListener("change", () => {
            relationProps[prop] = chkUse.checked;
          });
          labelUse.appendChild(chkUse);
          labelUse.appendChild(document.createTextNode(" Use in relation"));
          block.appendChild(labelUse);

          const labelShow = document.createElement("label");
          const chkShow = document.createElement("input");
          chkShow.type = "checkbox";
          chkShow.checked = showProps[prop];
          chkShow.addEventListener("change", () => {
            showProps[prop] = chkShow.checked;
          });
          labelShow.appendChild(chkShow);
          labelShow.appendChild(document.createTextNode(" Show in label"));
          block.appendChild(labelShow);

          propControlsDiv.appendChild(block);
        });
      }

      let particulas = [];
      let numeroparticulas = 0;

      class Particula{
        // persona: object with arbitrary properties
        constructor(x,y,a,persona){
          this.x = x;
          this.y = y;
          this.v = 0.5;

          this.vx = Math.cos(a) * this.v;
          this.vy = Math.sin(a) * this.v;

          this.ax = 0;
          this.ay = 0;

          this.data = persona; // store all properties

          this.fija = false;
          this.estableFrames = 0;
        }

        dibuja(){
          contexto.lineWidth = 1;
          contexto.lineCap = "butt";

          // determine how many lines will be drawn (visible props)
          const visibleProps = propertyKeys.filter(p => showProps[p]);
          const numLines = Math.max(visibleProps.length, 1);
          const lineHeight = 11;
          const totalHeight = numLines * lineHeight + 6; // padding
          const altopastilla = totalHeight / 2;

          const anchopastilla = 45;

          contexto.strokeStyle = "black";
          contexto.beginPath();
          contexto.moveTo(this.x-anchopastilla, this.y-altopastilla);
          contexto.lineTo(this.x+anchopastilla, this.y-altopastilla);
          contexto.arc(this.x+anchopastilla, this.y, altopastilla, -Math.PI/2, Math.PI/2);
          contexto.lineTo(this.x-anchopastilla, this.y+altopastilla);
          contexto.arc(this.x-anchopastilla, this.y, altopastilla, Math.PI/2, -Math.PI/2);
          contexto.fillStyle = "white";
          contexto.strokeStyle = "black";
          contexto.fill();
          contexto.stroke();
          contexto.fillStyle = "black";

          // text lines centered vertically
          const startY = this.y - ((numLines - 1) * lineHeight) / 2;

          let lineIndex = 0;
          visibleProps.forEach((prop, idx) => {
            const value = (this.data[prop] !== undefined && this.data[prop] !== null)
                          ? String(this.data[prop])
                          : "";
            const y = startY + lineIndex * lineHeight;
            contexto.font = (idx === 0 ? "12px sans-serif" : "10px sans-serif");
            contexto.fillText(value, this.x, y);
            lineIndex++;
          });
        }

        lineas(){
          if (!showLines) return;

          contexto.lineCap = "round";

          for(let i = 0; i < numeroparticulas; i++){
            const p = particulas[i];
            if (p === this) continue;
            const d = distance2D(this.x, this.y, p.x, p.y);
            if(d < 160){

              // Determine matches based on active relation properties
              const matchedProps = [];
              let anyRelationPropActive = false;

              for (const prop of propertyKeys) {
                if (!relationProps[prop]) continue;
                anyRelationPropActive = true;
                if (this.data[prop] === p.data[prop]) {
                  matchedProps.push(prop);
                }
              }

              // Build relation key for color
              let key = "none";
              if (matchedProps.length === 1) {
                key = matchedProps[0];
              } else if (matchedProps.length > 1) {
                key = matchedProps.slice().sort().join("+");
              } else if (!anyRelationPropActive) {
                key = "no-rel-props";
              }

              const h = hashString(key) % 360;
              const alpha = 0.30 + 0.5 * (1 - d / 160);
              contexto.strokeStyle = `hsla(${h}, 70%, 50%, ${alpha})`;

              const x1 = this.x;
              const y1 = this.y;
              const x2 = p.x;
              const y2 = p.y;

              const segments = 20;

              for (let s = 0; s < segments; s++) {
                const t1 = s / segments;
                const t2 = (s + 1) / segments;

                const sx1 = x1 + (x2 - x1) * t1;
                const sy1 = y1 + (y2 - y1) * t1;
                const sx2 = x1 + (x2 - x1) * t2;
                const sy2 = y1 + (y2 - y1) * t2;

                const tc = (t1 + t2) / 2;

                // thickness gradient: thick at ends, thin in middle
                const factor = 4 * (tc - 0.5) * (tc - 0.5); // [0,1]
                const w = minLineThickness + (maxLineThickness - minLineThickness) * factor;

                contexto.lineWidth = w;
                contexto.beginPath();
                contexto.moveTo(sx1, sy1);
                contexto.lineTo(sx2, sy2);
                contexto.stroke();
              }
            }
          }
        }

        interacciones(particulas) {
          if (this.fija) {
            this.ax = 0;
            this.ay = 0;
            return;
          }

          const rangoGlobal = Math.sqrt(anchura*anchura + altura*altura);

          const distanciaObjetivo = 120;
          const distanciaMinima = 70;
          const distanciaRepulsionDistinto = 220;

          const kAtraccionFuerte   = 0.0015;
          const kAtraccionMedia    = 0.0009;
          const kRepulsionDistinto = 0.001;
          const kRepulsionCorta    = 0.06;

          let fx = 0;
          let fy = 0;

          for (let p of particulas) {
            if (p === this) continue;

            let d = distance2D(this.x, this.y, p.x, p.y);
            if (d === 0 || d > rangoGlobal) continue;

            let dx = p.x - this.x;
            let dy = p.y - this.y;

            let ux = dx / d;
            let uy = dy / d;

            // repulsión fuerte para evitar solapamiento
            if (d < distanciaMinima) {
              let intensidad = (distanciaMinima - d) * kRepulsionCorta;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              continue;
            }

            // determine matches based on active relation properties
            const matchedProps = [];
            let anyRelationPropActive = false;
            for (const prop of propertyKeys) {
              if (!relationProps[prop]) continue;
              anyRelationPropActive = true;
              if (this.data[prop] === p.data[prop]) {
                matchedProps.push(prop);
              }
            }

            if (matchedProps.length > 1) {
              // strong attraction (several props match)
              let delta = d - distanciaObjetivo;
              fx += ux * delta * kAtraccionFuerte;
              fy += uy * delta * kAtraccionFuerte;
            } else if (matchedProps.length === 1) {
              // medium attraction (one prop matches)
              let delta = d - distanciaObjetivo;
              fx += ux * delta * kAtraccionMedia;
              fy += uy * delta * kAtraccionMedia;
            } else {
              // no matching active property: repulsion
              if (d < distanciaRepulsionDistinto) {
                let intensidad = (distanciaRepulsionDistinto - d) * kRepulsionDistinto;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
              }
            }
          }

          const maxForce = 0.05;
          let fmag = Math.sqrt(fx*fx + fy*fy);
          if (fmag > maxForce) {
            fx = fx / fmag * maxForce;
            fy = fy / fmag * maxForce;
          }

          this.ax = fx;
          this.ay = fy;
        }

        mueve(){
          if (this.fija) return;

          this.vx += this.ax;
          this.vy += this.ay;

          const friccion = 0.93;
          this.vx *= friccion;
          this.vy *= friccion;

          this.x += this.vx;
          this.y += this.vy;

          const speed  = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
          const fuerza = Math.sqrt(this.ax*this.ax + this.ay*this.ay);

          if (speed < 0.02 && fuerza < 0.002) {
            this.estableFrames++;
            if (this.estableFrames > 60) {
              this.fija = true;
              this.vx = 0;
              this.vy = 0;
            }
          } else {
            this.estableFrames = 0;
          }
        }

        rebote(){
          if (this.fija) return;

          const reboteFactor = -0.5;

          if (this.x > anchura) {
            this.x = anchura;
            this.vx *= reboteFactor;
          }
          if (this.x < 0) {
            this.x = 0;
            this.vx *= reboteFactor;
          }

          if (this.y > altura) {
            this.y = altura;
            this.vy *= reboteFactor;
          }
          if (this.y < 0) {
            this.y = 0;
            this.vy *= reboteFactor;
          }
        }
      }

      function bucle(){
        contexto.clearRect(0,0,anchura,altura);

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].interacciones(particulas);
        }

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].mueve();
          particulas[i].rebote();
        }

        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].lineas();
        }
        for (let i = 0; i < numeroparticulas; i++) {
          particulas[i].dibuja();
        }

        requestAnimationFrame(bucle);
      }

      // Load JSON and start
      fetch("personas.json")
        .then(respuesta => respuesta.json())
        .then(personas => {
          particulas = [];
          numeroparticulas = personas.length;

          // detect all property keys (union)
          const keySet = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => keySet.add(k));
          });
          const keys = Array.from(keySet);
          createPropertyControls(keys);

          for (let i = 0; i < personas.length; i++) {
            let persona = personas[i];
            particulas.push(
              new Particula(
                Math.random()*anchura,
                Math.random()*altura,
                Math.random()*Math.PI*2,
                persona
              )
            );
          }

          requestAnimationFrame(bucle);
        })
        .catch(error => {
          console.error("Error al cargar personas.json:", error);
        });
    </script>
  </body>
</html>
```

### con worker

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red de personas</title>
    <style>
      body,html{
        margin:0;
        padding:0;
        background:#ffffff;
        font-family: sans-serif;
        overflow:hidden;
      }
      #contLienzos{
        position:fixed;
        inset:0;
      }
      canvas{
        position:absolute;
        inset:0;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #controles #propiedades .bloque-prop{
        border-top:1px solid #ddd;
        margin-top:4px;
        padding-top:4px;
      }
      #controles #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #controles #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
    </style>
  </head>
  <body>
    <div id="controles">
      <label>
        Grosor mínimo
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>
    </div>

    <div id="contLienzos">
      <canvas id="lienzoLineas"></canvas>
      <canvas id="lienzoNodos"></canvas>
    </div>

    <script>
      // --- Utilidades generales ---
      function distancia2D(x1, y1, x2, y2) {
        const dx = x2 - x1;
        const dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
      }

      // Hash sencillo de cadenas
      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      // --- Lienzos ---
      const lienzoLineas = document.getElementById("lienzoLineas");
      const lienzoNodos  = document.getElementById("lienzoNodos");
      const ctxLineas    = lienzoLineas.getContext("2d");
      const ctxNodos     = lienzoNodos.getContext("2d");

      let ancho = window.innerWidth;
      let alto  = window.innerHeight;

      function redimensionarLienzos(){
        ancho = window.innerWidth;
        alto  = window.innerHeight;
        lienzoLineas.width  = ancho;
        lienzoLineas.height = alto;
        lienzoNodos.width   = ancho;
        lienzoNodos.height  = alto;
      }
      redimensionarLienzos();
      window.addEventListener("resize", redimensionarLienzos);

      ctxNodos.textAlign = "center";
      ctxNodos.textBaseline = "middle";

      // --- Controles globales ---
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      // Propiedades dinámicas (según JSON)
      let clavesPropiedades = [];     // lista de nombres de propiedades
      let usarEnRelacion = {};        // {prop: boolean} -> usar en física
      let mostrarEnEtiqueta = {};     // {prop: boolean} -> mostrar texto

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))     usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta))  mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          // Usar en relación (física)
          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;

            // Cuando cambian las condiciones de relación,
            // reactivamos todas las partículas.
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });

            if (workerListo && worker) {
              worker.postMessage({ tipo: "reactivar" });
            }
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          // Mostrar en etiqueta
          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });
      }

      // --- Partículas (solo dibujo en el hilo principal) ---
      let particulas = [];
      let numeroParticulas = 0;

      class Particula {
        constructor(x, y, a, persona){
          this.x = x;
          this.y = y;
          this.vx = Math.cos(a) * 0.5;
          this.vy = Math.sin(a) * 0.5;
          this.ax = 0;
          this.ay = 0;
          this.fija = false;
          this.estableFrames = 0;
          this.datos = persona;   // objeto con propiedades arbitrarias
        }

        dibujarNodos(){
          // propiedades visibles
          const propsVisibles = clavesPropiedades.filter(p => mostrarEnEtiqueta[p]);
          const numLineas = Math.max(propsVisibles.length, 1);
          const altoLinea = 11;
          const altoTotal = numLineas * altoLinea + 6;
          const radioY = altoTotal / 2;
          const anchoPastilla = 55;

          ctxNodos.lineWidth = 1;
          ctxNodos.lineCap   = "butt";
          ctxNodos.strokeStyle = "black";
          ctxNodos.fillStyle   = "white";

          ctxNodos.beginPath();
          ctxNodos.moveTo(this.x - anchoPastilla, this.y - radioY);
          ctxNodos.lineTo(this.x + anchoPastilla, this.y - radioY);
          ctxNodos.arc(this.x + anchoPastilla, this.y, radioY, -Math.PI/2, Math.PI/2);
          ctxNodos.lineTo(this.x - anchoPastilla, this.y + radioY);
          ctxNodos.arc(this.x - anchoPastilla, this.y, radioY, Math.PI/2, -Math.PI/2);
          ctxNodos.fill();
          ctxNodos.stroke();

          ctxNodos.fillStyle = "black";
          const inicioY = this.y - ((numLineas - 1) * altoLinea) / 2;
          let indiceLinea = 0;

          propsVisibles.forEach((prop, idx) => {
            const valor = (this.datos[prop] !== undefined && this.datos[prop] !== null)
                          ? String(this.datos[prop])
                          : "";
            const yTexto = inicioY + indiceLinea * altoLinea;
            ctxNodos.font = (idx === 0 ? "12px sans-serif" : "10px sans-serif");
            ctxNodos.fillText(valor, this.x, yTexto);
            indiceLinea++;
          });
        }

        dibujarLineas(){
          if (!mostrarLineas) return;

          ctxLineas.lineCap = "round";

          for (let i = 0; i < numeroParticulas; i++){
            const p = particulas[i];
            if (p === this) continue;
            const d = distancia2D(this.x, this.y, p.x, p.y);
            if (d >= 160) continue;

            // Coincidencias en propiedades activas
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;

            for (const prop of clavesPropiedades) {
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (this.datos[prop] === p.datos[prop]) {
                propsCoinciden.push(prop);
              }
            }

            // clave de relación para el color
            let clave = "ninguna";
            if (propsCoinciden.length === 1) {
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1) {
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas) {
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const alpha = 0.30 + 0.5 * (1 - d / 160);
            ctxLineas.strokeStyle = `hsla(${h}, 70%, 50%, ${alpha})`;

            const x1 = this.x;
            const y1 = this.y;
            const x2 = p.x;
            const y2 = p.y;

            // Segmentar la línea para crear gradiente de grosor
            const segmentos = 20;
            for (let s = 0; s < segmentos; s++){
              const t1 = s / segmentos;
              const t2 = (s + 1) / segmentos;

              const sx1 = x1 + (x2 - x1) * t1;
              const sy1 = y1 + (y2 - y1) * t1;
              const sx2 = x1 + (x2 - x1) * t2;
              const sy2 = y1 + (y2 - y1) * t2;

              const tc = (t1 + t2) / 2;
              // grosor máximo en extremos, mínimo en el centro
              const factor = 4 * (tc - 0.5) * (tc - 0.5); // [0,1]
              const w = grosorMin + (grosorMax - grosorMin) * factor;

              ctxLineas.lineWidth = w;
              ctxLineas.beginPath();
              ctxLineas.moveTo(sx1, sy1);
              ctxLineas.lineTo(sx2, sy2);
              ctxLineas.stroke();
            }
          }
        }
      }

      // --- Web Worker para la física ---
      let worker = null;
      let workerListo = false;

      function iniciarWorker(particulasIniciales, claves){
        worker = new Worker("worker.js");

        worker.onmessage = (e) => {
          const datos = e.data;
          if (datos.tipo === "estado") {
            const arr = datos.particulas;
            for (let i = 0; i < arr.length && i < particulas.length; i++){
              const src = arr[i];
              const dst = particulas[i];
              dst.x = src.x;
              dst.y = src.y;
              dst.vx = src.vx;
              dst.vy = src.vy;
              dst.ax = src.ax;
              dst.ay = src.ay;
              dst.fija = src.fija;
              dst.estableFrames = src.estableFrames;
            }

            // Dibujar con el estado recibido
            dibujarFrame();

            // Pedir siguiente paso de física
            if (workerListo) {
              worker.postMessage({
                tipo: "paso",
                usarEnRelacion: usarEnRelacion,
                clavesPropiedades: clavesPropiedades
              });
            }
          } else if (datos.tipo === "iniciado") {
            workerListo = true;
            // Primer paso de física
            worker.postMessage({
              tipo: "paso",
              usarEnRelacion: usarEnRelacion,
              clavesPropiedades: clavesPropiedades
            });
          }
        };

        // Enviar estado inicial al worker
        const particulasPlano = particulasIniciales.map(p => ({
          x: p.x,
          y: p.y,
          vx: p.vx,
          vy: p.vy,
          ax: 0,
          ay: 0,
          fija: false,
          estableFrames: 0,
          datos: p.datos
        }));

        worker.postMessage({
          tipo: "inicializar",
          particulas: particulasPlano,
          clavesPropiedades: claves,
          usarEnRelacion: usarEnRelacion,
          ancho: ancho,
          alto: alto
        });
      }

      // --- Dibujo de un frame completo ---
      function dibujarFrame(){
        ctxLineas.clearRect(0, 0, ancho, alto);
        ctxNodos.clearRect(0, 0, ancho, alto);

        for (let i = 0; i < numeroParticulas; i++){
          particulas[i].dibujarLineas();
        }
        for (let i = 0; i < numeroParticulas; i++){
          particulas[i].dibujarNodos();
        }

        requestAnimationFrame(() => {});
      }

      // --- Cargar JSON y arrancar ---
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          particulas = [];
          numeroParticulas = personas.length;

          // Detectar todas las propiedades
          const conjuntoClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => conjuntoClaves.add(k));
          });
          const claves = Array.from(conjuntoClaves);

          // Crear controles dinámicos
          crearControlesPropiedades(claves);

          // Crear objetos Particula en el hilo principal
          for (let i = 0; i < personas.length; i++){
            const persona = personas[i];
            particulas.push(
              new Particula(
                Math.random() * ancho,
                Math.random() * alto,
                Math.random() * Math.PI * 2,
                persona
              )
            );
          }

          // Iniciar worker con la física
          iniciarWorker(particulas, clavesPropiedades);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### espacio en 3D

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #ddd;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#555;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control en 2D -->
    <div id="controles">
      <label>
        Grosor mínimo
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación:<br>
        W/A/S/D: mover plano XZ<br>
        Ratón: mirar alrededor<br>
        Q/E: subir/bajar (vuelo)<br>
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #ECECEC">
      <!-- Cámara + controles FPS + "vuelo" con Q/E (lo añadimos en JS) -->
      <a-entity id="rig" position="0 3 15">
        <a-entity camera look-controls wasd-controls position="0 0 0"></a-entity>
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.7" position="1 2 0"></a-entity>

      <!-- Contenedor de conexiones (líneas) -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos (se rellenará desde JS) -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      // ---------- Utilidades ----------

      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      // ---------- Escena y entidades base ----------

      const escenaEl      = document.querySelector("a-scene");
      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // --- Parámetros físicos 3D ---
      const LIM_X = 20;  // límites de espacio en X
      const LIM_Y = 10;  // altura
      const LIM_Z = 20;  // límites en Z

      // Física (similar a antes, pero 3D)
      const DISTANCIA_OBJETIVO          = 6;
      const DISTANCIA_MINIMA            = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION = 12; // distancia máxima para dibujar conexión

      // ---------- Controles UI ----------

      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];   // nombres de propiedades del JSON
      let usarEnRelacion    = {};   // {prop: boolean}
      let mostrarEnEtiqueta = {};   // {prop: boolean}

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          // Usar en relación
          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            // Reactivar todas las partículas al cambiar condiciones
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          // Mostrar en etiqueta
          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });
      }

      // ---------- Datos y nodos 3D ----------

      let particulas = []; // cada partícula: {x,y,z,vx,vy,vz,ax,ay,az,fija,estableFrames,datos, nodeEl, textEl, sphereEl}
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1; // un poco por encima del suelo
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);

          const sphere = document.createElement("a-sphere");
          sphere.setAttribute("radius", "0.4");
          sphere.setAttribute("color", "#FFFFFF");
          sphere.setAttribute("metalness", "0.1");
          sphere.setAttribute("roughness", "0.8");
          nodo.appendChild(sphere);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#111",
            width: 2,
            wrapCount: 16
          });
          texto.setAttribute("position", "0 0.8 0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          particulas.push({
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            sphereEl:sphere
          });
        }
      }

      // ---------- Física 3D en el hilo principal ----------

      function pasoFisica(){
        const n = numeroParticulas;
        if (n === 0) return;

        // Reiniciar aceleraciones
        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        // Fuerzas de interacción
        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;
            if (d > Math.sqrt((LIM_X*2)**2 + (LIM_Y*2)**2 + (LIM_Z*2)**2)) continue;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            // Repulsión fuerte a corta distancia
            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            // Coincidencias según propiedades activas
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              // Atracción fuerte
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              // Atracción media
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              // Sin coincidencias: ligera repulsión si está relativamente cerca
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          // Limitar fuerza total
          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        // Integración y rebotes
        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            // Rebotes con caja
            const REBOTE = -0.5;

            if (p.x > LIM_X){
              p.x = LIM_X;
              p.vx *= REBOTE;
            }
            if (p.x < -LIM_X){
              p.x = -LIM_X;
              p.vx *= REBOTE;
            }
            if (p.z > LIM_Z){
              p.z = LIM_Z;
              p.vz *= REBOTE;
            }
            if (p.z < -LIM_Z){
              p.z = -LIM_Z;
              p.vz *= REBOTE;
            }
            if (p.y > LIM_Y){
              p.y = LIM_Y;
              p.vy *= REBOTE;
            }
            if (p.y < 0.5){
              p.y = 0.5;
              p.vy *= REBOTE;
            }

            // Estabilidad
            const vel = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);

            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          // Actualizar posición en la escena
          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);
          // Actualizar etiqueta (por si cambian los toggles)
          p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
        }
      }

      // ---------- Conexiones 3D ----------

      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          for (let j = i+1; j < n; j++){
            const b = particulas[j];

            const d = distancia3D(a.x,a.y,a.z,b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            // Coincidencias en propiedades activas
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Bucle principal ----------

      function bucle(){
        pasoFisica();
        actualizarConexiones();
        requestAnimationFrame(bucle);
      }

      // ---------- "Fly" con Q/E (subida/bajada del rig) ----------

      window.addEventListener("keydown", (e) => {
        const paso = 0.4;
        const pos = rigEl.object3D.position;
        if (e.key === "q" || e.key === "Q"){
          pos.y += paso;
        } else if (e.key === "e" || e.key === "E"){
          pos.y -= paso;
        }
      });

      // ---------- Carga de datos y arranque ----------

      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          // Detectar propiedades
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);

          // Crear nodos 3D
          crearNodos3D(personas);

          // Arrancar bucle
          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### espacio en 3D mejorado

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #ddd;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#555;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en esfera: zoom suave a esa persona
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #ECECEC">
      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.7" position="1 2 0"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      // ---------- Escena y entidades ----------
      const escenaEl      = document.querySelector("a-scene");
      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO          = 6;
      const DISTANCIA_MINIMA            = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10; // frames

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      let etiquetasSucias = false; // para no recalcular texto cada frame

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          // Usar en relación
          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            // Reactivar partículas y recalcular textos
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          // Mostrar en etiqueta
          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);

          const sphere = document.createElement("a-sphere");
          sphere.setAttribute("radius", "0.4");
          sphere.setAttribute("color", "#FFFFFF");
          sphere.setAttribute("metalness", "0.1");
          sphere.setAttribute("roughness", "0.8");
          sphere.setAttribute("class", "clickable");
          nodo.appendChild(sphere);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#111",
            width: 2,
            wrapCount: 16
          });
          texto.setAttribute("position", "0 0.8 0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            sphereEl:sphere
          };

          // Click -> zoom a este nodo
          sphere.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        // Reiniciar aceleraciones
        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        // Fuerzas
        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            // Repulsión fuerte corta distancia
            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            // Coincidencias
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          // Limitar fuerza
          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        // Integración
        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            // Caja de límites
            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            // Estabilidad
            const vel = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          // Actualizar posición en escena
          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          // Actualizar etiqueta solo cuando cambian los toggles
          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D (limitadas) ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            // Coincidencias
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          // Ordenar por distancia y quedarnos con los más cercanos
          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls caseros ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6; // unidades por segundo

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);  // dirección hacia delante
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        // adelante/atrás
        if (flyEstado.adelante) move.add(dir);
        if (flyEstado.atras)    move.add(dir.clone().multiplyScalar(-1));

        // izquierda/derecha
        if (flyEstado.derecha)  move.add(right);
        if (flyEstado.izquierda)move.add(right.clone().multiplyScalar(-1));

        // arriba/abajo
        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave al hacer clic ----------
      let zoomAnim = null; // {from:Vector3, to:Vector3, t:number, dur:number}

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        // Punto de destino: cerca de la partícula, un poco desplazado
        const destino = new THREE.Vector3(p.x, p.y + 1, p.z + 4);

        zoomAnim = {
          from: rigPos,
          to: destino,
          t: 0,
          dur: 1.0 // segundos
        };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1){
          t = 1;
        }

        // ease in-out quad
        const ease = t < 0.5
          ? 2*t*t
          : -1 + (4 - 2*t)*t;

        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);

        if (zoomAnim.t >= 1){
          zoomAnim = null;
        }
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos y arranque ----------
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);

          crearNodos3D(personas);

          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### direccion corregida

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(255,255,255,0.9);
        border:1px solid #ccc;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #ddd;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#555;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en esfera: zoom suave a esa persona
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #ECECEC">
      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.7" position="1 2 0"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      // ---------- Escena y entidades ----------
      const escenaEl      = document.querySelector("a-scene");
      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO          = 6;
      const DISTANCIA_MINIMA            = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10; // frames

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      let etiquetasSucias = false; // para no recalcular texto cada frame

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          // Usar en relación
          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            // Reactivar partículas
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          // Mostrar en etiqueta
          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);

          const sphere = document.createElement("a-sphere");
          sphere.setAttribute("radius", "0.4");
          sphere.setAttribute("color", "#FFFFFF");
          sphere.setAttribute("metalness", "0.1");
          sphere.setAttribute("roughness", "0.8");
          sphere.setAttribute("class", "clickable");
          nodo.appendChild(sphere);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#111",
            width: 2,
            wrapCount: 16
          });
          texto.setAttribute("position", "0 0.8 0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            sphereEl:sphere
          };

          // Click -> zoom a este nodo
          sphere.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        // Reiniciar aceleraciones
        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        // Fuerzas
        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            // Repulsión fuerte corta distancia
            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            // Coincidencias
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          // Limitar fuerza
          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        // Integración
        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            // Caja de límites
            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            // Estabilidad
            const vel = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          // Actualizar posición en escena
          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          // Actualizar etiqueta solo cuando cambian los toggles
          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D (limitadas) ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            // Coincidencias
            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          // Ordenar por distancia y quedarnos con los más cercanos
          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls caseros ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6; // unidades por segundo

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);  // dirección hacia "delante" (normalizada por A-Frame)
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        // ADELANTE / ATRÁS (corregido):
        // Usamos -dir para que W sea hacia delante visualmente.
        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);

        // IZQUIERDA / DERECHA
        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));

        // ARRIBA / ABAJO
        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave al hacer clic ----------
      let zoomAnim = null; // {from:Vector3, to:Vector3, t:number, dur:number}

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        // Punto de destino: cerca de la partícula, un poco desplazado
        const destino = new THREE.Vector3(p.x, p.y + 1, p.z + 4);

        zoomAnim = {
          from: rigPos,
          to: destino,
          t: 0,
          dur: 1.0 // segundos
        };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1){
          t = 1;
        }

        // ease in-out quad
        const ease = t < 0.5
          ? 2*t*t
          : -1 + (4 - 2*t)*t;

        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);

        if (zoomAnim.t >= 1){
          zoomAnim = null;
        }
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos y arranque ----------
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);

          crearNodos3D(personas);

          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### billboards y mas cosas

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(0,0,0,0.55);
        border:1px solid #444;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
        color:#eee;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #555;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#ccc;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo (solo UI)
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo (solo UI)
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en cápsula: zoom suave a esa persona
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #000000">
      <!-- Cielo con gradiente -->
      <a-sky material="shader: gradiente; topColor: #88c8ff; bottomColor: #02041a"></a-sky>

      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #8899aa"></a-entity>
      <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="1 3 2"></a-entity>
      <a-entity light="type: point; color: #88bbff; intensity: 0.4" position="-5 4 -3"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Shader gradiente para el cielo ----------
      AFRAME.registerShader('gradiente', {
        schema: {
          topColor:    {type: 'color', default: '#88c8ff'},
          bottomColor: {type: 'color', default: '#02041a'}
        },
        init: function (data) {
          this.uniforms = {
            topColor:    { value: new THREE.Color(data.topColor) },
            bottomColor: { value: new THREE.Color(data.bottomColor) }
          };
          this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            vertexShader: `
              varying vec3 vWorldPosition;
              void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * viewMatrix * worldPosition;
              }
            `,
            fragmentShader: `
              uniform vec3 topColor;
              uniform vec3 bottomColor;
              varying vec3 vWorldPosition;
              void main() {
                float h = normalize(vWorldPosition).y;
                float t = clamp(h * 0.5 + 0.5, 0.0, 1.0);
                vec3 color = mix(bottomColor, topColor, t);
                gl_FragColor = vec4(color, 1.0);
              }
            `,
            side: THREE.BackSide,
            depthWrite: false
          });
        },
        update: function (data) {
          this.uniforms.topColor.value.set(data.topColor);
          this.uniforms.bottomColor.value.set(data.bottomColor);
        }
      });

      // ---------- Componente billboard (mirar a la cámara) ----------
      AFRAME.registerComponent('billboard', {
        schema: { target: { type: 'selector' } },
        init: function () {
          this.camEl = this.data.target || document.querySelector('#rig');
        },
        tick: function () {
          if (!this.camEl) return;
          const obj = this.el.object3D;
          const camPos = new THREE.Vector3();
          this.camEl.object3D.getWorldPosition(camPos);
          obj.lookAt(camPos);
        }
      });

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      // ---------- Escena y entidades ----------
      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO           = 6;
      const DISTANCIA_MINIMA             = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10; // frames

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      let etiquetasSucias = false;

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          // Usar en relación
          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          // Mostrar en etiqueta
          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      // Cápsula transparente horizontal (como pastilla 2D)
      function crearCapsulaTransparenteHorizontal(){
        const capsula = document.createElement("a-entity");
        capsula.setAttribute("class", "clickable");
        // Eje largo horizontal: rotamos 90º alrededor de Z
        capsula.setAttribute("rotation", "0 0 90");

        const materialStr = "color: #ffffff; opacity: 0.25; transparent: true; metalness: 0.2; roughness: 0.1; side: double";

        // cilindro central (eje local Y, pero girado por el padre -> horizontal en pantalla)
        const cilindro = document.createElement("a-cylinder");
        cilindro.setAttribute("radius", 0.7);
        cilindro.setAttribute("height", 1.8);
        cilindro.setAttribute("position", "0 0 0");
        cilindro.setAttribute("material", materialStr);
        capsula.appendChild(cilindro);

        const esferaArriba = document.createElement("a-sphere");
        esferaArriba.setAttribute("radius", 0.7);
        esferaArriba.setAttribute("position", "0 0.9 0");
        esferaArriba.setAttribute("material", materialStr);
        capsula.appendChild(esferaArriba);

        const esferaAbajo = document.createElement("a-sphere");
        esferaAbajo.setAttribute("radius", 0.7);
        esferaAbajo.setAttribute("position", "0 -0.9 0");
        esferaAbajo.setAttribute("material", materialStr);
        capsula.appendChild(esferaAbajo);

        return capsula;
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          // Nodo contenedor que se mueve y mira a la cámara
          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);
          nodo.setAttribute("billboard", "target: #rig");

          // Cápsula horizontal
          const capsula = crearCapsulaTransparenteHorizontal();
          nodo.appendChild(capsula);

          // Texto centrado dentro de la cápsula
          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#000000",
            width: 3,
            wrapCount: 20,
            baseline: "center"
          });
          // Ligero desplazamiento en Z para evitar z-fighting, y giro 180º por si acaso
          texto.setAttribute("position", "0 0 0.01");
          texto.setAttribute("rotation", "0 180 0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            capsulaEl:capsula
          };

          // Click en la cápsula -> zoom a este nodo
          capsula.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            const vel  = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6;

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        // W = delante, S = detrás
        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);

        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));

        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave al hacer clic ----------
      let zoomAnim = null;

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        // un poco desplazado hacia "delante" desde el punto del nodo
        const destino = new THREE.Vector3(p.x, p.y + 0.5, p.z + 5);

        zoomAnim = {
          from: rigPos,
          to: destino,
          t: 0,
          dur: 1.0
        };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1) t = 1;

        const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;

        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);

        if (zoomAnim.t >= 1){
          zoomAnim = null;
        }
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos y arranque ----------
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);

          crearNodos3D(personas);

          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### mejoras en ver texto

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(0,0,0,0.55);
        border:1px solid #444;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
        color:#eee;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #555;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#ccc;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo (solo UI)
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo (solo UI)
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en cápsula: zoom suave a esa persona
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #000000">
      <!-- Cielo con gradiente -->
      <a-sky material="shader: gradiente; topColor: #88c8ff; bottomColor: #02041a"></a-sky>

      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #8899aa"></a-entity>
      <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="1 3 2"></a-entity>
      <a-entity light="type: point; color: #88bbff; intensity: 0.4" position="-5 4 -3"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Shader gradiente para el cielo ----------
      AFRAME.registerShader('gradiente', {
        schema: {
          topColor:    {type: 'color', default: '#88c8ff'},
          bottomColor: {type: 'color', default: '#02041a'}
        },
        init: function (data) {
          this.uniforms = {
            topColor:    { value: new THREE.Color(data.topColor) },
            bottomColor: { value: new THREE.Color(data.bottomColor) }
          };
          this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            vertexShader: `
              varying vec3 vWorldPosition;
              void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * viewMatrix * worldPosition;
              }
            `,
            fragmentShader: `
              uniform vec3 topColor;
              uniform vec3 bottomColor;
              varying vec3 vWorldPosition;
              void main() {
                float h = normalize(vWorldPosition).y;
                float t = clamp(h * 0.5 + 0.5, 0.0, 1.0);
                vec3 color = mix(bottomColor, topColor, t);
                gl_FragColor = vec4(color, 1.0);
              }
            `,
            side: THREE.BackSide,
            depthWrite: false
          });
        },
        update: function (data) {
          this.uniforms.topColor.value.set(data.topColor);
          this.uniforms.bottomColor.value.set(data.bottomColor);
        }
      });

      // ---------- Componente billboard ----------
      AFRAME.registerComponent('billboard', {
        schema: { target: { type: 'selector' } },
        init: function () {
          this.camEl = this.data.target || document.querySelector('#rig');
        },
        tick: function () {
          if (!this.camEl) return;
          const obj = this.el.object3D;
          const camPos = new THREE.Vector3();
          this.camEl.object3D.getWorldPosition(camPos);
          obj.lookAt(camPos);
        }
      });

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      // ---------- Escena y entidades ----------
      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO           = 6;
      const DISTANCIA_MINIMA             = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10;

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      let etiquetasSucias = false;

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      // Cápsula transparente horizontal
      function crearCapsulaTransparenteHorizontal(){
        const capsula = document.createElement("a-entity");
        capsula.setAttribute("class", "clickable");
        capsula.setAttribute("rotation", "0 0 90");

        // 👇 clave: depthWrite: false para no bloquear el texto
        const materialStr =
          "color: #ffffff; opacity: 0.25; transparent: true; " +
          "metalness: 0.2; roughness: 0.1; side: double; depthWrite: false; depthTest: true";

        const cilindro = document.createElement("a-cylinder");
        cilindro.setAttribute("radius", 0.7);
        cilindro.setAttribute("height", 1.8);
        cilindro.setAttribute("position", "0 0 0");
        cilindro.setAttribute("material", materialStr);
        capsula.appendChild(cilindro);

        const esferaArriba = document.createElement("a-sphere");
        esferaArriba.setAttribute("radius", 0.7);
        esferaArriba.setAttribute("position", "0 0.9 0");
        esferaArriba.setAttribute("material", materialStr);
        capsula.appendChild(esferaArriba);

        const esferaAbajo = document.createElement("a-sphere");
        esferaAbajo.setAttribute("radius", 0.7);
        esferaAbajo.setAttribute("position", "0 -0.9 0");
        esferaAbajo.setAttribute("material", materialStr);
        capsula.appendChild(esferaAbajo);

        return capsula;
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);
          nodo.setAttribute("billboard", "target: #rig");

          const capsula = crearCapsulaTransparenteHorizontal();
          nodo.appendChild(capsula);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#000000",
            width: 3,
            wrapCount: 20,
            baseline: "center"
          });
          // lo adelantamos un poco más para evitar z-fighting
          texto.setAttribute("position", "0 0 0.03");
          texto.setAttribute("rotation", "0 180 0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            capsulaEl:capsula
          };

          capsula.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            const vel  = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6;

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);

        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));

        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave ----------
      let zoomAnim = null;

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        const destino = new THREE.Vector3(p.x, p.y + 0.5, p.z + 5);

        zoomAnim = {
          from: rigPos,
          to: destino,
          t: 0,
          dur: 1.0
        };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1) t = 1;

        const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;

        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);

        if (zoomAnim.t >= 1){
          zoomAnim = null;
        }
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos ----------
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);
          crearNodos3D(personas);
          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### texto a ver si ahora si

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(0,0,0,0.55);
        border:1px solid #444;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
        color:#eee;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:24px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #555;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#ccc;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo (solo UI)
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo (solo UI)
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en cápsula: zoom suave a esa persona
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #000000">
      <!-- Cielo con gradiente -->
      <a-sky material="shader: gradiente; topColor: #88c8ff; bottomColor: #02041a"></a-sky>

      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #8899aa"></a-entity>
      <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="1 3 2"></a-entity>
      <a-entity light="type: point; color: #88bbff; intensity: 0.4" position="-5 4 -3"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Shader gradiente para el cielo ----------
      AFRAME.registerShader('gradiente', {
        schema: {
          topColor:    {type: 'color', default: '#88c8ff'},
          bottomColor: {type: 'color', default: '#02041a'}
        },
        init: function (data) {
          this.uniforms = {
            topColor:    { value: new THREE.Color(data.topColor) },
            bottomColor: { value: new THREE.Color(data.bottomColor) }
          };
          this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            vertexShader: `
              varying vec3 vWorldPosition;
              void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * viewMatrix * worldPosition;
              }
            `,
            fragmentShader: `
              uniform vec3 topColor;
              uniform vec3 bottomColor;
              varying vec3 vWorldPosition;
              void main() {
                float h = normalize(vWorldPosition).y;
                float t = clamp(h * 0.5 + 0.5, 0.0, 1.0);
                vec3 color = mix(bottomColor, topColor, t);
                gl_FragColor = vec4(color, 1.0);
              }
            `,
            side: THREE.BackSide,
            depthWrite: false
          });
        },
        update: function (data) {
          this.uniforms.topColor.value.set(data.topColor);
          this.uniforms.bottomColor.value.set(data.bottomColor);
        }
      });

      // ---------- Componente billboard ----------
      AFRAME.registerComponent('billboard', {
        schema: { target: { type: 'selector' } },
        init: function () {
          this.camEl = this.data.target || document.querySelector('#rig');
        },
        tick: function () {
          if (!this.camEl) return;
          const obj = this.el.object3D;
          const camPos = new THREE.Vector3();
          this.camEl.object3D.getWorldPosition(camPos);
          obj.lookAt(camPos);
        }
      });

      // ---------- Componente para ajustar materiales de cápsula ----------
      AFRAME.registerComponent('transparente-capsula', {
        init: function () {
          const el = this.el;
          const applySettings = () => {
            el.object3D.traverse(obj => {
              if (obj.isMesh && obj.material) {
                const m = obj.material;
                m.transparent = true;
                m.opacity = 0.25;
                m.depthWrite = false;   // 👈 no escribe en z-buffer
                m.depthTest  = true;
                m.side = THREE.DoubleSide;
                m.needsUpdate = true;
              }
            });
          };
          if (el.object3D) {
            applySettings();
          }
          el.addEventListener('object3dset', applySettings);
        }
      });

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO           = 6;
      const DISTANCIA_MINIMA             = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10;

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      let etiquetasSucias = false;

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      // Cápsula transparente horizontal
      function crearCapsulaTransparenteHorizontal(){
        const capsula = document.createElement("a-entity");
        capsula.setAttribute("class", "clickable");
        capsula.setAttribute("rotation", "0 0 90");
        capsula.setAttribute("transparente-capsula", ""); // aplica el componente

        // la geometría en sí, materiales los ajusta el componente
        const cilindro = document.createElement("a-cylinder");
        cilindro.setAttribute("radius", 0.7);
        cilindro.setAttribute("height", 1.8);
        cilindro.setAttribute("position", "0 0 0");
        capsula.appendChild(cilindro);

        const esferaArriba = document.createElement("a-sphere");
        esferaArriba.setAttribute("radius", 0.7);
        esferaArriba.setAttribute("position", "0 0.9 0");
        capsula.appendChild(esferaArriba);

        const esferaAbajo = document.createElement("a-sphere");
        esferaAbajo.setAttribute("radius", 0.7);
        esferaAbajo.setAttribute("position", "0 -0.9 0");
        capsula.appendChild(esferaAbajo);

        return capsula;
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);
          nodo.setAttribute("billboard", "target: #rig");

          const capsula = crearCapsulaTransparenteHorizontal();
          nodo.appendChild(capsula);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#000000",
            width: 3,
            wrapCount: 20,
            baseline: "center"
          });
          // IMPORTANTE: -Z = más cerca de la cámara (porque el nodo mira al rig)
          texto.setAttribute("position", "0 0 -0.02");
          texto.setAttribute("rotation", "0 180 0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            capsulaEl:capsula
          };

          capsula.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            const vel  = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6;

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);
        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));
        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave ----------
      let zoomAnim = null;

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        const destino = new THREE.Vector3(p.x, p.y + 0.5, p.z + 5);
        zoomAnim = { from: rigPos, to: destino, t: 0, dur: 1.0 };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1) t = 1;
        const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;
        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);
        if (zoomAnim.t >= 1) zoomAnim = null;
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos ----------
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);
          crearNodos3D(personas);
          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### giramos el texto

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(0,0,0,0.55);
        border:1px solid #444;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
        color:#eee;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:32px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #555;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#ccc;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo (solo UI)
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo (solo UI)
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <!-- *** NUEVO: mostrar/ocultar cápsulas -->
      <div class="fila">
        <label>
          <input id="chkMostrarCapsulas" type="checkbox" checked>
          Mostrar cápsulas
        </label>
      </div>

      <!-- *** NUEVO: transparencia de cápsulas -->
      <div class="fila">
        Transparencia cápsulas
        <input id="opacidadCapsulas" type="range" min="5" max="100" value="25">
        <span id="opacidadCapsulasValor" class="valor">25%</span>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas del JSON)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en cápsula: zoom suave a esa persona
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #000000">
      <!-- Cielo con gradiente -->
      <a-sky material="shader: gradiente; topColor: #88c8ff; bottomColor: #02041a"></a-sky>

      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #8899aa"></a-entity>
      <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="1 3 2"></a-entity>
      <a-entity light="type: point; color: #88bbff; intensity: 0.4" position="-5 4 -3"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Shader gradiente para el cielo ----------
      AFRAME.registerShader('gradiente', {
        schema: {
          topColor:    {type: 'color', default: '#88c8ff'},
          bottomColor: {type: 'color', default: '#02041a'}
        },
        init: function (data) {
          this.uniforms = {
            topColor:    { value: new THREE.Color(data.topColor) },
            bottomColor: { value: new THREE.Color(data.bottomColor) }
          };
          this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            vertexShader: `
              varying vec3 vWorldPosition;
              void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * viewMatrix * worldPosition;
              }
            `,
            fragmentShader: `
              uniform vec3 topColor;
              uniform vec3 bottomColor;
              varying vec3 vWorldPosition;
              void main() {
                float h = normalize(vWorldPosition).y;
                float t = clamp(h * 0.5 + 0.5, 0.0, 1.0);
                vec3 color = mix(bottomColor, topColor, t);
                gl_FragColor = vec4(color, 1.0);
              }
            `,
            side: THREE.BackSide,
            depthWrite: false
          });
        },
        update: function (data) {
          this.uniforms.topColor.value.set(data.topColor);
          this.uniforms.bottomColor.value.set(data.bottomColor);
        }
      });

      // ---------- Componente billboard ----------
      AFRAME.registerComponent('billboard', {
        schema: { target: { type: 'selector' } },
        init: function () {
          this.camEl = this.data.target || document.querySelector('#rig');
        },
        tick: function () {
          if (!this.camEl) return;
          const obj = this.el.object3D;
          const camPos = new THREE.Vector3();
          this.camEl.object3D.getWorldPosition(camPos);
          obj.lookAt(camPos);
        }
      });

      // ---------- Componente para ajustar materiales de cápsula ----------
      AFRAME.registerComponent('transparente-capsula', {
        schema: {
          opacity: { type: 'number', default: 0.25 }  // *** ahora parametrizable
        },
        init: function () {
          const el = this.el;
          const self = this;

          this.applySettings = function () {          // *** guardamos la función en this
            el.object3D.traverse(obj => {
              if (obj.isMesh && obj.material) {
                const m = obj.material;
                m.transparent = true;
                m.opacity = self.data.opacity;        // *** usamos la opacidad del componente
                m.depthWrite = false;
                m.depthTest  = true;
                m.side = THREE.DoubleSide;
                m.needsUpdate = true;
              }
            });
          };

          if (el.object3D) {
            this.applySettings();
          }
          el.addEventListener('object3dset', () => this.applySettings());
        },
        update: function (oldData) {                  // *** se llama al cambiar atributos
          if (oldData && oldData.opacity === this.data.opacity) return;
          if (this.applySettings) this.applySettings();
        }
      });

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO           = 6;
      const DISTANCIA_MINIMA             = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10;

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      // *** NUEVO estado de cápsulas
      let mostrarCapsulas   = true;
      let opacidadCapsulas  = 0.25;

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      const chkMostrarCapsulas       = document.getElementById("chkMostrarCapsulas");       // ***
      const sliderOpacidadCapsulas   = document.getElementById("opacidadCapsulas");          // ***
      const spanOpacidadCapsulas     = document.getElementById("opacidadCapsulasValor");     // ***

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      // *** mostrar/ocultar cápsulas
      chkMostrarCapsulas.addEventListener("change", () => {
        mostrarCapsulas = chkMostrarCapsulas.checked;
        particulas.forEach(p => {
          if (p.capsulaEl) {
            p.capsulaEl.object3D.visible = mostrarCapsulas;
          }
        });
      });

      // *** transparencia de cápsulas
      sliderOpacidadCapsulas.addEventListener("input", () => {
        const v = parseInt(sliderOpacidadCapsulas.value, 10);
        opacidadCapsulas = v / 100;
        spanOpacidadCapsulas.textContent = v + "%";
        particulas.forEach(p => {
          if (p.capsulaEl) {
            p.capsulaEl.setAttribute("transparente-capsula", "opacity:" + opacidadCapsulas);
          }
        });
      });

      let etiquetasSucias = false;

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datos){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datos[prop] !== undefined && datos[prop] !== null) ? String(datos[prop]) : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      // Cápsula transparente horizontal
      function crearCapsulaTransparenteHorizontal(){
        const capsula = document.createElement("a-entity");
        capsula.setAttribute("class", "clickable");
        capsula.setAttribute("rotation", "0 0 90");
        capsula.setAttribute("transparente-capsula", "opacity:0.25"); // *** se usará el slider para cambiarla

        const cilindro = document.createElement("a-cylinder");
        cilindro.setAttribute("radius", 0.7);
        cilindro.setAttribute("height", 1.8);
        cilindro.setAttribute("position", "0 0 0");
        capsula.appendChild(cilindro);

        const esferaArriba = document.createElement("a-sphere");
        esferaArriba.setAttribute("radius", 0.7);
        esferaArriba.setAttribute("position", "0 0.9 0");
        capsula.appendChild(esferaArriba);

        const esferaAbajo = document.createElement("a-sphere");
        esferaAbajo.setAttribute("radius", 0.7);
        esferaAbajo.setAttribute("position", "0 -0.9 0");
        capsula.appendChild(esferaAbajo);

        return capsula;
      }

      function crearNodos3D(personas){
        particulas = [];
        numeroParticulas = personas.length;

        for (let i = 0; i < personas.length; i++){
          const persona = personas[i];

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);
          nodo.setAttribute("billboard", "target: #rig");

          const capsula = crearCapsulaTransparenteHorizontal();
          nodo.appendChild(capsula);

          // *** TEXTO ARREGLADO: sin rotación 180 y más separado de la cápsula
          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(persona),
            align: "center",
            color: "#ffffff",   // blanco para máximo contraste
            width: 3,
            wrapCount: 20,
            baseline: "center"
          });
          // -Z está mirando a la cámara tras el billboard, así que el texto sale hacia la cámara
          texto.setAttribute("position", "0 0 -1.0"); // un poco por delante de la cápsula
          // sin rotación extra: ya hereda el lookAt del nodo
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:persona,
            nodeEl:nodo,
            textEl:texto,
            capsulaEl:capsula
          };

          // aplicar estado inicial de cápsulas
          capsula.object3D.visible = mostrarCapsulas;
          capsula.setAttribute("transparente-capsula", "opacity:" + opacidadCapsulas);

          capsula.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            const vel  = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6;

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);
        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));
        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave ----------
      let zoomAnim = null;

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        const destino = new THREE.Vector3(p.x, p.y + 0.5, p.z + 5);
        zoomAnim = { from: rigPos, to: destino, t: 0, dur: 1.0 };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1) t = 1;
        const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;
        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);
        if (zoomAnim.t >= 1) zoomAnim = null;
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos ----------
      fetch("personas.json")
        .then(r => r.json())
        .then(personas => {
          const setClaves = new Set();
          personas.forEach(p => {
            Object.keys(p).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);
          crearControlesPropiedades(claves);
          crearNodos3D(personas);
          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### carga de datos json

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(0,0,0,0.55);
        border:1px solid #444;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
        color:#eee;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:32px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #555;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#ccc;
      }

      /* --- Modal 2D --- */
      #modalOverlay{
        position:fixed;
        top:0;
        left:0;
        width:100vw;
        height:100vh;
        background:rgba(0,0,0,0.65);
        display:none;
        align-items:center;
        justify-content:center;
        z-index:20;
      }
      #modalCaja{
        background:#111;
        border:1px solid #555;
        border-radius:6px;
        max-width:600px;
        max-height:80vh;
        width:90%;
        box-shadow:0 0 20px rgba(0,0,0,0.8);
        color:#eee;
        display:flex;
        flex-direction:column;
      }
      #modalHeader{
        padding:8px 10px;
        border-bottom:1px solid #444;
        display:flex;
        justify-content:space-between;
        align-items:center;
        font-size:14px;
        background:#222;
      }
      #modalTitulo{
        font-weight:bold;
      }
      #modalCerrar{
        cursor:pointer;
        padding:2px 6px;
        border-radius:3px;
        border:1px solid #666;
        background:#333;
        font-size:12px;
      }
      #modalCerrar:hover{
        background:#555;
      }
      #modalContenido{
        padding:10px;
        overflow:auto;
        font-size:13px;
        line-height:1.4;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo (solo UI)
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo (solo UI)
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <label>
          <input id="chkMostrarCapsulas" type="checkbox" checked>
          Mostrar cápsulas
        </label>
      </div>

      <div class="fila">
        Transparencia cápsulas
        <input id="opacidadCapsulas" type="range" min="5" max="100" value="25">
        <span id="opacidadCapsulasValor" class="valor">25%</span>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas de categories)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en nodo: zoom + modal 2D con contenido
      </div>
    </div>

    <!-- Modal 2D -->
    <div id="modalOverlay">
      <div id="modalCaja">
        <div id="modalHeader">
          <div id="modalTitulo">Detalle de nodo</div>
          <button id="modalCerrar">Cerrar</button>
        </div>
        <div id="modalContenido"></div>
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #000000">
      <!-- Cielo con gradiente -->
      <a-sky material="shader: gradiente; topColor: #88c8ff; bottomColor: #02041a"></a-sky>

      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse; fuse: false"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #8899aa"></a-entity>
      <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="1 3 2"></a-entity>
      <a-entity light="type: point; color: #88bbff; intensity: 0.4" position="-5 4 -3"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Shader gradiente para el cielo ----------
      AFRAME.registerShader('gradiente', {
        schema: {
          topColor:    {type: 'color', default: '#88c8ff'},
          bottomColor: {type: 'color', default: '#02041a'}
        },
        init: function (data) {
          this.uniforms = {
            topColor:    { value: new THREE.Color(data.topColor) },
            bottomColor: { value: new THREE.Color(data.bottomColor) }
          };
          this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            vertexShader: `
              varying vec3 vWorldPosition;
              void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * viewMatrix * worldPosition;
              }
            `,
            fragmentShader: `
              uniform vec3 topColor;
              uniform vec3 bottomColor;
              varying vec3 vWorldPosition;
              void main() {
                float h = normalize(vWorldPosition).y;
                float t = clamp(h * 0.5 + 0.5, 0.0, 1.0);
                vec3 color = mix(bottomColor, topColor, t);
                gl_FragColor = vec4(color, 1.0);
              }
            `,
            side: THREE.BackSide,
            depthWrite: false
          });
        },
        update: function (data) {
          this.uniforms.topColor.value.set(data.topColor);
          this.uniforms.bottomColor.value.set(data.bottomColor);
        }
      });

      // ---------- Componente billboard ----------
      AFRAME.registerComponent('billboard', {
        schema: { target: { type: 'selector' } },
        init: function () {
          this.camEl = this.data.target || document.querySelector('#rig');
        },
        tick: function () {
          if (!this.camEl) return;
          const obj = this.el.object3D;
          const camPos = new THREE.Vector3();
          this.camEl.object3D.getWorldPosition(camPos);
          obj.lookAt(camPos);
        }
      });

      // ---------- Componente cápsula transparente ----------
      AFRAME.registerComponent('transparente-capsula', {
        schema: {
          opacity: { type: 'number', default: 0.25 }
        },
        init: function () {
          const el = this.el;
          const self = this;

          this.applySettings = function () {
            el.object3D.traverse(obj => {
              if (obj.isMesh && obj.material) {
                const m = obj.material;
                m.transparent = true;
                m.opacity = self.data.opacity;
                m.depthWrite = false;
                m.depthTest  = true;
                m.side = THREE.DoubleSide;
                m.needsUpdate = true;
              }
            });
          };

          if (el.object3D) {
            this.applySettings();
          }
          el.addEventListener('object3dset', () => this.applySettings());
        },
        update: function (oldData) {
          if (oldData && oldData.opacity === this.data.opacity) return;
          if (this.applySettings) this.applySettings();
        }
      });

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // Modal
      const modalOverlay   = document.getElementById("modalOverlay");
      const modalContenido = document.getElementById("modalContenido");
      const modalTitulo    = document.getElementById("modalTitulo");
      const modalCerrar    = document.getElementById("modalCerrar");

      function mostrarModal(titulo, html){
        modalTitulo.textContent = titulo || "Detalle de nodo";
        modalContenido.innerHTML = html || "<p>(Sin contenido)</p>";
        modalOverlay.style.display = "flex";
      }
      function ocultarModal(){
        modalOverlay.style.display = "none";
      }
      modalCerrar.addEventListener("click", ocultarModal);
      modalOverlay.addEventListener("click", (e)=>{
        if (e.target === modalOverlay) ocultarModal();
      });

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO           = 6;
      const DISTANCIA_MINIMA             = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION           = 12;
      const MAX_CONEXIONES_POR_NODO  = 2;
      const ACTUALIZAR_LINEAS_CADA   = 10;

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      let mostrarCapsulas   = true;
      let opacidadCapsulas  = 0.25;

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      const chkMostrarCapsulas       = document.getElementById("chkMostrarCapsulas");
      const sliderOpacidadCapsulas   = document.getElementById("opacidadCapsulas");
      const spanOpacidadCapsulas     = document.getElementById("opacidadCapsulasValor");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      chkMostrarCapsulas.addEventListener("change", () => {
        mostrarCapsulas = chkMostrarCapsulas.checked;
        particulas.forEach(p => {
          if (p.capsulaEl) {
            p.capsulaEl.object3D.visible = mostrarCapsulas;
          }
        });
      });

      sliderOpacidadCapsulas.addEventListener("input", () => {
        const v = parseInt(sliderOpacidadCapsulas.value, 10);
        opacidadCapsulas = v / 100;
        spanOpacidadCapsulas.textContent = v + "%";
        particulas.forEach(p => {
          if (p.capsulaEl) {
            p.capsulaEl.setAttribute("transparente-capsula", "opacity:" + opacidadCapsulas);
          }
        });
      });

      let etiquetasSucias = false;

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datosCategorias){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datosCategorias[prop] !== undefined && datosCategorias[prop] !== null)
                      ? String(datosCategorias[prop])
                      : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      // Cápsula transparente horizontal (sin clickable)
      function crearCapsulaTransparenteHorizontal(){
        const capsula = document.createElement("a-entity");
        capsula.setAttribute("rotation", "0 0 90");
        capsula.setAttribute("transparente-capsula", "opacity:0.25");

        const cilindro = document.createElement("a-cylinder");
        cilindro.setAttribute("radius", 0.7);
        cilindro.setAttribute("height", 1.8);
        cilindro.setAttribute("position", "0 0 0");
        capsula.appendChild(cilindro);

        const esferaArriba = document.createElement("a-sphere");
        esferaArriba.setAttribute("radius", 0.7);
        esferaArriba.setAttribute("position", "0 0.9 0");
        capsula.appendChild(esferaArriba);

        const esferaAbajo = document.createElement("a-sphere");
        esferaAbajo.setAttribute("radius", 0.7);
        esferaAbajo.setAttribute("position", "0 -0.9 0");
        capsula.appendChild(esferaAbajo);

        return capsula;
      }

      function crearNodos3D(items){
        particulas = [];
        numeroParticulas = items.length;

        for (let i = 0; i < items.length; i++){
          const item = items[i];
          const categorias    = item.categories || {};
          const contenidoHtml = item.content    || "";

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);
          nodo.setAttribute("billboard", "target: #rig");
          nodo.setAttribute("class", "clickable");   // aquí el raycaster impacta

          const capsula = crearCapsulaTransparenteHorizontal();
          nodo.appendChild(capsula);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(categorias),
            align: "center",
            color: "#ffffff",
            width: 3,
            wrapCount: 20,
            baseline: "center"
          });
          texto.setAttribute("position", "0 0 -1.0");
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:categorias,
            contenido:contenidoHtml,
            nodeEl:nodo,
            textEl:texto,
            capsulaEl:capsula
          };

          capsula.object3D.visible = mostrarCapsulas;
          capsula.setAttribute("transparente-capsula", "opacity:" + opacidadCapsulas);

          // click en el nodo completo
          nodo.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
            const tituloModal = categorias.nombre || "Detalle de nodo";
            mostrarModal(tituloModal, contenidoHtml);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            const vel  = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!mostrarLineas) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(MAX_CONEXIONES_POR_NODO, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      // ---------- Fly controls ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6;

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);
        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));
        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave ----------
      let zoomAnim = null;

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        const destino = new THREE.Vector3(p.x, p.y + 0.5, p.z + 5);
        zoomAnim = { from: rigPos, to: destino, t: 0, dur: 1.0 };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1) t = 1;
        const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;
        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);
        if (zoomAnim.t >= 1) zoomAnim = null;
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos ----------
      fetch("personas2.json")
        .then(r => r.json())
        .then(items => {
          const setClaves = new Set();
          items.forEach(item => {
            const cats = item.categories || {};
            Object.keys(cats).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);

          crearControlesPropiedades(claves);
          crearNodos3D(items);
          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas.json:", err);
        });
    </script>
  </body>
</html>
```

### click en pastillas

```html
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Red 3D de personas</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body,html{
        margin:0;
        padding:0;
        font-family:sans-serif;
        overflow:hidden;
      }
      #controles{
        position:fixed;
        top:10px;
        left:10px;
        padding:8px 10px;
        background:rgba(0,0,0,0.55);
        border:1px solid #444;
        border-radius:4px;
        font-size:12px;
        z-index:10;
        max-height:90vh;
        overflow:auto;
        color:#eee;
      }
      #controles label{
        display:block;
        margin-bottom:4px;
      }
      #controles input[type=range]{
        width:150px;
      }
      #controles span.valor{
        display:inline-block;
        width:32px;
        text-align:right;
        margin-left:4px;
      }
      #controles .fila{
        margin-top:4px;
        margin-bottom:4px;
      }
      #propiedades .bloque-prop{
        border-top:1px solid #555;
        margin-top:4px;
        padding-top:4px;
      }
      #propiedades .titulo-prop{
        font-weight:bold;
        margin-bottom:2px;
      }
      #propiedades label{
        display:inline-block;
        margin-right:8px;
        margin-bottom:2px;
      }
      #ayudaTeclas{
        font-size:11px;
        margin-top:6px;
        color:#ccc;
      }

      /* --- Modal 2D --- */
      #modalOverlay{
        position:fixed;
        top:0;
        left:0;
        width:100vw;
        height:100vh;
        background:rgba(0,0,0,0.65);
        display:none;
        align-items:center;
        justify-content:center;
        z-index:20;
      }
      #modalCaja{
        background:#111;
        border:1px solid #555;
        border-radius:6px;
        max-width:600px;
        max-height:80vh;
        width:90%;
        box-shadow:0 0 20px rgba(0,0,0,0.8);
        color:#eee;
        display:flex;
        flex-direction:column;
      }
      #modalHeader{
        padding:8px 10px;
        border-bottom:1px solid #444;
        display:flex;
        justify-content:space-between;
        align-items:center;
        font-size:14px;
        background:#222;
      }
      #modalTitulo{
        font-weight:bold;
      }
      #modalCerrar{
        cursor:pointer;
        padding:2px 6px;
        border-radius:3px;
        border:1px solid #666;
        background:#333;
        font-size:12px;
      }
      #modalCerrar:hover{
        background:#555;
      }
      #modalContenido{
        padding:10px;
        overflow:auto;
        font-size:13px;
        line-height:1.4;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div id="controles">
      <label>
        Grosor mínimo (solo UI)
        <input id="grosorMin" type="range" min="1" max="10" value="1">
        <span id="grosorMinValor" class="valor">1</span>
      </label>
      <label>
        Grosor máximo (solo UI)
        <input id="grosorMax" type="range" min="1" max="20" value="6">
        <span id="grosorMaxValor" class="valor">6</span>
      </label>

      <div class="fila">
        Máx conexiones/píldora
        <input id="maxConexiones" type="range" min="1" max="6" value="2">
        <span id="maxConexionesValor" class="valor">2</span>
      </div>

      <div class="fila">
        <label>
          <input id="chkMostrarLineas" type="checkbox" checked>
          Mostrar conexiones
        </label>
      </div>

      <div class="fila">
        <label>
          <input id="chkMostrarCapsulas" type="checkbox" checked>
          Mostrar cápsulas
        </label>
      </div>

      <div class="fila">
        Transparencia cápsulas
        <input id="opacidadCapsulas" type="range" min="5" max="100" value="25">
        <span id="opacidadCapsulasValor" class="valor">25%</span>
      </div>

      <div class="fila">
        <div><strong>Propiedades</strong> (detectadas de categories)</div>
        <div id="propiedades"></div>
      </div>

      <div id="ayudaTeclas">
        Navegación (fly):<br>
        W/A/S/D: mover en plano XZ<br>
        Q/E: subir / bajar<br>
        Ratón: mirar alrededor<br>
        Clic en nodo: zoom + modal 2D con contenido
      </div>
    </div>

    <!-- Modal 2D -->
    <div id="modalOverlay">
      <div id="modalCaja">
        <div id="modalHeader">
          <div id="modalTitulo">Detalle de nodo</div>
          <button id="modalCerrar">Cerrar</button>
        </div>
        <div id="modalContenido"></div>
      </div>
    </div>

    <!-- Escena A-Frame -->
    <a-scene background="color: #000000">
      <!-- Cielo con gradiente -->
      <a-sky material="shader: gradiente; topColor: #88c8ff; bottomColor: #02041a"></a-sky>

      <!-- Cámara con look-controls + cursor/mouse + raycaster -->
      <a-entity id="rig"
                camera
                look-controls
                position="0 3 15"
                cursor="rayOrigin: mouse; fuse: false"
                raycaster="objects: .clickable; far: 100">
      </a-entity>

      <!-- Luces -->
      <a-entity light="type: ambient; color: #8899aa"></a-entity>
      <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="1 3 2"></a-entity>
      <a-entity light="type: point; color: #88bbff; intensity: 0.4" position="-5 4 -3"></a-entity>

      <!-- Contenedor de conexiones -->
      <a-entity id="conexiones"></a-entity>

      <!-- Contenedor de nodos -->
      <a-entity id="nodos"></a-entity>
    </a-scene>

    <script>
      const THREE = AFRAME.THREE;

      // ---------- Shader gradiente para el cielo ----------
      AFRAME.registerShader('gradiente', {
        schema: {
          topColor:    {type: 'color', default: '#88c8ff'},
          bottomColor: {type: 'color', default: '#02041a'}
        },
        init: function (data) {
          this.uniforms = {
            topColor:    { value: new THREE.Color(data.topColor) },
            bottomColor: { value: new THREE.Color(data.bottomColor) }
          };
          this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            vertexShader: `
              varying vec3 vWorldPosition;
              void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * viewMatrix * worldPosition;
              }
            `,
            fragmentShader: `
              uniform vec3 topColor;
              uniform vec3 bottomColor;
              varying vec3 vWorldPosition;
              void main() {
                float h = normalize(vWorldPosition).y;
                float t = clamp(h * 0.5 + 0.5, 0.0, 1.0);
                vec3 color = mix(bottomColor, topColor, t);
                gl_FragColor = vec4(color, 1.0);
              }
            `,
            side: THREE.BackSide,
            depthWrite: false
          });
        },
        update: function (data) {
          this.uniforms.topColor.value.set(data.topColor);
          this.uniforms.bottomColor.value.set(data.bottomColor);
        }
      });

      // ---------- Componente billboard ----------
      AFRAME.registerComponent('billboard', {
        schema: { target: { type: 'selector' } },
        init: function () {
          this.camEl = this.data.target || document.querySelector('#rig');
        },
        tick: function () {
          if (!this.camEl) return;
          const obj = this.el.object3D;
          const camPos = new THREE.Vector3();
          this.camEl.object3D.getWorldPosition(camPos);
          obj.lookAt(camPos);
        }
      });

      // ---------- Componente cápsula transparente ----------
      AFRAME.registerComponent('transparente-capsula', {
        schema: {
          opacity: { type: 'number', default: 0.25 }
        },
        init: function () {
          const el = this.el;
          const self = this;

          this.applySettings = function () {
            el.object3D.traverse(obj => {
              if (obj.isMesh && obj.material) {
                const m = obj.material;
                m.transparent = true;
                m.opacity = self.data.opacity;
                m.depthWrite = false;
                m.depthTest  = true;
                m.side = THREE.DoubleSide;
                m.needsUpdate = true;
              }
            });
          };

          if (el.object3D) {
            this.applySettings();
          }
          el.addEventListener('object3dset', () => this.applySettings());
        },
        update: function (oldData) {
          if (oldData && oldData.opacity === this.data.opacity) return;
          if (this.applySettings) this.applySettings();
        }
      });

      // ---------- Utilidades ----------
      function distancia3D(x1,y1,z1,x2,y2,z2){
        const dx = x2 - x1;
        const dy = y2 - y1;
        const dz = z2 - z1;
        return Math.sqrt(dx*dx + dy*dy + dz*dz);
      }

      function hashCadena(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      }

      const nodosContEl   = document.getElementById("nodos");
      const conexionesEl  = document.getElementById("conexiones");
      const rigEl         = document.getElementById("rig");

      // Modal
      const modalOverlay   = document.getElementById("modalOverlay");
      const modalContenido = document.getElementById("modalContenido");
      const modalTitulo    = document.getElementById("modalTitulo");
      const modalCerrar    = document.getElementById("modalCerrar");

      function mostrarModal(titulo, html){
        modalTitulo.textContent = titulo || "Detalle de nodo";
        modalContenido.innerHTML = html || "<p>(Sin contenido)</p>";
        modalOverlay.style.display = "flex";
      }
      function ocultarModal(){
        modalOverlay.style.display = "none";
      }
      modalCerrar.addEventListener("click", ocultarModal);
      modalOverlay.addEventListener("click", (e)=>{
        if (e.target === modalOverlay) ocultarModal();
      });

      // ---------- Parámetros espaciales y físicos ----------
      const LIM_X = 20;
      const LIM_Y = 10;
      const LIM_Z = 20;

      const DISTANCIA_OBJETIVO           = 6;
      const DISTANCIA_MINIMA             = 1.8;
      const DISTANCIA_REPULSION_DISTINTO = 14;

      const K_ATRACCION_FUERTE   = 0.0015;
      const K_ATRACCION_MEDIA    = 0.0009;
      const K_REPULSION_DISTINTO = 0.001;
      const K_REPULSION_CORTA    = 0.06;

      const FRICCION   = 0.93;
      const MAX_FUERZA = 0.05;

      const RADIO_CONEXION         = 12;
      const ACTUALIZAR_LINEAS_CADA = 10;

      // ---------- Controles UI ----------
      let grosorMin = 1;
      let grosorMax = 6;
      let mostrarLineas = true;

      let clavesPropiedades = [];
      let usarEnRelacion    = {};
      let mostrarEnEtiqueta = {};

      let mostrarCapsulas   = true;
      let opacidadCapsulas  = 0.25;

      let maxConexionesPorNodo = 2;

      const sliderMin = document.getElementById("grosorMin");
      const sliderMax = document.getElementById("grosorMax");
      const spanMin   = document.getElementById("grosorMinValor");
      const spanMax   = document.getElementById("grosorMaxValor");
      const chkMostrarLineas = document.getElementById("chkMostrarLineas");
      const divPropiedades   = document.getElementById("propiedades");

      const chkMostrarCapsulas       = document.getElementById("chkMostrarCapsulas");
      const sliderOpacidadCapsulas   = document.getElementById("opacidadCapsulas");
      const spanOpacidadCapsulas     = document.getElementById("opacidadCapsulasValor");

      const sliderMaxConexiones      = document.getElementById("maxConexiones");
      const spanMaxConexiones        = document.getElementById("maxConexionesValor");

      sliderMin.addEventListener("input", () => {
        grosorMin = parseFloat(sliderMin.value);
        spanMin.textContent = sliderMin.value;
        if (grosorMin > grosorMax) {
          grosorMax = grosorMin;
          sliderMax.value = grosorMax;
          spanMax.textContent = grosorMax;
        }
      });

      sliderMax.addEventListener("input", () => {
        grosorMax = parseFloat(sliderMax.value);
        spanMax.textContent = sliderMax.value;
        if (grosorMax < grosorMin) {
          grosorMin = grosorMax;
          sliderMin.value = grosorMin;
          spanMin.textContent = grosorMin;
        }
      });

      sliderMaxConexiones.addEventListener("input", () => {
        maxConexionesPorNodo = parseInt(sliderMaxConexiones.value, 10);
        spanMaxConexiones.textContent = sliderMaxConexiones.value;
      });

      chkMostrarLineas.addEventListener("change", () => {
        mostrarLineas = chkMostrarLineas.checked;
      });

      chkMostrarCapsulas.addEventListener("change", () => {
        mostrarCapsulas = chkMostrarCapsulas.checked;
        particulas.forEach(p => {
          if (p.capsulaEl) {
            p.capsulaEl.object3D.visible = mostrarCapsulas;
          }
        });
      });

      sliderOpacidadCapsulas.addEventListener("input", () => {
        const v = parseInt(sliderOpacidadCapsulas.value, 10);
        opacidadCapsulas = v / 100;
        spanOpacidadCapsulas.textContent = v + "%";
        particulas.forEach(p => {
          if (p.capsulaEl) {
            p.capsulaEl.setAttribute("transparente-capsula", "opacity:" + opacidadCapsulas);
          }
        });
      });

      let etiquetasSucias = false;

      function crearControlesPropiedades(claves){
        divPropiedades.innerHTML = "";
        clavesPropiedades = claves.slice();

        clavesPropiedades.forEach(prop => {
          if (!(prop in usarEnRelacion))    usarEnRelacion[prop] = true;
          if (!(prop in mostrarEnEtiqueta)) mostrarEnEtiqueta[prop] = true;

          const bloque = document.createElement("div");
          bloque.className = "bloque-prop";

          const titulo = document.createElement("div");
          titulo.className = "titulo-prop";
          titulo.textContent = prop;
          bloque.appendChild(titulo);

          const lblUsar = document.createElement("label");
          const chkUsar = document.createElement("input");
          chkUsar.type = "checkbox";
          chkUsar.checked = usarEnRelacion[prop];
          chkUsar.addEventListener("change", () => {
            usarEnRelacion[prop] = chkUsar.checked;
            particulas.forEach(p => {
              p.fija = false;
              p.estableFrames = 0;
            });
          });
          lblUsar.appendChild(chkUsar);
          lblUsar.appendChild(document.createTextNode(" Usar en relación"));
          bloque.appendChild(lblUsar);

          const lblMostrar = document.createElement("label");
          const chkMostrar = document.createElement("input");
          chkMostrar.type = "checkbox";
          chkMostrar.checked = mostrarEnEtiqueta[prop];
          chkMostrar.addEventListener("change", () => {
            mostrarEnEtiqueta[prop] = chkMostrar.checked;
            etiquetasSucias = true;
          });
          lblMostrar.appendChild(chkMostrar);
          lblMostrar.appendChild(document.createTextNode(" Mostrar en etiqueta"));
          bloque.appendChild(lblMostrar);

          divPropiedades.appendChild(bloque);
        });

        etiquetasSucias = true;
      }

      // ---------- Datos y nodos ----------
      let particulas = [];
      let numeroParticulas = 0;

      function construirEtiqueta(datosCategorias){
        const lineas = [];
        for (const prop of clavesPropiedades){
          if (!mostrarEnEtiqueta[prop]) continue;
          const val = (datosCategorias[prop] !== undefined && datosCategorias[prop] !== null)
                      ? String(datosCategorias[prop])
                      : "";
          lineas.push(val);
        }
        return lineas.join("\n");
      }

      // Cápsula transparente horizontal:
      // ahora se marcan como .clickable las entidades con geometría
      function crearCapsulaTransparenteHorizontal(){
        const capsula = document.createElement("a-entity");
        capsula.setAttribute("rotation", "0 0 90");
        capsula.setAttribute("transparente-capsula", "opacity:0.25");

        const cilindro = document.createElement("a-cylinder");
        cilindro.setAttribute("radius", 0.7);
        cilindro.setAttribute("height", 1.8);
        cilindro.setAttribute("position", "0 0 0");
        cilindro.setAttribute("class", "clickable");
        capsula.appendChild(cilindro);

        const esferaArriba = document.createElement("a-sphere");
        esferaArriba.setAttribute("radius", 0.7);
        esferaArriba.setAttribute("position", "0 0.9 0");
        esferaArriba.setAttribute("class", "clickable");
        capsula.appendChild(esferaArriba);

        const esferaAbajo = document.createElement("a-sphere");
        esferaAbajo.setAttribute("radius", 0.7);
        esferaAbajo.setAttribute("position", "0 -0.9 0");
        esferaAbajo.setAttribute("class", "clickable");
        capsula.appendChild(esferaAbajo);

        return capsula;
      }

      function crearNodos3D(items){
        particulas = [];
        numeroParticulas = items.length;

        for (let i = 0; i < items.length; i++){
          const item = items[i];
          const categorias    = item.categories || {};
          const contenidoHtml = item.content    || "";

          const x = (Math.random() - 0.5) * LIM_X * 2;
          const y = Math.random() * LIM_Y + 1;
          const z = (Math.random() - 0.5) * LIM_Z * 2;

          const nodo = document.createElement("a-entity");
          nodo.setAttribute("position", `${x} ${y} ${z}`);
          nodo.setAttribute("billboard", "target: #rig");

          const capsula = crearCapsulaTransparenteHorizontal();
          nodo.appendChild(capsula);

          const texto = document.createElement("a-entity");
          texto.setAttribute("text", {
            value: construirEtiqueta(categorias),
            align: "center",
            color: "#ffffff",
            width: 3,
            wrapCount: 20,
            baseline: "center"
          });
          texto.setAttribute("position", "0 0 -1.0");
          texto.setAttribute("class", "clickable"); // también clickable el texto
          nodo.appendChild(texto);

          nodosContEl.appendChild(nodo);

          const pObj = {
            x:x, y:y, z:z,
            vx:(Math.random()-0.5)*0.1,
            vy:(Math.random()-0.5)*0.1,
            vz:(Math.random()-0.5)*0.1,
            ax:0, ay:0, az:0,
            fija:false,
            estableFrames:0,
            datos:categorias,
            contenido:contenidoHtml,
            nodeEl:nodo,
            textEl:texto,
            capsulaEl:capsula
          };

          capsula.object3D.visible = mostrarCapsulas;
          capsula.setAttribute("transparente-capsula", "opacity:" + opacidadCapsulas);

          // click en el nodo completo (evento burbujea desde los hijos .clickable)
          nodo.addEventListener("click", () => {
            zoomACentroDeParticula(pObj);
            const tituloModal = categorias.nombre || "Detalle de nodo";
            mostrarModal(tituloModal, contenidoHtml);
          });

          particulas.push(pObj);
        }
      }

      // ---------- Física 3D ----------
      function pasoFisica(dt){
        const n = numeroParticulas;
        if (n === 0) return;

        for (let i = 0; i < n; i++){
          particulas[i].ax = 0;
          particulas[i].ay = 0;
          particulas[i].az = 0;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (p.fija) continue;

          let fx = 0, fy = 0, fz = 0;

          for (let j = 0; j < n; j++){
            if (i === j) continue;
            const q = particulas[j];

            const d = distancia3D(p.x,p.y,p.z, q.x,q.y,q.z);
            if (d === 0) continue;

            const dx = q.x - p.x;
            const dy = q.y - p.y;
            const dz = q.z - p.z;

            const ux = dx / d;
            const uy = dy / d;
            const uz = dz / d;

            if (d < DISTANCIA_MINIMA){
              const intensidad = (DISTANCIA_MINIMA - d) * K_REPULSION_CORTA;
              fx -= ux * intensidad;
              fy -= uy * intensidad;
              fz -= uz * intensidad;
              continue;
            }

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (p.datos[prop] === q.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            if (propsCoinciden.length > 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_FUERTE;
              fy += uy * delta * K_ATRACCION_FUERTE;
              fz += uz * delta * K_ATRACCION_FUERTE;
            } else if (propsCoinciden.length === 1){
              const delta = d - DISTANCIA_OBJETIVO;
              fx += ux * delta * K_ATRACCION_MEDIA;
              fy += uy * delta * K_ATRACCION_MEDIA;
              fz += uz * delta * K_ATRACCION_MEDIA;
            } else {
              if (d < DISTANCIA_REPULSION_DISTINTO){
                const intensidad = (DISTANCIA_REPULSION_DISTINTO - d) * K_REPULSION_DISTINTO;
                fx -= ux * intensidad;
                fy -= uy * intensidad;
                fz -= uz * intensidad;
              }
            }
          }

          const modF = Math.sqrt(fx*fx + fy*fy + fz*fz);
          if (modF > MAX_FUERZA){
            fx = fx / modF * MAX_FUERZA;
            fy = fy / modF * MAX_FUERZA;
            fz = fz / modF * MAX_FUERZA;
          }

          p.ax = fx;
          p.ay = fy;
          p.az = fz;
        }

        for (let i = 0; i < n; i++){
          const p = particulas[i];
          if (!p.fija){
            p.vx += p.ax;
            p.vy += p.ay;
            p.vz += p.az;

            p.vx *= FRICCION;
            p.vy *= FRICCION;
            p.vz *= FRICCION;

            p.x += p.vx;
            p.y += p.vy;
            p.z += p.vz;

            const REBOTE = -0.5;
            if (p.x > LIM_X){ p.x = LIM_X; p.vx *= REBOTE; }
            if (p.x < -LIM_X){ p.x = -LIM_X; p.vx *= REBOTE; }
            if (p.z > LIM_Z){ p.z = LIM_Z; p.vz *= REBOTE; }
            if (p.z < -LIM_Z){ p.z = -LIM_Z; p.vz *= REBOTE; }
            if (p.y > LIM_Y){ p.y = LIM_Y; p.vy *= REBOTE; }
            if (p.y < 0.5){ p.y = 0.5; p.vy *= REBOTE; }

            const vel  = Math.sqrt(p.vx*p.vx + p.vy*p.vy + p.vz*p.vz);
            const fuer = Math.sqrt(p.ax*p.ax + p.ay*p.ay + p.az*p.az);
            if (vel < 0.02 && fuer < 0.002){
              p.estableFrames++;
              if (p.estableFrames > 60){
                p.fija = true;
                p.vx = p.vy = p.vz = 0;
              }
            } else {
              p.estableFrames = 0;
            }
          }

          p.nodeEl.setAttribute("position", `${p.x} ${p.y} ${p.z}`);

          if (etiquetasSucias){
            p.textEl.setAttribute("text", "value", construirEtiqueta(p.datos));
          }
        }

        if (etiquetasSucias){
          etiquetasSucias = false;
        }
      }

      // ---------- Conexiones 3D ----------
      function actualizarConexiones(){
        conexionesEl.innerHTML = "";
        if (!MostrarLineasGlobal()) return;

        const n = numeroParticulas;
        for (let i = 0; i < n; i++){
          const a = particulas[i];
          const candidatos = [];

          for (let j = i+1; j < n; j++){
            const b = particulas[j];
            const d = distancia3D(a.x,a.y,a.z, b.x,b.y,b.z);
            if (d > RADIO_CONEXION) continue;

            const propsCoinciden = [];
            let hayPropsRelacionActivas = false;
            for (const prop of clavesPropiedades){
              if (!usarEnRelacion[prop]) continue;
              hayPropsRelacionActivas = true;
              if (a.datos[prop] === b.datos[prop]){
                propsCoinciden.push(prop);
              }
            }

            let clave = "ninguna";
            if (propsCoinciden.length === 1){
              clave = propsCoinciden[0];
            } else if (propsCoinciden.length > 1){
              clave = propsCoinciden.slice().sort().join("+");
            } else if (!hayPropsRelacionActivas){
              clave = "sin-prop-relacion";
            }

            const h = hashCadena(clave) % 360;
            const color = `hsl(${h}, 70%, 50%)`;

            candidatos.push({j, d, color});
          }

          candidatos.sort((a,b) => a.d - b.d);
          const limite = Math.min(maxConexionesPorNodo, candidatos.length);
          for (let k = 0; k < limite; k++){
            const c = candidatos[k];
            const b = particulas[c.j];

            const lineaEl = document.createElement("a-entity");
            lineaEl.setAttribute("line", {
              start: `${a.x} ${a.y} ${a.z}`,
              end:   `${b.x} ${b.y} ${b.z}`,
              color: c.color
            });
            conexionesEl.appendChild(lineaEl);
          }
        }
      }

      function MostrarLineasGlobal() {
        return mostrarLineas;
      }

      // ---------- Fly controls ----------
      const flyEstado = {
        adelante:0,
        atras:0,
        izquierda:0,
        derecha:0,
        arriba:0,
        abajo:0
      };
      const VELOCIDAD_FLY = 6;

      window.addEventListener("keydown", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 1; break;
          case "s": flyEstado.atras    = 1; break;
          case "a": flyEstado.izquierda= 1; break;
          case "d": flyEstado.derecha  = 1; break;
          case "q": flyEstado.arriba   = 1; break;
          case "e": flyEstado.abajo    = 1; break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch(e.key.toLowerCase()){
          case "w": flyEstado.adelante = 0; break;
          case "s": flyEstado.atras    = 0; break;
          case "a": flyEstado.izquierda= 0; break;
          case "d": flyEstado.derecha  = 0; break;
          case "q": flyEstado.arriba   = 0; break;
          case "e": flyEstado.abajo    = 0; break;
        }
      });

      function actualizarFly(dt){
        const obj = rigEl.object3D;
        const dir = new THREE.Vector3();
        obj.getWorldDirection(dir);
        dir.normalize();

        const up = new THREE.Vector3(0,1,0);
        const right = new THREE.Vector3().crossVectors(dir, up).normalize().negate();

        let move = new THREE.Vector3(0,0,0);

        if (flyEstado.adelante) move.add(dir.clone().multiplyScalar(-1));
        if (flyEstado.atras)    move.add(dir);
        if (flyEstado.derecha)   move.add(right);
        if (flyEstado.izquierda) move.add(right.clone().multiplyScalar(-1));
        if (flyEstado.arriba) move.add(up);
        if (flyEstado.abajo)  move.add(up.clone().multiplyScalar(-1));

        if (move.lengthSq() > 0){
          move.normalize().multiplyScalar(VELOCIDAD_FLY * dt);
          obj.position.add(move);
        }
      }

      // ---------- Zoom suave ----------
      let zoomAnim = null;

      function zoomACentroDeParticula(p){
        const rigPos = rigEl.object3D.position.clone();
        const destino = new THREE.Vector3(p.x, p.y + 0.5, p.z + 5);
        zoomAnim = { from: rigPos, to: destino, t: 0, dur: 1.0 };
      }

      function actualizarZoom(dt){
        if (!zoomAnim) return;
        zoomAnim.t += dt / zoomAnim.dur;
        let t = zoomAnim.t;
        if (t >= 1) t = 1;
        const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;
        const pos = new THREE.Vector3().lerpVectors(zoomAnim.from, zoomAnim.to, ease);
        rigEl.object3D.position.copy(pos);
        if (zoomAnim.t >= 1) zoomAnim = null;
      }

      // ---------- Bucle principal ----------
      let ultimoTiempo = null;
      let contadorFrames = 0;

      function bucle(tiempoMs){
        if (!ultimoTiempo) ultimoTiempo = tiempoMs;
        const dt = (tiempoMs - ultimoTiempo) / 1000;
        ultimoTiempo = tiempoMs;

        pasoFisica(dt);
        actualizarFly(dt);
        actualizarZoom(dt);

        contadorFrames++;
        if (contadorFrames % ACTUALIZAR_LINEAS_CADA === 0){
          actualizarConexiones();
        }

        requestAnimationFrame(bucle);
      }

      // ---------- Carga de datos ----------
      fetch("personas2.json")
        .then(r => r.json())
        .then(items => {
          const setClaves = new Set();
          items.forEach(item => {
            const cats = item.categories || {};
            Object.keys(cats).forEach(k => setClaves.add(k));
          });
          const claves = Array.from(setClaves);

          crearControlesPropiedades(claves);
          crearNodos3D(items);
          requestAnimationFrame(bucle);
        })
        .catch(err => {
          console.error("Error al cargar personas2.json:", err);
        });
    </script>
  </body>
</html>
```

### personas

```json
[
  { "nombre": "Juan",   "hobbie": "Ajedrez", "edad": 20, "ciudad": "Valencia",  "profesion": "Estudiante" },
  { "nombre": "Juan",   "hobbie": "Pintura", "edad": 20, "ciudad": "Valencia",  "profesion": "Estudiante" },
  { "nombre": "Juan",   "hobbie": "Fútbol",  "edad": 20, "ciudad": "Valencia",  "profesion": "Estudiante" },
  { "nombre": "Juan",   "hobbie": "Música",  "edad": 20, "ciudad": "Valencia",  "profesion": "Estudiante" },
  { "nombre": "Juan",   "hobbie": "Lectura", "edad": 20, "ciudad": "Valencia",  "profesion": "Estudiante" },
  { "nombre": "Juan",   "hobbie": "Cine",    "edad": 20, "ciudad": "Valencia",  "profesion": "Estudiante" },

  { "nombre": "Julia",  "hobbie": "Ajedrez", "edad": 22, "ciudad": "Valencia",  "profesion": "Diseñadora" },
  { "nombre": "Julia",  "hobbie": "Pintura", "edad": 22, "ciudad": "Valencia",  "profesion": "Diseñadora" },
  { "nombre": "Julia",  "hobbie": "Fútbol",  "edad": 22, "ciudad": "Valencia",  "profesion": "Diseñadora" },
  { "nombre": "Julia",  "hobbie": "Música",  "edad": 22, "ciudad": "Valencia",  "profesion": "Diseñadora" },
  { "nombre": "Julia",  "hobbie": "Lectura", "edad": 22, "ciudad": "Valencia",  "profesion": "Diseñadora" },
  { "nombre": "Julia",  "hobbie": "Cine",    "edad": 22, "ciudad": "Valencia",  "profesion": "Diseñadora" },

  { "nombre": "Jorge",  "hobbie": "Ajedrez", "edad": 25, "ciudad": "Madrid",    "profesion": "Ingeniero" },
  { "nombre": "Jorge",  "hobbie": "Pintura", "edad": 25, "ciudad": "Madrid",    "profesion": "Ingeniero" },
  { "nombre": "Jorge",  "hobbie": "Fútbol",  "edad": 25, "ciudad": "Madrid",    "profesion": "Ingeniero" },
  { "nombre": "Jorge",  "hobbie": "Música",  "edad": 25, "ciudad": "Madrid",    "profesion": "Ingeniero" },
  { "nombre": "Jorge",  "hobbie": "Lectura", "edad": 25, "ciudad": "Madrid",    "profesion": "Ingeniero" },
  { "nombre": "Jorge",  "hobbie": "Cine",    "edad": 25, "ciudad": "Madrid",    "profesion": "Ingeniero" },

  { "nombre": "Jaime",  "hobbie": "Ajedrez", "edad": 27, "ciudad": "Madrid",    "profesion": "Músico" },
  { "nombre": "Jaime",  "hobbie": "Pintura", "edad": 27, "ciudad": "Madrid",    "profesion": "Músico" },
  { "nombre": "Jaime",  "hobbie": "Fútbol",  "edad": 27, "ciudad": "Madrid",    "profesion": "Músico" },
  { "nombre": "Jaime",  "hobbie": "Música",  "edad": 27, "ciudad": "Madrid",    "profesion": "Músico" },
  { "nombre": "Jaime",  "hobbie": "Lectura", "edad": 27, "ciudad": "Madrid",    "profesion": "Músico" },
  { "nombre": "Jaime",  "hobbie": "Cine",    "edad": 27, "ciudad": "Madrid",    "profesion": "Músico" },

  { "nombre": "Jose",   "hobbie": "Ajedrez", "edad": 35, "ciudad": "Barcelona", "profesion": "Profesor" },
  { "nombre": "Jose",   "hobbie": "Pintura", "edad": 35, "ciudad": "Barcelona", "profesion": "Profesor" },
  { "nombre": "Jose",   "hobbie": "Fútbol",  "edad": 35, "ciudad": "Barcelona", "profesion": "Profesor" },
  { "nombre": "Jose",   "hobbie": "Música",  "edad": 35, "ciudad": "Barcelona", "profesion": "Profesor" },
  { "nombre": "Jose",   "hobbie": "Lectura", "edad": 35, "ciudad": "Barcelona", "profesion": "Profesor" },
  { "nombre": "Jose",   "hobbie": "Cine",    "edad": 35, "ciudad": "Barcelona", "profesion": "Profesor" },

  { "nombre": "Julian", "hobbie": "Ajedrez", "edad": 30, "ciudad": "Barcelona", "profesion": "Programador" },
  { "nombre": "Julian", "hobbie": "Pintura", "edad": 30, "ciudad": "Barcelona", "profesion": "Programador" },
  { "nombre": "Julian", "hobbie": "Fútbol",  "edad": 30, "ciudad": "Barcelona", "profesion": "Programador" },
  { "nombre": "Julian", "hobbie": "Música",  "edad": 30, "ciudad": "Barcelona", "profesion": "Programador" },
  { "nombre": "Julian", "hobbie": "Lectura", "edad": 30, "ciudad": "Barcelona", "profesion": "Programador" },
  { "nombre": "Julian", "hobbie": "Cine",    "edad": 30, "ciudad": "Barcelona", "profesion": "Programador" },

  { "nombre": "Laura",  "hobbie": "Ajedrez", "edad": 28, "ciudad": "Sevilla",   "profesion": "Psicóloga" },
  { "nombre": "Laura",  "hobbie": "Pintura", "edad": 28, "ciudad": "Sevilla",   "profesion": "Psicóloga" },
  { "nombre": "Laura",  "hobbie": "Fútbol",  "edad": 28, "ciudad": "Sevilla",   "profesion": "Psicóloga" },
  { "nombre": "Laura",  "hobbie": "Música",  "edad": 28, "ciudad": "Sevilla",   "profesion": "Psicóloga" },
  { "nombre": "Laura",  "hobbie": "Lectura", "edad": 28, "ciudad": "Sevilla",   "profesion": "Psicóloga" },
  { "nombre": "Laura",  "hobbie": "Cine",    "edad": 28, "ciudad": "Sevilla",   "profesion": "Psicóloga" },

  { "nombre": "Luis",   "hobbie": "Ajedrez", "edad": 26, "ciudad": "Sevilla",   "profesion": "Administrador de sistemas" },
  { "nombre": "Luis",   "hobbie": "Pintura", "edad": 26, "ciudad": "Sevilla",   "profesion": "Administrador de sistemas" },
  { "nombre": "Luis",   "hobbie": "Fútbol",  "edad": 26, "ciudad": "Sevilla",   "profesion": "Administrador de sistemas" },
  { "nombre": "Luis",   "hobbie": "Música",  "edad": 26, "ciudad": "Sevilla",   "profesion": "Administrador de sistemas" },
  { "nombre": "Luis",   "hobbie": "Lectura", "edad": 26, "ciudad": "Sevilla",   "profesion": "Administrador de sistemas" },
  { "nombre": "Luis",   "hobbie": "Cine",    "edad": 26, "ciudad": "Sevilla",   "profesion": "Administrador de sistemas" },

  { "nombre": "Lucía",  "hobbie": "Ajedrez", "edad": 24, "ciudad": "Bilbao",    "profesion": "Artista" },
  { "nombre": "Lucía",  "hobbie": "Pintura", "edad": 24, "ciudad": "Bilbao",    "profesion": "Artista" },
  { "nombre": "Lucía",  "hobbie": "Fútbol",  "edad": 24, "ciudad": "Bilbao",    "profesion": "Artista" },
  { "nombre": "Lucía",  "hobbie": "Música",  "edad": 24, "ciudad": "Bilbao",    "profesion": "Artista" },
  { "nombre": "Lucía",  "hobbie": "Lectura", "edad": 24, "ciudad": "Bilbao",    "profesion": "Artista" },
  { "nombre": "Lucía",  "hobbie": "Cine",    "edad": 24, "ciudad": "Bilbao",    "profesion": "Artista" },

  { "nombre": "Leo",    "hobbie": "Ajedrez", "edad": 23, "ciudad": "Bilbao",    "profesion": "Desarrollador" },
  { "nombre": "Leo",    "hobbie": "Pintura", "edad": 23, "ciudad": "Bilbao",    "profesion": "Desarrollador" },
  { "nombre": "Leo",    "hobbie": "Fútbol",  "edad": 23, "ciudad": "Bilbao",    "profesion": "Desarrollador" },
  { "nombre": "Leo",    "hobbie": "Música",  "edad": 23, "ciudad": "Bilbao",    "profesion": "Desarrollador" },
  { "nombre": "Leo",    "hobbie": "Lectura", "edad": 23, "ciudad": "Bilbao",    "profesion": "Desarrollador" },
  { "nombre": "Leo",    "hobbie": "Cine",    "edad": 23, "ciudad": "Bilbao",    "profesion": "Desarrollador" },

  { "nombre": "Lola",   "hobbie": "Ajedrez", "edad": 29, "ciudad": "Zaragoza",  "profesion": "Arquitecta" },
  { "nombre": "Lola",   "hobbie": "Pintura", "edad": 29, "ciudad": "Zaragoza",  "profesion": "Arquitecta" },
  { "nombre": "Lola",   "hobbie": "Fútbol",  "edad": 29, "ciudad": "Zaragoza",  "profesion": "Arquitecta" },
  { "nombre": "Lola",   "hobbie": "Música",  "edad": 29, "ciudad": "Zaragoza",  "profesion": "Arquitecta" },
  { "nombre": "Lola",   "hobbie": "Lectura", "edad": 29, "ciudad": "Zaragoza",  "profesion": "Arquitecta" },
  { "nombre": "Lola",   "hobbie": "Cine",    "edad": 29, "ciudad": "Zaragoza",  "profesion": "Arquitecta" },

  { "nombre": "Andrés", "hobbie": "Ajedrez", "edad": 31, "ciudad": "Valencia",  "profesion": "Analista de datos" },
  { "nombre": "Andrés", "hobbie": "Pintura", "edad": 31, "ciudad": "Valencia",  "profesion": "Analista de datos" },
  { "nombre": "Andrés", "hobbie": "Fútbol",  "edad": 31, "ciudad": "Valencia",  "profesion": "Analista de datos" },
  { "nombre": "Andrés", "hobbie": "Música",  "edad": 31, "ciudad": "Valencia",  "profesion": "Analista de datos" },
  { "nombre": "Andrés", "hobbie": "Lectura", "edad": 31, "ciudad": "Valencia",  "profesion": "Analista de datos" },
  { "nombre": "Andrés", "hobbie": "Cine",    "edad": 31, "ciudad": "Valencia",  "profesion": "Analista de datos" },

  { "nombre": "Ana",    "hobbie": "Ajedrez", "edad": 21, "ciudad": "Madrid",    "profesion": "Estudiante" },
  { "nombre": "Ana",    "hobbie": "Pintura", "edad": 21, "ciudad": "Madrid",    "profesion": "Estudiante" },
  { "nombre": "Ana",    "hobbie": "Fútbol",  "edad": 21, "ciudad": "Madrid",    "profesion": "Estudiante" },
  { "nombre": "Ana",    "hobbie": "Música",  "edad": 21, "ciudad": "Madrid",    "profesion": "Estudiante" },
  { "nombre": "Ana",    "hobbie": "Lectura", "edad": 21, "ciudad": "Madrid",    "profesion": "Estudiante" },
  { "nombre": "Ana",    "hobbie": "Cine",    "edad": 21, "ciudad": "Madrid",    "profesion": "Estudiante" },

  { "nombre": "Pablo",  "hobbie": "Ajedrez", "edad": 32, "ciudad": "Barcelona", "profesion": "Investigador" },
  { "nombre": "Pablo",  "hobbie": "Pintura", "edad": 32, "ciudad": "Barcelona", "profesion": "Investigador" },
  { "nombre": "Pablo",  "hobbie": "Fútbol",  "edad": 32, "ciudad": "Barcelona", "profesion": "Investigador" },
  { "nombre": "Pablo",  "hobbie": "Música",  "edad": 32, "ciudad": "Barcelona", "profesion": "Investigador" },
  { "nombre": "Pablo",  "hobbie": "Lectura", "edad": 32, "ciudad": "Barcelona", "profesion": "Investigador" },
  { "nombre": "Pablo",  "hobbie": "Cine",    "edad": 32, "ciudad": "Barcelona", "profesion": "Investigador" }
]
```

### personas2

```json
[
  {
    "categories": {
      "nombre": "Juan",
      "hobbie": "Ajedrez",
      "edad": 20,
      "ciudad": "Valencia",
      "profesion": "Estudiante"
    },
    "content": "<h2>Juan (20)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Juan",
      "hobbie": "Pintura",
      "edad": 20,
      "ciudad": "Valencia",
      "profesion": "Estudiante"
    },
    "content": "<h2>Juan (20)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Juan",
      "hobbie": "Fútbol",
      "edad": 20,
      "ciudad": "Valencia",
      "profesion": "Estudiante"
    },
    "content": "<h2>Juan (20)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Juan",
      "hobbie": "Música",
      "edad": 20,
      "ciudad": "Valencia",
      "profesion": "Estudiante"
    },
    "content": "<h2>Juan (20)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Juan",
      "hobbie": "Lectura",
      "edad": 20,
      "ciudad": "Valencia",
      "profesion": "Estudiante"
    },
    "content": "<h2>Juan (20)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Juan",
      "hobbie": "Cine",
      "edad": 20,
      "ciudad": "Valencia",
      "profesion": "Estudiante"
    },
    "content": "<h2>Juan (20)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Julia",
      "hobbie": "Ajedrez",
      "edad": 22,
      "ciudad": "Valencia",
      "profesion": "Diseñadora"
    },
    "content": "<h2>Julia (22)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Diseñadora<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Julia",
      "hobbie": "Pintura",
      "edad": 22,
      "ciudad": "Valencia",
      "profesion": "Diseñadora"
    },
    "content": "<h2>Julia (22)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Diseñadora<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Julia",
      "hobbie": "Fútbol",
      "edad": 22,
      "ciudad": "Valencia",
      "profesion": "Diseñadora"
    },
    "content": "<h2>Julia (22)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Diseñadora<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Julia",
      "hobbie": "Música",
      "edad": 22,
      "ciudad": "Valencia",
      "profesion": "Diseñadora"
    },
    "content": "<h2>Julia (22)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Diseñadora<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Julia",
      "hobbie": "Lectura",
      "edad": 22,
      "ciudad": "Valencia",
      "profesion": "Diseñadora"
    },
    "content": "<h2>Julia (22)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Diseñadora<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Julia",
      "hobbie": "Cine",
      "edad": 22,
      "ciudad": "Valencia",
      "profesion": "Diseñadora"
    },
    "content": "<h2>Julia (22)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Diseñadora<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Jorge",
      "hobbie": "Ajedrez",
      "edad": 25,
      "ciudad": "Madrid",
      "profesion": "Ingeniero"
    },
    "content": "<h2>Jorge (25)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Ingeniero<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Jorge",
      "hobbie": "Pintura",
      "edad": 25,
      "ciudad": "Madrid",
      "profesion": "Ingeniero"
    },
    "content": "<h2>Jorge (25)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Ingeniero<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Jorge",
      "hobbie": "Fútbol",
      "edad": 25,
      "ciudad": "Madrid",
      "profesion": "Ingeniero"
    },
    "content": "<h2>Jorge (25)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Ingeniero<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Jorge",
      "hobbie": "Música",
      "edad": 25,
      "ciudad": "Madrid",
      "profesion": "Ingeniero"
    },
    "content": "<h2>Jorge (25)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Ingeniero<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Jorge",
      "hobbie": "Lectura",
      "edad": 25,
      "ciudad": "Madrid",
      "profesion": "Ingeniero"
    },
    "content": "<h2>Jorge (25)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Ingeniero<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Jorge",
      "hobbie": "Cine",
      "edad": 25,
      "ciudad": "Madrid",
      "profesion": "Ingeniero"
    },
    "content": "<h2>Jorge (25)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Ingeniero<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Jaime",
      "hobbie": "Ajedrez",
      "edad": 27,
      "ciudad": "Madrid",
      "profesion": "Músico"
    },
    "content": "<h2>Jaime (27)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Músico<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Jaime",
      "hobbie": "Pintura",
      "edad": 27,
      "ciudad": "Madrid",
      "profesion": "Músico"
    },
    "content": "<h2>Jaime (27)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Músico<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Jaime",
      "hobbie": "Fútbol",
      "edad": 27,
      "ciudad": "Madrid",
      "profesion": "Músico"
    },
    "content": "<h2>Jaime (27)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Músico<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Jaime",
      "hobbie": "Música",
      "edad": 27,
      "ciudad": "Madrid",
      "profesion": "Músico"
    },
    "content": "<h2>Jaime (27)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Músico<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Jaime",
      "hobbie": "Lectura",
      "edad": 27,
      "ciudad": "Madrid",
      "profesion": "Músico"
    },
    "content": "<h2>Jaime (27)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Músico<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Jaime",
      "hobbie": "Cine",
      "edad": 27,
      "ciudad": "Madrid",
      "profesion": "Músico"
    },
    "content": "<h2>Jaime (27)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Músico<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Jose",
      "hobbie": "Ajedrez",
      "edad": 35,
      "ciudad": "Barcelona",
      "profesion": "Profesor"
    },
    "content": "<h2>Jose (35)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Profesor<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Jose",
      "hobbie": "Pintura",
      "edad": 35,
      "ciudad": "Barcelona",
      "profesion": "Profesor"
    },
    "content": "<h2>Jose (35)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Profesor<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Jose",
      "hobbie": "Fútbol",
      "edad": 35,
      "ciudad": "Barcelona",
      "profesion": "Profesor"
    },
    "content": "<h2>Jose (35)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Profesor<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Jose",
      "hobbie": "Música",
      "edad": 35,
      "ciudad": "Barcelona",
      "profesion": "Profesor"
    },
    "content": "<h2>Jose (35)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Profesor<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Jose",
      "hobbie": "Lectura",
      "edad": 35,
      "ciudad": "Barcelona",
      "profesion": "Profesor"
    },
    "content": "<h2>Jose (35)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Profesor<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Jose",
      "hobbie": "Cine",
      "edad": 35,
      "ciudad": "Barcelona",
      "profesion": "Profesor"
    },
    "content": "<h2>Jose (35)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Profesor<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Julian",
      "hobbie": "Ajedrez",
      "edad": 30,
      "ciudad": "Barcelona",
      "profesion": "Programador"
    },
    "content": "<h2>Julian (30)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Programador<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Julian",
      "hobbie": "Pintura",
      "edad": 30,
      "ciudad": "Barcelona",
      "profesion": "Programador"
    },
    "content": "<h2>Julian (30)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Programador<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Julian",
      "hobbie": "Fútbol",
      "edad": 30,
      "ciudad": "Barcelona",
      "profesion": "Programador"
    },
    "content": "<h2>Julian (30)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Programador<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Julian",
      "hobbie": "Música",
      "edad": 30,
      "ciudad": "Barcelona",
      "profesion": "Programador"
    },
    "content": "<h2>Julian (30)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Programador<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Julian",
      "hobbie": "Lectura",
      "edad": 30,
      "ciudad": "Barcelona",
      "profesion": "Programador"
    },
    "content": "<h2>Julian (30)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Programador<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Julian",
      "hobbie": "Cine",
      "edad": 30,
      "ciudad": "Barcelona",
      "profesion": "Programador"
    },
    "content": "<h2>Julian (30)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Programador<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Laura",
      "hobbie": "Ajedrez",
      "edad": 28,
      "ciudad": "Sevilla",
      "profesion": "Psicóloga"
    },
    "content": "<h2>Laura (28)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Psicóloga<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Laura",
      "hobbie": "Pintura",
      "edad": 28,
      "ciudad": "Sevilla",
      "profesion": "Psicóloga"
    },
    "content": "<h2>Laura (28)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Psicóloga<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Laura",
      "hobbie": "Fútbol",
      "edad": 28,
      "ciudad": "Sevilla",
      "profesion": "Psicóloga"
    },
    "content": "<h2>Laura (28)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Psicóloga<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Laura",
      "hobbie": "Música",
      "edad": 28,
      "ciudad": "Sevilla",
      "profesion": "Psicóloga"
    },
    "content": "<h2>Laura (28)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Psicóloga<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Laura",
      "hobbie": "Lectura",
      "edad": 28,
      "ciudad": "Sevilla",
      "profesion": "Psicóloga"
    },
    "content": "<h2>Laura (28)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Psicóloga<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Laura",
      "hobbie": "Cine",
      "edad": 28,
      "ciudad": "Sevilla",
      "profesion": "Psicóloga"
    },
    "content": "<h2>Laura (28)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Psicóloga<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Luis",
      "hobbie": "Ajedrez",
      "edad": 26,
      "ciudad": "Sevilla",
      "profesion": "Administrador de sistemas"
    },
    "content": "<h2>Luis (26)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Administrador de sistemas<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Luis",
      "hobbie": "Pintura",
      "edad": 26,
      "ciudad": "Sevilla",
      "profesion": "Administrador de sistemas"
    },
    "content": "<h2>Luis (26)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Administrador de sistemas<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Luis",
      "hobbie": "Fútbol",
      "edad": 26,
      "ciudad": "Sevilla",
      "profesion": "Administrador de sistemas"
    },
    "content": "<h2>Luis (26)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Administrador de sistemas<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Luis",
      "hobbie": "Música",
      "edad": 26,
      "ciudad": "Sevilla",
      "profesion": "Administrador de sistemas"
    },
    "content": "<h2>Luis (26)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Administrador de sistemas<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Luis",
      "hobbie": "Lectura",
      "edad": 26,
      "ciudad": "Sevilla",
      "profesion": "Administrador de sistemas"
    },
    "content": "<h2>Luis (26)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Administrador de sistemas<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Luis",
      "hobbie": "Cine",
      "edad": 26,
      "ciudad": "Sevilla",
      "profesion": "Administrador de sistemas"
    },
    "content": "<h2>Luis (26)</h2><p><strong>Ciudad:</strong> Sevilla<br><strong>Profesión:</strong> Administrador de sistemas<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Lucía",
      "hobbie": "Ajedrez",
      "edad": 24,
      "ciudad": "Bilbao",
      "profesion": "Artista"
    },
    "content": "<h2>Lucía (24)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Artista<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Lucía",
      "hobbie": "Pintura",
      "edad": 24,
      "ciudad": "Bilbao",
      "profesion": "Artista"
    },
    "content": "<h2>Lucía (24)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Artista<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Lucía",
      "hobbie": "Fútbol",
      "edad": 24,
      "ciudad": "Bilbao",
      "profesion": "Artista"
    },
    "content": "<h2>Lucía (24)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Artista<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Lucía",
      "hobbie": "Música",
      "edad": 24,
      "ciudad": "Bilbao",
      "profesion": "Artista"
    },
    "content": "<h2>Lucía (24)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Artista<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Lucía",
      "hobbie": "Lectura",
      "edad": 24,
      "ciudad": "Bilbao",
      "profesion": "Artista"
    },
    "content": "<h2>Lucía (24)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Artista<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Lucía",
      "hobbie": "Cine",
      "edad": 24,
      "ciudad": "Bilbao",
      "profesion": "Artista"
    },
    "content": "<h2>Lucía (24)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Artista<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Leo",
      "hobbie": "Ajedrez",
      "edad": 23,
      "ciudad": "Bilbao",
      "profesion": "Desarrollador"
    },
    "content": "<h2>Leo (23)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Desarrollador<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Leo",
      "hobbie": "Pintura",
      "edad": 23,
      "ciudad": "Bilbao",
      "profesion": "Desarrollador"
    },
    "content": "<h2>Leo (23)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Desarrollador<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Leo",
      "hobbie": "Fútbol",
      "edad": 23,
      "ciudad": "Bilbao",
      "profesion": "Desarrollador"
    },
    "content": "<h2>Leo (23)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Desarrollador<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Leo",
      "hobbie": "Música",
      "edad": 23,
      "ciudad": "Bilbao",
      "profesion": "Desarrollador"
    },
    "content": "<h2>Leo (23)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Desarrollador<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Leo",
      "hobbie": "Lectura",
      "edad": 23,
      "ciudad": "Bilbao",
      "profesion": "Desarrollador"
    },
    "content": "<h2>Leo (23)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Desarrollador<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Leo",
      "hobbie": "Cine",
      "edad": 23,
      "ciudad": "Bilbao",
      "profesion": "Desarrollador"
    },
    "content": "<h2>Leo (23)</h2><p><strong>Ciudad:</strong> Bilbao<br><strong>Profesión:</strong> Desarrollador<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Lola",
      "hobbie": "Ajedrez",
      "edad": 29,
      "ciudad": "Zaragoza",
      "profesion": "Arquitecta"
    },
    "content": "<h2>Lola (29)</h2><p><strong>Ciudad:</strong> Zaragoza<br><strong>Profesión:</strong> Arquitecta<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Lola",
      "hobbie": "Pintura",
      "edad": 29,
      "ciudad": "Zaragoza",
      "profesion": "Arquitecta"
    },
    "content": "<h2>Lola (29)</h2><p><strong>Ciudad:</strong> Zaragoza<br><strong>Profesión:</strong> Arquitecta<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Lola",
      "hobbie": "Fútbol",
      "edad": 29,
      "ciudad": "Zaragoza",
      "profesion": "Arquitecta"
    },
    "content": "<h2>Lola (29)</h2><p><strong>Ciudad:</strong> Zaragoza<br><strong>Profesión:</strong> Arquitecta<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Lola",
      "hobbie": "Música",
      "edad": 29,
      "ciudad": "Zaragoza",
      "profesion": "Arquitecta"
    },
    "content": "<h2>Lola (29)</h2><p><strong>Ciudad:</strong> Zaragoza<br><strong>Profesión:</strong> Arquitecta<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Lola",
      "hobbie": "Lectura",
      "edad": 29,
      "ciudad": "Zaragoza",
      "profesion": "Arquitecta"
    },
    "content": "<h2>Lola (29)</h2><p><strong>Ciudad:</strong> Zaragoza<br><strong>Profesión:</strong> Arquitecta<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Lola",
      "hobbie": "Cine",
      "edad": 29,
      "ciudad": "Zaragoza",
      "profesion": "Arquitecta"
    },
    "content": "<h2>Lola (29)</h2><p><strong>Ciudad:</strong> Zaragoza<br><strong>Profesión:</strong> Arquitecta<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Andrés",
      "hobbie": "Ajedrez",
      "edad": 31,
      "ciudad": "Valencia",
      "profesion": "Analista de datos"
    },
    "content": "<h2>Andrés (31)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Analista de datos<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Andrés",
      "hobbie": "Pintura",
      "edad": 31,
      "ciudad": "Valencia",
      "profesion": "Analista de datos"
    },
    "content": "<h2>Andrés (31)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Analista de datos<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Andrés",
      "hobbie": "Fútbol",
      "edad": 31,
      "ciudad": "Valencia",
      "profesion": "Analista de datos"
    },
    "content": "<h2>Andrés (31)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Analista de datos<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Andrés",
      "hobbie": "Música",
      "edad": 31,
      "ciudad": "Valencia",
      "profesion": "Analista de datos"
    },
    "content": "<h2>Andrés (31)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Analista de datos<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Andrés",
      "hobbie": "Lectura",
      "edad": 31,
      "ciudad": "Valencia",
      "profesion": "Analista de datos"
    },
    "content": "<h2>Andrés (31)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Analista de datos<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Andrés",
      "hobbie": "Cine",
      "edad": 31,
      "ciudad": "Valencia",
      "profesion": "Analista de datos"
    },
    "content": "<h2>Andrés (31)</h2><p><strong>Ciudad:</strong> Valencia<br><strong>Profesión:</strong> Analista de datos<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Ana",
      "hobbie": "Ajedrez",
      "edad": 21,
      "ciudad": "Madrid",
      "profesion": "Estudiante"
    },
    "content": "<h2>Ana (21)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Ana",
      "hobbie": "Pintura",
      "edad": 21,
      "ciudad": "Madrid",
      "profesion": "Estudiante"
    },
    "content": "<h2>Ana (21)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Ana",
      "hobbie": "Fútbol",
      "edad": 21,
      "ciudad": "Madrid",
      "profesion": "Estudiante"
    },
    "content": "<h2>Ana (21)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Ana",
      "hobbie": "Música",
      "edad": 21,
      "ciudad": "Madrid",
      "profesion": "Estudiante"
    },
    "content": "<h2>Ana (21)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Ana",
      "hobbie": "Lectura",
      "edad": 21,
      "ciudad": "Madrid",
      "profesion": "Estudiante"
    },
    "content": "<h2>Ana (21)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Ana",
      "hobbie": "Cine",
      "edad": 21,
      "ciudad": "Madrid",
      "profesion": "Estudiante"
    },
    "content": "<h2>Ana (21)</h2><p><strong>Ciudad:</strong> Madrid<br><strong>Profesión:</strong> Estudiante<br><strong>Hobbie:</strong> Cine</p>"
  },
  {
    "categories": {
      "nombre": "Pablo",
      "hobbie": "Ajedrez",
      "edad": 32,
      "ciudad": "Barcelona",
      "profesion": "Investigador"
    },
    "content": "<h2>Pablo (32)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Investigador<br><strong>Hobbie:</strong> Ajedrez</p>"
  },
  {
    "categories": {
      "nombre": "Pablo",
      "hobbie": "Pintura",
      "edad": 32,
      "ciudad": "Barcelona",
      "profesion": "Investigador"
    },
    "content": "<h2>Pablo (32)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Investigador<br><strong>Hobbie:</strong> Pintura</p>"
  },
  {
    "categories": {
      "nombre": "Pablo",
      "hobbie": "Fútbol",
      "edad": 32,
      "ciudad": "Barcelona",
      "profesion": "Investigador"
    },
    "content": "<h2>Pablo (32)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Investigador<br><strong>Hobbie:</strong> Fútbol</p>"
  },
  {
    "categories": {
      "nombre": "Pablo",
      "hobbie": "Música",
      "edad": 32,
      "ciudad": "Barcelona",
      "profesion": "Investigador"
    },
    "content": "<h2>Pablo (32)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Investigador<br><strong>Hobbie:</strong> Música</p>"
  },
  {
    "categories": {
      "nombre": "Pablo",
      "hobbie": "Lectura",
      "edad": 32,
      "ciudad": "Barcelona",
      "profesion": "Investigador"
    },
    "content": "<h2>Pablo (32)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Investigador<br><strong>Hobbie:</strong> Lectura</p>"
  },
  {
    "categories": {
      "nombre": "Pablo",
      "hobbie": "Cine",
      "edad": 32,
      "ciudad": "Barcelona",
      "profesion": "Investigador"
    },
    "content": "<h2>Pablo (32)</h2><p><strong>Ciudad:</strong> Barcelona<br><strong>Profesión:</strong> Investigador<br><strong>Hobbie:</strong> Cine</p>"
  }
]
```

### worker

```javascript
// worker.js
// Lógica de física (interacciones y movimiento) en un Web Worker

function distancia2D(x1, y1, x2, y2) {
  const dx = x2 - x1;
  const dy = y2 - y1;
  return Math.sqrt(dx * dx + dy * dy);
}

let particulas = [];
let clavesPropiedades = [];
let usarEnRelacion = {};
let ancho = 0;
let alto  = 0;

onmessage = function(e){
  const datos = e.data;

  if (datos.tipo === "inicializar"){
    particulas = datos.particulas || [];
    clavesPropiedades = datos.clavesPropiedades || [];
    usarEnRelacion = datos.usarEnRelacion || {};
    ancho = datos.ancho || 0;
    alto  = datos.alto  || 0;

    postMessage({ tipo: "iniciado" });
  }
  else if (datos.tipo === "paso"){
    usarEnRelacion    = datos.usarEnRelacion || usarEnRelacion;
    clavesPropiedades = datos.clavesPropiedades || clavesPropiedades;

    calcularPasoFisica();
    postMessage({ tipo: "estado", particulas: particulas });
  }
  else if (datos.tipo === "reactivar"){
    // Quitar estado de "fija" para todas las partículas
    if (particulas) {
      for (let i = 0; i < particulas.length; i++){
        particulas[i].fija = false;
        particulas[i].estableFrames = 0;
      }
    }
  }
};

function calcularPasoFisica(){
  if (!particulas || particulas.length === 0) return;

  const n = particulas.length;

  const rangoGlobal = Math.sqrt(ancho*ancho + alto*alto);

  const distanciaObjetivo          = 120;
  const distanciaMinima            = 70;
  const distanciaRepulsionDistinto = 220;

  const kAtraccionFuerte   = 0.0015;
  const kAtraccionMedia    = 0.0009;
  const kRepulsionDistinto = 0.001;
  const kRepulsionCorta    = 0.06;

  const friccion = 0.93;
  const maxFuerza = 0.05;

  // Reiniciar aceleraciones
  for (let i = 0; i < n; i++){
    particulas[i].ax = 0;
    particulas[i].ay = 0;
  }

  // Calcular fuerzas de interacción
  for (let i = 0; i < n; i++){
    const p = particulas[i];
    if (p.fija) continue;

    let fx = 0;
    let fy = 0;

    for (let j = 0; j < n; j++){
      if (i === j) continue;
      const q = particulas[j];

      let d = distancia2D(p.x, p.y, q.x, q.y);
      if (d === 0 || d > rangoGlobal) continue;

      let dx = q.x - p.x;
      let dy = q.y - p.y;

      let ux = dx / d;
      let uy = dy / d;

      // Repulsión fuerte para evitar solapamiento
      if (d < distanciaMinima){
        let intensidad = (distanciaMinima - d) * kRepulsionCorta;
        fx -= ux * intensidad;
        fy -= uy * intensidad;
        continue;
      }

      // Coincidencias según propiedades activas en relación
      const propsCoinciden = [];
      let hayPropsRelacionActivas = false;
      for (const prop of clavesPropiedades){
        if (!usarEnRelacion[prop]) continue;
        hayPropsRelacionActivas = true;
        if (p.datos[prop] === q.datos[prop]){
          propsCoinciden.push(prop);
        }
      }

      if (propsCoinciden.length > 1){
        // Atracción fuerte (coinciden varias propiedades)
        let delta = d - distanciaObjetivo;
        fx += ux * delta * kAtraccionFuerte;
        fy += uy * delta * kAtraccionFuerte;

      } else if (propsCoinciden.length === 1){
        // Atracción media (coincide una propiedad)
        let delta = d - distanciaObjetivo;
        fx += ux * delta * kAtraccionMedia;
        fy += uy * delta * kAtraccionMedia;

      } else {
        // Sin coincidencias: repulsión suave si está relativamente cerca
        if (d < distanciaRepulsionDistinto){
          let intensidad = (distanciaRepulsionDistinto - d) * kRepulsionDistinto;
          fx -= ux * intensidad;
          fy -= uy * intensidad;
        }
      }
    }

    // Limitar fuerza total
    let modulo = Math.sqrt(fx*fx + fy*fy);
    if (modulo > maxFuerza){
      fx = fx / modulo * maxFuerza;
      fy = fy / modulo * maxFuerza;
    }

    p.ax = fx;
    p.ay = fy;
  }

  // Integrar movimiento y rebotes
  for (let i = 0; i < n; i++){
    const p = particulas[i];
    if (!p.fija){
      // Integrar aceleración -> velocidad
      p.vx += p.ax;
      p.vy += p.ay;

      // Fricción
      p.vx *= friccion;
      p.vy *= friccion;

      // Integrar velocidad -> posición
      p.x += p.vx;
      p.y += p.vy;

      // Rebote con bordes
      const reboteFactor = -0.5;

      if (p.x > ancho){
        p.x = ancho;
        p.vx *= reboteFactor;
      }
      if (p.x < 0){
        p.x = 0;
        p.vx *= reboteFactor;
      }
      if (p.y > alto){
        p.y = alto;
        p.vy *= reboteFactor;
      }
      if (p.y < 0){
        p.y = 0;
        p.vy *= reboteFactor;
      }

      // Comprobar estabilidad para fijar partícula
      const velocidad = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
      const fuerza    = Math.sqrt(p.ax*p.ax + p.ay*p.ay);
      if (velocidad < 0.02 && fuerza < 0.002){
        p.estableFrames = (p.estableFrames || 0) + 1;
        if (p.estableFrames > 60){
          p.fija = true;
          p.vx = 0;
          p.vy = 0;
        }
      } else {
        p.estableFrames = 0;
      }
    }
  }
}
```

<a id="pautas-de-diseno-de-la-secuencia-de-control-de-la-aplicacion"></a>
## Pautas de diseño de la secuencia de control de la aplicación

El diseño de interfaces gráficas es un aspecto crucial del desarrollo de aplicaciones, ya que determina la experiencia del usuario final. En esta subunidad, nos centraremos específicamente en las pautas de diseño de la secuencia de control de la aplicación, una área fundamental para garantizar que los usuarios interactúen de manera intuitiva y eficiente con el software.

La secuencia de control de la aplicación se refiere a la serie de pasos que un usuario realiza para realizar una tarea específica dentro del sistema. Es esencial diseñar esta secuencia de forma clara y coherente, asegurando que los usuarios puedan comprender fácilmente cómo interactuar con el software sin necesidad de instrucciones adicionales.

Para lograr una buena secuencia de control, es fundamental considerar la navegación intuitiva. Los usuarios deben poder moverse entre diferentes partes del sistema de manera natural y lógica. Esto implica organizar los elementos de la interfaz en un orden que refleje su relación funcional y permita a los usuarios identificar rápidamente las opciones disponibles.

Además, es crucial proporcionar retroalimentación visual clara para indicar el estado actual del sistema y las acciones realizadas por el usuario. Esto puede incluir cambios en la apariencia de los botones o campos cuando están seleccionados, mensajes emergentes que confirman acciones completadas, o indicadores visuales que muestran el progreso en tareas complejas.

La consistencia en la secuencia de control es otra pauta fundamental. Los usuarios deben sentirse cómodos y familiarizados con el flujo de trabajo una vez que se les ha explicado cómo funciona el sistema por primera vez. Por lo tanto, es importante mantener un diseño uniforme a lo largo del software, utilizando los mismos patrones y elementos en diferentes partes para evitar confusión.

La accesibilidad también juega un papel crucial en la secuencia de control. Los usuarios deben ser capaces de interactuar con el sistema sin necesidad de habilidades visuales o motoras avanzadas. Esto puede implicar proporcionar opciones de entrada alternativas, como teclado y voz, así como garantizar que los elementos críticos sean fácilmente accesibles para personas con discapacidades.

La eficiencia en la secuencia de control es otro aspecto importante a considerar. Los usuarios deben ser capaces de completar tareas de manera rápida y sin necesidad de desplazarse por el sistema innecesariamente. Esto puede implicar optimizar los flujos de trabajo, reducir el número de clics necesarios para realizar acciones y asegurarse de que la información relevante esté disponible en una ubicación accesible.

En conclusión, el diseño de interfaces gráficas requiere un enfoque integral que aborde tanto la funcionalidad como la experiencia del usuario. La secuencia de control es un aspecto crucial de esta experiencia y debe ser diseñada con cuidado para garantizar que los usuarios puedan interactuar eficientemente y satisfactoriamente con el software. Al seguir las pautas de diseño recomendadas, podemos crear interfaces gráficas que no solo sean funcionales, sino también agradables y fáciles de usar.


<a id="creacion-de-informes"></a>
# Creación de informes

<a id="informes-incrustados-y-no-incrustados-en-la-aplicacion"></a>
## Informes incrustados y no incrustados en la aplicación

En la creación de interfaces de usuario, los informes desempeñan un papel crucial para presentar datos de manera clara y accesible a los usuarios finales. Los informes pueden ser incrustados dentro del propio software o estar disponibles como recursos separados, cada uno con sus ventajas y desventajas.

Los informes incrustados en la aplicación son aquellos que se generan directamente dentro del entorno de trabajo del usuario. Estos informes suelen ser más interactivos y personalizados, ya que pueden adaptarse a las necesidades específicas del usuario y proporcionar una experiencia fluida dentro del mismo contexto de trabajo. Además, los informes incrustados permiten una mejor integridad de datos, ya que están vinculados directamente al sistema principal.

Por otro lado, los informes no incrustados son aquellos que se generan fuera del entorno principal y suelen estar disponibles en formatos como PDF o Excel. Estos informes ofrecen la ventaja de ser portátiles y accesibles desde cualquier lugar, lo que puede facilitar el compartir información con otros usuarios o almacenarlo para referencias futuras. Además, los informes no incrustados pueden ser más fáciles de mantener y actualizar, ya que no están dependientes del sistema principal.

La elección entre informes incrustados y no incrustados dependerá de las necesidades específicas del proyecto y del usuario final. Los informes incrustados son ideales para aplicaciones donde la interactividad y personalización son cruciales, mientras que los informes no incrustados son más adecuados cuando se requiere una mayor portabilidad y accesibilidad.

Para implementar informes en cualquier tipo de aplicación, es importante considerar factores como la complejidad de los datos a presentar, el nivel de interactividad requerido y las preferencias del usuario. Además, es fundamental que los informes sean fáciles de entender y visualizar, lo cual puede implicar el uso de gráficos, tablas y formatos adecuados.

En resumen, la creación de informes incrustados y no incrustados en aplicaciones requiere una consideración cuidadosa de las necesidades del usuario y los objetivos del proyecto. Cada tipo de informe tiene sus ventajas y desventajas, y la elección correcta dependerá de cómo se utilicen estos informes dentro del contexto general de la aplicación.

### pantalla completa de informe

```
<!doctype html>
<html>
  <head>
    <style>
    
      body{
        display:grid;
        grid-template-columns:repeat(4,1fr);
        background:black;
        gap:10px;
      }
      .tarjeta{
        background:MidnightBlue;
        border-radius:5px;
        padding:10px;
        height:200px;
        color:white;
        box-shadow:0px 0px 3px LightSteelBlue;
      }
    </style>
  </head>
  <body>
    <?php
      for($i = 0;$i<10;$i++){
        echo '<div 
          class="tarjeta" 
          style="
            grid-column:  span '.rand(1,2).';
            grid-row:  span '.rand(1,2).';
          ">Hola</div>';
      }
    ?>
  </body>
</html>
```

### tarta css puro

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Interactive SVG Pie Chart from JSON</title>
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    margin: 2rem;
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  #chart-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  svg {
    max-width: 350px;
    width: 100%;
    height: auto;
  }

  .slice {
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
    transform-box: fill-box;
    transform-origin: 50% 50%;
  }

  .slice:hover {
    transform: scale(1.05);
    opacity: 0.85;
  }

  #legend {
    margin-top: 1rem;
    font-size: 0.9rem;
  }

  .legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.3rem;
    gap: 0.5rem;
  }

  .legend-color {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid rgba(0,0,0,0.2);
  }

  #tooltip {
    position: fixed;
    pointer-events: none;
    padding: 0.3rem 0.5rem;
    background: rgba(0,0,0,0.8);
    color: #fff;
    border-radius: 4px;
    font-size: 0.8rem;
    transform: translate(-50%, -100%);
    white-space: nowrap;
    display: none;
    z-index: 9999;
  }

  #data-panel {
    max-width: 420px;
    width: 100%;
  }

  #data-input {
    width: 100%;
    min-height: 220px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.85rem;
  }

  #render-btn {
    margin-top: 0.5rem;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: #f5f5f5;
    cursor: pointer;
  }

  #render-btn:hover {
    background: #e9e9e9;
  }

  #error {
    color: #b00020;
    font-size: 0.8rem;
    margin-top: 0.5rem;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<div id="chart-container">
  <svg id="pie-chart" viewBox="0 0 300 300" aria-label="Pie chart"></svg>
  <div id="legend" aria-label="Legend"></div>
</div>

<div id="data-panel">
  <p>JSON input (array of objects with <code>label</code>, <code>value</code> and optional <code>color</code>):</p>
  <textarea id="data-input">
[
  { "label": "Marketing",  "value": 40, "color": "#4e79a7" },
  { "label": "Development","value": 30, "color": "#f28e2b" },
  { "label": "Support",    "value": 20, "color": "#e15759" },
  { "label": "Other",      "value": 10, "color": "#76b7b2" }
]
  </textarea>
  <button id="render-btn">Render chart</button>
  <div id="error"></div>
</div>

<div id="tooltip"></div>

<script>
(function () {
  const svg = document.getElementById('pie-chart');
  const legend = document.getElementById('legend');
  const tooltip = document.getElementById('tooltip');
  const textarea = document.getElementById('data-input');
  const btn = document.getElementById('render-btn');
  const errorBox = document.getElementById('error');

  const fallbackColors = [
    "#4e79a7", "#f28e2b", "#e15759", "#76b7b2",
    "#59a14f", "#edc948", "#b07aa1", "#ff9da7",
    "#9c755f", "#bab0ab"
  ];

  function polarToCartesian(cx, cy, r, angleRad) {
    return {
      x: cx + r * Math.cos(angleRad),
      y: cy + r * Math.sin(angleRad)
    };
  }

  function createSlicePath(cx, cy, r, startAngle, endAngle) {
    const start = polarToCartesian(cx, cy, r, startAngle);
    const end = polarToCartesian(cx, cy, r, endAngle);
    const largeArcFlag = (endAngle - startAngle) > Math.PI ? 1 : 0;
    const d = [
      `M ${cx} ${cy}`,
      `L ${start.x} ${start.y}`,
      `A ${r} ${r} 0 ${largeArcFlag} 1 ${end.x} ${end.y}`,
      'Z'
    ].join(' ');
    return d;
  }

  function clearChart() {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    while (legend.firstChild) legend.removeChild(legend.firstChild);
  }

  function showTooltip(text, x, y) {
    tooltip.textContent = text;
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
    tooltip.style.display = 'block';
  }

  function hideTooltip() {
    tooltip.style.display = 'none';
  }

  function renderPieChart(data) {
    clearChart();
    hideTooltip();

    const cx = 150;
    const cy = 150;
    const r = 120;

    const total = data.reduce((sum, item) => sum + (Number(item.value) || 0), 0);
    if (total === 0) {
      errorBox.textContent = "Total value is 0. Please provide positive numeric values.";
      return;
    }

    let startAngle = -Math.PI / 2; // start at top

    data.forEach((item, index) => {
      const value = Number(item.value) || 0;
      if (value <= 0) return; // skip non-positive

      const angle = (value / total) * 2 * Math.PI;
      const endAngle = startAngle + angle;
      const d = createSlicePath(cx, cy, r, startAngle, endAngle);

      const color = item.color || fallbackColors[index % fallbackColors.length];
      const percentage = (value / total * 100);

      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('d', d);
      path.setAttribute('fill', color);
      path.classList.add('slice');
      path.dataset.label = item.label || '';
      path.dataset.value = value;
      path.dataset.percentage = percentage.toFixed(1);

      path.addEventListener('mouseenter', (evt) => {
        const text = `${path.dataset.label}: ${path.dataset.value} (${path.dataset.percentage}%)`;
        showTooltip(text, evt.clientX, evt.clientY - 10);
      });

      path.addEventListener('mousemove', (evt) => {
        tooltip.style.left = evt.clientX + 'px';
        tooltip.style.top = (evt.clientY - 10) + 'px';
      });

      path.addEventListener('mouseleave', hideTooltip);

      svg.appendChild(path);

      // Legend entry
      const legendItem = document.createElement('div');
      legendItem.className = 'legend-item';

      const colorBox = document.createElement('div');
      colorBox.className = 'legend-color';
      colorBox.style.background = color;

      const labelSpan = document.createElement('span');
      labelSpan.textContent = `${item.label || '(no label)'} — ${value} (${percentage.toFixed(1)}%)`;

      legendItem.appendChild(colorBox);
      legendItem.appendChild(labelSpan);
      legend.appendChild(legendItem);

      startAngle = endAngle;
    });
  }

  function renderFromTextarea() {
    errorBox.textContent = '';
    try {
      const jsonText = textarea.value.trim();
      const data = JSON.parse(jsonText);
      if (!Array.isArray(data)) {
        throw new Error("JSON must be an array of objects.");
      }
      renderPieChart(data);
    } catch (e) {
      errorBox.textContent = "JSON error: " + e.message;
      clearChart();
    }
  }

  btn.addEventListener('click', renderFromTextarea);

  // Initial render with default JSON
  renderFromTextarea();

  // Optional: expose a function to render directly from a JS JSON string or object
  window.renderPieFromJsonString = function (jsonString) {
    textarea.value = jsonString;
    renderFromTextarea();
  };
  window.renderPieFromData = function (dataArray) {
    errorBox.textContent = '';
    renderPieChart(dataArray);
  };
})();
</script>

</body>
</html>
```

### incluir grafica

```
<!doctype html>
<html>
  <head>
    <style>
    
      body{
        display:grid;
        grid-template-columns:repeat(4,1fr);
        background:black;
        gap:10px;
      }
      .tarjeta{
        background:MidnightBlue;
        border-radius:5px;
        padding:10px;
        height:200px;
        color:white;
        box-shadow:0px 0px 3px LightSteelBlue;
        display:flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <?php
      for($i = 0;$i<10;$i++){
        echo '<div 
          class="tarjeta" 
          style="
            grid-column:  span '.rand(1,2).';
            grid-row:  span '.rand(1,2).';
          ">
          
          ';
          include "grafica.php";
          echo '</div>';
      }
    ?>
  </body>
</html>
```

### con json

```
<!doctype html>
<html>
  <head>
    <style>
      body{
        display:grid;
        grid-template-columns:repeat(4,1fr);
        background:black;
        gap:10px;
      }
      .tarjeta{
        background:MidnightBlue;
        border-radius:5px;
        padding:10px;
        height:200px;
        color:white;
        box-shadow:0px 0px 3px LightSteelBlue;
        display:flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <?php
      // Example: array of JSON strings for each chart
     $jsonCharts = [

    // 1
    '[
      {"label": "Alpha",   "value": 45, "color": "#0a1a3c"},
      {"label": "Beta",    "value": 25, "color": "#10244d"},
      {"label": "Gamma",   "value": 20, "color": "#1a3366"},
      {"label": "Delta",   "value": 10, "color": "#244280"}
    ]',

    // 2
    '[
      {"label": "North",   "value": 35, "color": "#0d1f44"},
      {"label": "South",   "value": 30, "color": "#132a58"},
      {"label": "East",    "value": 20, "color": "#1e3b73"},
      {"label": "West",    "value": 15, "color": "#294c8f"}
    ]',

    // 3
    '[
      {"label": "Red",     "value": 50, "color": "#0a1330"},
      {"label": "Green",   "value": 20, "color": "#142047"},
      {"label": "Blue",    "value": 15, "color": "#1f2e5e"},
      {"label": "Yellow",  "value": 15, "color": "#2b3d7a"}
    ]',

    // 4
    '[
      {"label": "Jan",     "value": 30, "color": "#0c1638"},
      {"label": "Feb",     "value": 30, "color": "#14224c"},
      {"label": "Mar",     "value": 25, "color": "#1d3062"},
      {"label": "Apr",     "value": 15, "color": "#2a437f"}
    ]',

    // 5
    '[
      {"label": "Chrome",  "value": 40, "color": "#09122c"},
      {"label": "Firefox", "value": 20, "color": "#111d40"},
      {"label": "Edge",    "value": 20, "color": "#1b2d59"},
      {"label": "Safari",  "value": 20, "color": "#274173"}
    ]',

    // 6
    '[
      {"label": "CPU",     "value": 55, "color": "#0a1a3c"},
      {"label": "GPU",     "value": 25, "color": "#132a58"},
      {"label": "RAM",     "value": 10, "color": "#1f3c74"},
      {"label": "Disk",    "value": 10, "color": "#2b4e8f"}
    ]',

    // 7
    '[
      {"label": "Spain",   "value": 30, "color": "#0d1f44"},
      {"label": "France",  "value": 30, "color": "#162b58"},
      {"label": "Italy",   "value": 20, "color": "#1f386f"},
      {"label": "Germany", "value": 20, "color": "#2a4788"}
    ]',

    // 8
    '[
      {"label": "Sales",       "value": 60, "color": "#0a1534"},
      {"label": "Purchasing",  "value": 20, "color": "#121f48"},
      {"label": "Logistics",   "value": 10, "color": "#1c2b61"},
      {"label": "Warehouse",   "value": 10, "color": "#283c7e"}
    ]',

    // 9
    '[
      {"label": "Facebook",    "value": 25, "color": "#09122c"},
      {"label": "Instagram",   "value": 35, "color": "#17244d"},
      {"label": "YouTube",     "value": 20, "color": "#233666"},
      {"label": "TikTok",      "value": 20, "color": "#2f4882"}
    ]',

    // 10
    '[
      {"label": "X",       "value": 30, "color": "#0b1736"},
      {"label": "Y",       "value": 30, "color": "#13234a"},
      {"label": "Z",       "value": 20, "color": "#1c315f"},
      {"label": "W",       "value": 20, "color": "#28427c"}
    ]',

];


      for ($i = 0; $i < 10; $i++) {

        // Choose one JSON per card (here we cycle through the array)
        $jsonForThisCard = $jsonCharts[$i % count($jsonCharts)];

        // Convert JSON → PHP array that svg_pie_chart_include.php expects
        $pieData = json_decode($jsonForThisCard, true);

        // Optional: options per chart
        $pieOptions = [
          'id'         => 'chart_' . $i, // ensures unique IDs
          'width'      => 200,
          'showLegend' => true,
        ];

        echo '<div 
          class="tarjeta" 
          style="
            grid-column:  span ' . rand(1,2) . ';
            grid-row:  span ' . rand(1,2) . ';
          ">
        ';

        // Here we include your chart file (grafica.php / svg_pie_chart_include.php)
        include "grafica.php";

        echo '</div>';
      }
    ?>
  </body>
</html>
```

### mejoras

```
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tech Grid Dashboard</title>
    <style>
      :root{
        --bg-main: #02030a;
        --bg-panel: #091122;
        --bg-panel-alt: #101b33;
        --accent: #4ea3ff;
        --accent-soft: rgba(78,163,255,0.35);
        --text-main: #e6f0ff;
        --grid-gap: 16px;
        --card-radius: 18px;
      }

      *{
        box-sizing: border-box;
      }

      html, body{
        margin:0;
        padding:0;
        width:100%;
        height:100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: var(--text-main);
      }

      body{
        display:grid;
        grid-template-columns:repeat(4,minmax(0,1fr));
        grid-auto-rows: minmax(220px, 1fr);
        grid-auto-flow: dense;
        gap:var(--grid-gap);
        padding:20px;
        background:
          radial-gradient(circle at 0% 0%, #1a2b5a 0, transparent 55%),
          radial-gradient(circle at 100% 100%, #0b142f 0, transparent 60%),
          #02030a;
        background-attachment: fixed;
        overflow:hidden;
      }

      /* subtle grid overlay */
      body::before{
        content:"";
        position:fixed;
        inset:0;
        background-image:
          linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events:none;
        opacity:0.5;
        mix-blend-mode:screen;
        z-index:-1;
      }

      .tarjeta{
        position:relative;
        background: radial-gradient(circle at 10% 0%, var(--bg-panel) 0, var(--bg-panel-alt) 55%, #050814 100%);
        border-radius:var(--card-radius);
        padding:0;
        color:var(--text-main);
        box-shadow:
          0 0 0 1px rgba(255,255,255,0.02),
          0 18px 40px rgba(0,0,0,0.7);
        display:flex;
        justify-content: center;
        align-items: stretch;
        overflow:hidden;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease,
          border 0.3s ease,
          background 0.3s ease;
        border: 1px solid rgba(78,163,255,0.18);
      }

      /* animated highlight sweep */
      .tarjeta::before{
        content:"";
        position:absolute;
        inset:-40%;
        background:
          linear-gradient(120deg,
            transparent 0%,
            rgba(255,255,255,0.12) 45%,
            rgba(255,255,255,0.08) 50%,
            transparent 55%);
        opacity:0;
        transform: translateX(-40%);
        pointer-events:none;
      }

      .tarjeta:hover{
        transform: translateY(-4px) scale(1.02);
        box-shadow:
          0 0 0 1px rgba(78,163,255,0.25),
          0 22px 60px rgba(0,0,0,0.85);
        background: radial-gradient(circle at 15% 0%, #101f3f 0, #050814 70%);
      }

      .tarjeta:hover::before{
        opacity:1;
        animation: sweep 1.1s ease-out forwards;
      }

      @keyframes sweep{
        0%{ transform: translateX(-50%) translateY(-10%); opacity:0; }
        20%{ opacity:1; }
        100%{ transform: translateX(40%) translateY(10%); opacity:0; }
      }

      /* small screens */
      @media (max-width: 1024px){
        body{
          grid-template-columns: repeat(2, minmax(0,1fr));
          grid-auto-rows: minmax(260px, 1fr);
        }
      }

      @media (max-width: 720px){
        body{
          grid-template-columns: 1fr;
          grid-auto-rows: minmax(260px, 1fr);
          padding:12px;
        }
      }
    </style>
  </head>
  <body>
    <?php
      // Example: array of JSON strings for each chart
      $jsonCharts = [

        // 1
        '[
          {"label": "Alpha",   "value": 45, "color": "#0a1a3c"},
          {"label": "Beta",    "value": 25, "color": "#10244d"},
          {"label": "Gamma",   "value": 20, "color": "#1a3366"},
          {"label": "Delta",   "value": 10, "color": "#244280"}
        ]',

        // 2
        '[
          {"label": "North",   "value": 35, "color": "#0d1f44"},
          {"label": "South",   "value": 30, "color": "#132a58"},
          {"label": "East",    "value": 20, "color": "#1e3b73"},
          {"label": "West",    "value": 15, "color": "#294c8f"}
        ]',

        // 3
        '[
          {"label": "Red",     "value": 50, "color": "#0a1330"},
          {"label": "Green",   "value": 20, "color": "#142047"},
          {"label": "Blue",    "value": 15, "color": "#1f2e5e"},
          {"label": "Yellow",  "value": 15, "color": "#2b3d7a"}
        ]',

        // 4
        '[
          {"label": "Jan",     "value": 30, "color": "#0c1638"},
          {"label": "Feb",     "value": 30, "color": "#14224c"},
          {"label": "Mar",     "value": 25, "color": "#1d3062"},
          {"label": "Apr",     "value": 15, "color": "#2a437f"}
        ]',

        // 5
        '[
          {"label": "Chrome",  "value": 40, "color": "#09122c"},
          {"label": "Firefox", "value": 20, "color": "#111d40"},
          {"label": "Edge",    "value": 20, "color": "#1b2d59"},
          {"label": "Safari",  "value": 20, "color": "#274173"}
        ]',

        // 6
        '[
          {"label": "CPU",     "value": 55, "color": "#0a1a3c"},
          {"label": "GPU",     "value": 25, "color": "#132a58"},
          {"label": "RAM",     "value": 10, "color": "#1f3c74"},
          {"label": "Disk",    "value": 10, "color": "#2b4e8f"}
        ]',

        // 7
        '[
          {"label": "Spain",   "value": 30, "color": "#0d1f44"},
          {"label": "France",  "value": 30, "color": "#162b58"},
          {"label": "Italy",   "value": 20, "color": "#1f386f"},
          {"label": "Germany", "value": 20, "color": "#2a4788"}
        ]',

        // 8
        '[
          {"label": "Sales",       "value": 60, "color": "#0a1534"},
          {"label": "Purchasing",  "value": 20, "color": "#121f48"},
          {"label": "Logistics",   "value": 10, "color": "#1c2b61"},
          {"label": "Warehouse",   "value": 10, "color": "#283c7e"}
        ]',

        // 9
        '[
          {"label": "Facebook",    "value": 25, "color": "#09122c"},
          {"label": "Instagram",   "value": 35, "color": "#17244d"},
          {"label": "YouTube",     "value": 20, "color": "#233666"},
          {"label": "TikTok",      "value": 20, "color": "#2f4882"}
        ]',

        // 10
        '[
          {"label": "X",       "value": 30, "color": "#0b1736"},
          {"label": "Y",       "value": 30, "color": "#13234a"},
          {"label": "Z",       "value": 20, "color": "#1c315f"},
          {"label": "W",       "value": 20, "color": "#28427c"}
        ]',

      ];

      for ($i = 0; $i < 10; $i++) {

        // Choose one JSON per card (here we cycle through the array)
        $jsonForThisCard = $jsonCharts[$i % count($jsonCharts)];

        // Convert JSON → PHP array that grafica.php expects
        $pieData = json_decode($jsonForThisCard, true);

        // Options per chart
        $pieOptions = [
          'id'         => 'chart_' . $i, // ensures unique IDs
          'width'      => 220,
          'showLegend' => true,
        ];

        echo '<div 
          class="tarjeta" 
          style="
            grid-column:  span ' . rand(1,2) . ';
          ">
        ';

        include "grafica.php";

        echo '</div>';
      }
    ?>
  </body>
</html>
```

### diferentes tipos

```
<!doctype html>
<html>
  <head>
    <style>
      :root{
        --bg-main:#020712;
        --card-bg:#050b1a;
        --card-border:#1c2c4f;
        --card-glow:#3b82f6;
        --grid-gap:10px;
      }
      *{
        box-sizing:border-box;
      }
      body{
        margin:0;
        min-height:100vh;
        display:grid;
        grid-template-columns:repeat(8,1fr);
        grid-auto-rows:220px;
        grid-auto-flow:dense;
        background:
          radial-gradient(circle at 10% 20%, #0b1220 0, transparent 40%),
          radial-gradient(circle at 80% 80%, #020617 0, transparent 45%),
          var(--bg-main);
        gap:var(--grid-gap);
        padding:var(--grid-gap);
        font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      }
      .tarjeta{
        position:relative;
        background:radial-gradient(circle at 0 0,#0b1b3a 0,#050b1a 55%);
        border-radius:10px;
        color:#e5e7eb;
        box-shadow:
          0 0 0 1px rgba(37,99,235,0.35),
          0 10px 30px rgba(15,23,42,0.9);
        display:flex;
        justify-content:center;
        align-items:center;
        overflow:hidden;
        isolation:isolate;
      }
      .tarjeta::before{
        content:"";
        position:absolute;
        inset:-40%;
        background:
          radial-gradient(circle at 0 0,rgba(56,189,248,0.15) 0,transparent 60%),
          radial-gradient(circle at 100% 100%,rgba(129,140,248,0.18) 0,transparent 60%);
        opacity:0.2;
        mix-blend-mode:screen;
        pointer-events:none;
      }
      .tarjeta::after{
        content:"";
        position:absolute;
        inset:0;
        background:
          repeating-linear-gradient(
            135deg,
            rgba(148,163,184,0.04) 0 2px,
            transparent 2px 4px
          );
        opacity:0.25;
        pointer-events:none;
      }
      .tarjeta-inner{
        position:relative;
        z-index:1;
        width:100%;
        height:100%;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .chart-label{
        position:absolute;
        top:6px;
        right:10px;
        font-size:10px;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:#9ca3af;
        background:rgba(15,23,42,0.8);
        border-radius:999px;
        padding:2px 8px;
        border:1px solid rgba(148,163,184,0.4);
        backdrop-filter:blur(4px);
        z-index:2;
      }
      @media(max-width:900px){
        body{
          grid-template-columns:repeat(2,1fr);
        }
      }
      @media(max-width:600px){
        body{
          grid-template-columns:1fr;
        }
      }
    </style>
  </head>
  <body>
    <?php
      // Example: array of JSON strings for each chart
      $jsonCharts = [

        // 1
        '[
          {"label": "Alpha",   "value": 45, "color": "#0a1a3c"},
          {"label": "Beta",    "value": 25, "color": "#10244d"},
          {"label": "Gamma",   "value": 20, "color": "#1a3366"},
          {"label": "Delta",   "value": 10, "color": "#244280"}
        ]',

        // 2
        '[
          {"label": "North",   "value": 35, "color": "#0d1f44"},
          {"label": "South",   "value": 30, "color": "#132a58"},
          {"label": "East",    "value": 20, "color": "#1e3b73"},
          {"label": "West",    "value": 15, "color": "#294c8f"}
        ]',

        // 3
        '[
          {"label": "Red",     "value": 50, "color": "#0a1330"},
          {"label": "Green",   "value": 20, "color": "#142047"},
          {"label": "Blue",    "value": 15, "color": "#1f2e5e"},
          {"label": "Yellow",  "value": 15, "color": "#2b3d7a"}
        ]',

        // 4
        '[
          {"label": "Jan",     "value": 30, "color": "#0c1638"},
          {"label": "Feb",     "value": 30, "color": "#14224c"},
          {"label": "Mar",     "value": 25, "color": "#1d3062"},
          {"label": "Apr",     "value": 15, "color": "#2a437f"}
        ]',

        // 5
        '[
          {"label": "Chrome",  "value": 40, "color": "#09122c"},
          {"label": "Firefox", "value": 20, "color": "#111d40"},
          {"label": "Edge",    "value": 20, "color": "#1b2d59"},
          {"label": "Safari",  "value": 20, "color": "#274173"}
        ]',

        // 6
        '[
          {"label": "CPU",     "value": 55, "color": "#0a1a3c"},
          {"label": "GPU",     "value": 25, "color": "#132a58"},
          {"label": "RAM",     "value": 10, "color": "#1f3c74"},
          {"label": "Disk",    "value": 10, "color": "#2b4e8f"}
        ]',

        // 7
        '[
          {"label": "Spain",   "value": 30, "color": "#0d1f44"},
          {"label": "France",  "value": 30, "color": "#162b58"},
          {"label": "Italy",   "value": 20, "color": "#1f386f"},
          {"label": "Germany", "value": 20, "color": "#2a4788"}
        ]',

        // 8
        '[
          {"label": "Sales",       "value": 60, "color": "#0a1534"},
          {"label": "Purchasing",  "value": 20, "color": "#121f48"},
          {"label": "Logistics",   "value": 10, "color": "#1c2b61"},
          {"label": "Warehouse",   "value": 10, "color": "#283c7e"}
        ]',

        // 9
        '[
          {"label": "Facebook",    "value": 25, "color": "#09122c"},
          {"label": "Instagram",   "value": 35, "color": "#17244d"},
          {"label": "YouTube",     "value": 20, "color": "#233666"},
          {"label": "TikTok",      "value": 20, "color": "#2f4882"}
        ]',

        // 10
        '[
          {"label": "X",       "value": 30, "color": "#0b1736"},
          {"label": "Y",       "value": 30, "color": "#13234a"},
          {"label": "Z",       "value": 20, "color": "#1c315f"},
          {"label": "W",       "value": 20, "color": "#28427c"}
        ]',
      ];

      $chartTypes = ['pie','bar','line'];

      for ($i = 0; $i < 10; $i++) {

        $jsonForThisCard = $jsonCharts[$i % count($jsonCharts)];
        $pieData = json_decode($jsonForThisCard, true);

        // random chart type
        $randomType = $chartTypes[array_rand($chartTypes)];

        $pieOptions = [
          'id'         => 'chart_' . $i,
          'width'      => 220,
          'showLegend' => true,
          'type'       => $randomType,
        ];

        echo '<div 
          class="tarjeta" 
          style="
            grid-column: span ' . rand(1,2) . ';
            grid-row: span ' . rand(1,2) . ';
          ">
          <div class="chart-label">'.strtoupper($randomType).'</div>
          <div class="tarjeta-inner">
        ';

        include "grafica2.php";

        echo '  </div>
        </div>';
      }
    ?>
  </body>
</html>
```

### mas usable

```
<!doctype html>
<html>
  <head>
    <style>
      :root{
        --bg-main:#020712;
        --card-bg:#050b1a;
        --card-border:#1c2c4f;
        --card-glow:#3b82f6;
        --grid-gap:10px;
      }
      *{
        box-sizing:border-box;
      }
      body{
        margin:0;
        min-height:100vh;
        display:grid;
        grid-template-columns:repeat(8,1fr);
        grid-auto-rows:220px;
        grid-auto-flow:dense;
        background:
          radial-gradient(circle at 10% 20%, #0b1220 0, transparent 40%),
          radial-gradient(circle at 80% 80%, #020617 0, transparent 45%),
          var(--bg-main);
        gap:var(--grid-gap);
        padding:var(--grid-gap);
        font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      }
      .tarjeta{
        position:relative;
        background:radial-gradient(circle at 0 0,#0b1b3a 0,#050b1a 55%);
        border-radius:10px;
        color:#e5e7eb;
        box-shadow:
          0 0 0 1px rgba(37,99,235,0.35),
          0 10px 30px rgba(15,23,42,0.9);
        display:flex;
        justify-content:center;
        align-items:center;
        overflow:hidden;
        isolation:isolate;
      }
      .tarjeta::before{
        content:"";
        position:absolute;
        inset:-40%;
        background:
          radial-gradient(circle at 0 0,rgba(56,189,248,0.15) 0,transparent 60%),
          radial-gradient(circle at 100% 100%,rgba(129,140,248,0.18) 0,transparent 60%);
        opacity:0.2;
        mix-blend-mode:screen;
        pointer-events:none;
      }
      .tarjeta::after{
        content:"";
        position:absolute;
        inset:0;
        background:
          repeating-linear-gradient(
            135deg,
            rgba(148,163,184,0.04) 0 2px,
            transparent 2px 4px
          );
        opacity:0.25;
        pointer-events:none;
      }
      .tarjeta-inner{
        position:relative;
        z-index:1;
        width:100%;
        height:100%;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .chart-label{
        position:absolute;
        top:6px;
        right:10px;
        font-size:10px;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:#9ca3af;
        background:rgba(15,23,42,0.8);
        border-radius:999px;
        padding:2px 8px;
        border:1px solid rgba(148,163,184,0.4);
        backdrop-filter:blur(4px);
        z-index:2;
      }
      @media(max-width:900px){
        body{
          grid-template-columns:repeat(2,1fr);
        }
      }
      @media(max-width:600px){
        body{
          grid-template-columns:1fr;
        }
      }
    </style>
  </head>
  <body>
    <?php
      // Example: array of JSON strings for each chart
      $jsonCharts = [

        // 1
        '[
          {"label": "Alpha",   "value": 45, "color": "#0a1a3c"},
          {"label": "Beta",    "value": 25, "color": "#10244d"},
          {"label": "Gamma",   "value": 20, "color": "#1a3366"},
          {"label": "Delta",   "value": 10, "color": "#244280"}
        ]',

        // 2
        '[
          {"label": "North",   "value": 35, "color": "#0d1f44"},
          {"label": "South",   "value": 30, "color": "#132a58"},
          {"label": "East",    "value": 20, "color": "#1e3b73"},
          {"label": "West",    "value": 15, "color": "#294c8f"}
        ]',

        // 3
        '[
          {"label": "Red",     "value": 50, "color": "#0a1330"},
          {"label": "Green",   "value": 20, "color": "#142047"},
          {"label": "Blue",    "value": 15, "color": "#1f2e5e"},
          {"label": "Yellow",  "value": 15, "color": "#2b3d7a"}
        ]',

        // 4
        '[
          {"label": "Jan",     "value": 30, "color": "#0c1638"},
          {"label": "Feb",     "value": 30, "color": "#14224c"},
          {"label": "Mar",     "value": 25, "color": "#1d3062"},
          {"label": "Apr",     "value": 15, "color": "#2a437f"}
        ]',

        // 5
        '[
          {"label": "Chrome",  "value": 40, "color": "#09122c"},
          {"label": "Firefox", "value": 20, "color": "#111d40"},
          {"label": "Edge",    "value": 20, "color": "#1b2d59"},
          {"label": "Safari",  "value": 20, "color": "#274173"}
        ]',

        // 6
        '[
          {"label": "CPU",     "value": 55, "color": "#0a1a3c"},
          {"label": "GPU",     "value": 25, "color": "#132a58"},
          {"label": "RAM",     "value": 10, "color": "#1f3c74"},
          {"label": "Disk",    "value": 10, "color": "#2b4e8f"}
        ]',

        // 7
        '[
          {"label": "Spain",   "value": 30, "color": "#0d1f44"},
          {"label": "France",  "value": 30, "color": "#162b58"},
          {"label": "Italy",   "value": 20, "color": "#1f386f"},
          {"label": "Germany", "value": 20, "color": "#2a4788"}
        ]',

        // 8
        '[
          {"label": "Sales",       "value": 60, "color": "#0a1534"},
          {"label": "Purchasing",  "value": 20, "color": "#121f48"},
          {"label": "Logistics",   "value": 10, "color": "#1c2b61"},
          {"label": "Warehouse",   "value": 10, "color": "#283c7e"}
        ]',

        // 9
        '[
          {"label": "Facebook",    "value": 25, "color": "#09122c"},
          {"label": "Instagram",   "value": 35, "color": "#17244d"},
          {"label": "YouTube",     "value": 20, "color": "#233666"},
          {"label": "TikTok",      "value": 20, "color": "#2f4882"}
        ]',

        // 10
        '[
          {"label": "X",       "value": 30, "color": "#0b1736"},
          {"label": "Y",       "value": 30, "color": "#13234a"},
          {"label": "Z",       "value": 20, "color": "#1c315f"},
          {"label": "W",       "value": 20, "color": "#28427c"}
        ]',
      ];

      $chartTypes = ['pie','bar','line'];

      for ($i = 0; $i < 10; $i++) {

        $jsonForThisCard = $jsonCharts[$i % count($jsonCharts)];
        $pieData = json_decode($jsonForThisCard, true);

        // random chart type
        $randomType = $chartTypes[array_rand($chartTypes)];

        $pieOptions = [
          'id'         => 'chart_' . $i,
          'width'      => 220,
          'showLegend' => true,
          'type'       => $randomType,
        ];

        echo '<div 
          class="tarjeta" 
          style="
            grid-column: span ' . rand(1,2) . ';
            grid-row: span ' . rand(1,2) . ';
          ">
          <div class="chart-label">'.strtoupper($randomType).'</div>
          <div class="tarjeta-inner">
        ';

        include "grafica2.php";

        echo '  </div>
        </div>';
      }
    ?>
  </body>
</html>
```

### json externo

```
<!doctype html>
<html>
  <head>
    <style>
      :root{
        --bg-main:#020712;
        --card-bg:#050b1a;
        --card-border:#1c2c4f;
        --card-glow:#3b82f6;
        --grid-gap:10px;
      }
      *{
        box-sizing:border-box;
      }
      body{
        margin:0;
        min-height:100vh;
        display:grid;
        grid-template-columns:repeat(5,1fr);
        grid-auto-rows:220px;
        grid-auto-flow:dense;
        background:
          radial-gradient(circle at 10% 20%, #0b1220 0, transparent 40%),
          radial-gradient(circle at 80% 80%, #020617 0, transparent 45%),
          var(--bg-main);
        gap:var(--grid-gap);
        padding:var(--grid-gap);
        font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      }
      .tarjeta{
        position:relative;
        background:radial-gradient(circle at 0 0,#0b1b3a 0,#050b1a 55%);
        border-radius:10px;
        color:#e5e7eb;
        box-shadow:
          0 0 0 1px rgba(37,99,235,0.35),
          0 10px 30px rgba(15,23,42,0.9);
        display:flex;
        justify-content:center;
        align-items:center;
        overflow:hidden;
        isolation:isolate;
      }
      .tarjeta::before{
        content:"";
        position:absolute;
        inset:-40%;
        background:
          radial-gradient(circle at 0 0,rgba(56,189,248,0.15) 0,transparent 60%),
          radial-gradient(circle at 100% 100%,rgba(129,140,248,0.18) 0,transparent 60%);
        opacity:0.2;
        mix-blend-mode:screen;
        pointer-events:none;
      }
      .tarjeta::after{
        content:"";
        position:absolute;
        inset:0;
        background:
          repeating-linear-gradient(
            135deg,
            rgba(148,163,184,0.04) 0 2px,
            transparent 2px 4px
          );
        opacity:0.25;
        pointer-events:none;
      }
      .tarjeta-inner{
        position:relative;
        z-index:1;
        width:100%;
        height:100%;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .chart-label{
        position:absolute;
        top:6px;
        right:10px;
        font-size:10px;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:#9ca3af;
        background:rgba(15,23,42,0.8);
        border-radius:999px;
        padding:2px 8px;
        border:1px solid rgba(148,163,184,0.4);
        backdrop-filter:blur(4px);
        z-index:2;
      }
      @media(max-width:900px){
        body{
          grid-template-columns:repeat(2,1fr);
        }
      }
      @media(max-width:600px){
        body{
          grid-template-columns:1fr;
        }
      }
    </style>
  </head>
  <body>
    <?php
      // 10 ficheros JSON externos
      $dataFiles = [
        "data/chart1.json",
        "data/chart2.json",
        "data/chart3.json",
        "data/chart4.json",
        "data/chart5.json",
        "data/chart6.json",
        "data/chart7.json",
        "data/chart8.json",
        "data/chart9.json",
        "data/chart10.json",
      ];

      $chartTypes = ['pie','bar','line'];

      for ($i = 0; $i < 10; $i++) {

        $randomType = $chartTypes[array_rand($chartTypes)];

        // Opciones que recibe grafica2.php
        $pieOptions = [
          'id'         => 'chart_' . $i,
          'width'      => 220,
          'showLegend' => true,
          'type'       => $randomType,
          'dataUrl'    => $dataFiles[$i], // ← fichero JSON de este gráfico
        ];

        echo '<div 
          class="tarjeta" 
          style="
            grid-column: span ' . rand(1,2) . ';
            grid-row: span ' . rand(1,2) . ';
          ">
          <div class="chart-label">'.strtoupper($randomType).'</div>
          <div class="tarjeta-inner">
        ';

        include "grafica3.php";

        echo '  </div>
        </div>';
      }
    ?>
  </body>
</html>
```

### grafica

```
<?php
/**
 * grafica.php
 * Each include renders one pie chart using $pieData and optional $pieOptions.
 */

if (!isset($pieData) || !is_array($pieData)) {
    $pieData = [
        [ 'label' => 'Marketing',   'value' => rand(10,100), 'color' => '#1f235a' ],
        [ 'label' => 'Development', 'value' => rand(10,100), 'color' => '#26306b' ],
        [ 'label' => 'Support',     'value' => rand(10,100), 'color' => '#30407f' ],
        [ 'label' => 'Other',       'value' => rand(10,100), 'color' => '#3b5294' ],
    ];
}

$pieOptions = isset($pieOptions) && is_array($pieOptions) ? $pieOptions : [];

$baseId     = $pieOptions['id'] ?? uniqid('piechart_');
$width      = isset($pieOptions['width']) ? (int)$pieOptions['width'] : 300;
$showLegend = array_key_exists('showLegend', $pieOptions)
    ? (bool)$pieOptions['showLegend']
    : true;

$svgId       = $baseId . '_svg';
$legendId    = $baseId . '_legend';
$tooltipId   = $baseId . '_tooltip';
$containerId = $baseId . '_container';

$jsonOptions = JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP;
$jsonData    = json_encode($pieData, $jsonOptions);

if (!defined('SVG_PIE_CHART_CSS_PRINTED')) {
    define('SVG_PIE_CHART_CSS_PRINTED', true);
    ?>
    <style>
      .svg-pie-chart-container {
        display: inline-flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        height: 100%;
        padding: 12px 16px;
        box-sizing: border-box;
        color:#e6f0ff;
      }

      .svg-pie-chart-container svg {
        flex: 1 1 auto;
        max-width: 60%;
        height: 100%;
        filter: drop-shadow(0 6px 18px rgba(0,0,0,0.7));
      }

      .svg-pie-slice {
        cursor: pointer;
        transition:
          transform 0.2s ease,
          opacity 0.2s ease,
          filter 0.2s ease;
        transform-box: fill-box;
        transform-origin: 50% 50%;
      }

      .svg-pie-slice:hover {
        transform: scale(1.06);
        opacity: 0.92;
        filter: drop-shadow(0 0 8px rgba(78,163,255,0.8));
      }

      .svg-pie-legend {
        flex: 0 0 40%;
        margin-left: 12px;
        font-size: 0.82rem;
        line-height: 1.3;
        display:flex;
        flex-direction:column;
        gap:4px;
      }

      .svg-pie-legend-item {
        display: flex;
        align-items: center;
        gap: 0.55rem;
        padding: 3px 6px;
        border-radius: 6px;
        background: linear-gradient(
          120deg,
          rgba(10,22,60,0.7),
          rgba(20,36,90,0.3)
        );
        border:1px solid rgba(78,163,255,0.12);
      }

      .svg-pie-legend-color {
        width: 14px;
        height: 14px;
        border-radius: 3px;
        border: 1px solid rgba(0,0,0,0.35);
        box-shadow: 0 0 8px rgba(78,163,255,0.45);
      }

      .svg-pie-tooltip {
        position: fixed;
        pointer-events: none;
        padding: 0.25rem 0.55rem;
        background: radial-gradient(circle at 0 0, #4ea3ff 0, #050814 55%);
        color: #e6f0ff;
        border-radius: 4px;
        font-size: 0.78rem;
        transform: translate(-50%, -100%);
        white-space: nowrap;
        display: none;
        z-index: 9999;
        border:1px solid rgba(78,163,255,0.7);
        box-shadow: 0 6px 18px rgba(0,0,0,0.8);
      }

      @media (max-width: 1024px){
        .svg-pie-chart-container{
          flex-direction: column;
          align-items: stretch;
          justify-content: center;
          gap:8px;
        }
        .svg-pie-chart-container svg{
          max-width: 100%;
        }
        .svg-pie-legend{
          margin-left:0;
          flex: 0 0 auto;
        }
      }
    </style>
    <?php
}
?>

<div id="<?php echo htmlspecialchars($containerId, ENT_QUOTES); ?>"
     class="svg-pie-chart-container">

  <svg id="<?php echo htmlspecialchars($svgId, ENT_QUOTES); ?>"
       viewBox="0 0 300 300"
       width="<?php echo $width; ?>"
       height="<?php echo $width; ?>"
       aria-label="Pie chart">
  </svg>

  <?php if ($showLegend): ?>
    <div id="<?php echo htmlspecialchars($legendId, ENT_QUOTES); ?>"
         class="svg-pie-legend"
         aria-label="Legend">
    </div>
  <?php endif; ?>

  <div id="<?php echo htmlspecialchars($tooltipId, ENT_QUOTES); ?>"
       class="svg-pie-tooltip"></div>
</div>

<script>
(function () {
  const data      = <?php echo $jsonData; ?>;
  const svgId     = <?php echo json_encode($svgId); ?>;
  const legendId  = <?php echo json_encode($legendId); ?>;
  const tooltipId = <?php echo json_encode($tooltipId); ?>;
  const showLegend = <?php echo $showLegend ? 'true' : 'false'; ?>;

  const svg     = document.getElementById(svgId);
  const legend  = showLegend ? document.getElementById(legendId) : null;
  const tooltip = document.getElementById(tooltipId);

  if (!svg || !tooltip) return;

  const fallbackColors = [
    "#4e79a7", "#f28e2b", "#e15759", "#76b7b2",
    "#59a14f", "#edc948", "#b07aa1", "#ff9da7",
    "#9c755f", "#bab0ab"
  ];

  function polarToCartesian(cx, cy, r, angleRad) {
    return {
      x: cx + r * Math.cos(angleRad),
      y: cy + r * Math.sin(angleRad)
    };
  }

  function createSlicePath(cx, cy, r, startAngle, endAngle) {
    const start = polarToCartesian(cx, cy, r, startAngle);
    const end   = polarToCartesian(cx, cy, r, endAngle);
    const largeArcFlag = (endAngle - startAngle) > Math.PI ? 1 : 0;

    return [
      "M " + cx + " " + cy,
      "L " + start.x + " " + start.y,
      "A " + r + " " + r + " 0 " + largeArcFlag + " 1 " + end.x + " " + end.y,
      "Z"
    ].join(" ");
  }

  function clearChart() {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    if (legend) {
      while (legend.firstChild) legend.removeChild(legend.firstChild);
    }
  }

  function showTooltip(text, x, y) {
    tooltip.textContent = text;
    tooltip.style.left  = x + "px";
    tooltip.style.top   = y + "px";
    tooltip.style.display = "block";
  }

  function hideTooltip() {
    tooltip.style.display = "none";
  }

  function renderPieChart(items) {
    clearChart();
    hideTooltip();

    const cx = 150;
    const cy = 150;
    const r  = 120;

    const total = items.reduce(function (sum, item) {
      const v = Number(item.value) || 0;
      return sum + v;
    }, 0);

    if (total === 0) {
      if (legend) {
        const msg = document.createElement("div");
        msg.textContent = "Total value is 0. Please provide positive numeric values.";
        legend.appendChild(msg);
      }
      return;
    }

    let startAngle = -Math.PI / 2;

    items.forEach(function (item, index) {
      const value = Number(item.value) || 0;
      if (value <= 0) return;

      const angle    = (value / total) * 2 * Math.PI;
      const endAngle = startAngle + angle;
      const d        = createSlicePath(cx, cy, r, startAngle, endAngle);

      const color      = item.color || fallbackColors[index % fallbackColors.length];
      const percentage = (value / total * 100);
      const label      = item.label || "";

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", d);
      path.setAttribute("fill", color);
      path.classList.add("svg-pie-slice");
      path.dataset.label       = label;
      path.dataset.value       = value;
      path.dataset.percentage  = percentage.toFixed(1);

      path.addEventListener("mouseenter", function (evt) {
        const text = label
          ? label + ": " + value + " (" + percentage.toFixed(1) + "%)"
          : value + " (" + percentage.toFixed(1) + "%)";
        showTooltip(text, evt.clientX, evt.clientY - 10);
      });

      path.addEventListener("mousemove", function (evt) {
        tooltip.style.left = evt.clientX + "px";
        tooltip.style.top  = (evt.clientY - 10) + "px";
      });

      path.addEventListener("mouseleave", hideTooltip);

      svg.appendChild(path);

      if (legend) {
        const legendItem = document.createElement("div");
        legendItem.className = "svg-pie-legend-item";

        const colorBox = document.createElement("div");
        colorBox.className = "svg-pie-legend-color";
        colorBox.style.background = color;

        const labelSpan = document.createElement("span");
        labelSpan.textContent =
          (label || "(no label)") +
          " — " + value +
          " (" + percentage.toFixed(1) + "%)";

        legendItem.appendChild(colorBox);
        legendItem.appendChild(labelSpan);
        legend.appendChild(legendItem);
      }

      startAngle = endAngle;
    });
  }

  renderPieChart(data);
})();
</script>
```

### grafica2

```
<?php
/**
 * grafica.php
 *
 * Expects:
 *   $pieData = [
 *       [ 'label' => '...', 'value' => 40, 'color' => '#123456' ],
 *       ...
 *   ];
 *   $pieOptions = [
 *       'id'         => 'chart_1',
 *       'width'      => 220,
 *       'showLegend' => true,
 *       'type'       => 'pie' | 'bar' | 'line'
 *   ];
 */

// 1. Data fallback
if (!isset($pieData) || !is_array($pieData)) {
    $pieData = [
        [ 'label' => 'Alpha',   'value' => rand(10,100), 'color' => '#0a1a3c' ],
        [ 'label' => 'Beta',    'value' => rand(10,100), 'color' => '#14224c' ],
        [ 'label' => 'Gamma',   'value' => rand(10,100), 'color' => '#1d3062' ],
        [ 'label' => 'Delta',   'value' => rand(10,100), 'color' => '#2a437f' ],
    ];
}

// 2. Options
$pieOptions = isset($pieOptions) && is_array($pieOptions) ? $pieOptions : [];

$baseId     = $pieOptions['id'] ?? uniqid('chart_');
$width      = isset($pieOptions['width']) ? (int)$pieOptions['width'] : 220;
$showLegend = array_key_exists('showLegend', $pieOptions)
    ? (bool)$pieOptions['showLegend']
    : true;
$chartType  = isset($pieOptions['type']) ? (string)$pieOptions['type'] : 'pie';

$svgId       = $baseId . '_svg';
$legendId    = $baseId . '_legend';
$tooltipId   = $baseId . '_tooltip';
$containerId = $baseId . '_container';

// 3. Encode data for JS
$jsonOptions = JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP;
$jsonData    = json_encode($pieData, $jsonOptions);

// 4. CSS only once
if (!defined('SVG_CHARTS_CSS_PRINTED')) {
    define('SVG_CHARTS_CSS_PRINTED', true);
    ?>
    <style>
      .svg-pie-chart-container {
        display:inline-flex;
        flex-direction:row;
        align-items:center;
        justify-content:center;
        width:100%;
        height:100%;
        padding:8px 10px;
        gap:10px;
      }

      .svg-pie-chart-container svg {
        flex:0 0 auto;
        height:100%;
        filter:drop-shadow(0 0 12px rgba(59,130,246,0.35));
      }

      .svg-pie-slice,
      .svg-bar-rect,
      .svg-line-point {
        cursor:pointer;
        transition:transform 0.2s ease, opacity 0.2s ease, filter 0.2s ease;
        transform-box:fill-box;
        transform-origin:50% 50%;
      }

      .svg-pie-slice:hover,
      .svg-bar-rect:hover,
      .svg-line-point:hover {
        transform:scale(1.05);
        opacity:0.9;
        filter:brightness(1.2);
      }

      .svg-pie-legend {
        flex:1 1 auto;
        font-size:0.7rem;
        color:#cbd5f5;
        max-height:100%;
        overflow:hidden;
      }

      .svg-pie-legend-item {
        display:flex;
        align-items:center;
        margin-bottom:0.18rem;
        gap:0.45rem;
        white-space:nowrap;
        text-overflow:ellipsis;
        overflow:hidden;
      }

      .svg-pie-legend-color {
        width:12px;
        height:12px;
        border-radius:3px;
        border:1px solid rgba(148,163,184,0.8);
        box-shadow:0 0 8px rgba(59,130,246,0.65);
      }

      .svg-pie-legend-item span{
        opacity:0.9;
      }

      .svg-pie-tooltip {
        position:fixed;
        pointer-events:none;
        padding:0.3rem 0.5rem;
        background:radial-gradient(circle at 0 0,#22d3ee 0,#1e293b 45%);
        color:#e5e7eb;
        border-radius:6px;
        font-size:0.75rem;
        transform:translate(-50%, -120%);
        white-space:nowrap;
        display:none;
        z-index:9999;
        border:1px solid rgba(96,165,250,0.6);
        box-shadow:
          0 0 18px rgba(59,130,246,0.7),
          0 10px 25px rgba(15,23,42,0.9);
      }

      .svg-grid-lines line{
        stroke:rgba(148,163,184,0.16);
        stroke-width:0.8;
      }

      .svg-axis line{
        stroke:rgba(191,219,254,0.7);
        stroke-width:1.2;
      }

      .svg-axis-label{
        fill:#9ca3af;
        font-size:9px;
      }
    </style>
    <?php
}
?>

<div id="<?php echo htmlspecialchars($containerId, ENT_QUOTES); ?>"
     class="svg-pie-chart-container">

  <svg id="<?php echo htmlspecialchars($svgId, ENT_QUOTES); ?>"
       viewBox="0 0 300 300"
       width="<?php echo $width; ?>"
       height="<?php echo $width; ?>"
       aria-label="Chart">
  </svg>

  <?php if ($showLegend): ?>
    <div id="<?php echo htmlspecialchars($legendId, ENT_QUOTES); ?>"
         class="svg-pie-legend"
         aria-label="Legend">
    </div>
  <?php endif; ?>

  <div id="<?php echo htmlspecialchars($tooltipId, ENT_QUOTES); ?>"
       class="svg-pie-tooltip"></div>
</div>

<script>
(function () {
  const rawData   = <?php echo $jsonData; ?>;
  const svgId     = <?php echo json_encode($svgId); ?>;
  const legendId  = <?php echo json_encode($legendId); ?>;
  const tooltipId = <?php echo json_encode($tooltipId); ?>;
  const showLegend = <?php echo $showLegend ? 'true' : 'false'; ?>;
  const chartType  = <?php echo json_encode($chartType); ?>;

  const svg     = document.getElementById(svgId);
  const legend  = showLegend ? document.getElementById(legendId) : null;
  const tooltip = document.getElementById(tooltipId);

  if (!svg || !tooltip) return;

  const fallbackColors = [
    "#1d4ed8","#0ea5e9","#6366f1","#22c55e",
    "#eab308","#f97316","#f43f5e","#a855f7",
    "#06b6d4","#4b5563"
  ];

  function clearChart() {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    if (legend) {
      while (legend.firstChild) legend.removeChild(legend.firstChild);
    }
  }

  function showTooltip(text, x, y) {
    tooltip.textContent = text;
    tooltip.style.left  = x + "px";
    tooltip.style.top   = y + "px";
    tooltip.style.display = "block";
  }

  function hideTooltip() {
    tooltip.style.display = "none";
  }

  function attachTooltip(el, label, value, percentage) {
    if (!el) return;
    el.addEventListener("mouseenter", function (evt) {
      const text = (label || "(no label)") +
        ": " + value + " (" + percentage.toFixed(1) + "%)";
      showTooltip(text, evt.clientX, evt.clientY - 10);
    });
    el.addEventListener("mousemove", function (evt) {
      tooltip.style.left = evt.clientX + "px";
      tooltip.style.top  = (evt.clientY - 10) + "px";
    });
    el.addEventListener("mouseleave", hideTooltip);
  }

  function polarToCartesian(cx, cy, r, angleRad) {
    return {
      x: cx + r * Math.cos(angleRad),
      y: cy + r * Math.sin(angleRad)
    };
  }

  function createSlicePath(cx, cy, r, startAngle, endAngle) {
    const start = polarToCartesian(cx, cy, r, startAngle);
    const end   = polarToCartesian(cx, cy, r, endAngle);
    const largeArcFlag = (endAngle - startAngle) > Math.PI ? 1 : 0;
    return [
      "M " + cx + " " + cy,
      "L " + start.x + " " + start.y,
      "A " + r + " " + r + " 0 " + largeArcFlag + " 1 " + end.x + " " + end.y,
      "Z"
    ].join(" ");
  }

  function buildLegend(items, total) {
    if (!legend) return;
    items.forEach(function (item) {
      const value = item.value;
      const label = item.label;
      const color = item.color;
      const pct   = total > 0 ? (value / total * 100) : 0;

      const legendItem = document.createElement("div");
      legendItem.className = "svg-pie-legend-item";

      const colorBox = document.createElement("div");
      colorBox.className = "svg-pie-legend-color";
      colorBox.style.background = color;

      const labelSpan = document.createElement("span");
      labelSpan.textContent =
        (label || "(no label)") +
        " — " + value +
        " (" + pct.toFixed(1) + "%)";

      legendItem.appendChild(colorBox);
      legendItem.appendChild(labelSpan);
      legend.appendChild(legendItem);
    });
  }

  function renderPieChart(items, total) {
    const cx = 150;
    const cy = 150;
    const r  = 110;

    let startAngle = -Math.PI / 2;

    items.forEach(function (item) {
      const value = item.value;
      if (value <= 0) return;

      const angle    = (value / total) * 2 * Math.PI;
      const endAngle = startAngle + angle;
      const d        = createSlicePath(cx, cy, r, startAngle, endAngle);

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", d);
      path.setAttribute("fill", item.color);
      path.classList.add("svg-pie-slice");

      const percentage = (value / total * 100);
      attachTooltip(path, item.label, value, percentage);

      svg.appendChild(path);
      startAngle = endAngle;
    });
  }

  function renderBarChart(items, total) {
    const chartTop    = 20;
    const chartBottom = 260;
    const chartLeft   = 40;
    const chartRight  = 280;
    const chartHeight = chartBottom - chartTop;
    const chartWidth  = chartRight - chartLeft;

    const maxValue = items.reduce(function (max, item) {
      return Math.max(max, item.value);
    }, 0);

    if (maxValue <= 0) return;

    // grid lines
    const grid = document.createElementNS("http://www.w3.org/2000/svg", "g");
    grid.setAttribute("class","svg-grid-lines");
    const steps = 4;
    for (let i = 0; i <= steps; i++) {
      const y = chartTop + (chartHeight / steps) * i;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", chartLeft);
      line.setAttribute("y1", y);
      line.setAttribute("x2", chartRight);
      line.setAttribute("y2", y);
      grid.appendChild(line);
    }
    svg.appendChild(grid);

    // axis
    const axis = document.createElementNS("http://www.w3.org/2000/svg", "g");
    axis.setAttribute("class","svg-axis");
    const xAxis = document.createElementNS("http://www.w3.org/2000/svg", "line");
    xAxis.setAttribute("x1", chartLeft);
    xAxis.setAttribute("y1", chartBottom);
    xAxis.setAttribute("x2", chartRight);
    xAxis.setAttribute("y2", chartBottom);
    axis.appendChild(xAxis);
    svg.appendChild(axis);

    const n = items.length;
    const slotWidth = chartWidth / Math.max(n,1);
    const barWidth  = slotWidth * 0.6;

    items.forEach(function (item, index) {
      const value = item.value;
      if (value <= 0) return;

      const barHeight = (value / maxValue) * chartHeight;
      const x = chartLeft + index * slotWidth + (slotWidth - barWidth) / 2;
      const y = chartBottom - barHeight;

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", x);
      rect.setAttribute("y", y);
      rect.setAttribute("width", barWidth);
      rect.setAttribute("height", barHeight);
      rect.setAttribute("rx", 4);
      rect.setAttribute("fill", item.color);
      rect.classList.add("svg-bar-rect");

      const percentage = (value / total * 100);
      attachTooltip(rect, item.label, value, percentage);

      svg.appendChild(rect);
    });
  }

  function renderLineChart(items, total) {
    const chartTop    = 25;
    const chartBottom = 260;
    const chartLeft   = 40;
    const chartRight  = 280;
    const chartHeight = chartBottom - chartTop;
    const chartWidth  = chartRight - chartLeft;

    const maxValue = items.reduce(function (max, item) {
      return Math.max(max, item.value);
    }, 0);

    if (maxValue <= 0) return;

    // grid
    const grid = document.createElementNS("http://www.w3.org/2000/svg", "g");
    grid.setAttribute("class","svg-grid-lines");
    const steps = 4;
    for (let i = 0; i <= steps; i++) {
      const y = chartTop + (chartHeight / steps) * i;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", chartLeft);
      line.setAttribute("y1", y);
      line.setAttribute("x2", chartRight);
      line.setAttribute("y2", y);
      grid.appendChild(line);
    }
    svg.appendChild(grid);

    const n = items.length;
    const spacing = n > 1 ? chartWidth / (n - 1) : 0;

    let points = "";
    const lineColor = items[0] ? items[0].color : "#38bdf8";

    items.forEach(function (item, idx) {
      const value = item.value;
      const x = chartLeft + spacing * idx;
      const y = chartTop + (1 - (value / maxValue)) * chartHeight;

      points += x + "," + y + " ";

      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      circle.setAttribute("cx", x);
      circle.setAttribute("cy", y);
      circle.setAttribute("r", 4);
      circle.setAttribute("fill", item.color);
      circle.classList.add("svg-line-point");

      const percentage = (value / total * 100);
      attachTooltip(circle, item.label, value, percentage);

      svg.appendChild(circle);
    });

    const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline.setAttribute("points", points.trim());
    polyline.setAttribute("fill", "none");
    polyline.setAttribute("stroke", lineColor);
    polyline.setAttribute("stroke-width", 2);
    polyline.setAttribute("stroke-linejoin","round");
    polyline.setAttribute("stroke-linecap","round");
    svg.insertBefore(polyline, svg.firstChild);
  }

  function normalizeData(raw) {
    return raw.map(function (item, index) {
      const value = Number(item.value) || 0;
      const color = item.color || fallbackColors[index % fallbackColors.length];
      const label = item.label || "";
      return { label: label, value: value, color: color };
    });
  }

  function renderChart(raw) {
    clearChart();
    hideTooltip();

    const items = normalizeData(raw);
    const total = items.reduce(function (sum, item) {
      return sum + item.value;
    }, 0);

    if (total === 0) {
      if (legend) {
        const msg = document.createElement("div");
        msg.textContent = "Total value is 0. Please provide positive numeric values.";
        legend.appendChild(msg);
      }
      return;
    }

    if (chartType === "bar") {
      renderBarChart(items, total);
    } else if (chartType === "line") {
      renderLineChart(items, total);
    } else {
      renderPieChart(items, total);
    }

    buildLegend(items, total);
  }

  renderChart(rawData);
})();
</script>
```

### grafica3

```
<?php
/**
 * grafica2.php
 *
 * Expects:
 *   $pieOptions = [
 *       'id'         => 'chart_1',
 *       'width'      => 220,
 *       'showLegend' => true,
 *       'type'       => 'pie' | 'bar' | 'line',
 *       'dataUrl'    => 'data/chart1.json'   // NEW: URL del JSON externo
 *   ];
 */

// 1. Options
$pieOptions = isset($pieOptions) && is_array($pieOptions) ? $pieOptions : [];

$baseId     = $pieOptions['id'] ?? uniqid('chart_');
$width      = isset($pieOptions['width']) ? (int)$pieOptions['width'] : 220;
$showLegend = array_key_exists('showLegend', $pieOptions)
    ? (bool)$pieOptions['showLegend']
    : true;
$chartType  = isset($pieOptions['type']) ? (string)$pieOptions['type'] : 'pie';
$dataUrl    = isset($pieOptions['dataUrl']) ? (string)$pieOptions['dataUrl'] : null;

$svgId       = $baseId . '_svg';
$legendId    = $baseId . '_legend';
$tooltipId   = $baseId . '_tooltip';
$containerId = $baseId . '_container';

// 2. CSS solo una vez
if (!defined('SVG_CHARTS_CSS_PRINTED')) {
    define('SVG_CHARTS_CSS_PRINTED', true);
    ?>
    <style>
      .svg-pie-chart-container {
        display:inline-flex;
        flex-direction:row;
        align-items:center;
        justify-content:center;
        width:100%;
        height:100%;
        padding:8px 10px;
        gap:10px;
      }

      .svg-pie-chart-container svg {
        flex:0 0 auto;
        height:100%;
        filter: drop-shadow(0 0 12px rgba(59, 130, 246, 0.35)) brightness(3);
      }

      .svg-pie-slice,
      .svg-bar-rect,
      .svg-line-point {
        cursor:pointer;
        transition:transform 0.2s ease, opacity 0.2s ease, filter 0.2s ease;
        transform-box:fill-box;
        transform-origin:50% 50%;
      }

      .svg-pie-slice:hover,
      .svg-bar-rect:hover,
      .svg-line-point:hover {
        transform:scale(1.05);
        opacity:0.9;
        filter:brightness(1.2);
      }

      .svg-pie-legend {
        flex:1 1 auto;
        font-size:0.7rem;
        color:#cbd5f5;
        max-height:100%;
        overflow:hidden;
      }

      .svg-pie-legend-item {
        display:flex;
        align-items:center;
        margin-bottom:0.18rem;
        gap:0.45rem;
        white-space:nowrap;
        text-overflow:ellipsis;
        overflow:hidden;
      }

      .svg-pie-legend-color {
        width:12px;
        height:12px;
        border-radius:3px;
        border:1px solid rgba(148,163,184,0.8);
        box-shadow:0 0 8px rgba(59,130,246,0.65);
      }

      .svg-pie-legend-item span{
        opacity:0.9;
      }

      .svg-pie-tooltip {
        position:fixed;
        pointer-events:none;
        padding:0.3rem 0.5rem;
        background:radial-gradient(circle at 0 0,#22d3ee 0,#1e293b 45%);
        color:#e5e7eb;
        border-radius:6px;
        font-size:0.75rem;
        transform:translate(-50%, -120%);
        white-space:nowrap;
        display:none;
        z-index:9999;
        border:1px solid rgba(96,165,250,0.6);
        box-shadow:
          0 0 18px rgba(59,130,246,0.7),
          0 10px 25px rgba(15,23,42,0.9);
      }

      .svg-grid-lines line{
        stroke:rgba(148,163,184,0.16);
        stroke-width:0.8;
      }

      .svg-axis line{
        stroke:rgba(191,219,254,0.7);
        stroke-width:1.2;
      }

      .svg-axis-label{
        fill:#9ca3af;
        font-size:9px;
      }
    </style>
    <?php
}
?>

<div id="<?php echo htmlspecialchars($containerId, ENT_QUOTES); ?>"
     class="svg-pie-chart-container">

  <svg id="<?php echo htmlspecialchars($svgId, ENT_QUOTES); ?>"
       viewBox="0 0 300 300"
       width="<?php echo $width; ?>"
       height="<?php echo $width; ?>"
       aria-label="Chart">
  </svg>

  <?php if ($showLegend): ?>
    <div id="<?php echo htmlspecialchars($legendId, ENT_QUOTES); ?>"
         class="svg-pie-legend"
         aria-label="Legend">
    </div>
  <?php endif; ?>

  <div id="<?php echo htmlspecialchars($tooltipId, ENT_QUOTES); ?>"
       class="svg-pie-tooltip"></div>
</div>

<script>
(function () {
  const svgId      = <?php echo json_encode($svgId); ?>;
  const legendId   = <?php echo json_encode($legendId); ?>;
  const tooltipId  = <?php echo json_encode($tooltipId); ?>;
  const showLegend = <?php echo $showLegend ? 'true' : 'false'; ?>;
  const chartType  = <?php echo json_encode($chartType); ?>;
  const dataUrl    = <?php echo json_encode($dataUrl); ?>; // URL JSON externo

  const svg     = document.getElementById(svgId);
  const legend  = showLegend ? document.getElementById(legendId) : null;
  const tooltip = document.getElementById(tooltipId);

  if (!svg || !tooltip || !dataUrl) return;

  const fallbackColors = [
    "#1d4ed8","#0ea5e9","#6366f1","#22c55e",
    "#eab308","#f97316","#f43f5e","#a855f7",
    "#06b6d4","#4b5563"
  ];

  let lastRawData = null;   // última versión recibida

  function clearChart() {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    if (legend) {
      while (legend.firstChild) legend.removeChild(legend.firstChild);
    }
  }

  function showTooltip(text, x, y) {
    tooltip.textContent = text;
    tooltip.style.left  = x + "px";
    tooltip.style.top   = y + "px";
    tooltip.style.display = "block";
  }

  function hideTooltip() {
    tooltip.style.display = "none";
  }

  function attachTooltip(el, label, value, percentage) {
    if (!el) return;
    el.addEventListener("mouseenter", function (evt) {
      const text = (label || "(no label)") +
        ": " + value.toFixed(1) + " (" + percentage.toFixed(1) + "%)";
      showTooltip(text, evt.clientX, evt.clientY - 10);
    });
    el.addEventListener("mousemove", function (evt) {
      tooltip.style.left = evt.clientX + "px";
      tooltip.style.top  = (evt.clientY - 10) + "px";
    });
    el.addEventListener("mouseleave", hideTooltip);
  }

  function polarToCartesian(cx, cy, r, angleRad) {
    return {
      x: cx + r * Math.cos(angleRad),
      y: cy + r * Math.sin(angleRad)
    };
  }

  function createSlicePath(cx, cy, r, startAngle, endAngle) {
    const start = polarToCartesian(cx, cy, r, startAngle);
    const end   = polarToCartesian(cx, cy, r, endAngle);
    const largeArcFlag = (endAngle - startAngle) > Math.PI ? 1 : 0;
    return [
      "M " + cx + " " + cy,
      "L " + start.x + " " + start.y,
      "A " + r + " " + r + " 0 " + largeArcFlag + " 1 " + end.x + " " + end.y,
      "Z"
    ].join(" ");
  }

  function buildLegend(items, total) {
    if (!legend) return;
    items.forEach(function (item) {
      const value = item.value;
      const label = item.label;
      const color = item.color;
      const pct   = total > 0 ? (value / total * 100) : 0;

      const legendItem = document.createElement("div");
      legendItem.className = "svg-pie-legend-item";

      const colorBox = document.createElement("div");
      colorBox.className = "svg-pie-legend-color";
      colorBox.style.background = color;

      const labelSpan = document.createElement("span");
      labelSpan.textContent =
        (label || "(no label)") +
        " — " + value.toFixed(1) +
        " (" + pct.toFixed(1) + "%)";

      legendItem.appendChild(colorBox);
      legendItem.appendChild(labelSpan);
      legend.appendChild(legendItem);
    });
  }

  function renderPieChart(items, total) {
    const cx = 150;
    const cy = 150;
    const r  = 110;

    let startAngle = -Math.PI / 2;

    items.forEach(function (item) {
      const value = item.value;
      if (value <= 0) return;

      const angle    = (value / total) * 2 * Math.PI;
      const endAngle = startAngle + angle;
      const d        = createSlicePath(cx, cy, r, startAngle, endAngle);

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", d);
      path.setAttribute("fill", item.color);
      path.classList.add("svg-pie-slice");

      const percentage = (value / total * 100);
      attachTooltip(path, item.label, value, percentage);

      svg.appendChild(path);
      startAngle = endAngle;
    });
  }

  function renderBarChart(items, total) {
    const chartTop    = 20;
    const chartBottom = 260;
    const chartLeft   = 40;
    const chartRight  = 280;
    const chartHeight = chartBottom - chartTop;
    const chartWidth  = chartRight - chartLeft;

    const maxValue = items.reduce(function (max, item) {
      return Math.max(max, item.value);
    }, 0);

    if (maxValue <= 0) return;

    // grid lines
    const grid = document.createElementNS("http://www.w3.org/2000/svg", "g");
    grid.setAttribute("class","svg-grid-lines");
    const steps = 4;
    for (let i = 0; i <= steps; i++) {
      const y = chartTop + (chartHeight / steps) * i;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", chartLeft);
      line.setAttribute("y1", y);
      line.setAttribute("x2", chartRight);
      line.setAttribute("y2", y);
      grid.appendChild(line);
    }
    svg.appendChild(grid);

    // axis
    const axis = document.createElementNS("http://www.w3.org/2000/svg", "g");
    axis.setAttribute("class","svg-axis");
    const xAxis = document.createElementNS("http://www.w3.org/2000/svg", "line");
    xAxis.setAttribute("x1", chartLeft);
    xAxis.setAttribute("y1", chartBottom);
    xAxis.setAttribute("x2", chartRight);
    xAxis.setAttribute("y2", chartBottom);
    axis.appendChild(xAxis);
    svg.appendChild(axis);

    const n = items.length;
    const slotWidth = chartWidth / Math.max(n,1);
    const barWidth  = slotWidth * 0.6;

    items.forEach(function (item, index) {
      const value = item.value;
      if (value <= 0) return;

      const barHeight = (value / maxValue) * chartHeight;
      const x = chartLeft + index * slotWidth + (slotWidth - barWidth) / 2;
      const y = chartBottom - barHeight;

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", x);
      rect.setAttribute("y", y);
      rect.setAttribute("width", barWidth);
      rect.setAttribute("height", barHeight);
      rect.setAttribute("rx", 4);
      rect.setAttribute("fill", item.color);
      rect.classList.add("svg-bar-rect");

      const percentage = (value / total * 100);
      attachTooltip(rect, item.label, value, percentage);

      svg.appendChild(rect);
    });
  }

  function renderLineChart(items, total) {
    const chartTop    = 25;
    const chartBottom = 260;
    const chartLeft   = 40;
    const chartRight  = 280;
    const chartHeight = chartBottom - chartTop;
    const chartWidth  = chartRight - chartLeft;

    const maxValue = items.reduce(function (max, item) {
      return Math.max(max, item.value);
    }, 0);

    if (maxValue <= 0) return;

    // grid
    const grid = document.createElementNS("http://www.w3.org/2000/svg", "g");
    grid.setAttribute("class","svg-grid-lines");
    const steps = 4;
    for (let i = 0; i <= steps; i++) {
      const y = chartTop + (chartHeight / steps) * i;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", chartLeft);
      line.setAttribute("y1", y);
      line.setAttribute("x2", chartRight);
      line.setAttribute("y2", y);
      grid.appendChild(line);
    }
    svg.appendChild(grid);

    const n = items.length;
    const spacing = n > 1 ? chartWidth / (n - 1) : 0;

    let points = "";
    const lineColor = items[0] ? items[0].color : "#38bdf8";

    items.forEach(function (item, idx) {
      const value = item.value;
      const x = chartLeft + spacing * idx;
      const y = chartTop + (1 - (value / maxValue)) * chartHeight;

      points += x + "," + y + " ";

      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      circle.setAttribute("cx", x);
      circle.setAttribute("cy", y);
      circle.setAttribute("r", 4);
      circle.setAttribute("fill", item.color);
      circle.classList.add("svg-line-point");

      const percentage = (value / total * 100);
      attachTooltip(circle, item.label, value, percentage);

      svg.appendChild(circle);
    });

    const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline.setAttribute("points", points.trim());
    polyline.setAttribute("fill", "none");
    polyline.setAttribute("stroke", lineColor);
    polyline.setAttribute("stroke-width", 2);
    polyline.setAttribute("stroke-linejoin","round");
    polyline.setAttribute("stroke-linecap","round");
    svg.insertBefore(polyline, svg.firstChild);
  }

  function normalizeData(raw) {
    return raw.map(function (item, index) {
      const value = Number(item.value) || 0;
      const color = item.color || fallbackColors[index % fallbackColors.length];
      const label = item.label || "";
      return { label: label, value: value, color: color };
    });
  }

  function renderChart(raw) {
    clearChart();
    hideTooltip();

    const items = normalizeData(raw);
    const total = items.reduce(function (sum, item) {
      return sum + item.value;
    }, 0);

    if (total === 0) {
      if (legend) {
        const msg = document.createElement("div");
        msg.textContent = "Total value is 0. Please provide positive numeric values.";
        legend.appendChild(msg);
      }
      return;
    }

    if (chartType === "bar") {
      renderBarChart(items, total);
    } else if (chartType === "line") {
      renderLineChart(items, total);
    } else {
      renderPieChart(items, total);
    }

    buildLegend(items, total);
  }

  // Animación entre dos conjuntos de datos
  function animateTransition(fromRaw, toRaw, durationMs) {
    const from = normalizeData(fromRaw);
    const to   = normalizeData(toRaw);

    const maxLen = Math.max(from.length, to.length);
    const fromP = [];
    const toP   = [];

    for (let i = 0; i < maxLen; i++) {
      const f = from[i] || {
        label: to[i] ? to[i].label : "",
        value: 0,
        color: to[i] ? to[i].color : fallbackColors[i % fallbackColors.length]
      };
      const t = to[i] || {
        label: from[i] ? from[i].label : "",
        value: 0,
        color: from[i] ? from[i].color : fallbackColors[i % fallbackColors.length]
      };
      fromP.push(f);
      toP.push(t);
    }

    const start = performance.now();

    function frame(now) {
      const elapsed = now - start;
      const tNorm = Math.min(1, elapsed / durationMs);

      const current = fromP.map(function (f, i) {
        const tv = toP[i].value;
        const v = f.value + (tv - f.value) * tNorm;
        return {
          label: toP[i].label,
          value: v,
          color: toP[i].color
        };
      });

      renderChart(current);

      if (tNorm < 1) {
        requestAnimationFrame(frame);
      }
    }

    requestAnimationFrame(frame);
  }

  async function loadAndRender() {
    try {
      const response = await fetch(dataUrl + "?t=" + Date.now(), { cache: "no-store" });
      if (!response.ok) {
        console.error("Error fetching", dataUrl, response.status);
        return;
      }
      const raw = await response.json();
      if (!Array.isArray(raw)) {
        console.error("Data is not an array for", dataUrl);
        return;
      }

      if (!lastRawData) {
        // Primera carga sin animación
        lastRawData = raw;
        renderChart(raw);
      } else {
        // Animación en actualizaciones
        animateTransition(lastRawData, raw, 500); // 500 ms
        lastRawData = raw;
      }
    } catch (e) {
      console.error("Exception fetching", dataUrl, e);
    }
  }

  // Primera carga
  loadAndRender();

  // Polling cada 10 segundos
  setInterval(loadAndRender, <?php echo rand(500,2000)?>);
})();
</script>
```

<a id="herramientas-graficas-integradas-en-el-ide-y-externas-al-mismo"></a>
## Herramientas gráficas integradas en el IDE y externas al mismo

En el desarrollo de interfaces gráficas, la creación de informes es una tarea fundamental que permite visualizar datos de manera organizada y accesible. Las herramientas gráficas integradas en los IDE (Entornos de Desarrollo Integrados) ofrecen un medio eficiente para generar informes incrustados dentro de las aplicaciones, facilitando la interacción del usuario con los datos.

Estas herramientas proporcionan una serie de características que hacen que la creación y visualización de informes sean más sencillas. Ofrecen interfaces gráficas intuitivas donde se pueden diseñar tablas, gráficos y otros elementos visuales que presentan los datos en un formato atractivo y fácilmente interpretable. Además, permiten aplicar filtros y ordenamientos para mostrar solo la información relevante al usuario.

Además de las herramientas integradas en el IDE, existen una variedad de herramientas gráficas externas que pueden ser utilizadas para crear informes independientes de la aplicación principal. Estas herramientas ofrecen funcionalidades avanzadas y personalizables, permitiendo a los desarrolladores crear informes complejos con gran detalle y personalización.

La integración entre las herramientas gráficas internas del IDE y las externas ofrece una flexibilidad que permite adaptar el diseño de los informes al contexto específico de la aplicación. Por ejemplo, mientras las herramientas internas pueden ser suficientes para informes simples o interactivos dentro de la interfaz principal, las herramientas externas pueden ser necesarias cuando se requiere un formato más sofisticado o una presentación más elaborada.

La creación de informes a través de estas herramientas gráficas también facilita el mantenimiento y actualización del contenido. Al utilizar interfaces gráficas, los desarrolladores pueden modificar fácilmente la estructura y diseño de los informes sin necesidad de escribir código adicional, lo que reduce errores y aumenta la eficiencia.

En resumen, las herramientas gráficas integradas en el IDE y externas al mismo proporcionan un conjunto completo de opciones para crear informes de manera efectiva. Desde informes simples hasta complejos, estas herramientas ofrecen una interfaz visual intuitiva que facilita la creación y presentación de datos de manera atractiva y accesible. La flexibilidad de utilizar tanto herramientas internas como externas permite adaptar el diseño de los informes al contexto específico de la aplicación, lo que es crucial para proporcionar información útil y relevante a los usuarios finales.

### api

```
<?php
// api.php
$username = 'jocarsa'; // Change this
$password = 'jocarsa'; // Change this

// Check for valid credentials
if (!isset($_SERVER['PHP_AUTH_USER']) ||
    !isset($_SERVER['PHP_AUTH_PW']) ||
    $_SERVER['PHP_AUTH_USER'] != $username ||
    $_SERVER['PHP_AUTH_PW'] != $password) {
    header('WWW-Authenticate: Basic realm="Restricted Area"');
    header('HTTP/1.0 401 Unauthorized');
    die('Authentication required.');
}

// Get the endpoint from the query string
$endpoint = isset($_GET['endpoint']) ? $_GET['endpoint'] : '';

// Base directory for CSV files
$csvDir = 'monitor_data';

// Function to read CSV and return as JSON
function readCsvAsJson($csvFile) {
    if (!file_exists($csvFile)) {
        return ['error' => 'No data available.'];
    }
    $data = [];
    $file = fopen($csvFile, 'r');
    $header = fgetcsv($file);
    while ($row = fgetcsv($file)) {
        $data[] = array_combine($header, $row);
    }
    fclose($file);
    return $data;
}

// Serve data based on endpoint
header('Content-Type: application/json');
switch ($endpoint) {
    case 'cpu':
        echo json_encode(readCsvAsJson("$csvDir/cpu_usage.csv"));
        break;
    case 'ram':
        echo json_encode(readCsvAsJson("$csvDir/ram_usage.csv"));
        break;
    case 'disk_usage':
        echo json_encode(readCsvAsJson("$csvDir/disk_usage.csv"));
        break;
    case 'disk_io':
        $disk = isset($_GET['disk']) ? $_GET['disk'] : 'sda';
        echo json_encode(readCsvAsJson("$csvDir/disk_io_$disk.csv"));
        break;
    case 'bandwidth':
        $iface = isset($_GET['iface']) ? $_GET['iface'] : 'eth0';
        echo json_encode(readCsvAsJson("$csvDir/bandwidth_$iface.csv"));
        break;
    case 'apache_request_rate':
        echo json_encode(readCsvAsJson("$csvDir/apache_request_rate.csv"));
        break;
    default:
        echo json_encode(['error' => 'Invalid endpoint. Use: cpu, ram, disk_usage, disk_io, bandwidth, apache_request_rate']);
}
?>
```

### grafica3

```
<?php
/**
 * grafica3.php
 *
 * Expects:
 *   $pieOptions = [
 *       'id'         => 'chart_1',
 *       'width'      => 220,
 *       'showLegend' => true,
 *       'type'       => 'pie' | 'bar' | 'line',
 *       'dataUrl'    => 'https://static.jocarsa.com/servidor/api.php?endpoint=cpu',
 *       'auth'       => 'base64_encoded_username:password'
 *   ];
 */

// 1. Options
$pieOptions = isset($pieOptions) && is_array($pieOptions) ? $pieOptions : [];
$baseId     = $pieOptions['id'] ?? uniqid('chart_');
$width      = isset($pieOptions['width']) ? (int)$pieOptions['width'] : 220;
$showLegend = array_key_exists('showLegend', $pieOptions) ? (bool)$pieOptions['showLegend'] : true;
$chartType  = isset($pieOptions['type']) ? (string)$pieOptions['type'] : 'pie';
$dataUrl    = isset($pieOptions['dataUrl']) ? (string)$pieOptions['dataUrl'] : null;
$auth       = isset($pieOptions['auth']) ? (string)$pieOptions['auth'] : null;
$svgId      = $baseId . '_svg';
$legendId   = $baseId . '_legend';
$tooltipId  = $baseId . '_tooltip';
$containerId = $baseId . '_container';

// 2. CSS (only once)
if (!defined('SVG_CHARTS_CSS_PRINTED')) {
    define('SVG_CHARTS_CSS_PRINTED', true);
    echo '<style>
      .svg-pie-chart-container { display:inline-flex; flex-direction:row; align-items:center; justify-content:center; width:100%; height:100%; padding:8px 10px; gap:10px; }
      .svg-pie-chart-container svg { flex:0 0 auto; height:100%; filter: drop-shadow(0 0 12px rgba(59, 130, 246, 0.35)) brightness(3); }
      .svg-pie-slice, .svg-bar-rect, .svg-line-point { cursor:pointer; transition:transform 0.2s ease, opacity 0.2s ease, filter 0.2s ease; transform-box:fill-box; transform-origin:50% 50%; }
      .svg-pie-slice:hover, .svg-bar-rect:hover, .svg-line-point:hover { transform:scale(1.05); opacity:0.9; filter:brightness(1.2); }
      .svg-pie-legend { flex:1 1 auto; font-size:0.7rem; color:#cbd5f5; max-height:100%; overflow:hidden; }
      .svg-pie-legend-item { display:flex; align-items:center; margin-bottom:0.18rem; gap:0.45rem; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; }
      .svg-pie-legend-color { width:12px; height:12px; border-radius:3px; border:1px solid rgba(148,163,184,0.8); box-shadow:0 0 8px rgba(59,130,246,0.65); }
      .svg-pie-legend-item span { opacity:0.9; }
      .svg-pie-tooltip { position:fixed; pointer-events:none; padding:0.3rem 0.5rem; background:radial-gradient(circle at 0 0,#22d3ee 0,#1e293b 45%); color:#e5e7eb; border-radius:6px; font-size:0.75rem; transform:translate(-50%, -120%); white-space:nowrap; display:none; z-index:9999; border:1px solid rgba(96,165,250,0.6); box-shadow:0 0 18px rgba(59,130,246,0.7), 0 10px 25px rgba(15,23,42,0.9); }
      .svg-grid-lines line { stroke:rgba(148,163,184,0.16); stroke-width:0.8; }
      .svg-axis line { stroke:rgba(191,219,254,0.7); stroke-width:1.2; }
      .svg-axis-label { fill:#9ca3af; font-size:9px; }
    </style>';
}
?>

<div id="<?php echo htmlspecialchars($containerId, ENT_QUOTES); ?>"
     class="svg-pie-chart-container">
  <svg id="<?php echo htmlspecialchars($svgId, ENT_QUOTES); ?>"
       viewBox="0 0 300 300"
       width="<?php echo $width; ?>"
       height="<?php echo $width; ?>"
       aria-label="Chart">
  </svg>
  <?php if ($showLegend): ?>
    <div id="<?php echo htmlspecialchars($legendId, ENT_QUOTES); ?>"
         class="svg-pie-legend"
         aria-label="Legend">
    </div>
  <?php endif; ?>
  <div id="<?php echo htmlspecialchars($tooltipId, ENT_QUOTES); ?>"
       class="svg-pie-tooltip"></div>
</div>

<script>
(function () {
  const svgId      = <?php echo json_encode($svgId); ?>;
  const legendId   = <?php echo json_encode($legendId); ?>;
  const tooltipId  = <?php echo json_encode($tooltipId); ?>;
  const showLegend = <?php echo $showLegend ? 'true' : 'false'; ?>;
  const chartType  = <?php echo json_encode($chartType); ?>;
  const dataUrl    = <?php echo json_encode($dataUrl); ?>;
  const auth       = <?php echo json_encode($auth); ?>;
  const svg     = document.getElementById(svgId);
  const legend  = showLegend ? document.getElementById(legendId) : null;
  const tooltip = document.getElementById(tooltipId);

  if (!svg || !tooltip || !dataUrl) return;

  const fallbackColors = [
    "#1d4ed8","#0ea5e9","#6366f1","#22c55e",
    "#eab308","#f97316","#f43f5e","#a855f7",
    "#06b6d4","#4b5563"
  ];

  let lastRawData = null;

  function clearChart() {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    if (legend) {
      while (legend.firstChild) legend.removeChild(legend.firstChild);
    }
  }

  function showTooltip(text, x, y) {
    tooltip.textContent = text;
    tooltip.style.left  = x + "px";
    tooltip.style.top   = y + "px";
    tooltip.style.display = "block";
  }

  function hideTooltip() {
    tooltip.style.display = "none";
  }

  function attachTooltip(el, label, value, percentage) {
    if (!el) return;
    el.addEventListener("mouseenter", function (evt) {
      const text = (label || "(no label)") +
        ": " + value.toFixed(1) + " (" + percentage.toFixed(1) + "%)";
      showTooltip(text, evt.clientX, evt.clientY - 10);
    });
    el.addEventListener("mousemove", function (evt) {
      tooltip.style.left = evt.clientX + "px";
      tooltip.style.top  = (evt.clientY - 10) + "px";
    });
    el.addEventListener("mouseleave", hideTooltip);
  }

  function polarToCartesian(cx, cy, r, angleRad) {
    return {
      x: cx + r * Math.cos(angleRad),
      y: cy + r * Math.sin(angleRad)
    };
  }

  function createSlicePath(cx, cy, r, startAngle, endAngle) {
    const start = polarToCartesian(cx, cy, r, startAngle);
    const end   = polarToCartesian(cx, cy, r, endAngle);
    const largeArcFlag = (endAngle - startAngle) > Math.PI ? 1 : 0;
    return [
      "M " + cx + " " + cy,
      "L " + start.x + " " + start.y,
      "A " + r + " " + r + " 0 " + largeArcFlag + " 1 " + end.x + " " + end.y,
      "Z"
    ].join(" ");
  }

  function buildLegend(items, total) {
    if (!legend) return;
    items.forEach(function (item) {
      const value = item.value;
      const label = item.label;
      const color = item.color;
      const pct   = total > 0 ? (value / total * 100) : 0;
      const legendItem = document.createElement("div");
      legendItem.className = "svg-pie-legend-item";
      const colorBox = document.createElement("div");
      colorBox.className = "svg-pie-legend-color";
      colorBox.style.background = color;
      const labelSpan = document.createElement("span");
      labelSpan.textContent =
        (label || "(no label)") +
        " — " + value.toFixed(1) +
        " (" + pct.toFixed(1) + "%)";
      legendItem.appendChild(colorBox);
      legendItem.appendChild(labelSpan);
      legend.appendChild(legendItem);
    });
  }

  function renderPieChart(items, total) {
    const cx = 150;
    const cy = 150;
    const r  = 110;
    let startAngle = -Math.PI / 2;
    items.forEach(function (item) {
      const value = item.value;
      if (value <= 0) return;
      const angle    = (value / total) * 2 * Math.PI;
      const endAngle = startAngle + angle;
      const d        = createSlicePath(cx, cy, r, startAngle, endAngle);
      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", d);
      path.setAttribute("fill", item.color);
      path.classList.add("svg-pie-slice");
      const percentage = (value / total * 100);
      attachTooltip(path, item.label, value, percentage);
      svg.appendChild(path);
      startAngle = endAngle;
    });
  }

  function renderBarChart(items, total) {
    const chartTop    = 20;
    const chartBottom = 260;
    const chartLeft   = 40;
    const chartRight  = 280;
    const chartHeight = chartBottom - chartTop;
    const chartWidth  = chartRight - chartLeft;
    const maxValue = items.reduce(function (max, item) {
      return Math.max(max, item.value);
    }, 0);
    if (maxValue <= 0) return;
    // grid lines
    const grid = document.createElementNS("http://www.w3.org/2000/svg", "g");
    grid.setAttribute("class","svg-grid-lines");
    const steps = 4;
    for (let i = 0; i <= steps; i++) {
      const y = chartTop + (chartHeight / steps) * i;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", chartLeft);
      line.setAttribute("y1", y);
      line.setAttribute("x2", chartRight);
      line.setAttribute("y2", y);
      grid.appendChild(line);
    }
    svg.appendChild(grid);
    // axis
    const axis = document.createElementNS("http://www.w3.org/2000/svg", "g");
    axis.setAttribute("class","svg-axis");
    const xAxis = document.createElementNS("http://www.w3.org/2000/svg", "line");
    xAxis.setAttribute("x1", chartLeft);
    xAxis.setAttribute("y1", chartBottom);
    xAxis.setAttribute("x2", chartRight);
    xAxis.setAttribute("y2", chartBottom);
    axis.appendChild(xAxis);
    svg.appendChild(axis);
    const n = items.length;
    const slotWidth = chartWidth / Math.max(n,1);
    const barWidth  = slotWidth * 0.6;
    items.forEach(function (item, index) {
      const value = item.value;
      if (value <= 0) return;
      const barHeight = (value / maxValue) * chartHeight;
      const x = chartLeft + index * slotWidth + (slotWidth - barWidth) / 2;
      const y = chartBottom - barHeight;
      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", x);
      rect.setAttribute("y", y);
      rect.setAttribute("width", barWidth);
      rect.setAttribute("height", barHeight);
      rect.setAttribute("rx", 4);
      rect.setAttribute("fill", item.color);
      rect.classList.add("svg-bar-rect");
      const percentage = (value / total * 100);
      attachTooltip(rect, item.label, value, percentage);
      svg.appendChild(rect);
    });
  }

  function renderLineChart(items, total) {
    const chartTop    = 25;
    const chartBottom = 260;
    const chartLeft   = 40;
    const chartRight  = 280;
    const chartHeight = chartBottom - chartTop;
    const chartWidth  = chartRight - chartLeft;
    const maxValue = items.reduce(function (max, item) {
      return Math.max(max, item.value);
    }, 0);
    if (maxValue <= 0) return;
    // grid
    const grid = document.createElementNS("http://www.w3.org/2000/svg", "g");
    grid.setAttribute("class","svg-grid-lines");
    const steps = 4;
    for (let i = 0; i <= steps; i++) {
      const y = chartTop + (chartHeight / steps) * i;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", chartLeft);
      line.setAttribute("y1", y);
      line.setAttribute("x2", chartRight);
      line.setAttribute("y2", y);
      grid.appendChild(line);
    }
    svg.appendChild(grid);
    const n = items.length;
    const spacing = n > 1 ? chartWidth / (n - 1) : 0;
    let points = "";
    const lineColor = items[0] ? items[0].color : "#38bdf8";
    items.forEach(function (item, idx) {
      const value = item.value;
      const x = chartLeft + spacing * idx;
      const y = chartTop + (1 - (value / maxValue)) * chartHeight;
      points += x + "," + y + " ";
      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      circle.setAttribute("cx", x);
      circle.setAttribute("cy", y);
      circle.setAttribute("r", 4);
      circle.setAttribute("fill", item.color);
      circle.classList.add("svg-line-point");
      const percentage = (value / total * 100);
      attachTooltip(circle, item.label, value, percentage);
      svg.appendChild(circle);
    });
    const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline.setAttribute("points", points.trim());
    polyline.setAttribute("fill", "none");
    polyline.setAttribute("stroke", lineColor);
    polyline.setAttribute("stroke-width", 2);
    polyline.setAttribute("stroke-linejoin","round");
    polyline.setAttribute("stroke-linecap","round");
    svg.insertBefore(polyline, svg.firstChild);
  }

  function normalizeData(raw) {
    return raw.map(function (item, index) {
      const value = Number(item.value) || 0;
      const color = item.color || fallbackColors[index % fallbackColors.length];
      const label = item.label || "";
      return { label: label, value: value, color: color };
    });
  }

  function renderChart(raw) {
    clearChart();
    hideTooltip();
    const items = normalizeData(raw);
    const total = items.reduce(function (sum, item) {
      return sum + item.value;
    }, 0);
    if (total === 0) {
      if (legend) {
        const msg = document.createElement("div");
        msg.textContent = "Total value is 0. Please provide positive numeric values.";
        legend.appendChild(msg);
      }
      return;
    }
    if (chartType === "bar") {
      renderBarChart(items, total);
    } else if (chartType === "line") {
      renderLineChart(items, total);
    } else {
      renderPieChart(items, total);
    }
    buildLegend(items, total);
  }

  function animateTransition(fromRaw, toRaw, durationMs) {
    const from = normalizeData(fromRaw);
    const to   = normalizeData(toRaw);
    const maxLen = Math.max(from.length, to.length);
    const fromP = [];
    const toP   = [];
    for (let i = 0; i < maxLen; i++) {
      const f = from[i] || {
        label: to[i] ? to[i].label : "",
        value: 0,
        color: to[i] ? to[i].color : fallbackColors[i % fallbackColors.length]
      };
      const t = to[i] || {
        label: from[i] ? from[i].label : "",
        value: 0,
        color: from[i] ? from[i].color : fallbackColors[i % fallbackColors.length]
      };
      fromP.push(f);
      toP.push(t);
    }
    const start = performance.now();
    function frame(now) {
      const elapsed = now - start;
      const tNorm = Math.min(1, elapsed / durationMs);
      const current = fromP.map(function (f, i) {
        const tv = toP[i].value;
        const v = f.value + (tv - f.value) * tNorm;
        return {
          label: toP[i].label,
          value: v,
          color: toP[i].color
        };
      });
      renderChart(current);
      if (tNorm < 1) {
        requestAnimationFrame(frame);
      }
    }
    requestAnimationFrame(frame);
  }

  async function loadAndRender() {
    try {
      const headers = {};
      if (auth) {
        headers["Authorization"] = "Basic " + auth;
      }

      const response = await fetch(dataUrl, {
        headers: headers,
        cache: "no-store"
      });
      if (!response.ok) {
        console.error("Error fetching", dataUrl, response.status);
        return;
      }

      const raw = await response.json();

      // ✅ Caso correcto: el API devuelve un array de filas (CSV parseado)
      if (Array.isArray(raw)) {
        const formattedData = raw.map(function (item, index) {
          const keys = Object.keys(item || {});
          const valueKey = keys.find(function (k) { return k !== "date"; });
          const value = valueKey ? Number(item[valueKey]) : 0;

          let label = "";
          if (item.date) {
            const d = new Date(item.date);
            if (!Number.isNaN(d.getTime())) {
              label = d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
            } else {
              label = String(item.date);
            }
          }
          if (!label) {
            label = "Item " + (index + 1);
          }

          return {
            label: label,
            value: value,
            color: fallbackColors[index % fallbackColors.length]
          };
        });

        if (!lastRawData) {
          lastRawData = formattedData;
          renderChart(formattedData);
        } else {
          animateTransition(lastRawData, formattedData, 500);
          lastRawData = formattedData;
        }

      // ✅ Caso de error estructurado: {"error": "..."}
      } else if (raw && typeof raw === "object" && raw.error) {
        console.error("API returned an error for", dataUrl, ":", raw.error);
        clearChart();
        if (legend) {
          const msg = document.createElement("div");
          msg.textContent = raw.error;
          legend.appendChild(msg);
        }

      // ❗ Cualquier otro formato inesperado
      } else {
        console.error("Data is not in expected format for", dataUrl, raw);
      }

    } catch (e) {
      console.error("Exception fetching", dataUrl, e);
    }
  }

  // First load
  loadAndRender();
  // Polling every 10 seconds
  setInterval(loadAndRender, 10000);
})();
</script>
```

### index

```
<!doctype html>
<html>
  <head>
    <style>
      :root{
        --bg-main:#020712;
        --card-bg:#050b1a;
        --card-border:#1c2c4f;
        --card-glow:#3b82f6;
        --grid-gap:10px;
      }
      *{
        box-sizing:border-box;
      }
      body{
        margin:0;
        min-height:100vh;
        display:grid;
        grid-template-columns:repeat(5,1fr);
        grid-auto-rows:220px;
        grid-auto-flow:dense;
        background:
          radial-gradient(circle at 10% 20%, #0b1220 0, transparent 40%),
          radial-gradient(circle at 80% 80%, #020617 0, transparent 45%),
          var(--bg-main);
        gap:var(--grid-gap);
        padding:var(--grid-gap);
        font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      }
      .tarjeta{
        position:relative;
        background:radial-gradient(circle at 0 0,#0b1b3a 0,#050b1a 55%);
        border-radius:10px;
        color:#e5e7eb;
        box-shadow:
          0 0 0 1px rgba(37,99,235,0.35),
          0 10px 30px rgba(15,23,42,0.9);
        display:flex;
        justify-content:center;
        align-items:center;
        overflow:hidden;
        isolation:isolate;
      }
      .tarjeta::before{
        content:"";
        position:absolute;
        inset:-40%;
        background:
          radial-gradient(circle at 0 0,rgba(56,189,248,0.15) 0,transparent 60%),
          radial-gradient(circle at 100% 100%,rgba(129,140,248,0.18) 0,transparent 60%);
        opacity:0.2;
        mix-blend-mode:screen;
        pointer-events:none;
      }
      .tarjeta::after{
        content:"";
        position:absolute;
        inset:0;
        background:
          repeating-linear-gradient(
            135deg,
            rgba(148,163,184,0.04) 0 2px,
            transparent 2px 4px
          );
        opacity:0.25;
        pointer-events:none;
      }
      .tarjeta-inner{
        position:relative;
        z-index:1;
        width:100%;
        height:100%;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .chart-label{
        position:absolute;
        top:6px;
        right:10px;
        font-size:10px;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:#9ca3af;
        background:rgba(15,23,42,0.8);
        border-radius:999px;
        padding:2px 8px;
        border:1px solid rgba(148,163,184,0.4);
        backdrop-filter:blur(4px);
        z-index:2;
      }
      @media(max-width:900px){
        body{
          grid-template-columns:repeat(2,1fr);
        }
      }
      @media(max-width:600px){
        body{
          grid-template-columns:1fr;
        }
      }
    </style>
  </head>
  <body>
    <?php
      // Define endpoints and chart types
      $endpoints = [
        ['endpoint' => 'cpu', 'type' => 'line', 'label' => 'CPU'],
        ['endpoint' => 'ram', 'type' => 'bar', 'label' => 'RAM'],
        ['endpoint' => 'disk_usage', 'type' => 'pie', 'label' => 'DISK'],
        ['endpoint' => 'disk_io', 'type' => 'line', 'label' => 'DISK I/O', 'disk' => 'sda'],
        ['endpoint' => 'bandwidth', 'type' => 'bar', 'label' => 'BANDWIDTH', 'iface' => 'eth0'],
        ['endpoint' => 'apache_request_rate', 'type' => 'line', 'label' => 'REQUEST RATE'],
      ];

      // API base URL
      $apiBaseUrl = 'api.php?endpoint=';

      // Authentication credentials
      $username = 'jocarsa';
      $password = 'jocarsa';

      foreach ($endpoints as $index => $endpoint) {
        $endpointUrl = $apiBaseUrl . $endpoint['endpoint'];
        if (isset($endpoint['disk'])) {
          $endpointUrl .= '&disk=' . $endpoint['disk'];
        }
        if (isset($endpoint['iface'])) {
          $endpointUrl .= '&iface=' . $endpoint['iface'];
        }

        $pieOptions = [
          'id'         => 'chart_' . $index,
          'width'      => 220,
          'showLegend' => true,
          'type'       => $endpoint['type'],
          'dataUrl'    => $endpointUrl,
          'auth'       => base64_encode("$username:$password"),
        ];

        echo '<div
          class="tarjeta"
          style="
            grid-column: span ' . rand(1, 2) . ';
            grid-row: span ' . rand(1, 2) . ';
          ">
          <div class="chart-label">' . $endpoint['label'] . '</div>
          <div class="tarjeta-inner">
        ';

        include "grafica3.php";

        echo '  </div>
        </div>';
      }
    ?>
  </body>
</html>
```

### server_monitor

```python
# server_monitor.py
import psutil
import csv
from datetime import datetime, timedelta
import re
import os
from pytz import timezone  # You may need to install pytz: pip install pytz

# --- Config ---
CSV_DIR = 'monitor_data'
os.makedirs(CSV_DIR, exist_ok=True)

# --- Helper Functions ---
def save_to_csv(filename, headers, data):
    """Saves data to CSV, creating headers if the file doesn't exist."""
    filepath = os.path.join(CSV_DIR, filename)
    file_exists = os.path.isfile(filepath)
    with open(filepath, 'a', newline='') as f:
        writer = csv.writer(f)
        if not file_exists:
            writer.writerow(headers)
        writer.writerow(data)

# --- CPU Monitoring ---
def monitor_cpu():
    cpu_usage = psutil.cpu_percent(interval=1)
    save_to_csv('cpu_usage.csv', ['date', 'cpu_usage'], [datetime.now().strftime('%Y-%m-%d %H:%M:%S'), cpu_usage])

# --- RAM Monitoring ---
def monitor_ram():
    ram = psutil.virtual_memory()
    save_to_csv('ram_usage.csv', ['date', 'ram_usage_percent', 'ram_total_gb'],
                [datetime.now().strftime('%Y-%m-%d %H:%M:%S'), ram.percent, round(ram.total / (1024 ** 3), 2)])

# --- Disk I/O Monitoring ---
def monitor_disk_io():
    disk_io_counters = psutil.disk_io_counters(perdisk=True)  # Fixed: Added this line
    for disk, io in disk_io_counters.items():
        save_to_csv(f'disk_io_{disk}.csv',
                    ['date', 'read_bytes', 'write_bytes', 'read_ops', 'write_ops', 'read_time_ms', 'write_time_ms', 'busy_time_ms'],
                    [datetime.now().strftime('%Y-%m-%d %H:%M:%S'), io.read_bytes, io.write_bytes, io.read_count, io.write_count, io.read_time, io.write_time, io.busy_time])

# --- Disk Usage Monitoring ---
def monitor_disk_usage():
    disk_usage = psutil.disk_usage('/')
    save_to_csv('disk_usage.csv',
                ['date', 'disk_usage_percent', 'disk_total_gb', 'disk_free_gb'],
                [datetime.now().strftime('%Y-%m-%d %H:%M:%S'), disk_usage.percent, round(disk_usage.total / (1024 ** 3), 2), round(disk_usage.free / (1024 ** 3), 2)])

# --- Bandwidth Monitoring ---
def monitor_bandwidth():
    net_io = psutil.net_io_counters(pernic=True)
    for iface, io in net_io.items():
        save_to_csv(f'bandwidth_{iface}.csv',
                    ['date', 'bytes_sent', 'bytes_recv', 'packets_sent', 'packets_recv'],
                    [datetime.now().strftime('%Y-%m-%d %H:%M:%S'), io.bytes_sent, io.bytes_recv, io.packets_sent, io.packets_recv])

# --- Apache2 Request Rate Monitoring ---
def monitor_apache_request_rate():
    ACCESS_LOG = '/var/log/apache2/access.log'
    request_counts = {}
    current_time = datetime.now(timezone('UTC'))  # Make current_time timezone-aware
    time_window = timedelta(minutes=1)

    with open(ACCESS_LOG, 'r') as f:
        for line in f:
            match = re.search(r'\[([^\]]+)\]', line)
            if match:
                timestamp_str = match.group(1)
                timestamp = datetime.strptime(timestamp_str, '%d/%b/%Y:%H:%M:%S %z')  # Already timezone-aware
                if (current_time - timestamp) <= time_window:
                    minute_key = timestamp.strftime('%Y-%m-%d %H:%M')
                    request_counts[minute_key] = request_counts.get(minute_key, 0) + 1

    for minute, count in request_counts.items():
        save_to_csv('apache_request_rate.csv', ['date', 'requests_per_minute'], [minute, count])

# --- Main ---
if __name__ == '__main__':
    monitor_cpu()
    monitor_ram()
    monitor_disk_io()
    monitor_disk_usage()
    monitor_bandwidth()
    monitor_apache_request_rate()
    print("Monitoring data saved.")
```

<a id="estructura-general-secciones"></a>
## Estructura general. Secciones

La creación de informes es un aspecto crucial del desarrollo de interfaces de usuario, ya que permite a los usuarios visualizar y analizar datos de manera efectiva. En esta subunidad, exploraremos la estructura general de los informes y las secciones comunes que suelen incluirse.

Un informe bien estructurado debe comenzar con una introducción que resuma el propósito del documento y establezca el contexto en el que se presentan los datos. Esta sección es fundamental para orientar al lector y proporcionar un punto de partida claro.

A continuación, se presenta la sección principal donde se detallan los datos relevantes. Este es el corazón del informe, donde se presentan gráficos, tablas y listados que ilustran las principales tendencias o hallazgos. Es importante utilizar herramientas gráficas adecuadas para hacer que la información sea accesible y fácil de entender.

La estructura general de los informes suele incluir una sección dedicada a la filtrado de datos, donde se pueden seleccionar subconjuntos más específicos del conjunto total de datos. Esta funcionalidad es crucial para permitir un análisis más detallado y personalizado.

Además, es común encontrar una sección que muestre el numeración de líneas, recuentos y totales, proporcionando información adicional sobre los datos presentados. Estas métricas pueden incluir conteos de registros, sumatorias o promedios, ofreciendo un resumen rápido del estado actual de la información.

La inclusión de gráficos en los informes es una práctica fundamental para visualizar relaciones y tendencias entre diferentes conjuntos de datos. Gráficos como barras, líneas, sectores o dispersión pueden ayudar a identificar patrones que podrían no ser evidentes en un formato tabular.

Las librerías para generación de informes ofrecen una amplia gama de clases y métodos que facilitan la creación de gráficos y tablas. Es importante conocer cómo utilizar estas herramientas para optimizar el rendimiento y la legibilidad del informe.

La conexión con las fuentes de datos es otro aspecto crucial en la generación de informes. Esto implica establecer conexiones a bases de datos o archivos de datos externos, ejecutar consultas para obtener los datos necesarios y presentarlos de manera coherente y organizada.

En conclusión, la creación de informes requiere una combinación de conocimientos técnicos en programación, diseño gráfico y análisis de datos. Una estructura bien definida y secciones claras son esenciales para crear informes que sean útiles, accesibles y informativos. Al seguir estos principios, los desarrolladores pueden crear herramientas de visualización de datos que faciliten la toma de decisiones y el análisis empresarial.

<a id="filtrado-de-datos"></a>
## Filtrado de datos

La creación de informes es una habilidad fundamental en la programación de interfaces de usuario, ya que permite a los usuarios visualizar y analizar datos de manera efectiva. En esta subunidad, exploraremos cómo implementar el filtrado de datos en informes para mejorar su utilidad y personalización.

El filtrado de datos es un proceso que permite seleccionar y mostrar solo una porción específica de los datos disponibles en un informe. Este proceso puede basarse en criterios específicos, como rangos numéricos, fechas o valores de texto. Al implementar el filtrado de datos, se facilita la búsqueda y análisis de información relevante, lo que mejora significativamente la experiencia del usuario.

Para implementar el filtrado de datos en informes, es necesario conocer las estructuras de datos utilizadas para almacenar los datos. En muchos casos, estos datos están organizados en tablas o listas, donde cada fila representa un registro y cada columna una propiedad específica del registro. Utilizando estas estructuras de datos, se pueden aplicar criterios de filtrado para seleccionar solo las filas que cumplen con ciertas condiciones.

La implementación del filtrado de datos puede realizarse mediante la creación de funciones o métodos específicos en el código del informe. Estos métodos recibirán los criterios de filtrado como parámetros y devolverán una lista de registros que cumplen con dichos criterios. Por ejemplo, si se desea filtrar un conjunto de datos por un rango de fechas, se podría crear una función que reciba dos fechas como parámetros y devuelva solo los registros cuyas fechas estén dentro de ese rango.

Además del filtrado basado en criterios estándar, también es posible implementar el filtrado por búsqueda. En este caso, se permite a los usuarios ingresar un término de búsqueda y el sistema devuelve todos los registros que contienen ese término en alguna de sus propiedades. Este tipo de filtrado es especialmente útil cuando se desea buscar información específica dentro de grandes conjuntos de datos.

Para mejorar la experiencia del usuario, es importante proporcionar una interfaz gráfica intuitiva para aplicar el filtrado de datos. Esto puede incluir campos de entrada para ingresar criterios de búsqueda, botones para seleccionar rangos numéricos o fechas, y opciones para seleccionar propiedades específicas a considerar en el filtrado. Al diseñar la interfaz de usuario, se debe tener en cuenta la accesibilidad y usabilidad, asegurando que los usuarios puedan aplicar fácilmente criterios de filtrado sin necesidad de conocimientos avanzados.

Una vez implementado el filtrado de datos, es importante probar su funcionalidad para garantizar que funciona correctamente. Esto puede incluir pruebas unitarias para verificar que la función de filtrado devuelve los resultados esperados, así como pruebas de integración para asegurarse de que se integra correctamente con otras partes del sistema. Además, es recomendable documentar el proceso de filtrado y proporcionar instrucciones claras a los usuarios sobre cómo utilizar esta funcionalidad.

En resumen, el filtrado de datos es una técnica poderosa que permite mejorar la utilidad y personalización de informes en interfaces de usuario. Al implementar este filtro correctamente, se facilita la búsqueda y análisis de información relevante, lo que mejora significativamente la experiencia del usuario. Con un enfoque en la accesibilidad y usabilidad, es posible crear sistemas de filtrado de datos intuitivos y eficientes que añadan valor a las aplicaciones informáticas.

<a id="numeracion-de-lineas-recuentos-y-totales"></a>
## Numeración de líneas, recuentos y totales

La creación de informes es una habilidad fundamental en la programación de interfaces de usuario, ya que permite a los desarrolladores presentar datos de manera clara y estructurada. En esta subunidad, nos centraremos en el aspecto crucial de numeración de líneas, recuentos y totales dentro de los informes.

La numeración de líneas es una práctica común para identificar fácilmente cada fila de un conjunto de datos. En la programación, esto se puede lograr mediante el uso de contadores que incrementan con cada iteración del bucle que genera las filas del informe. Es importante asegurarse de reiniciar el contador cuando se cambia a una nueva página o cuando se generan nuevos grupos de datos.

Los recuentos y totales son otro elemento esencial en la creación de informes, especialmente cuando se necesita mostrar estadísticas sobre los datos presentados. Los contadores pueden ser utilizados para sumar valores específicos de cada fila, mientras que los totales pueden calcularse al finalizar el bucle o mediante funciones de agregación disponibles en las bibliotecas de informes.

La implementación de estos elementos requiere una comprensión sólida del lenguaje de programación y la biblioteca específica utilizada para generar los informes. Por ejemplo, en Java, se pueden utilizar objetos `JTable` para mostrar datos tabulares y métodos como `getRowCount()` para obtener el número total de filas. En Python, con las bibliotecas como pandas o reportlab, se pueden crear fácilmente informes que incluyan numeración, recuentos y totales.

Es importante también considerar la presentación visual de estos elementos en los informes. La numeración de líneas puede ser mostrada en una columna adicional, mientras que los recuentos y totales pueden estar ubicados en el pie de página o en secciones específicas del informe. La consistencia en la presentación es crucial para mantener la claridad y facilidad de lectura del informe.

Además, la creación de informes con numeración, recuentos y totales puede requerir la implementación de funciones personalizadas si las bibliotecas utilizadas no proporcionan funcionalidades suficientes. En estos casos, es necesario entender los algoritmos básicos para sumar valores y manejar contadores, lo que fortalece las habilidades de programación.

En resumen, la numeración de líneas, recuentos y totales son elementos cruciales en la creación de informes eficaces. A través del uso de contadores y funciones de agregación disponibles en las bibliotecas específicas, se pueden presentar datos de manera clara y estructurada. La consistencia en la presentación visual es fundamental para mantener la facilidad de lectura del informe, mientras que la implementación de funciones personalizadas puede ser necesaria en casos donde las bibliotecas utilizadas no proporcionan suficientes funcionalidades.

<a id="graficos"></a>
## Gráficos

En este capítulo, nos adentramos en la creación de gráficos dentro de aplicaciones informáticas. Los gráficos son una herramienta poderosa para visualizar datos complejos y facilitar su comprensión. En primer lugar, es importante entender que existen diferentes tipos de gráficos, cada uno con sus propias ventajas y aplicaciones específicas. Algunos ejemplos incluyen los gráficos de barras, líneas, pastel, dispersión y radar.

Para crear gráficos en nuestras aplicaciones, utilizamos herramientas gráficas integradas que ofrecen una variedad de clases y métodos para definir la apariencia y el comportamiento del gráfico. Estas herramientas suelen proporcionar funcionalidades como la adición de títulos, etiquetas de ejes, leyendas y opciones de personalización avanzada.

La creación de un gráfico comienza con la selección del tipo de gráfico adecuado para los datos que se quieren representar. Luego, se instancian las clases correspondientes y se configuran sus propiedades, como el rango de valores en los ejes, los colores de las barras o líneas, y cualquier otro detalle visual que desee personalizar.

Es crucial también considerar la interactividad del gráfico. Muchos sistemas modernos permiten agregar eventos a los gráficos para que respondan a acciones del usuario, como hacer clic en una barra para obtener más detalles. Esto no solo hace que el gráfico sea más dinámico y atractivo, sino que también facilita la exploración de datos.

Además de la creación y configuración de gráficos individuales, es común utilizar bibliotecas gráficas que permitan crear gráficos compuestos o múltiples en una sola interfaz. Estas bibliotecas suelen ofrecer funcionalidades avanzadas como la sincronización de los ejes entre diferentes gráficos, la superposición de datos y la creación de animaciones.

La generación de informes que incluyen gráficos es un proceso integral en muchas aplicaciones empresariales y científicas. Los gráficos no solo presentan los datos de manera visualmente atractiva, sino que también facilitan la toma de decisiones basada en la interpretación de tendencias y patrones.

Para finalizar esta sección, es importante recordar que la creación de gráficos es un proceso iterativo. A partir del diseño inicial hasta la implementación y la revisión, cada paso puede requerir ajustes para mejorar la claridad y el impacto visual del gráfico. La práctica constante y la experimentación con diferentes tipos de gráficos y configuraciones son clave para desarrollar una habilidad sólida en esta área.

En resumen, la creación de gráficos es un aspecto fundamental de la programación de interfaces de usuario modernas. A través del uso de herramientas gráficas integradas y bibliotecas avanzadas, podemos crear visualizaciones que no solo presentan datos de manera efectiva, sino que también facilitan la exploración y el análisis de información compleja.

<a id="librerias-para-generacion-de-informes-clases-metodos-y-atributos"></a>
## Librerías para generación de informes. Clases, métodos y atributos

En este capítulo, exploraremos las librerías utilizadas para la generación de informes en aplicaciones gráficas. Estas herramientas proporcionan una forma eficiente y flexible de crear documentos que presentan datos de manera clara y organizada. Una de las librerías más populares es **JasperReports**, conocida por su capacidad para generar informes complejos con gran detalle.

JasperReports permite definir los informes utilizando un lenguaje específico llamado JRXML, que es XML estandarizado. Este formato facilita la creación y edición de informes a través de interfaces gráficas o directamente en el código. Los informes pueden incluir texto, tablas, gráficos y otros elementos visuales, lo que los hace ideales para presentar datos de manera informativa.

Además de JRXML, JasperReports cuenta con una amplia gama de clases y métodos que permiten la manipulación y personalización de los informes. Por ejemplo, se pueden definir estilos globales para los elementos del informe, controlar el formato de las fechas y números, y aplicar filtros a los datos antes de su presentación.

Para interactuar con JasperReports desde un programa Java, se utilizan clases como `JasperReport`, `JasperFillManager` y `JasperExportManager`. La clase `JasperReport` representa el informe en sí, mientras que `JasperFillManager` se encarga de llenar este informe con los datos proporcionados. Finalmente, `JasperExportManager` permite exportar el informe a diferentes formatos como PDF, Excel o HTML.

Un aspecto importante de la generación de informes es la gestión de parámetros. JasperReports permite definir parámetros que pueden ser utilizados en el informe para personalizar su contenido dinámicamente. Estos parámetros pueden provenir de fuentes externas como bases de datos o variables del sistema.

Otro punto clave es la manipulación de conjuntos de datos. En JasperReports, los conjuntos de datos son colecciones de registros que se utilizan para alimentar el informe. Se pueden definir consultas SQL directamente en JRXML o utilizar clases Java personalizadas para cargar los datos.

La librería también ofrece funcionalidades avanzadas como la creación de subinformes, la generación de gráficos interactivos y la exportación a formatos más complejos. Además, JasperReports cuenta con una extensa documentación y comunidad activa que facilitan su aprendizaje y uso.

En resumen, las librerías para la generación de informes como JasperReports ofrecen un poderoso conjunto de herramientas para crear documentos informativos y presentables. Su capacidad para personalizar el contenido, interactuar con diferentes fuentes de datos y exportar a múltiples formatos los convierte en una opción valiosa para cualquier proyecto que requiera la creación de informes profesionales.

<a id="conexion-con-las-fuentes-de-datos-ejecucion-de-consultas"></a>
## Conexión con las fuentes de datos. Ejecución de consultas

En este capítulo, nos adentramos en la creación de informes dentro del entorno de desarrollo de interfaces gráficas, con un énfasis especial en cómo conectar nuestros informes a fuentes de datos y ejecutar consultas para obtener los datos necesarios. Comenzamos por entender las diferentes fuentes de datos que pueden utilizarse, desde bases de datos relacionales hasta sistemas nativos o incluso APIs externas.

La conexión a una fuente de datos es un paso crucial en el proceso de creación de informes, ya que nos permite acceder a los datos que queremos presentar. Para hacer esto, necesitamos conocer cómo establecer conexiones seguras y eficientes con nuestras fuentes de datos. Esto implica entender conceptos como autenticación, permisos y políticas de seguridad, así como aprender a utilizar las herramientas y bibliotecas adecuadas para cada tipo de fuente.

Una vez establecida la conexión, el siguiente paso es ejecutar consultas que nos permitan recuperar los datos deseados. Esto puede implicar escribir consultas SQL en el caso de bases de datos relacionales, o utilizar métodos específicos para interactuar con sistemas nativos o APIs. Es importante aprender a optimizar nuestras consultas para mejorar el rendimiento y la eficiencia del proceso.

Además de la conexión y la consulta de datos, también es crucial entender cómo presentar estos datos de manera efectiva en nuestros informes. Esto puede implicar utilizar gráficos, tablas y otros elementos visuales para hacer que los datos sean más accesibles y comprensibles para el usuario final. También debemos considerar aspectos como la paginación, la ordenación y el filtrado de datos para asegurar que nuestro informe sea útil y fácil de usar.

Durante este proceso, es importante mantener una buena práctica de documentación. Esto nos permite no solo recordar cómo se realizó cada paso, sino también facilitar el mantenimiento y la colaboración con otros miembros del equipo en el futuro. Además, la documentación puede ser útil para futuras versiones del informe o para compartir nuestro trabajo con otras personas.

En resumen, la creación de informes que se conectan a fuentes de datos y ejecutan consultas es un proceso integral dentro del desarrollo de interfaces gráficas. Requiere una comprensión sólida de las diferentes fuentes de datos disponibles, habilidades para establecer conexiones seguras y eficientes, conocimientos sobre cómo escribir y optimizar consultas, y la capacidad de presentar los datos de manera efectiva. Con práctica y dedicación, podemos desarrollar informes que no solo proporcionen información valiosa, sino que también sean útiles y accesibles para el usuario final.


<a id="documentacion-de-aplicaciones"></a>
# Documentación de aplicaciones

<a id="ficheros-de-ayuda-formatos"></a>
## Ficheros de ayuda. Formatos

En la carpeta `Segundo/Desarrollo de interfaces/006-Documentación de aplicaciones/001-Ficheros de ayuda. Formatos`, se aborda el tema crucial de cómo organizar y presentar información de manera accesible para los usuarios finales. Los ficheros de ayuda son una herramienta fundamental en la experiencia del usuario, proporcionando documentación detallada sobre las funcionalidades y operaciones disponibles dentro de una aplicación.

El formato más común para estos ficheros es el HTML (Hypertext Markup Language), que permite una presentación rica y estructurada. El uso de HTML facilita la creación de enlaces internos, imágenes, tablas y listas, lo que mejora significativamente la comprensión del contenido por parte del usuario.

Además de HTML, existen otros formatos populares para ficheros de ayuda, como el PDF (Portable Document Format). El PDF es conocido por su capacidad para mantener una apariencia constante en diferentes dispositivos y plataformas, lo que lo hace ideal para documentación técnica compleja. Sin embargo, su formato estático puede limitar la interactividad.

La documentación de aplicaciones también puede presentarse a través de formatos más modernos como Markdown o ReStructuredText. Estos formatos son fáciles de escribir y convertir en HTML o PDF, lo que permite una mayor flexibilidad en el proceso de creación y mantenimiento del contenido.

Un aspecto importante a considerar es la localización de los ficheros de ayuda. Para aplicaciones globales, es crucial ofrecer versiones traducidas al menos en inglés y el idioma local del usuario. Esto asegura que todos puedan entender completamente las instrucciones y funcionalidades disponibles.

La organización interna de los ficheros de ayuda también es fundamental para una fácil navegación. Utilizar un sistema de índice o tabla de contenidos puede orientar a los usuarios hacia la información específica que buscan, reduciendo así el tiempo necesario para encontrar lo que necesitan.

En conclusión, la documentación de aplicaciones es un componente esencial del desarrollo de interfaces, y su formato adecuado puede marcar la diferencia entre una experiencia de usuario satisfactoria y frustrante. Al elegir el formato correcto y seguir buenas prácticas de organización, se pueden crear ficheros de ayuda que no solo informen al usuario sobre cómo usar la aplicación, sino que también lo hagan de manera intuitiva y accesible.

<a id="herramientas-de-generacion-de-ayudas"></a>
## Herramientas de generación de ayudas

La documentación de aplicaciones es un aspecto crucial que complementa la funcionalidad del software, proporcionando a los usuarios una comprensión clara de cómo interactuar con el sistema. En esta subunidad, exploraremos las herramientas disponibles para generar ayudas en formatos variados, desde ficheros de texto hasta sistemas de ayuda basados en HTML y XML.

Las herramientas de generación de ayudas permiten a los desarrolladores crear documentaciones detalladas que incluyen instrucciones paso a paso, ejemplos prácticos y referencias técnicas. Estas herramientas suelen ofrecer una interfaz gráfica intuitiva que facilita la creación y edición de contenido, así como la exportación en diferentes formatos.

Una de las principales ventajas de usar herramientas de generación de ayudas es la capacidad de crear documentaciones personalizadas para diferentes tipos de usuarios. Por ejemplo, se pueden crear versiones simplificadas para usuarios no técnicos o versatiles para profesionales con conocimientos avanzados. Además, estas herramientas permiten una fácil actualización y mantenimiento del contenido, lo que asegura que la información proporcionada sea siempre precisa y relevante.

En el contexto de aplicaciones web, las herramientas de generación de ayudas pueden integrarse directamente en el código fuente, lo que facilita la sincronización entre el software y su documentación. Esto es especialmente útil para desarrolladores que trabajan en proyectos ágiles o donde los requisitos cambian con frecuencia.

Además de las herramientas gráficas, existen también bibliotecas y frameworks que permiten generar ayudas a partir de código fuente. Estos enfoques son útiles cuando se desea una documentación más profunda y detallada, ya que permite la inclusión de información dinámica y actualizada directamente desde el software.

La generación de ayudas también puede incluir la creación de tutoriales interactivos, lo que mejora significativamente la experiencia del usuario. Estos tutoriales pueden presentar los conceptos básicos paso a paso, ofreciendo ejemplos prácticos y permitiendo al usuario experimentar directamente con el software.

En resumen, las herramientas de generación de ayudas son una herramienta poderosa para mejorar la calidad y accesibilidad del software. Al proporcionar documentaciones detalladas y personalizadas, estas herramientas facilitan la comprensión y uso del sistema, lo que puede llevar a un aumento en la satisfacción del usuario y en la eficiencia operativa de la organización.

<a id="tablas-de-contenidos-indices-sistemas-de-busqueda-entre-otros"></a>
## Tablas de contenidos, índices, sistemas de búsqueda, entre otros

La documentación de aplicaciones es un aspecto crucial que no debe ser subestimado en el desarrollo de software. En esta sección, exploraremos los elementos fundamentales que componen una buena documentación: las tablas de contenidos, los índices y los sistemas de búsqueda.

Las tablas de contenidos son la estructura principal que guía a los usuarios a través del contenido de la documentación. Son esenciales para orientar a los lectores en el recorrido por la información proporcionada, facilitando así su acceso a cualquier sección específica del manual. Una tabla de contenidos bien organizada debe ser clara y fácil de navegar, permitiendo que los usuarios encuentren rápidamente lo que buscan.

Los índices complementan las tablas de contenidos al proporcionar una lista de términos clave con sus respectivas páginas o secciones en la documentación. Esto es especialmente útil para aquellos lectores que están buscando información específica sobre un tema determinado, ya que les permite localizar rápidamente el contenido relevante sin necesidad de recorrer todo el manual.

Los sistemas de búsqueda añaden una capa adicional de interactividad a la documentación. A través de estas herramientas, los usuarios pueden buscar términos o frases específicas dentro del documento, lo que puede ser especialmente útil en documentos grandes y complejos. Los sistemas de búsqueda deben estar bien optimizados para proporcionar resultados precisos y relevantes, facilitando así el acceso a la información deseada.

Además de estas herramientas fundamentales, es importante considerar otros elementos como los ejemplos prácticos, las ilustraciones y las capturas de pantalla. Estos recursos visuales pueden ser valiosos para complementar la documentación textual, proporcionando una comprensión más clara y detallada del contenido.

La documentación debe mantener un tono claro y conciso, evitando jerga técnica innecesaria o lenguaje complicado. Esto facilitará el acceso a la información para usuarios con diferentes niveles de conocimiento técnico, asegurando que todos puedan entender y utilizar los contenidos proporcionados.

En resumen, la documentación de aplicaciones es un componente esencial del desarrollo completo de software. Una buena documentación debe ser estructurada, accesible y fácil de usar, proporcionando a los usuarios una experiencia informativa y productiva. Al implementar las tablas de contenidos, índices y sistemas de búsqueda, se asegura que la información esté bien organizada y sea fácilmente localizable, lo que contribuye significativamente al éxito del proyecto.

<a id="tipos-de-manuales"></a>
## Tipos de manuales

En la documentación de aplicaciones, los manuales desempeñan un papel crucial para facilitar el uso y comprensión del software por parte de sus usuarios. Existen varios tipos de manuales que abordan diferentes aspectos del producto, cada uno con su enfoque específico y propósito.

El primer tipo de manual es el manual de usuario o manual del operador, también conocido como manual de instrucciones. Este documento se centra en explicar cómo utilizar los distintos componentes y funciones del software de manera efectiva. Proporciona pasos detallados para realizar tareas comunes, así como información sobre las características principales del producto.

Acompañando el manual de usuario, hay el manual técnico o manual de programador. Este tipo de documento es más orientado a los profesionales que desarrollan software o realizan mantenimiento en sistemas existentes. Ofrece una descripción detallada de la arquitectura interna del software, incluyendo detalles técnicos sobre su funcionamiento y las interfaces disponibles para el desarrollo de aplicaciones adicionales.

El manual de instalación es otro tipo importante que se encuentra dentro de esta categoría. Este documento guía paso a paso al usuario o al técnico en el proceso de configuración y despliegue del software en un entorno específico. Incluye instrucciones sobre la preparación del sistema, la instalación de dependencias necesarias y la configuración inicial.

Además, existen manuales de referencia que sirven como guía rápida para los usuarios frecuentes. Estos documentos contienen una lista concisa de comandos, funciones y procedimientos útiles, facilitando el acceso a información esencial sin tener que buscar en profundidad el manual completo.

El manual de soporte técnico complementa la documentación general proporcionando soluciones a problemas comunes y detalles técnicos adicionales. Este tipo de manuales suelen estar actualizados regularmente para reflejar las últimas versiones del software y los cambios realizados en su funcionalidad.

En el ámbito de la documentación digital, también se encuentran los tutoriales interactivos o videos explicativos. Estos recursos visuales ofrecen una alternativa atractiva y fácil de seguir para aprender cómo usar un software. A través de pasos visuales y narrados, los usuarios pueden experimentar directamente las funciones del producto sin necesidad de leer instrucciones extensas.

Los manuales de usuario también pueden incluir secciones dedicadas a la seguridad, explicando cómo proteger la información sensible dentro del sistema y qué medidas tomar en caso de incidentes. Esta documentación es crucial para mantener la confianza de los usuarios en el software y garantizar su uso seguro.

Finalmente, los manuales de usuario pueden contener una sección dedicada a las actualizaciones y mejoras futuras del software. Este tipo de información permite a los usuarios estar informados sobre nuevas funcionalidades y correcciones de errores, facilitando la planificación de actualizaciones y el mantenimiento del sistema.

En resumen, los manuales de aplicaciones son herramientas esenciales para asegurar que los usuarios puedan explotar al máximo las capacidades del software. Cada tipo de manual aborda aspectos específicos del producto, desde su uso diario hasta sus detalles técnicos y configuración inicial, proporcionando a los usuarios la información necesaria para utilizar el software de manera eficiente y segura.

<a id="elaboracion-de-tutoriales"></a>
## Elaboración de tutoriales

La documentación de aplicaciones es un aspecto crucial que complementa la funcionalidad técnica con una comunicación clara y accesible para los usuarios finales. En esta subunidad, nos centraremos específicamente en el proceso de elaboración de tutoriales, una herramienta poderosa para guiar a los usuarios a través de las características y funciones de una aplicación.

El primer paso en la creación de un tutorial es identificar su objetivo principal. ¿Es para nuevos usuarios que quieren entender cómo iniciar con la aplicación? ¿O para usuarios avanzados que necesitan aprender técnicas más complejas? El propósito definirá el tono, la profundidad y los contenidos del tutorial.

Una vez establecido el objetivo, se debe estructurar el contenido de manera lógica y coherente. Los tutoriales suelen seguir una secuencia clara: introducción, pasos detallados, ejemplos prácticos y conclusiones. Esta estructura facilita la comprensión y asegura que los usuarios puedan seguir cada paso sin dificultades.

El contenido del tutorial debe ser preciso y conciso. Evitar el uso de jerga técnica innecesaria o términos complicados que puedan confundir al usuario. En su lugar, optar por explicaciones simples y directas, acompañadas de ejemplos prácticos para ilustrar los conceptos.

La utilización de imágenes y diagramas es fundamental en la creación de tutoriales efectivos. Estos recursos visuales ayudan a complementar el texto y proporcionan una comprensión visual que puede ser más fácil de seguir que las instrucciones escritas solo. Es importante asegurarse de que los elementos gráficos sean claros, precisos y fáciles de entender.

Además de la explicación del contenido, es crucial incluir consejos prácticos y trucos útiles para mejorar la experiencia del usuario. Estos detalles adicionales pueden ser valiosos tanto para usuarios principiantes como avanzados, proporcionando una mayor valor a la aplicación.

La redacción del tutorial debe tener en cuenta el nivel de conocimiento previo del lector. Para evitar frustraciones, es importante introducir los conceptos de manera progresiva y asegurarse de que cada paso sea claro y lógico. Evitar saltos repentinos o cambios bruscos en la complejidad puede ayudar a mantener la atención del usuario.

Al finalizar el tutorial, es recomendable incluir un resumen de los puntos clave y sugerencias adicionales para mejorar la experiencia del usuario. Este cierre proporciona una visión general completa del contenido y ayuda a consolidar lo aprendido en el lector.

La documentación de aplicaciones, especialmente tutoriales, debe ser revisada y actualizada regularmente para mantener su relevancia y eficacia. Los cambios en la aplicación pueden requerir ajustes en los tutoriales, asegurando que siempre proporcionen información precisa y útil a los usuarios.

En resumen, el proceso de elaboración de tutoriales es una tarea integral en la documentación de aplicaciones. Al seguir un enfoque estructurado, preciso y accesible, se pueden crear recursos educativos valiosos que ayuden a mejorar la experiencia del usuario y aumentar su satisfacción con la aplicación.


<a id="distribucion-de-aplicaciones"></a>
# Distribución de aplicaciones

<a id="componentes-de-una-aplicacion-empaquetado"></a>
## Componentes de una aplicación. Empaquetado

En la distribución de aplicaciones, los componentes desempeñan un papel crucial ya que son las unidades básicas que conforman el funcionamiento global del software. Cada componente tiene una función específica y puede interactuar con otros para proporcionar servicios o realizar tareas. En este contexto, es fundamental entender cómo se organizan y empaquetan estos componentes para asegurar su correcta distribución y ejecución.

El primer paso en la distribución de aplicaciones es identificar los componentes necesarios. Cada componente debe tener una definición clara de sus responsabilidades y las interfaces que expone, lo que facilita su integración con otros elementos del sistema. Además, cada componente debe ser independiente tanto como sea posible para permitir cambios o actualizaciones sin afectar el resto del software.

El empaquetado es otro aspecto crucial en la distribución de aplicaciones. Este proceso implica preparar los componentes y sus dependencias en un formato que pueda ser fácilmente instalado y ejecutado en diferentes entornos. El empaquetado puede realizarse utilizando herramientas específicas para cada plataforma o lenguaje de programación, lo que asegura la compatibilidad y la seguridad del software.

La documentación es otro componente fundamental en la distribución de aplicaciones. Es esencial proporcionar instrucciones detalladas sobre cómo instalar, configurar y ejecutar el software. La documentación debe incluir información sobre las dependencias necesarias, los requisitos de hardware y software, y cualquier otra configuración específica que pueda requerirse.

La gestión de versiones también es un componente importante en la distribución de aplicaciones. Es fundamental mantener un historial de cambios y actualizaciones del software para poder revertir a una versión anterior si es necesario. Herramientas de control de versiones como Git facilitan este proceso, permitiendo el seguimiento de cambios y colaboración entre diferentes desarrolladores.

La seguridad es otro aspecto crucial en la distribución de aplicaciones. Es fundamental garantizar que los componentes del software sean seguros contra amenazas externas y internas. Esto implica realizar pruebas de seguridad y utilizar técnicas de encriptación y autenticación para proteger la información sensible.

La instalación es el último paso en la distribución de aplicaciones. Este proceso implica configurar los componentes del software en el entorno objetivo, lo que puede implicar la creación de archivos de configuración, la instalación de dependencias y la ejecución de scripts de instalación específicos para cada plataforma.

En resumen, la distribución de aplicaciones es un proceso complejo que implica la identificación, empaquetado, documentación, gestión de versiones, seguridad y instalación de los componentes del software. Cada uno de estos aspectos es crucial para garantizar el correcto funcionamiento y la seguridad del software en diferentes entornos.

### config

```json
{
  "expanded": [],
  "currentRoot": "/var/www/html"
}
```

### electron-main

```javascript
// electron-main.js
const { app, BrowserWindow, nativeImage } = require("electron");
const path = require("path");
const { startServer, PORT } = require("./server");

let mainWindow = null;
let serverInstance = null;

async function createWindow() {
  // Start Express server
  try {
    serverInstance = await startServer();
  } catch (err) {
    console.error("No se pudo arrancar el servidor Express:", err);
    app.quit();
    return;
  }

  // Build icon
  const iconPath = path.join(__dirname, "build", "icon.png");
  const appIcon = nativeImage.createFromPath(iconPath);

  if (appIcon.isEmpty()) {
    console.error("No se pudo cargar el icono:", iconPath);
  } else {
    console.log("Icono cargado correctamente:", iconPath);
  }

  // Create Electron window
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    icon: appIcon,
    webPreferences: {
      contextIsolation: true,
      nodeIntegration: false
    },
    title: "jocarsa | editor"
  });

  mainWindow.loadURL(`http://localhost:${PORT}`);

  mainWindow.on("closed", () => {
    mainWindow = null;
  });
}

app.whenReady().then(createWindow);

app.on("activate", () => {
  if (mainWindow === null) {
    createWindow();
  }
});

app.on("window-all-closed", () => {
  if (serverInstance && serverInstance.close) {
    serverInstance.close(() => {
      console.log("Servidor Express detenido.");
    });
  }
  app.quit();
});
```

### package-lock

```json
{
  "name": "jocarsa-editor-electron",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "jocarsa-editor-electron",
      "version": "1.0.0",
      "license": "MIT",
      "dependencies": {
        "express": "^5.1.0"
      },
      "devDependencies": {
        "electron": "^31.0.0",
        "electron-builder": "^24.13.3"
      }
    },
    "node_modules/@develar/schema-utils": {
      "version": "2.6.5",
      "resolved": "https://registry.npmjs.org/@develar/schema-utils/-/schema-utils-2.6.5.tgz",
      "integrity": "sha512-0cp4PsWQ/9avqTVMCtZ+GirikIA36ikvjtHweU4/j8yLtgObI0+JUPhYFScgwlteveGB1rt3Cm8UhN04XayDig==",
      "dev": true,
      "dependencies": {
        "ajv": "^6.12.0",
        "ajv-keywords": "^3.4.1"
      },
      "engines": {
        "node": ">= 8.9.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/webpack"
      }
    },
    "node_modules/@electron/asar": {
      "version": "3.4.1",
      "resolved": "https://registry.npmjs.org/@electron/asar/-/asar-3.4.1.tgz",
      "integrity": "sha512-i4/rNPRS84t0vSRa2HorerGRXWyF4vThfHesw0dmcWHp+cspK743UanA0suA5Q5y8kzY2y6YKrvbIUn69BCAiA==",
      "dev": true,
      "dependencies": {
        "commander": "^5.0.0",
        "glob": "^7.1.6",
        "minimatch": "^3.0.4"
      },
      "bin": {
        "asar": "bin/asar.js"
      },
      "engines": {
        "node": ">=10.12.0"
      }
    },
    "node_modules/@electron/asar/node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "dev": true,
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/@electron/asar/node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "dev": true,
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/@electron/get": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/@electron/get/-/get-2.0.3.tgz",
      "integrity": "sha512-Qkzpg2s9GnVV2I2BjRksUi43U5e6+zaQMcjoJy0C+C5oxaKl+fmckGDQFtRpZpZV0NQekuZZ+tGz7EA9TVnQtQ==",
      "dev": true,
      "dependencies": {
        "debug": "^4.1.1",
        "env-paths": "^2.2.0",
        "fs-extra": "^8.1.0",
        "got": "^11.8.5",
        "progress": "^2.0.3",
        "semver": "^6.2.0",
        "sumchecker": "^3.0.1"
      },
      "engines": {
        "node": ">=12"
      },
      "optionalDependencies": {
        "global-agent": "^3.0.0"
      }
    },
    "node_modules/@electron/notarize": {
      "version": "2.2.1",
      "resolved": "https://registry.npmjs.org/@electron/notarize/-/notarize-2.2.1.tgz",
      "integrity": "sha512-aL+bFMIkpR0cmmj5Zgy0LMKEpgy43/hw5zadEArgmAMWWlKc5buwFvFT9G/o/YJkvXAJm5q3iuTuLaiaXW39sg==",
      "dev": true,
      "dependencies": {
        "debug": "^4.1.1",
        "fs-extra": "^9.0.1",
        "promise-retry": "^2.0.1"
      },
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/@electron/notarize/node_modules/fs-extra": {
      "version": "9.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-9.1.0.tgz",
      "integrity": "sha512-hcg3ZmepS30/7BSFqRvoo3DOMQu7IjqxO5nCDt+zM9XWjb33Wg7ziNT+Qvqbuc3+gWpzO02JubVyk2G4Zvo1OQ==",
      "dev": true,
      "dependencies": {
        "at-least-node": "^1.0.0",
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/@electron/notarize/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/@electron/notarize/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/@electron/osx-sign": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/@electron/osx-sign/-/osx-sign-1.0.5.tgz",
      "integrity": "sha512-k9ZzUQtamSoweGQDV2jILiRIHUu7lYlJ3c6IEmjv1hC17rclE+eb9U+f6UFlOOETo0JzY1HNlXy4YOlCvl+Lww==",
      "dev": true,
      "dependencies": {
        "compare-version": "^0.1.2",
        "debug": "^4.3.4",
        "fs-extra": "^10.0.0",
        "isbinaryfile": "^4.0.8",
        "minimist": "^1.2.6",
        "plist": "^3.0.5"
      },
      "bin": {
        "electron-osx-flat": "bin/electron-osx-flat.js",
        "electron-osx-sign": "bin/electron-osx-sign.js"
      },
      "engines": {
        "node": ">=12.0.0"
      }
    },
    "node_modules/@electron/osx-sign/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@electron/osx-sign/node_modules/isbinaryfile": {
      "version": "4.0.10",
      "resolved": "https://registry.npmjs.org/isbinaryfile/-/isbinaryfile-4.0.10.tgz",
      "integrity": "sha512-iHrqe5shvBUcFbmZq9zOQHBoeOhZJu6RQGrDpBgenUm/Am+F3JM2MgQj+rK3Z601fzrL5gLZWtAPH2OBaSVcyw==",
      "dev": true,
      "engines": {
        "node": ">= 8.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/gjtorikian/"
      }
    },
    "node_modules/@electron/osx-sign/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/@electron/osx-sign/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/@electron/universal": {
      "version": "1.5.1",
      "resolved": "https://registry.npmjs.org/@electron/universal/-/universal-1.5.1.tgz",
      "integrity": "sha512-kbgXxyEauPJiQQUNG2VgUeyfQNFk6hBF11ISN2PNI6agUgPl55pv4eQmaqHzTAzchBvqZ2tQuRVaPStGf0mxGw==",
      "dev": true,
      "dependencies": {
        "@electron/asar": "^3.2.1",
        "@malept/cross-spawn-promise": "^1.1.0",
        "debug": "^4.3.1",
        "dir-compare": "^3.0.0",
        "fs-extra": "^9.0.1",
        "minimatch": "^3.0.4",
        "plist": "^3.0.4"
      },
      "engines": {
        "node": ">=8.6"
      }
    },
    "node_modules/@electron/universal/node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "dev": true,
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/@electron/universal/node_modules/fs-extra": {
      "version": "9.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-9.1.0.tgz",
      "integrity": "sha512-hcg3ZmepS30/7BSFqRvoo3DOMQu7IjqxO5nCDt+zM9XWjb33Wg7ziNT+Qvqbuc3+gWpzO02JubVyk2G4Zvo1OQ==",
      "dev": true,
      "dependencies": {
        "at-least-node": "^1.0.0",
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/@electron/universal/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/@electron/universal/node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "dev": true,
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/@electron/universal/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/@isaacs/cliui": {
      "version": "8.0.2",
      "resolved": "https://registry.npmjs.org/@isaacs/cliui/-/cliui-8.0.2.tgz",
      "integrity": "sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==",
      "dev": true,
      "dependencies": {
        "string-width": "^5.1.2",
        "string-width-cjs": "npm:string-width@^4.2.0",
        "strip-ansi": "^7.0.1",
        "strip-ansi-cjs": "npm:strip-ansi@^6.0.1",
        "wrap-ansi": "^8.1.0",
        "wrap-ansi-cjs": "npm:wrap-ansi@^7.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@isaacs/cliui/node_modules/ansi-regex": {
      "version": "6.2.2",
      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
      "dev": true,
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
      }
    },
    "node_modules/@isaacs/cliui/node_modules/ansi-styles": {
      "version": "6.2.3",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-6.2.3.tgz",
      "integrity": "sha512-4Dj6M28JB+oAH8kFkTLUo+a2jwOFkuqb3yucU0CANcRRUbxS0cP0nZYCGjcc3BNXwRIsUVmDGgzawme7zvJHvg==",
      "dev": true,
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/@isaacs/cliui/node_modules/emoji-regex": {
      "version": "9.2.2",
      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-9.2.2.tgz",
      "integrity": "sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==",
      "dev": true
    },
    "node_modules/@isaacs/cliui/node_modules/string-width": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/string-width/-/string-width-5.1.2.tgz",
      "integrity": "sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==",
      "dev": true,
      "dependencies": {
        "eastasianwidth": "^0.2.0",
        "emoji-regex": "^9.2.2",
        "strip-ansi": "^7.0.1"
      },
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/@isaacs/cliui/node_modules/strip-ansi": {
      "version": "7.1.2",
      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
      "dev": true,
      "dependencies": {
        "ansi-regex": "^6.0.1"
      },
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
      }
    },
    "node_modules/@isaacs/cliui/node_modules/wrap-ansi": {
      "version": "8.1.0",
      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-8.1.0.tgz",
      "integrity": "sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==",
      "dev": true,
      "dependencies": {
        "ansi-styles": "^6.1.0",
        "string-width": "^5.0.1",
        "strip-ansi": "^7.0.1"
      },
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
      }
    },
    "node_modules/@malept/cross-spawn-promise": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@malept/cross-spawn-promise/-/cross-spawn-promise-1.1.1.tgz",
      "integrity": "sha512-RTBGWL5FWQcg9orDOCcp4LvItNzUPcyEU9bwaeJX0rJ1IQxzucC48Y0/sQLp/g6t99IQgAlGIaesJS+gTn7tVQ==",
      "dev": true,
      "funding": [
        {
          "type": "individual",
          "url": "https://github.com/sponsors/malept"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/subscription/pkg/npm-.malept-cross-spawn-promise?utm_medium=referral&utm_source=npm_fund"
        }
      ],
      "dependencies": {
        "cross-spawn": "^7.0.1"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@malept/flatpak-bundler": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/@malept/flatpak-bundler/-/flatpak-bundler-0.4.0.tgz",
      "integrity": "sha512-9QOtNffcOF/c1seMCDnjckb3R9WHcG34tky+FHpNKKCW0wc/scYLwMtO+ptyGUfMW0/b/n4qRiALlaFHc9Oj7Q==",
      "dev": true,
      "dependencies": {
        "debug": "^4.1.1",
        "fs-extra": "^9.0.0",
        "lodash": "^4.17.15",
        "tmp-promise": "^3.0.2"
      },
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/@malept/flatpak-bundler/node_modules/fs-extra": {
      "version": "9.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-9.1.0.tgz",
      "integrity": "sha512-hcg3ZmepS30/7BSFqRvoo3DOMQu7IjqxO5nCDt+zM9XWjb33Wg7ziNT+Qvqbuc3+gWpzO02JubVyk2G4Zvo1OQ==",
      "dev": true,
      "dependencies": {
        "at-least-node": "^1.0.0",
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/@malept/flatpak-bundler/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/@malept/flatpak-bundler/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/@pkgjs/parseargs": {
      "version": "0.11.0",
      "resolved": "https://registry.npmjs.org/@pkgjs/parseargs/-/parseargs-0.11.0.tgz",
      "integrity": "sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/@sindresorhus/is": {
      "version": "4.6.0",
      "resolved": "https://registry.npmjs.org/@sindresorhus/is/-/is-4.6.0.tgz",
      "integrity": "sha512-t09vSN3MdfsyCHoFcTRCH/iUtG7OJ0CsjzB8cjAmKc/va/kIgeDI/TxsigdncE/4be734m0cvIYwNaV4i2XqAw==",
      "dev": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sindresorhus/is?sponsor=1"
      }
    },
    "node_modules/@szmarczak/http-timer": {
      "version": "4.0.6",
      "resolved": "https://registry.npmjs.org/@szmarczak/http-timer/-/http-timer-4.0.6.tgz",
      "integrity": "sha512-4BAffykYOgO+5nzBWYwE3W90sBgLJoUPRWWcL8wlyiM8IB8ipJz3UMJ9KXQd1RKQXpKp8Tutn80HZtWsu2u76w==",
      "dev": true,
      "dependencies": {
        "defer-to-connect": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/@tootallnate/once": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/@tootallnate/once/-/once-2.0.0.tgz",
      "integrity": "sha512-XCuKFP5PS55gnMVu3dty8KPatLqUoy/ZYzDzAGCQ8JNFCkLXzmI7vNHCR+XpbZaMWQK/vQubr7PkYq8g470J/A==",
      "dev": true,
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@types/cacheable-request": {
      "version": "6.0.3",
      "resolved": "https://registry.npmjs.org/@types/cacheable-request/-/cacheable-request-6.0.3.tgz",
      "integrity": "sha512-IQ3EbTzGxIigb1I3qPZc1rWJnH0BmSKv5QYTalEwweFvyBDLSAe24zP0le/hyi7ecGfZVlIVAg4BZqb8WBwKqw==",
      "dev": true,
      "dependencies": {
        "@types/http-cache-semantics": "*",
        "@types/keyv": "^3.1.4",
        "@types/node": "*",
        "@types/responselike": "^1.0.0"
      }
    },
    "node_modules/@types/debug": {
      "version": "4.1.12",
      "resolved": "https://registry.npmjs.org/@types/debug/-/debug-4.1.12.tgz",
      "integrity": "sha512-vIChWdVG3LG1SMxEvI/AK+FWJthlrqlTu7fbrlywTkkaONwk/UAGaULXRlf8vkzFBLVm0zkMdCquhL5aOjhXPQ==",
      "dev": true,
      "dependencies": {
        "@types/ms": "*"
      }
    },
    "node_modules/@types/fs-extra": {
      "version": "9.0.13",
      "resolved": "https://registry.npmjs.org/@types/fs-extra/-/fs-extra-9.0.13.tgz",
      "integrity": "sha512-nEnwB++1u5lVDM2UI4c1+5R+FYaKfaAzS4OococimjVm3nQw3TuzH5UNsocrcTBbhnerblyHj4A49qXbIiZdpA==",
      "dev": true,
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/http-cache-semantics": {
      "version": "4.0.4",
      "resolved": "https://registry.npmjs.org/@types/http-cache-semantics/-/http-cache-semantics-4.0.4.tgz",
      "integrity": "sha512-1m0bIFVc7eJWyve9S0RnuRgcQqF/Xd5QsUZAZeQFr1Q3/p9JWoQQEqmVy+DPTNpGXwhgIetAoYF8JSc33q29QA==",
      "dev": true
    },
    "node_modules/@types/keyv": {
      "version": "3.1.4",
      "resolved": "https://registry.npmjs.org/@types/keyv/-/keyv-3.1.4.tgz",
      "integrity": "sha512-BQ5aZNSCpj7D6K2ksrRCTmKRLEpnPvWDiLPfoGyhZ++8YtiK9d/3DBKPJgry359X/P1PfruyYwvnvwFjuEiEIg==",
      "dev": true,
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/ms": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/@types/ms/-/ms-2.1.0.tgz",
      "integrity": "sha512-GsCCIZDE/p3i96vtEqx+7dBUGXrc7zeSK3wwPHIaRThS+9OhWIXRqzs4d6k1SVU8g91DrNRWxWUGhp5KXQb2VA==",
      "dev": true
    },
    "node_modules/@types/node": {
      "version": "20.19.25",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-20.19.25.tgz",
      "integrity": "sha512-ZsJzA5thDQMSQO788d7IocwwQbI8B5OPzmqNvpf3NY/+MHDAS759Wo0gd2WQeXYt5AAAQjzcrTVC6SKCuYgoCQ==",
      "dev": true,
      "dependencies": {
        "undici-types": "~6.21.0"
      }
    },
    "node_modules/@types/plist": {
      "version": "3.0.5",
      "resolved": "https://registry.npmjs.org/@types/plist/-/plist-3.0.5.tgz",
      "integrity": "sha512-E6OCaRmAe4WDmWNsL/9RMqdkkzDCY1etutkflWk4c+AcjDU07Pcz1fQwTX0TQz+Pxqn9i4L1TU3UFpjnrcDgxA==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "@types/node": "*",
        "xmlbuilder": ">=11.0.1"
      }
    },
    "node_modules/@types/responselike": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/@types/responselike/-/responselike-1.0.3.tgz",
      "integrity": "sha512-H/+L+UkTV33uf49PH5pCAUBVPNj2nDBXTN+qS1dOwyyg24l3CcicicCA7ca+HMvJBZcFgl5r8e+RR6elsb4Lyw==",
      "dev": true,
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/verror": {
      "version": "1.10.11",
      "resolved": "https://registry.npmjs.org/@types/verror/-/verror-1.10.11.tgz",
      "integrity": "sha512-RlDm9K7+o5stv0Co8i8ZRGxDbrTxhJtgjqjFyVh/tXQyl/rYtTKlnTvZ88oSTeYREWurwx20Js4kTuKCsFkUtg==",
      "dev": true,
      "optional": true
    },
    "node_modules/@types/yauzl": {
      "version": "2.10.3",
      "resolved": "https://registry.npmjs.org/@types/yauzl/-/yauzl-2.10.3.tgz",
      "integrity": "sha512-oJoftv0LSuaDZE3Le4DbKX+KS9G36NzOeSap90UIK0yMA/NhKJhqlSGtNDORNRaIbQfzjXDrQa0ytJ6mNRGz/Q==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@xmldom/xmldom": {
      "version": "0.8.11",
      "resolved": "https://registry.npmjs.org/@xmldom/xmldom/-/xmldom-0.8.11.tgz",
      "integrity": "sha512-cQzWCtO6C8TQiYl1ruKNn2U6Ao4o4WBBcbL61yJl84x+j5sOWWFU9X7DpND8XZG3daDppSsigMdfAIl2upQBRw==",
      "dev": true,
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/7zip-bin": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/7zip-bin/-/7zip-bin-5.2.0.tgz",
      "integrity": "sha512-ukTPVhqG4jNzMro2qA9HSCSSVJN3aN7tlb+hfqYCt3ER0yWroeA2VR38MNrOHLQ/cVj+DaIMad0kFCtWWowh/A==",
      "dev": true
    },
    "node_modules/accepts": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-2.0.0.tgz",
      "integrity": "sha512-5cvg6CtKwfgdmVqY1WIiXKc3Q1bkRqGLi+2W/6ao+6Y7gu/RCwRuAhGEzh5B4KlszSuTLgZYuqFqo5bImjNKng==",
      "dependencies": {
        "mime-types": "^3.0.0",
        "negotiator": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/agent-base": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/agent-base/-/agent-base-6.0.2.tgz",
      "integrity": "sha512-RZNwNclF7+MS/8bDg70amg32dyeZGZxiDuQmZxKLAlQjr3jGyLx+4Kkk58UO7D2QdgFIQCovuSuZESne6RG6XQ==",
      "dev": true,
      "dependencies": {
        "debug": "4"
      },
      "engines": {
        "node": ">= 6.0.0"
      }
    },
    "node_modules/ajv": {
      "version": "6.12.6",
      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",
      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",
      "dev": true,
      "dependencies": {
        "fast-deep-equal": "^3.1.1",
        "fast-json-stable-stringify": "^2.0.0",
        "json-schema-traverse": "^0.4.1",
        "uri-js": "^4.2.2"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/epoberezkin"
      }
    },
    "node_modules/ajv-keywords": {
      "version": "3.5.2",
      "resolved": "https://registry.npmjs.org/ajv-keywords/-/ajv-keywords-3.5.2.tgz",
      "integrity": "sha512-5p6WTN0DdTGVQk6VjcEju19IgaHudalcfabD7yhDGeA6bcQnmL+CpveLJq/3hvfwd1aof6L386Ougkx6RfyMIQ==",
      "dev": true,
      "peerDependencies": {
        "ajv": "^6.9.1"
      }
    },
    "node_modules/ansi-regex": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/ansi-styles": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
      "dev": true,
      "dependencies": {
        "color-convert": "^2.0.1"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/app-builder-bin": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/app-builder-bin/-/app-builder-bin-4.0.0.tgz",
      "integrity": "sha512-xwdG0FJPQMe0M0UA4Tz0zEB8rBJTRA5a476ZawAqiBkMv16GRK5xpXThOjMaEOFnZ6zabejjG4J3da0SXG63KA==",
      "dev": true
    },
    "node_modules/app-builder-lib": {
      "version": "24.13.3",
      "resolved": "https://registry.npmjs.org/app-builder-lib/-/app-builder-lib-24.13.3.tgz",
      "integrity": "sha512-FAzX6IBit2POXYGnTCT8YHFO/lr5AapAII6zzhQO3Rw4cEDOgK+t1xhLc5tNcKlicTHlo9zxIwnYCX9X2DLkig==",
      "dev": true,
      "dependencies": {
        "@develar/schema-utils": "~2.6.5",
        "@electron/notarize": "2.2.1",
        "@electron/osx-sign": "1.0.5",
        "@electron/universal": "1.5.1",
        "@malept/flatpak-bundler": "^0.4.0",
        "@types/fs-extra": "9.0.13",
        "async-exit-hook": "^2.0.1",
        "bluebird-lst": "^1.0.9",
        "builder-util": "24.13.1",
        "builder-util-runtime": "9.2.4",
        "chromium-pickle-js": "^0.2.0",
        "debug": "^4.3.4",
        "ejs": "^3.1.8",
        "electron-publish": "24.13.1",
        "form-data": "^4.0.0",
        "fs-extra": "^10.1.0",
        "hosted-git-info": "^4.1.0",
        "is-ci": "^3.0.0",
        "isbinaryfile": "^5.0.0",
        "js-yaml": "^4.1.0",
        "lazy-val": "^1.0.5",
        "minimatch": "^5.1.1",
        "read-config-file": "6.3.2",
        "sanitize-filename": "^1.6.3",
        "semver": "^7.3.8",
        "tar": "^6.1.12",
        "temp-file": "^3.4.0"
      },
      "engines": {
        "node": ">=14.0.0"
      },
      "peerDependencies": {
        "dmg-builder": "24.13.3",
        "electron-builder-squirrel-windows": "24.13.3"
      }
    },
    "node_modules/app-builder-lib/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/app-builder-lib/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/app-builder-lib/node_modules/semver": {
      "version": "7.7.3",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.3.tgz",
      "integrity": "sha512-SdsKMrI9TdgjdweUSR9MweHA4EJ8YxHn8DFaDisvhVlUOe4BF1tLD7GAj0lIqWVl+dPb/rExr0Btby5loQm20Q==",
      "dev": true,
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/app-builder-lib/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/archiver": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/archiver/-/archiver-5.3.2.tgz",
      "integrity": "sha512-+25nxyyznAXF7Nef3y0EbBeqmGZgeN/BxHX29Rs39djAfaFalmQ89SE6CWyDCHzGL0yt/ycBtNOmGTW0FyGWNw==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "archiver-utils": "^2.1.0",
        "async": "^3.2.4",
        "buffer-crc32": "^0.2.1",
        "readable-stream": "^3.6.0",
        "readdir-glob": "^1.1.2",
        "tar-stream": "^2.2.0",
        "zip-stream": "^4.1.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/archiver-utils": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/archiver-utils/-/archiver-utils-2.1.0.tgz",
      "integrity": "sha512-bEL/yUb/fNNiNTuUz979Z0Yg5L+LzLxGJz8x79lYmR54fmTIb6ob/hNQgkQnIUDWIFjZVQwl9Xs356I6BAMHfw==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "glob": "^7.1.4",
        "graceful-fs": "^4.2.0",
        "lazystream": "^1.0.0",
        "lodash.defaults": "^4.2.0",
        "lodash.difference": "^4.5.0",
        "lodash.flatten": "^4.4.0",
        "lodash.isplainobject": "^4.0.6",
        "lodash.union": "^4.6.0",
        "normalize-path": "^3.0.0",
        "readable-stream": "^2.0.0"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/archiver-utils/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/archiver-utils/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "dev": true,
      "peer": true
    },
    "node_modules/archiver-utils/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/argparse": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz",
      "integrity": "sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==",
      "dev": true
    },
    "node_modules/assert-plus": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/assert-plus/-/assert-plus-1.0.0.tgz",
      "integrity": "sha512-NfJ4UzBCcQGLDlQq7nHxH+tv3kyZ0hHQqF5BO6J7tNJeP5do1llPr8dZ8zHonfhAu0PHAdMkSo+8o0wxg9lZWw==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/astral-regex": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/astral-regex/-/astral-regex-2.0.0.tgz",
      "integrity": "sha512-Z7tMw1ytTXt5jqMcOP+OQteU1VuNK9Y02uuJtKQ1Sv69jXQKKg5cibLwGJow8yzZP+eAc18EmLGPal0bp36rvQ==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/async": {
      "version": "3.2.6",
      "resolved": "https://registry.npmjs.org/async/-/async-3.2.6.tgz",
      "integrity": "sha512-htCUDlxyyCLMgaM3xXg0C0LW2xqfuQ6p05pCEIsXuyQ+a1koYKTuBMzRNwmybfLgvJDMd0r1LTn4+E0Ti6C2AA==",
      "dev": true
    },
    "node_modules/async-exit-hook": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/async-exit-hook/-/async-exit-hook-2.0.1.tgz",
      "integrity": "sha512-NW2cX8m1Q7KPA7a5M2ULQeZ2wR5qI5PAbw5L0UOMxdioVk9PMZ0h1TmyZEkPYrCvYjDlFICusOu1dlEKAAeXBw==",
      "dev": true,
      "engines": {
        "node": ">=0.12.0"
      }
    },
    "node_modules/asynckit": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz",
      "integrity": "sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==",
      "dev": true
    },
    "node_modules/at-least-node": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/at-least-node/-/at-least-node-1.0.0.tgz",
      "integrity": "sha512-+q/t7Ekv1EDY2l6Gda6LLiX14rU9TV20Wa3ofeQmwPFZbOMo9DXrLbOjFaaclkXKWidIaopwAObQDqwWtGUjqg==",
      "dev": true,
      "engines": {
        "node": ">= 4.0.0"
      }
    },
    "node_modules/balanced-match": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.2.tgz",
      "integrity": "sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==",
      "dev": true
    },
    "node_modules/base64-js": {
      "version": "1.5.1",
      "resolved": "https://registry.npmjs.org/base64-js/-/base64-js-1.5.1.tgz",
      "integrity": "sha512-AKpaYlHn8t4SVbOHCy+b5+KKgvR4vrsD8vbvrbiQJps7fKDTkjkDry6ji0rUJjC0kzbNePLwzxq8iypo41qeWA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ]
    },
    "node_modules/bl": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/bl/-/bl-4.1.0.tgz",
      "integrity": "sha512-1W07cM9gS6DcLperZfFSj+bWLtaPGSOHWhPiGzXmvVJbRLdG82sH/Kn8EtW1VqWVA54AKf2h5k5BbnIbwF3h6w==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "buffer": "^5.5.0",
        "inherits": "^2.0.4",
        "readable-stream": "^3.4.0"
      }
    },
    "node_modules/bluebird": {
      "version": "3.7.2",
      "resolved": "https://registry.npmjs.org/bluebird/-/bluebird-3.7.2.tgz",
      "integrity": "sha512-XpNj6GDQzdfW+r2Wnn7xiSAd7TM3jzkxGXBGTtWKuSXv1xUV+azxAm8jdWZN06QTQk+2N2XB9jRDkvbmQmcRtg==",
      "dev": true
    },
    "node_modules/bluebird-lst": {
      "version": "1.0.9",
      "resolved": "https://registry.npmjs.org/bluebird-lst/-/bluebird-lst-1.0.9.tgz",
      "integrity": "sha512-7B1Rtx82hjnSD4PGLAjVWeYH3tHAcVUmChh85a3lltKQm6FresXh9ErQo6oAv6CqxttczC3/kEg8SY5NluPuUw==",
      "dev": true,
      "dependencies": {
        "bluebird": "^3.5.5"
      }
    },
    "node_modules/body-parser": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/body-parser/-/body-parser-2.2.0.tgz",
      "integrity": "sha512-02qvAaxv8tp7fBa/mw1ga98OGm+eCbqzJOKoRt70sLmfEEi+jyBYVTDGfCL/k06/4EMk/z01gCe7HoCH/f2LTg==",
      "dependencies": {
        "bytes": "^3.1.2",
        "content-type": "^1.0.5",
        "debug": "^4.4.0",
        "http-errors": "^2.0.0",
        "iconv-lite": "^0.6.3",
        "on-finished": "^2.4.1",
        "qs": "^6.14.0",
        "raw-body": "^3.0.0",
        "type-is": "^2.0.0"
      },
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/boolean": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/boolean/-/boolean-3.2.0.tgz",
      "integrity": "sha512-d0II/GO9uf9lfUHH2BQsjxzRJZBdsjgsBiW4BvhWk/3qoKwQFjIDVN19PfX8F2D/r9PCMTtLWjYVCFrpeYUzsw==",
      "deprecated": "Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.",
      "dev": true,
      "optional": true
    },
    "node_modules/brace-expansion": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.2.tgz",
      "integrity": "sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==",
      "dev": true,
      "dependencies": {
        "balanced-match": "^1.0.0"
      }
    },
    "node_modules/buffer": {
      "version": "5.7.1",
      "resolved": "https://registry.npmjs.org/buffer/-/buffer-5.7.1.tgz",
      "integrity": "sha512-EHcyIPBQ4BSGlvjB16k5KgAJ27CIsHY/2JBmCRReo48y9rQ3MaUzWX3KVlBa4U7MyX02HdVj0K7C3WaB3ju7FQ==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "dependencies": {
        "base64-js": "^1.3.1",
        "ieee754": "^1.1.13"
      }
    },
    "node_modules/buffer-crc32": {
      "version": "0.2.13",
      "resolved": "https://registry.npmjs.org/buffer-crc32/-/buffer-crc32-0.2.13.tgz",
      "integrity": "sha512-VO9Ht/+p3SN7SKWqcrgEzjGbRSJYTx+Q1pTQC0wrWqHx0vpJraQ6GtHx8tvcg1rlK1byhU5gccxgOgj7B0TDkQ==",
      "dev": true,
      "engines": {
        "node": "*"
      }
    },
    "node_modules/buffer-equal": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/buffer-equal/-/buffer-equal-1.0.1.tgz",
      "integrity": "sha512-QoV3ptgEaQpvVwbXdSO39iqPQTCxSF7A5U99AxbHYqUdCizL/lH2Z0A2y6nbZucxMEOtNyZfG2s6gsVugGpKkg==",
      "dev": true,
      "engines": {
        "node": ">=0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/buffer-from": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/buffer-from/-/buffer-from-1.1.2.tgz",
      "integrity": "sha512-E+XQCRwSbaaiChtv6k6Dwgc+bx+Bs6vuKJHHl5kox/BaKbhiXzqQOwK4cO22yElGp2OCmjwVhT3HmxgyPGnJfQ==",
      "dev": true
    },
    "node_modules/builder-util": {
      "version": "24.13.1",
      "resolved": "https://registry.npmjs.org/builder-util/-/builder-util-24.13.1.tgz",
      "integrity": "sha512-NhbCSIntruNDTOVI9fdXz0dihaqX2YuE1D6zZMrwiErzH4ELZHE6mdiB40wEgZNprDia+FghRFgKoAqMZRRjSA==",
      "dev": true,
      "dependencies": {
        "@types/debug": "^4.1.6",
        "7zip-bin": "~5.2.0",
        "app-builder-bin": "4.0.0",
        "bluebird-lst": "^1.0.9",
        "builder-util-runtime": "9.2.4",
        "chalk": "^4.1.2",
        "cross-spawn": "^7.0.3",
        "debug": "^4.3.4",
        "fs-extra": "^10.1.0",
        "http-proxy-agent": "^5.0.0",
        "https-proxy-agent": "^5.0.1",
        "is-ci": "^3.0.0",
        "js-yaml": "^4.1.0",
        "source-map-support": "^0.5.19",
        "stat-mode": "^1.0.0",
        "temp-file": "^3.4.0"
      }
    },
    "node_modules/builder-util-runtime": {
      "version": "9.2.4",
      "resolved": "https://registry.npmjs.org/builder-util-runtime/-/builder-util-runtime-9.2.4.tgz",
      "integrity": "sha512-upp+biKpN/XZMLim7aguUyW8s0FUpDvOtK6sbanMFDAMBzpHDqdhgVYm6zc9HJ6nWo7u2Lxk60i2M6Jd3aiNrA==",
      "dev": true,
      "dependencies": {
        "debug": "^4.3.4",
        "sax": "^1.2.4"
      },
      "engines": {
        "node": ">=12.0.0"
      }
    },
    "node_modules/builder-util/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/builder-util/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/builder-util/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/bytes": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/bytes/-/bytes-3.1.2.tgz",
      "integrity": "sha512-/Nf7TyzTx6S3yRJObOAV7956r8cr2+Oj8AC5dt8wSP3BQAoeX58NoHyCU8P8zGkNXStjTSi6fzO6F0pBdcYbEg==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/cacheable-lookup": {
      "version": "5.0.4",
      "resolved": "https://registry.npmjs.org/cacheable-lookup/-/cacheable-lookup-5.0.4.tgz",
      "integrity": "sha512-2/kNscPhpcxrOigMZzbiWF7dz8ilhb/nIHU3EyZiXWXpeq/au8qJ8VhdftMkty3n7Gj6HIGalQG8oiBNB3AJgA==",
      "dev": true,
      "engines": {
        "node": ">=10.6.0"
      }
    },
    "node_modules/cacheable-request": {
      "version": "7.0.4",
      "resolved": "https://registry.npmjs.org/cacheable-request/-/cacheable-request-7.0.4.tgz",
      "integrity": "sha512-v+p6ongsrp0yTGbJXjgxPow2+DL93DASP4kXCDKb8/bwRtt9OEF3whggkkDkGNzgcWy2XaF4a8nZglC7uElscg==",
      "dev": true,
      "dependencies": {
        "clone-response": "^1.0.2",
        "get-stream": "^5.1.0",
        "http-cache-semantics": "^4.0.0",
        "keyv": "^4.0.0",
        "lowercase-keys": "^2.0.0",
        "normalize-url": "^6.0.1",
        "responselike": "^2.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/chalk": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz",
      "integrity": "sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==",
      "dev": true,
      "dependencies": {
        "ansi-styles": "^4.1.0",
        "supports-color": "^7.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/chalk?sponsor=1"
      }
    },
    "node_modules/chownr": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/chownr/-/chownr-2.0.0.tgz",
      "integrity": "sha512-bIomtDF5KGpdogkLd9VspvFzk9KfpyyGlS8YFVZl7TGPBHL5snIOnxeshwVgPteQ9b4Eydl+pVbIyE1DcvCWgQ==",
      "dev": true,
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/chromium-pickle-js": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/chromium-pickle-js/-/chromium-pickle-js-0.2.0.tgz",
      "integrity": "sha512-1R5Fho+jBq0DDydt+/vHWj5KJNJCKdARKOCwZUen84I5BreWoLqRLANH1U87eJy1tiASPtMnGqJJq0ZsLoRPOw==",
      "dev": true
    },
    "node_modules/ci-info": {
      "version": "3.9.0",
      "resolved": "https://registry.npmjs.org/ci-info/-/ci-info-3.9.0.tgz",
      "integrity": "sha512-NIxF55hv4nSqQswkAeiOi1r83xy8JldOFDTWiug55KBu9Jnblncd2U6ViHmYgHf01TPZS77NJBhBMKdWj9HQMQ==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/sibiraj-s"
        }
      ],
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/cli-truncate": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/cli-truncate/-/cli-truncate-2.1.0.tgz",
      "integrity": "sha512-n8fOixwDD6b/ObinzTrp1ZKFzbgvKZvuz/TvejnLn1aQfC6r52XEx85FmuC+3HI+JM7coBRXUvNqEU2PHVrHpg==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "slice-ansi": "^3.0.0",
        "string-width": "^4.2.0"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/cliui": {
      "version": "8.0.1",
      "resolved": "https://registry.npmjs.org/cliui/-/cliui-8.0.1.tgz",
      "integrity": "sha512-BSeNnyus75C4//NQ9gQt1/csTXyo/8Sb+afLAkzAptFuMsod9HFokGNudZpi/oQV73hnVK+sR+5PVRMd+Dr7YQ==",
      "dev": true,
      "dependencies": {
        "string-width": "^4.2.0",
        "strip-ansi": "^6.0.1",
        "wrap-ansi": "^7.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/clone-response": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/clone-response/-/clone-response-1.0.3.tgz",
      "integrity": "sha512-ROoL94jJH2dUVML2Y/5PEDNaSHgeOdSDicUyS7izcF63G6sTc/FTjLub4b8Il9S8S0beOfYt0TaA5qvFK+w0wA==",
      "dev": true,
      "dependencies": {
        "mimic-response": "^1.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/color-convert": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
      "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
      "dev": true,
      "dependencies": {
        "color-name": "~1.1.4"
      },
      "engines": {
        "node": ">=7.0.0"
      }
    },
    "node_modules/color-name": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
      "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
      "dev": true
    },
    "node_modules/combined-stream": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/combined-stream/-/combined-stream-1.0.8.tgz",
      "integrity": "sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==",
      "dev": true,
      "dependencies": {
        "delayed-stream": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/commander": {
      "version": "5.1.0",
      "resolved": "https://registry.npmjs.org/commander/-/commander-5.1.0.tgz",
      "integrity": "sha512-P0CysNDQ7rtVw4QIQtm+MRxV66vKFSvlsQvGYXZWR3qFU0jlMKHZZZgw8e+8DSah4UDKMqnknRDQz+xuQXQ/Zg==",
      "dev": true,
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/compare-version": {
      "version": "0.1.2",
      "resolved": "https://registry.npmjs.org/compare-version/-/compare-version-0.1.2.tgz",
      "integrity": "sha512-pJDh5/4wrEnXX/VWRZvruAGHkzKdr46z11OlTPN+VrATlWWhSKewNCJ1futCO5C7eJB3nPMFZA1LeYtcFboZ2A==",
      "dev": true,
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/compress-commons": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/compress-commons/-/compress-commons-4.1.2.tgz",
      "integrity": "sha512-D3uMHtGc/fcO1Gt1/L7i1e33VOvD4A9hfQLP+6ewd+BvG/gQ84Yh4oftEhAdjSMgBgwGL+jsppT7JYNpo6MHHg==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "buffer-crc32": "^0.2.13",
        "crc32-stream": "^4.0.2",
        "normalize-path": "^3.0.0",
        "readable-stream": "^3.6.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/concat-map": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz",
      "integrity": "sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==",
      "dev": true
    },
    "node_modules/config-file-ts": {
      "version": "0.2.6",
      "resolved": "https://registry.npmjs.org/config-file-ts/-/config-file-ts-0.2.6.tgz",
      "integrity": "sha512-6boGVaglwblBgJqGyxm4+xCmEGcWgnWHSWHY5jad58awQhB6gftq0G8HbzU39YqCIYHMLAiL1yjwiZ36m/CL8w==",
      "dev": true,
      "dependencies": {
        "glob": "^10.3.10",
        "typescript": "^5.3.3"
      }
    },
    "node_modules/config-file-ts/node_modules/glob": {
      "version": "10.5.0",
      "resolved": "https://registry.npmjs.org/glob/-/glob-10.5.0.tgz",
      "integrity": "sha512-DfXN8DfhJ7NH3Oe7cFmu3NCu1wKbkReJ8TorzSAFbSKrlNaQSKfIzqYqVY8zlbs2NLBbWpRiU52GX2PbaBVNkg==",
      "dev": true,
      "dependencies": {
        "foreground-child": "^3.1.0",
        "jackspeak": "^3.1.2",
        "minimatch": "^9.0.4",
        "minipass": "^7.1.2",
        "package-json-from-dist": "^1.0.0",
        "path-scurry": "^1.11.1"
      },
      "bin": {
        "glob": "dist/esm/bin.mjs"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/config-file-ts/node_modules/minimatch": {
      "version": "9.0.5",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-9.0.5.tgz",
      "integrity": "sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==",
      "dev": true,
      "dependencies": {
        "brace-expansion": "^2.0.1"
      },
      "engines": {
        "node": ">=16 || 14 >=14.17"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/config-file-ts/node_modules/minipass": {
      "version": "7.1.2",
      "resolved": "https://registry.npmjs.org/minipass/-/minipass-7.1.2.tgz",
      "integrity": "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==",
      "dev": true,
      "engines": {
        "node": ">=16 || 14 >=14.17"
      }
    },
    "node_modules/content-disposition": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/content-disposition/-/content-disposition-1.0.1.tgz",
      "integrity": "sha512-oIXISMynqSqm241k6kcQ5UwttDILMK4BiurCfGEREw6+X9jkkpEe5T9FZaApyLGGOnFuyMWZpdolTXMtvEJ08Q==",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/content-type": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/content-type/-/content-type-1.0.5.tgz",
      "integrity": "sha512-nTjqfcBFEipKdXCv4YDQWCfmcLZKm81ldF0pAopTvyrFGVbcR6P/VAAd5G7N+0tTr8QqiU0tFadD6FK4NtJwOA==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie": {
      "version": "0.7.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.2.tgz",
      "integrity": "sha512-yki5XnKuf750l50uGTllt6kKILY4nQ1eNIQatoXEByZ5dWgnKqbnqmTrBE5B4N7lrMJKQ2ytWMiTO2o0v6Ew/w==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie-signature": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/cookie-signature/-/cookie-signature-1.2.2.tgz",
      "integrity": "sha512-D76uU73ulSXrD1UXF4KE2TMxVVwhsnCgfAyTg9k8P6KGZjlXKrOLe4dJQKI3Bxi5wjesZoFXJWElNWBjPZMbhg==",
      "engines": {
        "node": ">=6.6.0"
      }
    },
    "node_modules/core-util-is": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/core-util-is/-/core-util-is-1.0.2.tgz",
      "integrity": "sha512-3lqz5YjWTYnW6dlDa5TLaTCcShfar1e40rmcJVwCBJC6mWlFuj0eCHIElmG1g5kyuJ/GD+8Wn4FFCcz4gJPfaQ==",
      "dev": true
    },
    "node_modules/crc": {
      "version": "3.8.0",
      "resolved": "https://registry.npmjs.org/crc/-/crc-3.8.0.tgz",
      "integrity": "sha512-iX3mfgcTMIq3ZKLIsVFAbv7+Mc10kxabAGQb8HvjA1o3T1PIYprbakQ65d3I+2HGHt6nSKkM9PYjgoJO2KcFBQ==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "buffer": "^5.1.0"
      }
    },
    "node_modules/crc-32": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/crc-32/-/crc-32-1.2.2.tgz",
      "integrity": "sha512-ROmzCKrTnOwybPcJApAA6WBWij23HVfGVNKqqrZpuyZOHqK2CwHSvpGuyt/UNNvaIjEd8X5IFGp4Mh+Ie1IHJQ==",
      "dev": true,
      "peer": true,
      "bin": {
        "crc32": "bin/crc32.njs"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/crc32-stream": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/crc32-stream/-/crc32-stream-4.0.3.tgz",
      "integrity": "sha512-NT7w2JVU7DFroFdYkeq8cywxrgjPHWkdX1wjpRQXPX5Asews3tA+Ght6lddQO5Mkumffp3X7GEqku3epj2toIw==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "crc-32": "^1.2.0",
        "readable-stream": "^3.4.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/cross-spawn": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.6.tgz",
      "integrity": "sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==",
      "dev": true,
      "dependencies": {
        "path-key": "^3.1.0",
        "shebang-command": "^2.0.0",
        "which": "^2.0.1"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/decompress-response": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/decompress-response/-/decompress-response-6.0.0.tgz",
      "integrity": "sha512-aW35yZM6Bb/4oJlZncMH2LCoZtJXTRxES17vE3hoRiowU2kWHaJKFkSBDnDR+cm9J+9QhXmREyIfv0pji9ejCQ==",
      "dev": true,
      "dependencies": {
        "mimic-response": "^3.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/decompress-response/node_modules/mimic-response": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/mimic-response/-/mimic-response-3.1.0.tgz",
      "integrity": "sha512-z0yWI+4FDrrweS8Zmt4Ej5HdJmky15+L2e6Wgn3+iK5fWzb6T3fhNFq2+MeTRb064c6Wr4N/wv0DzQTjNzHNGQ==",
      "dev": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/defer-to-connect": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/defer-to-connect/-/defer-to-connect-2.0.1.tgz",
      "integrity": "sha512-4tvttepXG1VaYGrRibk5EwJd1t4udunSOVMdLSAL6mId1ix438oPwPZMALY41FCijukO1L0twNcGsdzS7dHgDg==",
      "dev": true,
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/define-data-property": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/define-data-property/-/define-data-property-1.1.4.tgz",
      "integrity": "sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "es-define-property": "^1.0.0",
        "es-errors": "^1.3.0",
        "gopd": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/define-properties": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/define-properties/-/define-properties-1.2.1.tgz",
      "integrity": "sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "define-data-property": "^1.0.1",
        "has-property-descriptors": "^1.0.0",
        "object-keys": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/delayed-stream": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/delayed-stream/-/delayed-stream-1.0.0.tgz",
      "integrity": "sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==",
      "dev": true,
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/depd": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/depd/-/depd-2.0.0.tgz",
      "integrity": "sha512-g7nH6P6dyDioJogAAGprGpCtVImJhpPk/roCzdb3fIh61/s/nPsfR6onyMwkCAR/OlC3yBC0lESvUoQEAssIrw==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/detect-node": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/detect-node/-/detect-node-2.1.0.tgz",
      "integrity": "sha512-T0NIuQpnTvFDATNuHN5roPwSBG83rFsuO+MXXH9/3N1eFbn4wcPjttvjMLEPWJ0RGUYgQE7cGgS3tNxbqCGM7g==",
      "dev": true,
      "optional": true
    },
    "node_modules/dir-compare": {
      "version": "3.3.0",
      "resolved": "https://registry.npmjs.org/dir-compare/-/dir-compare-3.3.0.tgz",
      "integrity": "sha512-J7/et3WlGUCxjdnD3HAAzQ6nsnc0WL6DD7WcwJb7c39iH1+AWfg+9OqzJNaI6PkBwBvm1mhZNL9iY/nRiZXlPg==",
      "dev": true,
      "dependencies": {
        "buffer-equal": "^1.0.0",
        "minimatch": "^3.0.4"
      }
    },
    "node_modules/dir-compare/node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "dev": true,
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/dir-compare/node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "dev": true,
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/dmg-builder": {
      "version": "24.13.3",
      "resolved": "https://registry.npmjs.org/dmg-builder/-/dmg-builder-24.13.3.tgz",
      "integrity": "sha512-rcJUkMfnJpfCboZoOOPf4L29TRtEieHNOeAbYPWPxlaBw/Z1RKrRA86dOI9rwaI4tQSc/RD82zTNHprfUHXsoQ==",
      "dev": true,
      "dependencies": {
        "app-builder-lib": "24.13.3",
        "builder-util": "24.13.1",
        "builder-util-runtime": "9.2.4",
        "fs-extra": "^10.1.0",
        "iconv-lite": "^0.6.2",
        "js-yaml": "^4.1.0"
      },
      "optionalDependencies": {
        "dmg-license": "^1.0.11"
      }
    },
    "node_modules/dmg-builder/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/dmg-builder/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/dmg-builder/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/dmg-license": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/dmg-license/-/dmg-license-1.0.11.tgz",
      "integrity": "sha512-ZdzmqwKmECOWJpqefloC5OJy1+WZBBse5+MR88z9g9Zn4VY+WYUkAyojmhzJckH5YbbZGcYIuGAkY5/Ys5OM2Q==",
      "dev": true,
      "optional": true,
      "os": [
        "darwin"
      ],
      "dependencies": {
        "@types/plist": "^3.0.1",
        "@types/verror": "^1.10.3",
        "ajv": "^6.10.0",
        "crc": "^3.8.0",
        "iconv-corefoundation": "^1.1.7",
        "plist": "^3.0.4",
        "smart-buffer": "^4.0.2",
        "verror": "^1.10.0"
      },
      "bin": {
        "dmg-license": "bin/dmg-license.js"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/dotenv": {
      "version": "9.0.2",
      "resolved": "https://registry.npmjs.org/dotenv/-/dotenv-9.0.2.tgz",
      "integrity": "sha512-I9OvvrHp4pIARv4+x9iuewrWycX6CcZtoAu1XrzPxc5UygMJXJZYmBsynku8IkrJwgypE5DGNjDPmPRhDCptUg==",
      "dev": true,
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/dotenv-expand": {
      "version": "5.1.0",
      "resolved": "https://registry.npmjs.org/dotenv-expand/-/dotenv-expand-5.1.0.tgz",
      "integrity": "sha512-YXQl1DSa4/PQyRfgrv6aoNjhasp/p4qs9FjJ4q4cQk+8m4r6k4ZSiEyytKG8f8W9gi8WsQtIObNmKd+tMzNTmA==",
      "dev": true
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/eastasianwidth": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/eastasianwidth/-/eastasianwidth-0.2.0.tgz",
      "integrity": "sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==",
      "dev": true
    },
    "node_modules/ee-first": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/ee-first/-/ee-first-1.1.1.tgz",
      "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow=="
    },
    "node_modules/ejs": {
      "version": "3.1.10",
      "resolved": "https://registry.npmjs.org/ejs/-/ejs-3.1.10.tgz",
      "integrity": "sha512-UeJmFfOrAQS8OJWPZ4qtgHyWExa088/MtK5UEyoJGFH67cDEXkZSviOiKRCZ4Xij0zxI3JECgYs3oKx+AizQBA==",
      "dev": true,
      "dependencies": {
        "jake": "^10.8.5"
      },
      "bin": {
        "ejs": "bin/cli.js"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/electron": {
      "version": "31.7.7",
      "resolved": "https://registry.npmjs.org/electron/-/electron-31.7.7.tgz",
      "integrity": "sha512-HZtZg8EHsDGnswFt0QeV8If8B+et63uD6RJ7I4/xhcXqmTIbI08GoubX/wm+HdY0DwcuPe1/xsgqpmYvjdjRoA==",
      "dev": true,
      "hasInstallScript": true,
      "dependencies": {
        "@electron/get": "^2.0.0",
        "@types/node": "^20.9.0",
        "extract-zip": "^2.0.1"
      },
      "bin": {
        "electron": "cli.js"
      },
      "engines": {
        "node": ">= 12.20.55"
      }
    },
    "node_modules/electron-builder": {
      "version": "24.13.3",
      "resolved": "https://registry.npmjs.org/electron-builder/-/electron-builder-24.13.3.tgz",
      "integrity": "sha512-yZSgVHft5dNVlo31qmJAe4BVKQfFdwpRw7sFp1iQglDRCDD6r22zfRJuZlhtB5gp9FHUxCMEoWGq10SkCnMAIg==",
      "dev": true,
      "dependencies": {
        "app-builder-lib": "24.13.3",
        "builder-util": "24.13.1",
        "builder-util-runtime": "9.2.4",
        "chalk": "^4.1.2",
        "dmg-builder": "24.13.3",
        "fs-extra": "^10.1.0",
        "is-ci": "^3.0.0",
        "lazy-val": "^1.0.5",
        "read-config-file": "6.3.2",
        "simple-update-notifier": "2.0.0",
        "yargs": "^17.6.2"
      },
      "bin": {
        "electron-builder": "cli.js",
        "install-app-deps": "install-app-deps.js"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/electron-builder-squirrel-windows": {
      "version": "24.13.3",
      "resolved": "https://registry.npmjs.org/electron-builder-squirrel-windows/-/electron-builder-squirrel-windows-24.13.3.tgz",
      "integrity": "sha512-oHkV0iogWfyK+ah9ZIvMDpei1m9ZRpdXcvde1wTpra2U8AFDNNpqJdnin5z+PM1GbQ5BoaKCWas2HSjtR0HwMg==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "app-builder-lib": "24.13.3",
        "archiver": "^5.3.1",
        "builder-util": "24.13.1",
        "fs-extra": "^10.1.0"
      }
    },
    "node_modules/electron-builder-squirrel-windows/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/electron-builder-squirrel-windows/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/electron-builder-squirrel-windows/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "peer": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/electron-builder/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/electron-builder/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/electron-builder/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/electron-publish": {
      "version": "24.13.1",
      "resolved": "https://registry.npmjs.org/electron-publish/-/electron-publish-24.13.1.tgz",
      "integrity": "sha512-2ZgdEqJ8e9D17Hwp5LEq5mLQPjqU3lv/IALvgp+4W8VeNhryfGhYEQC/PgDPMrnWUp+l60Ou5SJLsu+k4mhQ8A==",
      "dev": true,
      "dependencies": {
        "@types/fs-extra": "^9.0.11",
        "builder-util": "24.13.1",
        "builder-util-runtime": "9.2.4",
        "chalk": "^4.1.2",
        "fs-extra": "^10.1.0",
        "lazy-val": "^1.0.5",
        "mime": "^2.5.2"
      }
    },
    "node_modules/electron-publish/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/electron-publish/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/electron-publish/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/emoji-regex": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
      "dev": true
    },
    "node_modules/encodeurl": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
      "integrity": "sha512-Q0n9HRi4m6JuGIV1eFlmvJB7ZEVxu93IrMyiMsGC0lrMJMWzRgx6WGquyfQgZVb31vhGgXnfmPNNXmxnOkRBrg==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/end-of-stream": {
      "version": "1.4.5",
      "resolved": "https://registry.npmjs.org/end-of-stream/-/end-of-stream-1.4.5.tgz",
      "integrity": "sha512-ooEGc6HP26xXq/N+GCGOT0JKCLDGrq2bQUZrQ7gyrJiZANJ/8YDTxTpQBXGMn+WbIQXNVpyWymm7KYVICQnyOg==",
      "dev": true,
      "dependencies": {
        "once": "^1.4.0"
      }
    },
    "node_modules/env-paths": {
      "version": "2.2.1",
      "resolved": "https://registry.npmjs.org/env-paths/-/env-paths-2.2.1.tgz",
      "integrity": "sha512-+h1lkLKhZMTYjog1VEpJNG7NZJWcuc2DDk/qsqSTRRCOXiLjeQ1d1/udrUGhqMxUgAlwKNZ0cf2uqan5GLuS2A==",
      "dev": true,
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/err-code": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/err-code/-/err-code-2.0.3.tgz",
      "integrity": "sha512-2bmlRpNKBxT/CRmPOlyISQpNj+qSeYvcym/uT0Jx2bMOlKLtSy1ZmLuVxSEKKyor/N5yhvp/ZiG1oE3DEYMSFA==",
      "dev": true
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-set-tostringtag": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz",
      "integrity": "sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==",
      "dev": true,
      "dependencies": {
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es6-error": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/es6-error/-/es6-error-4.1.1.tgz",
      "integrity": "sha512-Um/+FxMr9CISWh0bi5Zv0iOD+4cFh5qLeks1qhAopKVAJw3drgKbKySikp7wGhDL0HPeaja0P5ULZrxLkniUVg==",
      "dev": true,
      "optional": true
    },
    "node_modules/escalade": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/escalade/-/escalade-3.2.0.tgz",
      "integrity": "sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==",
      "dev": true,
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/escape-html": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/escape-html/-/escape-html-1.0.3.tgz",
      "integrity": "sha512-NiSupZ4OeuGwr68lGIeym/ksIZMJodUGOSCZ/FSnTxcrekbvqrgdUxlJOMpijaKZVjAJrWrGs/6Jy8OMuyj9ow=="
    },
    "node_modules/escape-string-regexp": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
      "integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/etag": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/etag/-/etag-1.8.1.tgz",
      "integrity": "sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/express": {
      "version": "5.1.0",
      "resolved": "https://registry.npmjs.org/express/-/express-5.1.0.tgz",
      "integrity": "sha512-DT9ck5YIRU+8GYzzU5kT3eHGA5iL+1Zd0EutOmTE9Dtk+Tvuzd23VBU+ec7HPNSTxXYO55gPV/hq4pSBJDjFpA==",
      "dependencies": {
        "accepts": "^2.0.0",
        "body-parser": "^2.2.0",
        "content-disposition": "^1.0.0",
        "content-type": "^1.0.5",
        "cookie": "^0.7.1",
        "cookie-signature": "^1.2.1",
        "debug": "^4.4.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "finalhandler": "^2.1.0",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "merge-descriptors": "^2.0.0",
        "mime-types": "^3.0.0",
        "on-finished": "^2.4.1",
        "once": "^1.4.0",
        "parseurl": "^1.3.3",
        "proxy-addr": "^2.0.7",
        "qs": "^6.14.0",
        "range-parser": "^1.2.1",
        "router": "^2.2.0",
        "send": "^1.1.0",
        "serve-static": "^2.2.0",
        "statuses": "^2.0.1",
        "type-is": "^2.0.1",
        "vary": "^1.1.2"
      },
      "engines": {
        "node": ">= 18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/extract-zip": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/extract-zip/-/extract-zip-2.0.1.tgz",
      "integrity": "sha512-GDhU9ntwuKyGXdZBUgTIe+vXnWj0fppUEtMDL0+idd5Sta8TGpHssn/eusA9mrPr9qNDym6SxAYZjNvCn/9RBg==",
      "dev": true,
      "dependencies": {
        "debug": "^4.1.1",
        "get-stream": "^5.1.0",
        "yauzl": "^2.10.0"
      },
      "bin": {
        "extract-zip": "cli.js"
      },
      "engines": {
        "node": ">= 10.17.0"
      },
      "optionalDependencies": {
        "@types/yauzl": "^2.9.1"
      }
    },
    "node_modules/extsprintf": {
      "version": "1.4.1",
      "resolved": "https://registry.npmjs.org/extsprintf/-/extsprintf-1.4.1.tgz",
      "integrity": "sha512-Wrk35e8ydCKDj/ArClo1VrPVmN8zph5V4AtHwIuHhvMXsKf73UT3BOD+azBIW+3wOJ4FhEH7zyaJCFvChjYvMA==",
      "dev": true,
      "engines": [
        "node >=0.6.0"
      ],
      "optional": true
    },
    "node_modules/fast-deep-equal": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
      "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
      "dev": true
    },
    "node_modules/fast-json-stable-stringify": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz",
      "integrity": "sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==",
      "dev": true
    },
    "node_modules/fd-slicer": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/fd-slicer/-/fd-slicer-1.1.0.tgz",
      "integrity": "sha512-cE1qsB/VwyQozZ+q1dGxR8LBYNZeofhEdUNGSMbQD3Gw2lAzX9Zb3uIU6Ebc/Fmyjo9AWWfnn0AUCHqtevs/8g==",
      "dev": true,
      "dependencies": {
        "pend": "~1.2.0"
      }
    },
    "node_modules/filelist": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/filelist/-/filelist-1.0.4.tgz",
      "integrity": "sha512-w1cEuf3S+DrLCQL7ET6kz+gmlJdbq9J7yXCSjK/OZCPA+qEN1WyF4ZAf0YYJa4/shHJra2t/d/r8SV4Ji+x+8Q==",
      "dev": true,
      "dependencies": {
        "minimatch": "^5.0.1"
      }
    },
    "node_modules/finalhandler": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/finalhandler/-/finalhandler-2.1.0.tgz",
      "integrity": "sha512-/t88Ty3d5JWQbWYgaOGCCYfXRwV1+be02WqYYlL6h0lEiUAMPM8o8qKGO01YIkOHzka2up08wvgYD0mDiI+q3Q==",
      "dependencies": {
        "debug": "^4.4.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "on-finished": "^2.4.1",
        "parseurl": "^1.3.3",
        "statuses": "^2.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/foreground-child": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/foreground-child/-/foreground-child-3.3.1.tgz",
      "integrity": "sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==",
      "dev": true,
      "dependencies": {
        "cross-spawn": "^7.0.6",
        "signal-exit": "^4.0.1"
      },
      "engines": {
        "node": ">=14"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/form-data": {
      "version": "4.0.5",
      "resolved": "https://registry.npmjs.org/form-data/-/form-data-4.0.5.tgz",
      "integrity": "sha512-8RipRLol37bNs2bhoV67fiTEvdTrbMUYcFTiy3+wuuOnUog2QBHCZWXDRijWQfAkhBj2Uf5UnVaiWwA5vdd82w==",
      "dev": true,
      "dependencies": {
        "asynckit": "^0.4.0",
        "combined-stream": "^1.0.8",
        "es-set-tostringtag": "^2.1.0",
        "hasown": "^2.0.2",
        "mime-types": "^2.1.12"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/form-data/node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "dev": true,
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/form-data/node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "dev": true,
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/forwarded": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/forwarded/-/forwarded-0.2.0.tgz",
      "integrity": "sha512-buRG0fpBtRHSTCOASe6hD258tEubFoRLb4ZNA6NxMVHNw2gOcwHo9wyablzMzOA5z9xA9L1KNjk/Nt6MT9aYow==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/fresh": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/fresh/-/fresh-2.0.0.tgz",
      "integrity": "sha512-Rx/WycZ60HOaqLKAi6cHRKKI7zxWbJ31MhntmtwMoaTeF7XFH9hhBp8vITaMidfljRQ6eYWCKkaTK+ykVJHP2A==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/fs-constants": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/fs-constants/-/fs-constants-1.0.0.tgz",
      "integrity": "sha512-y6OAwoSIf7FyjMIv94u+b5rdheZEjzR63GTyZJm5qh4Bi+2YgwLCcI/fPFZkL5PSixOt6ZNKm+w+Hfp/Bciwow==",
      "dev": true,
      "peer": true
    },
    "node_modules/fs-extra": {
      "version": "8.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-8.1.0.tgz",
      "integrity": "sha512-yhlQgA6mnOJUKOsRUFsgJdQCvkKhcz8tlZG5HBQfReYZy46OwLcY+Zia0mtdHsOo9y/hP+CxMN0TU9QxoOtG4g==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^4.0.0",
        "universalify": "^0.1.0"
      },
      "engines": {
        "node": ">=6 <7 || >=8"
      }
    },
    "node_modules/fs-minipass": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/fs-minipass/-/fs-minipass-2.1.0.tgz",
      "integrity": "sha512-V/JgOLFCS+R6Vcq0slCuaeWEdNC3ouDlJMNIsacH2VtALiu9mV4LPrHc5cDl8k5aw6J8jwgWWpiTo5RYhmIzvg==",
      "dev": true,
      "dependencies": {
        "minipass": "^3.0.0"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/fs-minipass/node_modules/minipass": {
      "version": "3.3.6",
      "resolved": "https://registry.npmjs.org/minipass/-/minipass-3.3.6.tgz",
      "integrity": "sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw==",
      "dev": true,
      "dependencies": {
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/fs.realpath": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/fs.realpath/-/fs.realpath-1.0.0.tgz",
      "integrity": "sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==",
      "dev": true
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-caller-file": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/get-caller-file/-/get-caller-file-2.0.5.tgz",
      "integrity": "sha512-DyFP3BM/3YHTQOCUL/w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==",
      "dev": true,
      "engines": {
        "node": "6.* || 8.* || >= 10.*"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/get-stream": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/get-stream/-/get-stream-5.2.0.tgz",
      "integrity": "sha512-nBF+F1rAZVCu/p7rjzgA+Yb4lfYXrpl7a6VmJrU8wF9I1CKvP/QwPNZHnOlwbTkY6dvtFIzFMSyQXbLoTQPRpA==",
      "dev": true,
      "dependencies": {
        "pump": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/glob": {
      "version": "7.2.3",
      "resolved": "https://registry.npmjs.org/glob/-/glob-7.2.3.tgz",
      "integrity": "sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==",
      "deprecated": "Glob versions prior to v9 are no longer supported",
      "dev": true,
      "dependencies": {
        "fs.realpath": "^1.0.0",
        "inflight": "^1.0.4",
        "inherits": "2",
        "minimatch": "^3.1.1",
        "once": "^1.3.0",
        "path-is-absolute": "^1.0.0"
      },
      "engines": {
        "node": "*"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/glob/node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "dev": true,
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/glob/node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "dev": true,
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/global-agent": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/global-agent/-/global-agent-3.0.0.tgz",
      "integrity": "sha512-PT6XReJ+D07JvGoxQMkT6qji/jVNfX/h364XHZOWeRzy64sSFr+xJ5OX7LI3b4MPQzdL4H8Y8M0xzPpsVMwA8Q==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "boolean": "^3.0.1",
        "es6-error": "^4.1.1",
        "matcher": "^3.0.0",
        "roarr": "^2.15.3",
        "semver": "^7.3.2",
        "serialize-error": "^7.0.1"
      },
      "engines": {
        "node": ">=10.0"
      }
    },
    "node_modules/global-agent/node_modules/semver": {
      "version": "7.7.3",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.3.tgz",
      "integrity": "sha512-SdsKMrI9TdgjdweUSR9MweHA4EJ8YxHn8DFaDisvhVlUOe4BF1tLD7GAj0lIqWVl+dPb/rExr0Btby5loQm20Q==",
      "dev": true,
      "optional": true,
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/globalthis": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/globalthis/-/globalthis-1.0.4.tgz",
      "integrity": "sha512-DpLKbNU4WylpxJykQujfCcwYWiV/Jhm50Goo0wrVILAv5jOr9d+H+UR3PhSCD2rCCEIg0uc+G+muBTwD54JhDQ==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "define-properties": "^1.2.1",
        "gopd": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/got": {
      "version": "11.8.6",
      "resolved": "https://registry.npmjs.org/got/-/got-11.8.6.tgz",
      "integrity": "sha512-6tfZ91bOr7bOXnK7PRDCGBLa1H4U080YHNaAQ2KsMGlLEzRbk44nsZF2E1IeRc3vtJHPVbKCYgdFbaGO2ljd8g==",
      "dev": true,
      "dependencies": {
        "@sindresorhus/is": "^4.0.0",
        "@szmarczak/http-timer": "^4.0.5",
        "@types/cacheable-request": "^6.0.1",
        "@types/responselike": "^1.0.0",
        "cacheable-lookup": "^5.0.3",
        "cacheable-request": "^7.0.2",
        "decompress-response": "^6.0.0",
        "http2-wrapper": "^1.0.0-beta.5.2",
        "lowercase-keys": "^2.0.0",
        "p-cancelable": "^2.0.0",
        "responselike": "^2.0.0"
      },
      "engines": {
        "node": ">=10.19.0"
      },
      "funding": {
        "url": "https://github.com/sindresorhus/got?sponsor=1"
      }
    },
    "node_modules/graceful-fs": {
      "version": "4.2.11",
      "resolved": "https://registry.npmjs.org/graceful-fs/-/graceful-fs-4.2.11.tgz",
      "integrity": "sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==",
      "dev": true
    },
    "node_modules/has-flag": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz",
      "integrity": "sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/has-property-descriptors": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-property-descriptors/-/has-property-descriptors-1.0.2.tgz",
      "integrity": "sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "es-define-property": "^1.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-tostringtag": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz",
      "integrity": "sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==",
      "dev": true,
      "dependencies": {
        "has-symbols": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/hosted-git-info": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-4.1.0.tgz",
      "integrity": "sha512-kyCuEOWjJqZuDbRHzL8V93NzQhwIB71oFWSyzVo+KPZI+pnQPPxucdkrOZvkLRnrf5URsQM+IJ09Dw29cRALIA==",
      "dev": true,
      "dependencies": {
        "lru-cache": "^6.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/http-cache-semantics": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/http-cache-semantics/-/http-cache-semantics-4.2.0.tgz",
      "integrity": "sha512-dTxcvPXqPvXBQpq5dUr6mEMJX4oIEFv6bwom3FDwKRDsuIjjJGANqhBuoAn9c1RQJIdAKav33ED65E2ys+87QQ==",
      "dev": true
    },
    "node_modules/http-errors": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.1.tgz",
      "integrity": "sha512-4FbRdAX+bSdmo4AUFuS0WNiPz8NgFt+r8ThgNWmlrjQjt1Q7ZR9+zTlce2859x4KSXrwIsaeTqDoKQmtP8pLmQ==",
      "dependencies": {
        "depd": "~2.0.0",
        "inherits": "~2.0.4",
        "setprototypeof": "~1.2.0",
        "statuses": "~2.0.2",
        "toidentifier": "~1.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/http-proxy-agent": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/http-proxy-agent/-/http-proxy-agent-5.0.0.tgz",
      "integrity": "sha512-n2hY8YdoRE1i7r6M0w9DIw5GgZN0G25P8zLCRQ8rjXtTU3vsNFBI/vWK/UIeE6g5MUUz6avwAPXmL6Fy9D/90w==",
      "dev": true,
      "dependencies": {
        "@tootallnate/once": "2",
        "agent-base": "6",
        "debug": "4"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/http2-wrapper": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/http2-wrapper/-/http2-wrapper-1.0.3.tgz",
      "integrity": "sha512-V+23sDMr12Wnz7iTcDeJr3O6AIxlnvT/bmaAAAP/Xda35C90p9599p0F1eHR/N1KILWSoWVAiOMFjBBXaXSMxg==",
      "dev": true,
      "dependencies": {
        "quick-lru": "^5.1.1",
        "resolve-alpn": "^1.0.0"
      },
      "engines": {
        "node": ">=10.19.0"
      }
    },
    "node_modules/https-proxy-agent": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/https-proxy-agent/-/https-proxy-agent-5.0.1.tgz",
      "integrity": "sha512-dFcAjpTQFgoLMzC2VwU+C/CbS7uRL0lWmxDITmqm7C+7F0Odmj6s9l6alZc6AELXhrnggM2CeWSXHGOdX2YtwA==",
      "dev": true,
      "dependencies": {
        "agent-base": "6",
        "debug": "4"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/iconv-corefoundation": {
      "version": "1.1.7",
      "resolved": "https://registry.npmjs.org/iconv-corefoundation/-/iconv-corefoundation-1.1.7.tgz",
      "integrity": "sha512-T10qvkw0zz4wnm560lOEg0PovVqUXuOFhhHAkixw8/sycy7TJt7v/RrkEKEQnAw2viPSJu6iAkErxnzR0g8PpQ==",
      "dev": true,
      "optional": true,
      "os": [
        "darwin"
      ],
      "dependencies": {
        "cli-truncate": "^2.1.0",
        "node-addon-api": "^1.6.3"
      },
      "engines": {
        "node": "^8.11.2 || >=10"
      }
    },
    "node_modules/iconv-lite": {
      "version": "0.6.3",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.6.3.tgz",
      "integrity": "sha512-4fCk79wshMdzMp2rH06qWrJE4iolqLhCUH+OiuIgU++RB0+94NlDL81atO7GX55uUKueo0txHNtvEyI6D7WdMw==",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3.0.0"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/ieee754": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/ieee754/-/ieee754-1.2.1.tgz",
      "integrity": "sha512-dcyqhDvX1C46lXZcVqCpK+FtMRQVdIMN6/Df5js2zouUsqG7I6sFxitIC+7KYK29KdXOLHdu9zL4sFnoVQnqaA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ]
    },
    "node_modules/inflight": {
      "version": "1.0.6",
      "resolved": "https://registry.npmjs.org/inflight/-/inflight-1.0.6.tgz",
      "integrity": "sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==",
      "deprecated": "This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.",
      "dev": true,
      "dependencies": {
        "once": "^1.3.0",
        "wrappy": "1"
      }
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ=="
    },
    "node_modules/ipaddr.js": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/ipaddr.js/-/ipaddr.js-1.9.1.tgz",
      "integrity": "sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g==",
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/is-ci": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/is-ci/-/is-ci-3.0.1.tgz",
      "integrity": "sha512-ZYvCgrefwqoQ6yTyYUbQu64HsITZ3NfKX1lzaEYdkTDcfKzzCI/wthRRYKkdjHKFVgNiXKAKm65Zo1pk2as/QQ==",
      "dev": true,
      "dependencies": {
        "ci-info": "^3.2.0"
      },
      "bin": {
        "is-ci": "bin.js"
      }
    },
    "node_modules/is-fullwidth-code-point": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-3.0.0.tgz",
      "integrity": "sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/is-promise": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/is-promise/-/is-promise-4.0.0.tgz",
      "integrity": "sha512-hvpoI6korhJMnej285dSg6nu1+e6uxs7zG3BYAm5byqDsgJNWwxzM6z6iZiAgQR4TJ30JmBTOwqZUw3WlyH3AQ=="
    },
    "node_modules/isarray": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-1.0.0.tgz",
      "integrity": "sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==",
      "dev": true,
      "peer": true
    },
    "node_modules/isbinaryfile": {
      "version": "5.0.7",
      "resolved": "https://registry.npmjs.org/isbinaryfile/-/isbinaryfile-5.0.7.tgz",
      "integrity": "sha512-gnWD14Jh3FzS3CPhF0AxNOJ8CxqeblPTADzI38r0wt8ZyQl5edpy75myt08EG2oKvpyiqSqsx+Wkz9vtkbTqYQ==",
      "dev": true,
      "engines": {
        "node": ">= 18.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/gjtorikian/"
      }
    },
    "node_modules/isexe": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
      "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
      "dev": true
    },
    "node_modules/jackspeak": {
      "version": "3.4.3",
      "resolved": "https://registry.npmjs.org/jackspeak/-/jackspeak-3.4.3.tgz",
      "integrity": "sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==",
      "dev": true,
      "dependencies": {
        "@isaacs/cliui": "^8.0.2"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      },
      "optionalDependencies": {
        "@pkgjs/parseargs": "^0.11.0"
      }
    },
    "node_modules/jake": {
      "version": "10.9.4",
      "resolved": "https://registry.npmjs.org/jake/-/jake-10.9.4.tgz",
      "integrity": "sha512-wpHYzhxiVQL+IV05BLE2Xn34zW1S223hvjtqk0+gsPrwd/8JNLXJgZZM/iPFsYc1xyphF+6M6EvdE5E9MBGkDA==",
      "dev": true,
      "dependencies": {
        "async": "^3.2.6",
        "filelist": "^1.0.4",
        "picocolors": "^1.1.1"
      },
      "bin": {
        "jake": "bin/cli.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/js-yaml": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.1.tgz",
      "integrity": "sha512-qQKT4zQxXl8lLwBtHMWwaTcGfFOZviOJet3Oy/xmGk2gZH677CJM9EvtfdSkgWcATZhj/55JZ0rmy3myCT5lsA==",
      "dev": true,
      "dependencies": {
        "argparse": "^2.0.1"
      },
      "bin": {
        "js-yaml": "bin/js-yaml.js"
      }
    },
    "node_modules/json-buffer": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz",
      "integrity": "sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==",
      "dev": true
    },
    "node_modules/json-schema-traverse": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",
      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",
      "dev": true
    },
    "node_modules/json-stringify-safe": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/json-stringify-safe/-/json-stringify-safe-5.0.1.tgz",
      "integrity": "sha512-ZClg6AaYvamvYEE82d3Iyd3vSSIjQ+odgjaTzRuO3s7toCdFKczob2i0zCh7JE8kWn17yvAWhUVxvqGwUalsRA==",
      "dev": true,
      "optional": true
    },
    "node_modules/json5": {
      "version": "2.2.3",
      "resolved": "https://registry.npmjs.org/json5/-/json5-2.2.3.tgz",
      "integrity": "sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==",
      "dev": true,
      "bin": {
        "json5": "lib/cli.js"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/jsonfile": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-4.0.0.tgz",
      "integrity": "sha512-m6F1R3z8jjlf2imQHS2Qez5sjKWQzbuuhuJ/FKYFRZvPE3PuHcSMVZzfsLhGVOkfd20obL5SWEBew5ShlquNxg==",
      "dev": true,
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/keyv": {
      "version": "4.5.4",
      "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
      "integrity": "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==",
      "dev": true,
      "dependencies": {
        "json-buffer": "3.0.1"
      }
    },
    "node_modules/lazy-val": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/lazy-val/-/lazy-val-1.0.5.tgz",
      "integrity": "sha512-0/BnGCCfyUMkBpeDgWihanIAF9JmZhHBgUhEqzvf+adhNGLoP6TaiI5oF8oyb3I45P+PcnrqihSf01M0l0G5+Q==",
      "dev": true
    },
    "node_modules/lazystream": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/lazystream/-/lazystream-1.0.1.tgz",
      "integrity": "sha512-b94GiNHQNy6JNTrt5w6zNyffMrNkXZb3KTkCZJb2V1xaEGCk093vkZ2jk3tpaeP33/OiXC+WvK9AxUebnf5nbw==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "readable-stream": "^2.0.5"
      },
      "engines": {
        "node": ">= 0.6.3"
      }
    },
    "node_modules/lazystream/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/lazystream/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "dev": true,
      "peer": true
    },
    "node_modules/lazystream/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/lodash": {
      "version": "4.17.21",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz",
      "integrity": "sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==",
      "dev": true
    },
    "node_modules/lodash.defaults": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/lodash.defaults/-/lodash.defaults-4.2.0.tgz",
      "integrity": "sha512-qjxPLHd3r5DnsdGacqOMU6pb/avJzdh9tFX2ymgoZE27BmjXrNy/y4LoaiTeAb+O3gL8AfpJGtqfX/ae2leYYQ==",
      "dev": true,
      "peer": true
    },
    "node_modules/lodash.difference": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/lodash.difference/-/lodash.difference-4.5.0.tgz",
      "integrity": "sha512-dS2j+W26TQ7taQBGN8Lbbq04ssV3emRw4NY58WErlTO29pIqS0HmoT5aJ9+TUQ1N3G+JOZSji4eugsWwGp9yPA==",
      "dev": true,
      "peer": true
    },
    "node_modules/lodash.flatten": {
      "version": "4.4.0",
      "resolved": "https://registry.npmjs.org/lodash.flatten/-/lodash.flatten-4.4.0.tgz",
      "integrity": "sha512-C5N2Z3DgnnKr0LOpv/hKCgKdb7ZZwafIrsesve6lmzvZIRZRGaZ/l6Q8+2W7NaT+ZwO3fFlSCzCzrDCFdJfZ4g==",
      "dev": true,
      "peer": true
    },
    "node_modules/lodash.isplainobject": {
      "version": "4.0.6",
      "resolved": "https://registry.npmjs.org/lodash.isplainobject/-/lodash.isplainobject-4.0.6.tgz",
      "integrity": "sha512-oSXzaWypCMHkPC3NvBEaPHf0KsA5mvPrOPgQWDsbg8n7orZ290M0BmC/jgRZ4vcJ6DTAhjrsSYgdsW/F+MFOBA==",
      "dev": true,
      "peer": true
    },
    "node_modules/lodash.union": {
      "version": "4.6.0",
      "resolved": "https://registry.npmjs.org/lodash.union/-/lodash.union-4.6.0.tgz",
      "integrity": "sha512-c4pB2CdGrGdjMKYLA+XiRDO7Y0PRQbm/Gzg8qMj+QH+pFVAoTp5sBpO0odL3FjoPCGjK96p6qsP+yQoiLoOBcw==",
      "dev": true,
      "peer": true
    },
    "node_modules/lowercase-keys": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/lowercase-keys/-/lowercase-keys-2.0.0.tgz",
      "integrity": "sha512-tqNXrS78oMOE73NMxK4EMLQsQowWf8jKooH9g7xPavRT706R6bkQJ6DY2Te7QukaZsulxa30wQ7bk0pm4XiHmA==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/lru-cache": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-6.0.0.tgz",
      "integrity": "sha512-Jo6dJ04CmSjuznwJSS3pUeWmd/H0ffTlkXXgwZi+eq1UCmqQwCh+eLsYOYCwY991i2Fah4h1BEMCx4qThGbsiA==",
      "dev": true,
      "dependencies": {
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/matcher": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/matcher/-/matcher-3.0.0.tgz",
      "integrity": "sha512-OkeDaAZ/bQCxeFAozM55PKcKU0yJMPGifLwV4Qgjitu+5MoAfSQN4lsLJeXZ1b8w0x+/Emda6MZgXS1jvsapng==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "escape-string-regexp": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/media-typer": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/media-typer/-/media-typer-1.1.0.tgz",
      "integrity": "sha512-aisnrDP4GNe06UcKFnV5bfMNPBUw4jsLGaWwWfnH3v02GnBuXX2MCVn5RbrWo0j3pczUilYblq7fQ7Nw2t5XKw==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/merge-descriptors": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-2.0.0.tgz",
      "integrity": "sha512-Snk314V5ayFLhp3fkUREub6WtjBfPdCPY1Ln8/8munuLuiYhsABgBVWsozAG+MWMbVEvcdcpbi9R7ww22l9Q3g==",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/mime": {
      "version": "2.6.0",
      "resolved": "https://registry.npmjs.org/mime/-/mime-2.6.0.tgz",
      "integrity": "sha512-USPkMeET31rOMiarsBNIHZKLGgvKc/LrjofAnBlOttf5ajRvqiRA8QsenbcooctK6d6Ts6aqZXBA+XbkKthiQg==",
      "dev": true,
      "bin": {
        "mime": "cli.js"
      },
      "engines": {
        "node": ">=4.0.0"
      }
    },
    "node_modules/mime-db": {
      "version": "1.54.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.54.0.tgz",
      "integrity": "sha512-aU5EJuIN2WDemCcAp2vFBfp/m4EAhWJnUNSSw0ixs7/kXbd6Pg64EmwJkNdFhB8aWt1sH2CTXrLxo/iAGV3oPQ==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-3.0.2.tgz",
      "integrity": "sha512-Lbgzdk0h4juoQ9fCKXW4by0UJqj+nOOrI9MJ1sSj4nI8aI2eo1qmvQEie4VD1glsS250n15LsWsYtCugiStS5A==",
      "dependencies": {
        "mime-db": "^1.54.0"
      },
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/mimic-response": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/mimic-response/-/mimic-response-1.0.1.tgz",
      "integrity": "sha512-j5EctnkH7amfV/q5Hgmoal1g2QHFJRraOtmx0JpIqkxhBhI/lJSl1nMpQ45hVarwNETOoWEimndZ4QK0RHxuxQ==",
      "dev": true,
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/minimatch": {
      "version": "5.1.6",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-5.1.6.tgz",
      "integrity": "sha512-lKwV/1brpG6mBUFHtb7NUmtABCb2WZZmm2wNiOA5hAb8VdCS4B3dtMWyvcoViccwAW/COERjXLt0zP1zXUN26g==",
      "dev": true,
      "dependencies": {
        "brace-expansion": "^2.0.1"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/minimist": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/minimist/-/minimist-1.2.8.tgz",
      "integrity": "sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==",
      "dev": true,
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/minipass": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/minipass/-/minipass-5.0.0.tgz",
      "integrity": "sha512-3FnjYuehv9k6ovOEbyOswadCDPX1piCfhV8ncmYtHOjuPwylVWsghTLo7rabjC3Rx5xD4HDx8Wm1xnMF7S5qFQ==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/minizlib": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/minizlib/-/minizlib-2.1.2.tgz",
      "integrity": "sha512-bAxsR8BVfj60DWXHE3u30oHzfl4G7khkSuPW+qvpd7jFRHm7dLxOjUk1EHACJ/hxLY8phGJ0YhYHZo7jil7Qdg==",
      "dev": true,
      "dependencies": {
        "minipass": "^3.0.0",
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/minizlib/node_modules/minipass": {
      "version": "3.3.6",
      "resolved": "https://registry.npmjs.org/minipass/-/minipass-3.3.6.tgz",
      "integrity": "sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw==",
      "dev": true,
      "dependencies": {
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/mkdirp": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/mkdirp/-/mkdirp-1.0.4.tgz",
      "integrity": "sha512-vVqVZQyf3WLx2Shd0qJ9xuvqgAyKPLAiqITEtqW0oIUjzo3PePDd6fW9iFz30ef7Ysp/oiWqbhszeGWW2T6Gzw==",
      "dev": true,
      "bin": {
        "mkdirp": "bin/cmd.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA=="
    },
    "node_modules/negotiator": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-1.0.0.tgz",
      "integrity": "sha512-8Ofs/AUQh8MaEcrlq5xOX0CQ9ypTF5dl78mjlMNfOK08fzpgTHQRQPBxcPlEtIw0yRpws+Zo/3r+5WRby7u3Gg==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/node-addon-api": {
      "version": "1.7.2",
      "resolved": "https://registry.npmjs.org/node-addon-api/-/node-addon-api-1.7.2.tgz",
      "integrity": "sha512-ibPK3iA+vaY1eEjESkQkM0BbCqFOaZMiXRTtdB0u7b4djtY6JnsjvPdUHVMg6xQt3B8fpTTWHI9A+ADjM9frzg==",
      "dev": true,
      "optional": true
    },
    "node_modules/normalize-path": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/normalize-path/-/normalize-path-3.0.0.tgz",
      "integrity": "sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==",
      "dev": true,
      "peer": true,
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/normalize-url": {
      "version": "6.1.0",
      "resolved": "https://registry.npmjs.org/normalize-url/-/normalize-url-6.1.0.tgz",
      "integrity": "sha512-DlL+XwOy3NxAQ8xuC0okPgK46iuVNAK01YN7RueYBqqFeGsBjV9XmCAzAdgt+667bCl5kPh9EqKKDwnaPG1I7A==",
      "dev": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object-keys": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/object-keys/-/object-keys-1.1.1.tgz",
      "integrity": "sha512-NuAESUOUMrlIXOfHKzD6bpPu3tYt3xvjNdRIQ+FeT0lNb4K8WR70CaDxhuNguS2XG+GjkyMwOzsN5ZktImfhLA==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/on-finished": {
      "version": "2.4.1",
      "resolved": "https://registry.npmjs.org/on-finished/-/on-finished-2.4.1.tgz",
      "integrity": "sha512-oVlzkg3ENAhCk2zdv7IJwd/QUD4z2RxRwpkcGY8psCVcCYZNq4wYnVWALHM+brtuJjePWiYF/ClmuDr8Ch5+kg==",
      "dependencies": {
        "ee-first": "1.1.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/once": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/once/-/once-1.4.0.tgz",
      "integrity": "sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==",
      "dependencies": {
        "wrappy": "1"
      }
    },
    "node_modules/p-cancelable": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/p-cancelable/-/p-cancelable-2.1.1.tgz",
      "integrity": "sha512-BZOr3nRQHOntUjTrH8+Lh54smKHoHyur8We1V8DSMVrl5A2malOOwuJRnKRDjSnkoeBh4at6BwEnb5I7Jl31wg==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/package-json-from-dist": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/package-json-from-dist/-/package-json-from-dist-1.0.1.tgz",
      "integrity": "sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==",
      "dev": true
    },
    "node_modules/parseurl": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/parseurl/-/parseurl-1.3.3.tgz",
      "integrity": "sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/path-is-absolute": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/path-is-absolute/-/path-is-absolute-1.0.1.tgz",
      "integrity": "sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==",
      "dev": true,
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/path-key": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
      "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-scurry": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/path-scurry/-/path-scurry-1.11.1.tgz",
      "integrity": "sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==",
      "dev": true,
      "dependencies": {
        "lru-cache": "^10.2.0",
        "minipass": "^5.0.0 || ^6.0.2 || ^7.0.0"
      },
      "engines": {
        "node": ">=16 || 14 >=14.18"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/path-scurry/node_modules/lru-cache": {
      "version": "10.4.3",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-10.4.3.tgz",
      "integrity": "sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==",
      "dev": true
    },
    "node_modules/path-to-regexp": {
      "version": "8.3.0",
      "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-8.3.0.tgz",
      "integrity": "sha512-7jdwVIRtsP8MYpdXSwOS0YdD0Du+qOoF/AEPIt88PcCFrZCzx41oxku1jD88hZBwbNUIEfpqvuhjFaMAqMTWnA==",
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/pend": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/pend/-/pend-1.2.0.tgz",
      "integrity": "sha512-F3asv42UuXchdzt+xXqfW1OGlVBe+mxa2mqI0pg5yAHZPvFmY3Y6drSf/GQ1A86WgWEN9Kzh/WrgKa6iGcHXLg==",
      "dev": true
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "dev": true
    },
    "node_modules/plist": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/plist/-/plist-3.1.0.tgz",
      "integrity": "sha512-uysumyrvkUX0rX/dEVqt8gC3sTBzd4zoWfLeS29nb53imdaXVvLINYXTI2GNqzaMuvacNx4uJQ8+b3zXR0pkgQ==",
      "dev": true,
      "dependencies": {
        "@xmldom/xmldom": "^0.8.8",
        "base64-js": "^1.5.1",
        "xmlbuilder": "^15.1.1"
      },
      "engines": {
        "node": ">=10.4.0"
      }
    },
    "node_modules/process-nextick-args": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/process-nextick-args/-/process-nextick-args-2.0.1.tgz",
      "integrity": "sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==",
      "dev": true,
      "peer": true
    },
    "node_modules/progress": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/progress/-/progress-2.0.3.tgz",
      "integrity": "sha512-7PiHtLll5LdnKIMw100I+8xJXR5gW2QwWYkT6iJva0bXitZKa/XMrSbdmg3r2Xnaidz9Qumd0VPaMrZlF9V9sA==",
      "dev": true,
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/promise-retry": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/promise-retry/-/promise-retry-2.0.1.tgz",
      "integrity": "sha512-y+WKFlBR8BGXnsNlIHFGPZmyDf3DFMoLhaflAnyZgV6rG6xu+JwesTo2Q9R6XwYmtmwAFCkAk3e35jEdoeh/3g==",
      "dev": true,
      "dependencies": {
        "err-code": "^2.0.2",
        "retry": "^0.12.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/proxy-addr": {
      "version": "2.0.7",
      "resolved": "https://registry.npmjs.org/proxy-addr/-/proxy-addr-2.0.7.tgz",
      "integrity": "sha512-llQsMLSUDUPT44jdrU/O37qlnifitDP+ZwrmmZcoSKyLKvtZxpyV0n2/bD/N4tBAAZ/gJEdZU7KMraoK1+XYAg==",
      "dependencies": {
        "forwarded": "0.2.0",
        "ipaddr.js": "1.9.1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/pump": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/pump/-/pump-3.0.3.tgz",
      "integrity": "sha512-todwxLMY7/heScKmntwQG8CXVkWUOdYxIvY2s0VWAAMh/nd8SoYiRaKjlr7+iCs984f2P8zvrfWcDDYVb73NfA==",
      "dev": true,
      "dependencies": {
        "end-of-stream": "^1.1.0",
        "once": "^1.3.1"
      }
    },
    "node_modules/punycode": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/punycode/-/punycode-2.3.1.tgz",
      "integrity": "sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==",
      "dev": true,
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/qs": {
      "version": "6.14.0",
      "resolved": "https://registry.npmjs.org/qs/-/qs-6.14.0.tgz",
      "integrity": "sha512-YWWTjgABSKcvs/nWBi9PycY/JiPJqOD4JA6o9Sej2AtvSGarXxKC3OQSk4pAarbdQlKAh5D4FCQkJNkW+GAn3w==",
      "dependencies": {
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">=0.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/quick-lru": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/quick-lru/-/quick-lru-5.1.1.tgz",
      "integrity": "sha512-WuyALRjWPDGtt/wzJiadO5AXY+8hZ80hVpe6MyivgraREW751X3SbhRvG3eLKOYN+8VEvqLcf3wdnt44Z4S4SA==",
      "dev": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/range-parser": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/range-parser/-/range-parser-1.2.1.tgz",
      "integrity": "sha512-Hrgsx+orqoygnmhFbKaHE6c296J+HTAQXoxEF6gNupROmmGJRoyzfG3ccAveqCBrwr/2yxQ5BVd/GTl5agOwSg==",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/raw-body": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/raw-body/-/raw-body-3.0.2.tgz",
      "integrity": "sha512-K5zQjDllxWkf7Z5xJdV0/B0WTNqx6vxG70zJE4N0kBs4LovmEYWJzQGxC9bS9RAKu3bgM40lrd5zoLJ12MQ5BA==",
      "dependencies": {
        "bytes": "~3.1.2",
        "http-errors": "~2.0.1",
        "iconv-lite": "~0.7.0",
        "unpipe": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/raw-body/node_modules/iconv-lite": {
      "version": "0.7.0",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.7.0.tgz",
      "integrity": "sha512-cf6L2Ds3h57VVmkZe+Pn+5APsT7FpqJtEhhieDCvrE2MK5Qk9MyffgQyuxQTm6BChfeZNtcOLHp9IcWRVcIcBQ==",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3.0.0"
      },
      "engines": {
        "node": ">=0.10.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/read-config-file": {
      "version": "6.3.2",
      "resolved": "https://registry.npmjs.org/read-config-file/-/read-config-file-6.3.2.tgz",
      "integrity": "sha512-M80lpCjnE6Wt6zb98DoW8WHR09nzMSpu8XHtPkiTHrJ5Az9CybfeQhTJ8D7saeBHpGhLPIVyA8lcL6ZmdKwY6Q==",
      "dev": true,
      "dependencies": {
        "config-file-ts": "^0.2.4",
        "dotenv": "^9.0.2",
        "dotenv-expand": "^5.1.0",
        "js-yaml": "^4.1.0",
        "json5": "^2.2.0",
        "lazy-val": "^1.0.4"
      },
      "engines": {
        "node": ">=12.0.0"
      }
    },
    "node_modules/readable-stream": {
      "version": "3.6.2",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-3.6.2.tgz",
      "integrity": "sha512-9u/sniCrY3D5WdsERHzHE4G2YCXqoG5FTHUiCC4SIbr6XcLZBY05ya9EKjYek9O5xOAwjGq+1JdGBAS7Q9ScoA==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "inherits": "^2.0.3",
        "string_decoder": "^1.1.1",
        "util-deprecate": "^1.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/readdir-glob": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/readdir-glob/-/readdir-glob-1.1.3.tgz",
      "integrity": "sha512-v05I2k7xN8zXvPD9N+z/uhXPaj0sUFCe2rcWZIpBsqxfP7xXFQ0tipAd/wjj1YxWyWtUS5IDJpOG82JKt2EAVA==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "minimatch": "^5.1.0"
      }
    },
    "node_modules/require-directory": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/require-directory/-/require-directory-2.1.1.tgz",
      "integrity": "sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC/PQr7RsRDSTLUg/bZAZtF+TVIkHc6/4RIKrui+Q==",
      "dev": true,
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/resolve-alpn": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/resolve-alpn/-/resolve-alpn-1.2.1.tgz",
      "integrity": "sha512-0a1F4l73/ZFZOakJnQ3FvkJ2+gSTQWz/r2KE5OdDY0TxPm5h4GkqkWWfM47T7HsbnOtcJVEF4epCVy6u7Q3K+g==",
      "dev": true
    },
    "node_modules/responselike": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/responselike/-/responselike-2.0.1.tgz",
      "integrity": "sha512-4gl03wn3hj1HP3yzgdI7d3lCkF95F21Pz4BPGvKHinyQzALR5CapwC8yIi0Rh58DEMQ/SguC03wFj2k0M/mHhw==",
      "dev": true,
      "dependencies": {
        "lowercase-keys": "^2.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/retry": {
      "version": "0.12.0",
      "resolved": "https://registry.npmjs.org/retry/-/retry-0.12.0.tgz",
      "integrity": "sha512-9LkiTwjUh6rT555DtE9rTX+BKByPfrMzEAtnlEtdEwr3Nkffwiihqe2bWADg+OQRjt9gl6ICdmB/ZFDCGAtSow==",
      "dev": true,
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/roarr": {
      "version": "2.15.4",
      "resolved": "https://registry.npmjs.org/roarr/-/roarr-2.15.4.tgz",
      "integrity": "sha512-CHhPh+UNHD2GTXNYhPWLnU8ONHdI+5DI+4EYIAOaiD63rHeYlZvyh8P+in5999TTSFgUYuKUAjzRI4mdh/p+2A==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "boolean": "^3.0.1",
        "detect-node": "^2.0.4",
        "globalthis": "^1.0.1",
        "json-stringify-safe": "^5.0.1",
        "semver-compare": "^1.0.0",
        "sprintf-js": "^1.1.2"
      },
      "engines": {
        "node": ">=8.0"
      }
    },
    "node_modules/router": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/router/-/router-2.2.0.tgz",
      "integrity": "sha512-nLTrUKm2UyiL7rlhapu/Zl45FwNgkZGaCpZbIHajDYgwlJCOzLSk+cIPAnsEqV955GjILJnKbdQC1nVPz+gAYQ==",
      "dependencies": {
        "debug": "^4.4.0",
        "depd": "^2.0.0",
        "is-promise": "^4.0.0",
        "parseurl": "^1.3.3",
        "path-to-regexp": "^8.0.0"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "peer": true
    },
    "node_modules/safer-buffer": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz",
      "integrity": "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg=="
    },
    "node_modules/sanitize-filename": {
      "version": "1.6.3",
      "resolved": "https://registry.npmjs.org/sanitize-filename/-/sanitize-filename-1.6.3.tgz",
      "integrity": "sha512-y/52Mcy7aw3gRm7IrcGDFx/bCk4AhRh2eI9luHOQM86nZsqwiRkkq2GekHXBBD+SmPidc8i2PqtYZl+pWJ8Oeg==",
      "dev": true,
      "dependencies": {
        "truncate-utf8-bytes": "^1.0.0"
      }
    },
    "node_modules/sax": {
      "version": "1.4.3",
      "resolved": "https://registry.npmjs.org/sax/-/sax-1.4.3.tgz",
      "integrity": "sha512-yqYn1JhPczigF94DMS+shiDMjDowYO6y9+wB/4WgO0Y19jWYk0lQ4tuG5KI7kj4FTp1wxPj5IFfcrz/s1c3jjQ==",
      "dev": true
    },
    "node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/semver-compare": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/semver-compare/-/semver-compare-1.0.0.tgz",
      "integrity": "sha512-YM3/ITh2MJ5MtzaM429anh+x2jiLVjqILF4m4oyQB18W7Ggea7BfqdH/wGMK7dDiMghv/6WG7znWMwUDzJiXow==",
      "dev": true,
      "optional": true
    },
    "node_modules/send": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/send/-/send-1.2.0.tgz",
      "integrity": "sha512-uaW0WwXKpL9blXE2o0bRhoL2EGXIrZxQ2ZQ4mgcfoBxdFmQold+qWsD2jLrfZ0trjKL6vOw0j//eAwcALFjKSw==",
      "dependencies": {
        "debug": "^4.3.5",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "mime-types": "^3.0.1",
        "ms": "^2.1.3",
        "on-finished": "^2.4.1",
        "range-parser": "^1.2.1",
        "statuses": "^2.0.1"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/serialize-error": {
      "version": "7.0.1",
      "resolved": "https://registry.npmjs.org/serialize-error/-/serialize-error-7.0.1.tgz",
      "integrity": "sha512-8I8TjW5KMOKsZQTvoxjuSIa7foAwPWGOts+6o7sgjz41/qMD9VQHEDxi6PBvK2l0MXUmqZyNpUK+T2tQaaElvw==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "type-fest": "^0.13.1"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/serve-static": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/serve-static/-/serve-static-2.2.0.tgz",
      "integrity": "sha512-61g9pCh0Vnh7IutZjtLGGpTA355+OPn2TyDv/6ivP2h/AdAVX9azsoxmg2/M6nZeQZNYBEwIcsne1mJd9oQItQ==",
      "dependencies": {
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "parseurl": "^1.3.3",
        "send": "^1.2.0"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/setprototypeof": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/setprototypeof/-/setprototypeof-1.2.0.tgz",
      "integrity": "sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw=="
    },
    "node_modules/shebang-command": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
      "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
      "dev": true,
      "dependencies": {
        "shebang-regex": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/shebang-regex": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
      "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
      "dev": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/signal-exit": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/signal-exit/-/signal-exit-4.1.0.tgz",
      "integrity": "sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==",
      "dev": true,
      "engines": {
        "node": ">=14"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/simple-update-notifier": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/simple-update-notifier/-/simple-update-notifier-2.0.0.tgz",
      "integrity": "sha512-a2B9Y0KlNXl9u/vsW6sTIu9vGEpfKu2wRV6l1H3XEas/0gUIzGzBoP/IouTcUQbm9JWZLH3COxyn03TYlFax6w==",
      "dev": true,
      "dependencies": {
        "semver": "^7.5.3"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/simple-update-notifier/node_modules/semver": {
      "version": "7.7.3",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.3.tgz",
      "integrity": "sha512-SdsKMrI9TdgjdweUSR9MweHA4EJ8YxHn8DFaDisvhVlUOe4BF1tLD7GAj0lIqWVl+dPb/rExr0Btby5loQm20Q==",
      "dev": true,
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/slice-ansi": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/slice-ansi/-/slice-ansi-3.0.0.tgz",
      "integrity": "sha512-pSyv7bSTC7ig9Dcgbw9AuRNUb5k5V6oDudjZoMBSr13qpLBG7tB+zgCkARjq7xIUgdz5P1Qe8u+rSGdouOOIyQ==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "ansi-styles": "^4.0.0",
        "astral-regex": "^2.0.0",
        "is-fullwidth-code-point": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/smart-buffer": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/smart-buffer/-/smart-buffer-4.2.0.tgz",
      "integrity": "sha512-94hK0Hh8rPqQl2xXc3HsaBoOXKV20MToPkcXvwbISWLEs+64sBq5kFgn2kJDHb1Pry9yrP0dxrCI9RRci7RXKg==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">= 6.0.0",
        "npm": ">= 3.0.0"
      }
    },
    "node_modules/source-map": {
      "version": "0.6.1",
      "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz",
      "integrity": "sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==",
      "dev": true,
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/source-map-support": {
      "version": "0.5.21",
      "resolved": "https://registry.npmjs.org/source-map-support/-/source-map-support-0.5.21.tgz",
      "integrity": "sha512-uBHU3L3czsIyYXKX88fdrGovxdSCoTGDRZ6SYXtSRxLZUzHg5P/66Ht6uoUlHu9EZod+inXhKo3qQgwXUT/y1w==",
      "dev": true,
      "dependencies": {
        "buffer-from": "^1.0.0",
        "source-map": "^0.6.0"
      }
    },
    "node_modules/sprintf-js": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/sprintf-js/-/sprintf-js-1.1.3.tgz",
      "integrity": "sha512-Oo+0REFV59/rz3gfJNKQiBlwfHaSESl1pcGyABQsnnIfWOFt6JNj5gCog2U6MLZ//IGYD+nA8nI+mTShREReaA==",
      "dev": true,
      "optional": true
    },
    "node_modules/stat-mode": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/stat-mode/-/stat-mode-1.0.0.tgz",
      "integrity": "sha512-jH9EhtKIjuXZ2cWxmXS8ZP80XyC3iasQxMDV8jzhNJpfDb7VbQLVW4Wvsxz9QZvzV+G4YoSfBUVKDOyxLzi/sg==",
      "dev": true,
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/statuses": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.2.tgz",
      "integrity": "sha512-DvEy55V3DB7uknRo+4iOGT5fP1slR8wQohVdknigZPMpMstaKJQWhwiYBACJE3Ul2pTnATihhBYnRhZQHGBiRw==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/string_decoder": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz",
      "integrity": "sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "safe-buffer": "~5.2.0"
      }
    },
    "node_modules/string-width": {
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
      "dev": true,
      "dependencies": {
        "emoji-regex": "^8.0.0",
        "is-fullwidth-code-point": "^3.0.0",
        "strip-ansi": "^6.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/string-width-cjs": {
      "name": "string-width",
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
      "dev": true,
      "dependencies": {
        "emoji-regex": "^8.0.0",
        "is-fullwidth-code-point": "^3.0.0",
        "strip-ansi": "^6.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/strip-ansi": {
      "version": "6.0.1",
      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
      "dev": true,
      "dependencies": {
        "ansi-regex": "^5.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/strip-ansi-cjs": {
      "name": "strip-ansi",
      "version": "6.0.1",
      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
      "dev": true,
      "dependencies": {
        "ansi-regex": "^5.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/sumchecker": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/sumchecker/-/sumchecker-3.0.1.tgz",
      "integrity": "sha512-MvjXzkz/BOfyVDkG0oFOtBxHX2u3gKbMHIF/dXblZsgD3BWOFLmHovIpZY7BykJdAjcqRCBi1WYBNdEC9yI7vg==",
      "dev": true,
      "dependencies": {
        "debug": "^4.1.0"
      },
      "engines": {
        "node": ">= 8.0"
      }
    },
    "node_modules/supports-color": {
      "version": "7.2.0",
      "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz",
      "integrity": "sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==",
      "dev": true,
      "dependencies": {
        "has-flag": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/tar": {
      "version": "6.2.1",
      "resolved": "https://registry.npmjs.org/tar/-/tar-6.2.1.tgz",
      "integrity": "sha512-DZ4yORTwrbTj/7MZYq2w+/ZFdI6OZ/f9SFHR+71gIVUZhOQPHzVCLpvRnPgyaMpfWxxk/4ONva3GQSyNIKRv6A==",
      "dev": true,
      "dependencies": {
        "chownr": "^2.0.0",
        "fs-minipass": "^2.0.0",
        "minipass": "^5.0.0",
        "minizlib": "^2.1.1",
        "mkdirp": "^1.0.3",
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/tar-stream": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/tar-stream/-/tar-stream-2.2.0.tgz",
      "integrity": "sha512-ujeqbceABgwMZxEJnk2HDY2DlnUZ+9oEcb1KzTVfYHio0UE6dG71n60d8D2I4qNvleWrrXpmjpt7vZeF1LnMZQ==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "bl": "^4.0.3",
        "end-of-stream": "^1.4.1",
        "fs-constants": "^1.0.0",
        "inherits": "^2.0.3",
        "readable-stream": "^3.1.1"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/temp-file": {
      "version": "3.4.0",
      "resolved": "https://registry.npmjs.org/temp-file/-/temp-file-3.4.0.tgz",
      "integrity": "sha512-C5tjlC/HCtVUOi3KWVokd4vHVViOmGjtLwIh4MuzPo/nMYTV/p1urt3RnMz2IWXDdKEGJH3k5+KPxtqRsUYGtg==",
      "dev": true,
      "dependencies": {
        "async-exit-hook": "^2.0.1",
        "fs-extra": "^10.0.0"
      }
    },
    "node_modules/temp-file/node_modules/fs-extra": {
      "version": "10.1.0",
      "resolved": "https://registry.npmjs.org/fs-extra/-/fs-extra-10.1.0.tgz",
      "integrity": "sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==",
      "dev": true,
      "dependencies": {
        "graceful-fs": "^4.2.0",
        "jsonfile": "^6.0.1",
        "universalify": "^2.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/temp-file/node_modules/jsonfile": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/jsonfile/-/jsonfile-6.2.0.tgz",
      "integrity": "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg==",
      "dev": true,
      "dependencies": {
        "universalify": "^2.0.0"
      },
      "optionalDependencies": {
        "graceful-fs": "^4.1.6"
      }
    },
    "node_modules/temp-file/node_modules/universalify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-2.0.1.tgz",
      "integrity": "sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==",
      "dev": true,
      "engines": {
        "node": ">= 10.0.0"
      }
    },
    "node_modules/tmp": {
      "version": "0.2.5",
      "resolved": "https://registry.npmjs.org/tmp/-/tmp-0.2.5.tgz",
      "integrity": "sha512-voyz6MApa1rQGUxT3E+BK7/ROe8itEx7vD8/HEvt4xwXucvQ5G5oeEiHkmHZJuBO21RpOf+YYm9MOivj709jow==",
      "dev": true,
      "engines": {
        "node": ">=14.14"
      }
    },
    "node_modules/tmp-promise": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/tmp-promise/-/tmp-promise-3.0.3.tgz",
      "integrity": "sha512-RwM7MoPojPxsOBYnyd2hy0bxtIlVrihNs9pj5SUvY8Zz1sQcQG2tG1hSr8PDxfgEB8RNKDhqbIlroIarSNDNsQ==",
      "dev": true,
      "dependencies": {
        "tmp": "^0.2.0"
      }
    },
    "node_modules/toidentifier": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",
      "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/truncate-utf8-bytes": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/truncate-utf8-bytes/-/truncate-utf8-bytes-1.0.2.tgz",
      "integrity": "sha512-95Pu1QXQvruGEhv62XCMO3Mm90GscOCClvrIUwCM0PYOXK3kaF3l3sIHxx71ThJfcbM2O5Au6SO3AWCSEfW4mQ==",
      "dev": true,
      "dependencies": {
        "utf8-byte-length": "^1.0.1"
      }
    },
    "node_modules/type-fest": {
      "version": "0.13.1",
      "resolved": "https://registry.npmjs.org/type-fest/-/type-fest-0.13.1.tgz",
      "integrity": "sha512-34R7HTnG0XIJcBSn5XhDd7nNFPRcXYRZrBB2O2jdKqYODldSzBAqzsWoZYYvduky73toYS/ESqxPvkDf/F0XMg==",
      "dev": true,
      "optional": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/type-is": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/type-is/-/type-is-2.0.1.tgz",
      "integrity": "sha512-OZs6gsjF4vMp32qrCbiVSkrFmXtG/AZhY3t0iAMrMBiAZyV9oALtXO8hsrHbMXF9x6L3grlFuwW2oAz7cav+Gw==",
      "dependencies": {
        "content-type": "^1.0.5",
        "media-typer": "^1.1.0",
        "mime-types": "^3.0.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/typescript": {
      "version": "5.9.3",
      "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.9.3.tgz",
      "integrity": "sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==",
      "dev": true,
      "bin": {
        "tsc": "bin/tsc",
        "tsserver": "bin/tsserver"
      },
      "engines": {
        "node": ">=14.17"
      }
    },
    "node_modules/undici-types": {
      "version": "6.21.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-6.21.0.tgz",
      "integrity": "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==",
      "dev": true
    },
    "node_modules/universalify": {
      "version": "0.1.2",
      "resolved": "https://registry.npmjs.org/universalify/-/universalify-0.1.2.tgz",
      "integrity": "sha512-rBJeI5CXAlmy1pV+617WB9J63U6XcazHHF2f2dbJix4XzpUF0RS3Zbj0FGIOCAva5P/d/GBOYaACQ1w+0azUkg==",
      "dev": true,
      "engines": {
        "node": ">= 4.0.0"
      }
    },
    "node_modules/unpipe": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",
      "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/uri-js": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",
      "integrity": "sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==",
      "dev": true,
      "dependencies": {
        "punycode": "^2.1.0"
      }
    },
    "node_modules/utf8-byte-length": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/utf8-byte-length/-/utf8-byte-length-1.0.5.tgz",
      "integrity": "sha512-Xn0w3MtiQ6zoz2vFyUVruaCL53O/DwUvkEeOvj+uulMm0BkUGYWmBYVyElqZaSLhY6ZD0ulfU3aBra2aVT4xfA==",
      "dev": true
    },
    "node_modules/util-deprecate": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/util-deprecate/-/util-deprecate-1.0.2.tgz",
      "integrity": "sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==",
      "dev": true,
      "peer": true
    },
    "node_modules/vary": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",
      "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/verror": {
      "version": "1.10.1",
      "resolved": "https://registry.npmjs.org/verror/-/verror-1.10.1.tgz",
      "integrity": "sha512-veufcmxri4e3XSrT0xwfUR7kguIkaxBeosDg00yDWhk49wdwkSUrvvsm7nc75e1PUyvIeZj6nS8VQRYz2/S4Xg==",
      "dev": true,
      "optional": true,
      "dependencies": {
        "assert-plus": "^1.0.0",
        "core-util-is": "1.0.2",
        "extsprintf": "^1.2.0"
      },
      "engines": {
        "node": ">=0.6.0"
      }
    },
    "node_modules/which": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
      "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
      "dev": true,
      "dependencies": {
        "isexe": "^2.0.0"
      },
      "bin": {
        "node-which": "bin/node-which"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/wrap-ansi": {
      "version": "7.0.0",
      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
      "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
      "dev": true,
      "dependencies": {
        "ansi-styles": "^4.0.0",
        "string-width": "^4.1.0",
        "strip-ansi": "^6.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
      }
    },
    "node_modules/wrap-ansi-cjs": {
      "name": "wrap-ansi",
      "version": "7.0.0",
      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
      "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
      "dev": true,
      "dependencies": {
        "ansi-styles": "^4.0.0",
        "string-width": "^4.1.0",
        "strip-ansi": "^6.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
      }
    },
    "node_modules/wrappy": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
      "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ=="
    },
    "node_modules/xmlbuilder": {
      "version": "15.1.1",
      "resolved": "https://registry.npmjs.org/xmlbuilder/-/xmlbuilder-15.1.1.tgz",
      "integrity": "sha512-yMqGBqtXyeN1e3TGYvgNgDVZ3j84W4cwkOXQswghol6APgZWaff9lnbvN7MHYJOiXsvGPXtjTYJEiC9J2wv9Eg==",
      "dev": true,
      "engines": {
        "node": ">=8.0"
      }
    },
    "node_modules/y18n": {
      "version": "5.0.8",
      "resolved": "https://registry.npmjs.org/y18n/-/y18n-5.0.8.tgz",
      "integrity": "sha512-0pfFzegeDWJHJIAmTLRP2DwHjdF5s7jo9tuztdQxAhINCdvS+3nGINqPd00AphqJR/0LhANUS6/+7SCb98YOfA==",
      "dev": true,
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/yallist": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz",
      "integrity": "sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==",
      "dev": true
    },
    "node_modules/yargs": {
      "version": "17.7.2",
      "resolved": "https://registry.npmjs.org/yargs/-/yargs-17.7.2.tgz",
      "integrity": "sha512-7dSzzRQ++CKnNI/krKnYRV7JKKPUXMEh61soaHKg9mrWEhzFWhFnxPxGl+69cD1Ou63C13NUPCnmIcrvqCuM6w==",
      "dev": true,
      "dependencies": {
        "cliui": "^8.0.1",
        "escalade": "^3.1.1",
        "get-caller-file": "^2.0.5",
        "require-directory": "^2.1.1",
        "string-width": "^4.2.3",
        "y18n": "^5.0.5",
        "yargs-parser": "^21.1.1"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/yargs-parser": {
      "version": "21.1.1",
      "resolved": "https://registry.npmjs.org/yargs-parser/-/yargs-parser-21.1.1.tgz",
      "integrity": "sha512-tVpsJW7DdjecAiFpbIB1e3qxIQsE6NoPc5/eTdrbbIC4h0LVsWhnoa3g+m2HclBIujHzsxZ4VJVA+GUuc2/LBw==",
      "dev": true,
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/yauzl": {
      "version": "2.10.0",
      "resolved": "https://registry.npmjs.org/yauzl/-/yauzl-2.10.0.tgz",
      "integrity": "sha512-p4a9I6X6nu6IhoGmBqAcbJy1mlC4j27vEPZX9F4L4/vZT3Lyq1VkFHw/V/PUcB9Buo+DG3iHkT0x3Qya58zc3g==",
      "dev": true,
      "dependencies": {
        "buffer-crc32": "~0.2.3",
        "fd-slicer": "~1.1.0"
      }
    },
    "node_modules/zip-stream": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/zip-stream/-/zip-stream-4.1.1.tgz",
      "integrity": "sha512-9qv4rlDiopXg4E69k+vMHjNN63YFMe9sZMrdlvKnCjlCRWeCBswPPMPUfx+ipsAWq1LXHe70RcbaHdJJpS6hyQ==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "archiver-utils": "^3.0.4",
        "compress-commons": "^4.1.2",
        "readable-stream": "^3.6.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/zip-stream/node_modules/archiver-utils": {
      "version": "3.0.4",
      "resolved": "https://registry.npmjs.org/archiver-utils/-/archiver-utils-3.0.4.tgz",
      "integrity": "sha512-KVgf4XQVrTjhyWmx6cte4RxonPLR9onExufI1jhvw/MQ4BB6IsZD5gT8Lq+u/+pRkWna/6JoHpiQioaqFP5Rzw==",
      "dev": true,
      "peer": true,
      "dependencies": {
        "glob": "^7.2.3",
        "graceful-fs": "^4.2.0",
        "lazystream": "^1.0.0",
        "lodash.defaults": "^4.2.0",
        "lodash.difference": "^4.5.0",
        "lodash.flatten": "^4.4.0",
        "lodash.isplainobject": "^4.0.6",
        "lodash.union": "^4.6.0",
        "normalize-path": "^3.0.0",
        "readable-stream": "^3.6.0"
      },
      "engines": {
        "node": ">= 10"
      }
    }
  }
}
```

### package

```json
{
  "name": "jocarsa-editor-electron",
  "version": "1.0.0",
  "description": "jocarsa | editor standalone desktop application using Electron",
  "author": "Jose Vicente Carratalá",
  "license": "MIT",
  "main": "electron-main.js",
  "scripts": {
  "start": "ELECTRON_DISABLE_SANDBOX=1 electron .",
  "web": "node server.js",
  "dist": "electron-builder",
  "dist:win": "electron-builder --win nsis",
  "pack": "electron-builder --dir"
}
,
  "dependencies": {
    "express": "^5.1.0"
  },
  "devDependencies": {
    "electron": "^31.0.0",
    "electron-builder": "^24.13.3"
  },
  "build": {
  "appId": "com.jocarsa.editor",
  "productName": "jocarsa editor",
  "files": [
    "**/*"
  ],
  "asar": true,
  "directories": {
    "output": "dist"
  },
  "linux": {
    "category": "Utility",
    "target": ["AppImage"],
    "icon": "build/icon.png"
  },
  "win": {
    "target": ["nsis"],
    "icon": "build/icon.ico"
  }
}


}
```

### server

```javascript
// server.js
const express = require("express");
const path = require("path");
const fs = require("fs").promises;
const fsSync = require("fs");

const app = express();

// Raíz del sistema de archivos ("/" en Linux)
const ROOT_DIR = path.parse(process.cwd()).root; // p.ej. "/"

// Fichero de configuración para estado de la UI
const CONFIG_PATH = path.join(__dirname, "config.json");

function resolvePath(p) {
  if (!p) p = ROOT_DIR;
  let full;

  if (path.isAbsolute(p)) {
    full = p;
  } else {
    full = path.join(ROOT_DIR, p);
  }

  full = path.resolve(full);

  // mantenerse dentro de ROOT_DIR
  if (!full.startsWith(ROOT_DIR)) {
    throw new Error("Ruta no válida");
  }
  return full;
}

async function readConfig() {
  try {
    const txt = await fs.readFile(CONFIG_PATH, "utf8");
    const cfg = JSON.parse(txt);
    if (!cfg || typeof cfg !== "object") {
      return { expanded: [], currentRoot: ROOT_DIR };
    }
    if (!Array.isArray(cfg.expanded)) cfg.expanded = [];
    if (typeof cfg.currentRoot !== "string") cfg.currentRoot = ROOT_DIR;
    return cfg;
  } catch (e) {
    // primera ejecución: no existe
    return { expanded: [], currentRoot: ROOT_DIR };
  }
}

async function writeConfig(cfg) {
  const safe = {
    expanded: Array.isArray(cfg.expanded) ? cfg.expanded : [],
    currentRoot: typeof cfg.currentRoot === "string" ? cfg.currentRoot : ROOT_DIR,
  };
  await fs.writeFile(CONFIG_PATH, JSON.stringify(safe, null, 2), "utf8");
}

app.use(express.json());
app.use(express.static(path.join(__dirname, "public")));

// ------------------- API: árbol de directorios -------------------

app.get("/api/tree", async (req, res) => {
  const requested = req.query.path || ROOT_DIR;
  let base;
  try {
    base = resolvePath(requested);
  } catch (e) {
    return res.status(400).json({ ok: false, error: "Ruta no válida" });
  }

  try {
    const stat = await fs.stat(base);
    if (!stat.isDirectory()) {
      return res.status(400).json({ ok: false, error: "No es un directorio" });
    }
  } catch (e) {
    return res.status(400).json({ ok: false, error: "No es un directorio" });
  }

  try {
    const items = await fs.readdir(base);
    const entries = [];
    items.sort().forEach((name) => {
      const full = path.join(base, name);
      const type = fsSync.statSync(full).isDirectory() ? "dir" : "file";
      entries.push({
        name,
        relpath: full, // ruta absoluta
        type,
      });
    });
    res.json({ ok: true, path: base, entries });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

// ------------------- API: leer fichero -------------------

app.get("/api/file", async (req, res) => {
  const p = req.query.path;
  if (!p) {
    return res.status(400).json({ ok: false, error: "Falta la ruta" });
  }

  let full;
  try {
    full = resolvePath(p);
  } catch (e) {
    return res.status(400).json({ ok: false, error: "Ruta no válida" });
  }

  try {
    const stat = await fs.stat(full);
    if (!stat.isFile()) {
      return res.status(404).json({ ok: false, error: "Fichero no encontrado" });
    }
  } catch (e) {
    return res.status(404).json({ ok: false, error: "Fichero no encontrado" });
  }

  try {
    const content = await fs.readFile(full, "utf8");
    res.json({ ok: true, path: full, content });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

// ------------------- API: guardar fichero -------------------

app.post("/api/file", async (req, res) => {
  const p = req.body.path;
  const content = req.body.content || "";

  if (!p) {
    return res.status(400).json({ ok: false, error: "Falta la ruta" });
  }

  let full;
  try {
    full = resolvePath(p);
  } catch (e) {
    return res.status(400).json({ ok: false, error: "Ruta no válida" });
  }

  try {
    const dir = path.dirname(full);
    await fs.mkdir(dir, { recursive: true });
    await fs.writeFile(full, content, "utf8");
    res.json({ ok: true, path: full });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

// ------------------- API: crear carpeta -------------------

app.post("/api/new-folder", async (req, res) => {
  const parentPath = req.body.parentPath;
  const name = (req.body.name || "").trim();

  if (!parentPath || !name) {
    return res
      .status(400)
      .json({ ok: false, error: "Faltan la carpeta padre o el nombre" });
  }

  let parentFull;
  try {
    parentFull = resolvePath(parentPath);
  } catch (e) {
    return res.status(400).json({ ok: false, error: "Carpeta padre no válida" });
  }

  try {
    const parentStat = await fs.stat(parentFull);
    if (!parentStat.isDirectory()) {
      return res.status(400).json({ ok: false, error: "La carpeta padre no es un directorio" });
    }
  } catch (e) {
    return res.status(400).json({ ok: false, error: "La carpeta padre no es un directorio" });
  }

  const newDir = path.join(parentFull, name);

  try {
    await fs.mkdir(newDir);
    res.json({ ok: true, path: newDir });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

// ------------------- API: crear fichero vacío -------------------

app.post("/api/new-file", async (req, res) => {
  const parentPath = req.body.parentPath;
  const name = (req.body.name || "").trim();

  if (!parentPath || !name) {
    return res
      .status(400)
      .json({ ok: false, error: "Faltan la carpeta padre o el nombre" });
  }

  let parentFull;
  try {
    parentFull = resolvePath(parentPath);
  } catch (e) {
    return res.status(400).json({ ok: false, error: "Carpeta padre no válida" });
  }

  try {
    const parentStat = await fs.stat(parentFull);
    if (!parentStat.isDirectory()) {
      return res.status(400).json({ ok: false, error: "La carpeta padre no es un directorio" });
    }
  } catch (e) {
    return res.status(400).json({ ok: false, error: "La carpeta padre no es un directorio" });
  }

  const newFile = path.join(parentFull, name);

  try {
    await fs.writeFile(newFile, "", { flag: "wx" }); // falla si existe
    res.json({ ok: true, path: newFile });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

// ------------------- API: configuración (estado árbol) -------------------

app.get("/api/config", async (req, res) => {
  try {
    const cfg = await readConfig();
    res.json({ ok: true, config: cfg });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

app.post("/api/config", async (req, res) => {
  const cfg = (req.body && req.body.config) || {};
  try {
    await writeConfig(cfg);
    res.json({ ok: true });
  } catch (e) {
    res.status(500).json({ ok: false, error: e.message });
  }
});

// ------------------- Inicio -------------------

const PORT = process.env.PORT || 3000;

function startServer() {
  return new Promise((resolve, reject) => {
    const server = app.listen(PORT, () => {
      console.log(`jocarsa | editor escuchando en http://localhost:${PORT}`);
      console.log(`Raíz del sistema de ficheros: ${ROOT_DIR}`);
      resolve(server);
    });
    server.on("error", reject);
  });
}

// Si se ejecuta directamente con "node server.js"
if (require.main === module) {
  startServer().catch((err) => {
    console.error("Error al arrancar el servidor:", err);
  });
}

module.exports = { startServer, PORT };
```

<a id="instaladores"></a>
## Instaladores

En la subunidad "Distribución de aplicaciones" del módulo "Desarrollo de interfaces", se aborda el tema crucial de los instaladores. Los instaladores son esenciales para que las aplicaciones lleguen a los usuarios finales, proporcionando una forma sencilla y segura de instalar software en sistemas operativos. En esta sección, se exploran los componentes básicos de un instalador, desde la definición del paquete hasta el proceso de instalación y desinstalación.

El primer paso en la creación de un instalador es definir el paquete. Esto implica organizar todos los archivos necesarios para que la aplicación funcione correctamente, incluyendo ejecutables, bibliotecas, recursos gráficos y configuraciones iniciales. El paquete debe ser estructurado de manera que pueda ser fácilmente distribuido y instalado en diferentes sistemas operativos.

Una vez definido el paquete, se necesita crear un instalador que pueda instalar los archivos del paquete en el sistema del usuario. Los instaladores modernos suelen proporcionar una interfaz gráfica amigable para este proceso, permitiendo al usuario elegir opciones como la ubicación de instalación y las preferencias iniciales. Además, es importante implementar funciones de desinstalación y actualización, asegurando que los usuarios puedan eliminar o actualizar la aplicación sin problemas.

Durante el proceso de instalación, es crucial manejar correctamente los permisos de acceso a los archivos y directorios. Esto implica crear usuarios y grupos específicos para la aplicación y asignar los permisos necesarios para que la aplicación pueda leer, escribir y ejecutar en las áreas apropiadas del sistema.

Además de la instalación, el proceso de distribución debe incluir la documentación y soporte al usuario. Los instaladores modernos suelen proporcionar acceso a manuales de usuario y tutoriales interactivos, facilitando que los usuarios aprendan cómo utilizar la aplicación una vez instalada. Es importante también ofrecer canales de soporte para resolver problemas comunes y responder preguntas del usuario.

La seguridad es otro aspecto crucial en el desarrollo de instaladores. Los instaladores deben implementar medidas de seguridad para proteger contra malware y garantizar que solo software confiable sea instalado en los sistemas del usuario. Esto puede incluir la verificación digital de firmas, la comprobación de integridad de los archivos y la realización de escaneos antivirus antes de permitir la instalación.

En el mundo actual, donde la distribución de aplicaciones se realiza a través de múltiples canales como tiendas digitales, sitios web y sistemas operativos nativos, es fundamental que los instaladores sean flexibles y adaptables. Deben ser capaces de funcionar en diferentes entornos y proporcionar una experiencia de usuario consistente, independientemente del método de distribución.

La creación de un buen instalador no solo facilita la distribución de aplicaciones, sino que también mejora la experiencia del usuario final. Al proporcionar una interfaz amigable, opciones personalizadas y soporte al usuario, los instaladores contribuyen a hacer que las aplicaciones sean más accesibles y deseadas.

En conclusión, el desarrollo de instaladores es un proceso integral en la distribución de aplicaciones. A través de la definición del paquete, la creación de una interfaz de instalación amigable, la gestión de permisos, la inclusión de documentación y soporte al usuario, y la implementación de medidas de seguridad, se puede crear un instalador que no solo funcione correctamente, sino que también mejore la experiencia del usuario final. Este proceso es fundamental para garantizar que las aplicaciones lleguen a su público objetivo de manera eficiente y segura.

<a id="paquetes-autoinstalables"></a>
## Paquetes autoinstalables

En la subunidad "Paquetes autoinstalables" del módulo "Distribución de aplicaciones", se aborda el concepto de empaquetar una aplicación para su distribución independiente. Los paquetes autoinstalables son archivos que contienen todo lo necesario para instalar un programa en un sistema operativo, incluyendo los archivos binarios, configuraciones y scripts necesarios. Este formato facilita la distribución y el uso de aplicaciones entre diferentes sistemas, ya que solo se necesita ejecutar el paquete para comenzar el proceso de instalación.

Los paquetes autoinstalables suelen estar disponibles en formatos como `.exe` (Windows), `.dmg` (macOS) o `.deb`, `.rpm` (Linux). Cada uno de estos formatos tiene sus propias características y herramientas asociadas para crear y ejecutar paquetes. Por ejemplo, en Linux, los paquetes `.deb` son manejados por el sistema `dpkg` y su gestor de paquetes `apt`, mientras que los `.rpm` se manejan con `rpm` y `yum`.

La creación de un paquete autoinstalable implica la preparación de todos los archivos necesarios en una estructura específica, seguida del uso de herramientas específicas para empaquetar estos archivos. En el caso de Windows, se utilizan herramientas como Inno Setup o NSIS (Nullsoft Scriptable Install System). Para sistemas basados en Linux, `dpkg-deb` y `rpmbuild` son las herramientas principales.

Una vez creado el paquete, su distribución es tan sencilla como compartir el archivo con otros usuarios. Cuando un usuario ejecuta el paquete, se desempaqueta automáticamente y se instala la aplicación en su sistema operativo. Este proceso puede incluir la creación de entradas en los menús del sistema, configuraciones predeterminadas y actualizaciones automáticas.

La ventaja principal de los paquetes autoinstalables es que facilitan el acceso a aplicaciones para usuarios no técnicos, ya que eliminan la necesidad de instalar dependencias manualmente o conocer comandos avanzados. Además, proporcionan una forma consistente y segura de distribuir software entre diferentes sistemas operativos, reduciendo así los problemas relacionados con las diferencias en el entorno de ejecución.

En resumen, los paquetes autoinstalables son una herramienta esencial para la distribución de aplicaciones, ofreciendo un proceso simplificado y seguro que facilita su uso y acceso entre diferentes sistemas operativos. Su creación implica preparar adecuadamente los archivos necesarios y utilizar las herramientas apropiadas para empaquetarlos, pero el resultado es una experiencia de instalación fluida y accesible para cualquier usuario.

<a id="firma-digital-de-aplicaciones"></a>
## Firma digital de aplicaciones

La firma digital de aplicaciones es un proceso crucial para garantizar la integridad, confidencialidad y autenticidad de los programas informáticos distribuidos. Este método implica el uso de claves criptográficas para firmar los archivos ejecutables o paquetes de instalación antes de su distribución. La firma digital se realiza mediante un algoritmo de criptografía asimétrica, que utiliza una clave privada para crear la firma y una clave pública para verificarla.

El proceso comienza con la generación de una pareja de claves: una clave privada y una clave pública. La clave privada debe mantenerse en secreto y solo el emisor del archivo debería tener acceso a ella, mientras que la clave pública puede ser compartida públicamente. Cuando se firma un archivo, el emisor utiliza su clave privada para cifrar un resumen criptográfico del contenido del archivo. Este resumen cifrado es la firma digital.

La distribución de aplicaciones firmadas implica compartir tanto el archivo ejecutable como la firma digital correspondiente. Cuando un usuario descarga una aplicación firmada, puede utilizar la clave pública asociada con el emisor para verificar la firma. Si la verificación es exitosa, significa que el contenido del archivo no ha sido modificado y que se originó efectivamente desde el emisor declarado.

La firma digital también proporciona autenticidad, asegurando que solo el emisor autorizado puede firmar un archivo. Esto es crucial en entornos empresariales o de software libre donde la confianza entre partes es fundamental. Además, la firma digital facilita la implementación de políticas de seguridad más estrictas y permite a los usuarios tomar decisiones informadas sobre la ejecución de aplicaciones.

En el contexto del desarrollo de interfaces, la firma digital puede ser especialmente relevante cuando se distribuyen componentes visuales o bibliotecas que pueden ser utilizados por otros desarrolladores. Al firmar estos componentes, se asegura que su contenido no ha sido alterado y que son originales del emisor declarado.

La implementación de la firma digital en aplicaciones implica el uso de librerías criptográficas adecuadas para generar y verificar las firmas. Estas librerías proporcionan funciones específicas para crear firmas digitales, validarlas y manejar claves públicas y privadas. El proceso puede variar según la plataforma o lenguaje de programación utilizado, pero generalmente implica el uso de funciones como `sign()` para generar firmas y `verify()` para comprobar su validez.

En resumen, la firma digital es un mecanismo fundamental para proteger la integridad y autenticidad de aplicaciones informáticas distribuidas. Al firmar los archivos ejecutables o paquetes de instalación, se asegura que el contenido no ha sido alterado y que proviene del emisor declarado. Este proceso es crucial en entornos empresariales y de software libre para garantizar la confianza entre partes y facilitar la implementación de políticas de seguridad más estrictas.

<a id="herramientas-para-crear-paquetes-de-instalacion"></a>
## Herramientas para crear paquetes de instalación

En este capítulo, nos adentramos en la distribución de aplicaciones, un aspecto crucial para el acceso a los programas desarrollados por nuestros estudiantes. La distribución no es solo sobre instalar software en un sistema operativo, sino también sobre cómo hacerlo de manera eficiente y segura para diferentes usuarios y plataformas.

La creación de paquetes de instalación es una técnica que permite empaquetar todos los archivos necesarios para ejecutar una aplicación en un formato específico. Este proceso facilita la distribución y la instalación del software, asegurando que todo lo necesario esté en su lugar y que no se pierdan dependencias importantes.

Existen varias herramientas disponibles para crear paquetes de instalación, cada una con sus propias ventajas y desventajas. Algunas de las más populares incluyen Inno Setup para Windows, InstallShield para diversos sistemas operativos, y Launch4j para aplicaciones Java. Cada una de estas herramientas ofrece opciones personalizadas que permiten ajustar el proceso de instalación a las necesidades específicas del proyecto.

La elección de la herramienta adecuada depende del sistema operativo objetivo y de los requisitos específicos del software. Por ejemplo, si se está desarrollando un programa para Windows, Inno Setup puede ser una buena opción debido a su facilidad de uso y a su capacidad para crear instaladores personalizados. Para aplicaciones Java, Launch4j es una herramienta ideal porque facilita la creación de ejecutables portátiles.

Además de las herramientas específicas para la creación de paquetes, también es importante considerar aspectos como la seguridad y la compatibilidad con diferentes versiones del sistema operativo. Es crucial que los paquetes sean fáciles de instalar y no causen conflictos con otros programas instalados en el sistema.

La documentación detallada de cada paso del proceso de creación de paquetes es fundamental para garantizar una distribución exitosa. Esto incluye la especificación clara de las dependencias, los permisos necesarios y cualquier configuración adicional que pueda requerirse durante la instalación.

En resumen, la creación de paquetes de instalación es un proceso integral en el desarrollo de aplicaciones, permitiendo una distribución eficiente y segura. Al seleccionar la herramienta adecuada y seguir las mejores prácticas, podemos asegurar que nuestros programas lleguen a los usuarios de manera efectiva y sin inconvenientes.

Este capítulo ha proporcionado una visión general del proceso de creación de paquetes de instalación, destacando su importancia en el desarrollo integral de aplicaciones. A medida que avanzamos en nuestro estudio, es crucial mantener este conocimiento en mente para asegurar que nuestros proyectos sean accesibles y funcionales para todos los usuarios.

<a id="personalizacion-de-la-instalacion"></a>
## Personalización de la instalación

La personalización de la instalación es un aspecto crucial en el desarrollo de interfaces de usuario, ya que permite a los usuarios adaptar las aplicaciones a sus necesidades específicas. Este proceso implica proporcionar opciones para configurar aspectos como el idioma, el tema visual, los atajos de teclado y otros elementos interactivos. Para lograr una experiencia óptima, es fundamental considerar la diversidad de preferencias entre los usuarios.

La personalización comienza con la identificación de las opciones disponibles. Por ejemplo, se pueden ofrecer diferentes temas de interfaz (claro, oscuro, tema del sistema) y permitir a los usuarios seleccionar el que más les convenga. Además, es posible proporcionar configuraciones para el idioma de la aplicación, lo que facilita su uso en entornos multilingües.

Además de las opciones visuales, la personalización puede abordarse en términos de funcionalidades y accesibilidad. Por ejemplo, se pueden permitir cambios en los atajos de teclado para optimizar el flujo de trabajo del usuario, o ofrecer configuraciones específicas para usuarios con discapacidades visuales, como aumentar la tamaño de las fuentes o proporcionar opciones de contraste.

La implementación de la personalización requiere un enfoque modular y flexible. Esto significa que cada opción debe ser independiente y configurable sin afectar a otras partes del sistema. Por ejemplo, si se permite cambiar el tema visual, esto no debería interferir con las preferencias de idioma o los atajos de teclado.

Para facilitar la personalización, es útil proporcionar una interfaz gráfica intuitiva donde los usuarios puedan ver y seleccionar sus opciones. Esta interfaz debe ser accesible y fácil de usar, incluso para usuarios no técnicos. Además, se deben ofrecer indicadores visuales que muestren el estado actual de la configuración, lo que facilita la identificación de cambios realizados.

La personalización también implica considerar la persistencia de las preferencias del usuario. Una vez que un usuario realiza una configuración, esta debe ser guardada y aplicada automáticamente en futuras sesiones. Esto asegura que los usuarios no tengan que volver a configurar su entorno cada vez que inicien la aplicación.

Además de la personalización del usuario final, es importante considerar la personalización del instalador. Por ejemplo, se pueden ofrecer diferentes paquetes de instalación según el nivel de funcionalidad requerido. Además, se puede permitir la selección de componentes adicionales durante el proceso de instalación, lo que permite a los usuarios optimizar el espacio en disco y las características disponibles.

La personalización también debe considerar aspectos de seguridad y privacidad. Por ejemplo, se pueden ofrecer opciones para limitar el acceso a ciertas funcionalidades o configuraciones según el nivel de privilegios del usuario. Además, se debe proporcionar información clara sobre cómo se manejan las preferencias del usuario y cómo se protegen sus datos.

En conclusión, la personalización de la instalación es un aspecto fundamental en el desarrollo de interfaces de usuario. Al permitir a los usuarios adaptar las aplicaciones a sus necesidades específicas, se mejora significativamente la experiencia del usuario final. Para lograr una implementación efectiva, es importante considerar opciones visuales, funcionalidades y accesibilidad, y proporcionar una interfaz gráfica intuitiva para su selección. Además, se debe garantizar la persistencia de las preferencias del usuario y considerar aspectos de seguridad y privacidad.

<a id="asistentes-de-instalacion-y-desinstalacion"></a>
## Asistentes de instalación y desinstalación

En este capítulo, nos adentramos en la distribución de aplicaciones, un aspecto crucial para el éxito del software. La distribución no es solo sobre instalar una aplicación en un sistema operativo, sino también sobre cómo hacerlo de manera eficiente y segura.

La instalación de aplicaciones puede ser un proceso sencillo o complejo, dependiendo de su naturaleza y la plataforma objetivo. Para facilitar este proceso, existen asistentes de instalación que simplifican las tareas repetitivas y permiten una configuración personalizada. Estos asistentes son herramientas gráficas que guían al usuario a través del proceso de instalación paso a paso.

La desinstalación es otro aspecto importante de la distribución, especialmente cuando se necesita actualizar o eliminar una aplicación. Los asistentes de desinstalación también ofrecen un enfoque guiado, asegurando que todos los componentes asociados con la aplicación sean eliminados correctamente para evitar conflictos futuros.

Además de las herramientas gráficas, existen métodos más avanzados como el uso de scripts y paquetes autoinstalables. Estos métodos ofrecen mayor control y pueden ser útiles en entornos empresariales o cuando se necesita automatizar el proceso de distribución.

La firma digital de aplicaciones es otro elemento crucial en la distribución segura. Permite verificar la autenticidad del software y garantizar que no haya sido modificado durante su transmisión o almacenamiento. Los asistentes de instalación pueden integrar esta funcionalidad, asegurando que los usuarios descarguen solo software confiable.

La creación de paquetes de instalación es un proceso que involucra empaquetar todos los archivos necesarios para una aplicación en un formato específico. Esto facilita la distribución y permite a los usuarios instalar la aplicación sin necesidad de acceso al código fuente o a herramientas adicionales.

Los asistentes de instalación también pueden ofrecer opciones personalizadas, permitiendo que los usuarios elijan qué componentes de la aplicación instalar y cómo configurarlos. Esto es especialmente útil en aplicaciones complejas con muchas funcionalidades.

La creación de canales de distribución como repositorios ofrece una forma eficiente de compartir aplicaciones entre diferentes usuarios o equipos. Los asistentes de instalación pueden integrarse con estos canales, facilitando la actualización y el mantenimiento del software.

En conclusión, los asistentes de instalación y desinstalación son herramientas esenciales en el proceso de distribución de aplicaciones. Aunque su uso puede variar según las necesidades específicas del software y el entorno de destino, proporcionan una experiencia fluida y segura para los usuarios finales.

<a id="canales-de-distribucion-repositorios"></a>
## Canales de distribución repositorios

La distribución de aplicaciones es un aspecto crucial del ciclo completo de desarrollo de software, que abarca desde la creación hasta su uso final por los usuarios. En esta subunidad, nos centraremos específicamente en los canales de distribución repositorios, una forma eficiente y organizada de compartir e instalar software.

Los canales de distribución repositorios ofrecen un medio centralizado para almacenar y acceder a aplicaciones y bibliotecas de código fuente. Estos repositorios pueden ser públicos o privados, dependiendo del nivel de acceso que se desee controlar. Algunos ejemplos populares de repositorios incluyen GitHub, GitLab y Bitbucket.

La ventaja principal de utilizar canales de distribución repositorios es la facilidad con la que se pueden compartir proyectos entre desarrolladores. Los usuarios pueden clonar un repositorio en su entorno local, lo que les permite trabajar directamente con el código fuente. Además, los cambios realizados en el repositorio pueden ser compartidos y actualizados por todos los miembros del equipo.

Además de la colaboración, los canales de distribución repositorios también facilitan la gestión de versiones. Cada cambio realizado en el código se registra como una nueva versión, lo que permite a los desarrolladores revertir cambios si es necesario o comparar diferentes versiones para identificar mejoras y correcciones.

La seguridad es otro aspecto importante a considerar cuando se utilizan canales de distribución repositorios. Muchos servicios de repositorio ofrecen opciones de autenticación y control de acceso, lo que permite limitar el acceso a ciertos proyectos solo a usuarios autorizados. Además, los desarrolladores pueden configurar políticas de fusión para asegurar que solo se acepten cambios que cumplen con ciertos criterios.

La distribución de aplicaciones mediante canales de repositorio no es una práctica reciente; en realidad, ha sido un método estándar en el desarrollo de software durante años. Sin embargo, con la adopción cada vez mayor de herramientas de control de versiones como Git y plataformas de gestión de proyectos como GitHub, esta práctica se ha vuelto aún más popular.

En conclusión, los canales de distribución repositorios son una herramienta poderosa y flexible para el desarrollo de software. Ofrecen un medio eficiente para compartir, colaborar y gestionar aplicaciones, mientras que también proporcionan opciones avanzadas para la seguridad y la gestión de versiones. Al utilizar estos canales, los desarrolladores pueden mejorar significativamente su productividad y colaboración en proyectos de cualquier tamaño o complejidad.


<a id="realizacion-de-pruebas"></a>
# Realización de pruebas

<a id="objetivo-importancia-y-limitaciones-del-proceso-de-prueba"></a>
## Objetivo, importancia y limitaciones del proceso de prueba

El proceso de prueba es una etapa fundamental en el desarrollo de interfaces de usuario (UI) y aplicaciones en general. Su objetivo principal es asegurar que los productos finales cumplan con las expectativas del usuario y cumplen con los requisitos funcionales establecidos. A través de pruebas exhaustivas, se pueden identificar y corregir errores, mejorar la experiencia del usuario y garantizar la calidad final del producto.

La importancia del proceso de prueba radica en su capacidad para prevenir problemas potenciales antes de que lleguen a los usuarios finales. Al realizar pruebas tempranas y frecuentes, se pueden detectar y solucionar errores más rápidamente, lo que reduce el costo y el tiempo de desarrollo. Además, las pruebas ayudan a validar la funcionalidad y la usabilidad del producto, asegurando que cumpla con los estándares establecidos.

Sin embargo, es importante reconocer las limitaciones del proceso de prueba. Aunque se pueden realizar pruebas exhaustivas, siempre hay un grado de incertidumbre en el resultado final debido a factores impredecibles como la variabilidad humana y las condiciones de uso reales. Además, los recursos disponibles para las pruebas son limitados, lo que puede llevar a una cobertura incompleta del producto.

El proceso de prueba implica varios tipos de actividades, desde pruebas unitarias individuales hasta pruebas de integración y pruebas de sistema. Cada tipo de prueba tiene su propio enfoque y objetivos específicos. Las pruebas unitarias se centran en la funcionalidad individual de los componentes del producto, mientras que las pruebas de integración evalúan cómo estos componentes funcionan juntos. Las pruebas de sistema, por otro lado, verifican el funcionamiento completo del producto como un todo.

Además, el proceso de prueba debe ser un enfoque continuo y adaptativo. Los requisitos pueden cambiar a lo largo del tiempo, y las pruebas deben ajustarse para mantenerse al día con estos cambios. Además, es crucial documentar todos los resultados de las pruebas, incluyendo tanto los errores encontrados como las correcciones realizadas, para asegurar que el producto final cumpla con los estándares establecidos.

En conclusión, el proceso de prueba es una herramienta esencial en el desarrollo de interfaces de usuario y aplicaciones. Aunque tiene limitaciones inherentes, su importancia no puede ser subestimada. Al realizar pruebas exhaustivas y adaptativas, se pueden garantizar la calidad final del producto y mejorar la experiencia del usuario.

<a id="pruebas-de-integracion-ascendentes-y-descendentes"></a>
## Pruebas de integración ascendentes y descendentes

La realización de pruebas es un componente fundamental del desarrollo de interfaces de usuario, garantizando que las aplicaciones funcionen como se espera y proporcionen una experiencia óptima al usuario final. En esta subunidad, nos centraremos en dos tipos específicos de pruebas de integración: la prueba de integración ascendentes y la prueba de integración descendentes.

La prueba de integración ascendentes comienza desde el nivel más interno del sistema y se extiende hacia arriba hasta llegar a las interfaces de usuario. Este enfoque es útil para identificar problemas que pueden surgir debido a la interacción entre diferentes componentes del sistema. Por ejemplo, si estamos desarrollando una aplicación web que utiliza una base de datos, podríamos comenzar probando las consultas SQL y los procedimientos almacenados antes de pasar a probar cómo estas funciones se integran con el resto del sistema.

Por otro lado, la prueba de integración descendentes comienza desde la interfaz de usuario y se extiende hacia abajo hasta llegar al nivel más interno del sistema. Este enfoque es útil para identificar problemas que pueden surgir debido a la interacción entre diferentes interfaces de usuario y componentes del sistema. Por ejemplo, si estamos desarrollando una aplicación móvil que utiliza una librería multimedia, podríamos comenzar probando cómo se manejan los eventos de entrada (como toques o gestos) antes de pasar a probar cómo estas funciones se integran con el resto del sistema.

Ambas pruebas de integración son esenciales para garantizar la calidad y la funcionalidad del sistema. La prueba de integración ascendentes es útil para identificar problemas que pueden surgir debido a la interacción entre diferentes componentes del sistema, mientras que la prueba de integración descendentes es útil para identificar problemas que pueden surgir debido a la interacción entre diferentes interfaces de usuario y componentes del sistema.

La realización de pruebas de integración requiere una buena comprensión del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

La realización de pruebas de integración también requiere una buena documentación del sistema y sus componentes. Es importante tener en cuenta que las pruebas de integración no solo deben verificar que los componentes funcionan individualmente, sino también que se integran correctamente entre sí. Para realizar estas pruebas, es común utilizar herramientas de prueba automatizadas como JUnit para Java o NUnit para C#, que permiten ejecutar pruebas en un entorno controlado y repetible.

<a id="pruebas-de-sistema-configuracion-recuperacion-entre-otras"></a>
## Pruebas de sistema configuración, recuperación, entre otras

La realización de pruebas es un aspecto crucial del desarrollo de interfaces de usuario, ya que asegura que el producto final cumpla con las expectativas del usuario y funcione correctamente. En esta subunidad, nos centraremos en los tipos de pruebas de sistema configuración y recuperación, así como en otras técnicas importantes para garantizar la calidad del software.

La primera categoría de pruebas que exploraremos es la configuración del sistema. Esta fase implica verificar que todos los componentes necesarios estén correctamente instalados y configurados. Es fundamental realizar pruebas de configuración exhaustivas para asegurar que no haya errores o incompatibilidades que puedan afectar el funcionamiento general del sistema.

Continuando con la configuración, es importante probar la recuperación del sistema. Esto implica verificar cómo el software se comporta cuando ocurren situaciones como fallos de red, fallas de hardware o problemas de almacenamiento. Las pruebas de recuperación deben ser rigurosas para garantizar que el sistema pueda recuperarse sin pérdida de datos y con mínimos tiempos de inactividad.

Además de las pruebas de configuración y recuperación, es crucial realizar pruebas de rendimiento. Estas pruebas evalúan la capacidad del sistema para manejar un alto volumen de usuarios simultáneos o grandes conjuntos de datos. Es importante identificar cualquier punto de congestión o limitación que pueda afectar el desempeño y optimizarlo para mejorar la experiencia del usuario.

Otra técnica importante es la prueba de seguridad. En este contexto, se evalúa cómo el sistema responde a intentos de acceso no autorizados, ataques cibernéticos y otras amenazas potenciales. Las pruebas de seguridad son cruciales para proteger los datos del usuario y garantizar la confidencialidad y integridad del sistema.

Además de las pruebas técnicas, es importante realizar pruebas de usabilidad y accesibilidad. Estas pruebas evalúan cómo el sistema se adapta a diferentes tipos de usuarios, incluyendo personas con discapacidades visuales o auditivas. Las pruebas de usabilidad y accesibilidad son fundamentales para asegurar que todos los usuarios puedan interactuar con el sistema sin dificultades.

Es también importante realizar pruebas de integración. Estas pruebas evalúan cómo diferentes componentes del sistema funcionan juntos, asegurando que no haya conflictos o incompatibilidades entre ellos. Las pruebas de integración son cruciales para garantizar la coherencia y funcionalidad global del sistema.

Además de las pruebas técnicas y de integración, es importante realizar pruebas de carga. Estas pruebas evalúan cómo el sistema se comporta cuando se generan cargas significativas de trabajo o tráfico de red. Las pruebas de carga son cruciales para identificar cualquier punto de congestión o limitación que pueda afectar la capacidad del sistema para manejar un alto volumen de usuarios.

En conclusión, la realización de pruebas es una parte integral y crucial del desarrollo de interfaces de usuario. Al realizar pruebas exhaustivas en configuración, recuperación, rendimiento, seguridad, usabilidad, accesibilidad, integración y carga, podemos asegurar que el sistema funcione correctamente y cumpla con las expectativas del usuario. Las pruebas son esenciales para garantizar la calidad del software y proporcionar una experiencia de usuario óptima.

<a id="pruebas-de-uso-de-recursos"></a>
## Pruebas de uso de recursos

La realización de pruebas es un paso crucial en el desarrollo de interfaces de usuario, ya que permite identificar problemas potenciales antes de la fase final de la implementación. En esta subunidad, nos centraremos específicamente en las pruebas de uso de recursos, que se centran en evaluar cómo la interfaz interactúa con los recursos disponibles del sistema.

Las pruebas de uso de recursos son esenciales para garantizar que la interfaz no solo funcione correctamente, sino que también lo haga de manera eficiente. Esto incluye la verificación de la carga de memoria, el uso de procesadores y la gestión de espacio en disco. Al realizar estas pruebas, se busca asegurar que la interfaz no consuma recursos de forma excesiva, lo que podría llevar a problemas como retrasos o incluso fallos del sistema.

Para llevar a cabo las pruebas de uso de recursos, es necesario utilizar herramientas específicas que puedan monitorear y analizar el comportamiento de la interfaz en diferentes escenarios. Estas herramientas pueden variar según el entorno y la plataforma utilizadas, pero generalmente ofrecen funcionalidades para medir la carga del sistema, el uso de memoria y procesadores, así como la gestión de recursos de red.

Es importante recordar que las pruebas de uso de recursos no solo deben centrarse en la eficiencia del sistema, sino también en la experiencia del usuario. Una interfaz que consume demasiados recursos puede resultar lenta o inestable, lo que afecta negativamente la satisfacción del usuario. Por lo tanto, es crucial equilibrar el rendimiento técnico con la comodidad y eficiencia del usuario.

Además de las pruebas automatizadas, también es fundamental realizar pruebas manuales para validar los comportamientos específicos de la interfaz en situaciones reales. Esto puede implicar la simulación de diferentes escenarios de uso, como el manejo simultáneo de múltiples usuarios o la carga de grandes cantidades de datos. Las observaciones y feedbacks obtenidos durante estas pruebas manuales son cruciales para identificar problemas que podrían no ser detectados por las herramientas automatizadas.

En conclusión, las pruebas de uso de recursos son una parte integral del proceso de desarrollo de interfaces de usuario. A través de la utilización de herramientas adecuadas y la realización de pruebas tanto automáticas como manuales, es posible asegurar que la interfaz no solo funcione correctamente, sino que también lo haga de manera eficiente y sin afectar negativamente la experiencia del usuario. Es un aspecto crucial en el desarrollo de software moderno, donde la eficiencia y la comodidad del usuario son factores clave para el éxito del proyecto.

<a id="pruebas-de-seguridad"></a>
## Pruebas de seguridad

La realización de pruebas de seguridad es un aspecto crucial del desarrollo de interfaces de usuario, ya que asegura la protección tanto de los datos como de la funcionalidad de las aplicaciones. En esta subunidad didáctica, exploraremos cómo identificar vulnerabilidades y garantizar la integridad, confidencialidad y disponibilidad de los sistemas.

Comenzamos por entender el concepto de seguridad en el contexto de las interfaces de usuario. La seguridad no se limita solo a proteger contra accesos no autorizados, sino también a prevenir ataques que puedan comprometer la funcionalidad o la experiencia del usuario. Esto incluye la protección contra inyecciones SQL, XSS (Cross-Site Scripting), CSRF (Cross-Site Request Forgery) y otros tipos de ataques web.

La realización de pruebas de seguridad debe ser una parte integral del ciclo de vida del desarrollo, comenzando desde las fases tempranas hasta el lanzamiento final. Esto implica la creación de escenarios de prueba específicos para identificar vulnerabilidades potenciales y probar cómo se comportan los sistemas ante diferentes tipos de ataques.

Una práctica común es utilizar herramientas automatizadas para realizar pruebas de seguridad, como scanners de vulnerabilidad y simuladores de ataque. Estas herramientas pueden detectar patrones comunes que podrían ser utilizados por un atacante y proporcionar recomendaciones sobre cómo mejorar la seguridad del sistema. Sin embargo, es importante recordar que estas herramientas solo son una parte del proceso y no reemplazan las pruebas manuales.

Las pruebas de seguridad también implican la evaluación de la experiencia del usuario en situaciones de ataque. Esto puede incluir la realización de pruebas de penetración (pen testing) donde un equipo de expertos intenta explotar vulnerabilidades para identificar problemas reales, así como pruebas de carga y rendimiento bajo condiciones adversas.

Además, es crucial documentar todos los hallazgos durante el proceso de pruebas de seguridad. Esto incluye la creación de informes detallados que describan las vulnerabilidades encontradas, su impacto potencial y recomendaciones para su corrección. La documentación no solo sirve como evidencia del proceso de pruebas, sino también como recurso para el equipo de desarrollo para mejorar la seguridad en futuras iteraciones.

La realización de pruebas de seguridad debe ser un enfoque continuo, ya que las amenazas y vulnerabilidades cambian constantemente. Esto implica mantenerse al día con las últimas técnicas y herramientas de seguridad, así como realizar pruebas regulares para identificar y mitigar nuevas amenazas.

En conclusión, la realización de pruebas de seguridad es un componente fundamental del desarrollo de interfaces de usuario. A través de una combinación de herramientas automatizadas y pruebas manuales, junto con una documentación exhaustiva y un enfoque continuo, podemos asegurar que nuestros sistemas sean seguros y resistentes a los ataques más complejos.

<a id="pruebas-manuales-y-automaticas"></a>
## Pruebas manuales y automáticas

La realización de pruebas es un componente fundamental del desarrollo de interfaces de usuario, asegurando que las aplicaciones funcionen correctamente y cumplen con los requisitos establecidos. En esta subunidad, exploraremos tanto las pruebas manuales como las automáticas, abordando sus ventajas, desventajas y métodos de implementación.

Las pruebas manuales son un enfoque tradicional donde los desarrolladores o usuarios realizan acciones específicas dentro de la aplicación para verificar su funcionamiento. Este método permite una comprensión profunda del comportamiento de la interfaz y es especialmente útil para identificar problemas que pueden no ser detectados por las pruebas automáticas. Sin embargo, las pruebas manuales son costosas en términos de tiempo y pueden llevar a errores humanos debido a la naturaleza subjetiva del proceso.

Por otro lado, las pruebas automáticas utilizan herramientas especializadas para automatizar el proceso de prueba, lo que permite una ejecución rápida y repetitiva sin intervención humana. Este enfoque es especialmente beneficioso para pruebas recurrentes y para verificar cambios en la aplicación con frecuencia. Las pruebas automáticas pueden ser más precisas que las manuales debido a su capacidad para realizar múltiples iteraciones rápidamente.

La integración de ambos métodos puede ofrecer una visión completa del estado de la aplicación. Las pruebas manuales pueden proporcionar un enfoque detallado y subjetivo, mientras que las automáticas pueden ofrecer una cobertura exhaustiva y repetitiva. Una estrategia efectiva es combinar ambas técnicas, realizando pruebas manuales para validar funcionalidades complejas y pruebas automáticas para cubrir un amplio rango de escenarios.

Para implementar pruebas automáticas en interfaces de usuario, se pueden utilizar herramientas como Selenium WebDriver, que permite controlar navegadores web a través de scripts. Estos scripts pueden interactuar con los elementos de la interfaz, realizar acciones y verificar resultados, lo que facilita el automatizado de pruebas complejas.

Además de las pruebas funcionales, es importante considerar pruebas no funcionionales como la usabilidad y la accesibilidad. Las herramientas automáticas pueden ser utilizadas para medir tiempos de respuesta, verificar la consistencia del diseño y realizar pruebas de accesibilidad, lo que asegura que la interfaz sea usable para todos los usuarios.

La documentación de las pruebas es otro aspecto crucial. Deben registrarse los pasos realizados, los resultados obtenidos y cualquier incidencia detectada. Esta documentación no solo sirve como evidencia del proceso de prueba, sino que también facilita el seguimiento de problemas y la mejora continua del sistema.

En conclusión, la realización de pruebas manuales y automáticas es una práctica esencial en el desarrollo de interfaces de usuario. Cada método tiene sus ventajas y desventajas, y su combinación puede ofrecer una visión completa y detallada del estado de la aplicación. Al implementar estas pruebas, se asegura que las aplicaciones sean funcionales, seguras y accesibles para todos los usuarios.


<a id="actividad-libre-de-final-de-evaluacion-la-milla-extra"></a>
# Actividad libre de final de evaluación - La milla extra

<a id="la-milla-extra-primera-evaluacion"></a>
## La Milla Extra - Primera evaluación

### ejercicio

```markdown

```
