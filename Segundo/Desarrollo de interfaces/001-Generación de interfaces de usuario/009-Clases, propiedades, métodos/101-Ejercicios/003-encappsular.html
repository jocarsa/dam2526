<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>jocarsa|ux – Table Renderer (v0)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;   /* slate-900 */
      --muted:#475569;  /* slate-600 */
      --line:#e2e8f0;   /* slate-200 */
      --head:#0ea5e9;   /* sky-500 */
      --chip:#f8fafc;   /* slate-50 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:1000px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 6px;font-size:clamp(18px,3.5vw,26px)}
    p{margin:0 0 14px;color:var(--muted)}

    .card{border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#fff}
    .pad{padding:14px}

    .toolbar{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .search{display:flex; gap:8px; align-items:center}
    .search input{border:1px solid var(--line); border-radius:10px; padding:8px 10px; min-width:220px}
    .badge{display:inline-block; background:var(--chip); padding:2px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted)}

    .table-scroll{max-height:70vh; overflow:auto; border-top:1px solid var(--line)}
    table{width:100%; border-collapse:separate; border-spacing:0; font-size:14px}
    thead th{position:sticky; top:0; background:linear-gradient(0deg,#f8fafc,#ffffff); border-bottom:1px solid var(--line); text-align:left; font-weight:700; padding:10px 12px; white-space:nowrap}
    th.sortable{cursor:pointer; user-select:none}
    th .dir{margin-left:6px; font-size:11px; color:var(--muted)}
    tbody td{border-bottom:1px solid var(--line); padding:10px 12px; vertical-align:top}
    tbody tr:nth-child(odd){background:#fafafa}
    .count{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>jocarsa|ux</h1>
    <p>Lightweight UI kit (v0). For now it ships a table renderer with search and sortable columns. API: <code>new JocarsaUX().tableRenderer(opts)</code>.</p>

    <div class="card">
      <div class="pad">
        <div class="toolbar">
          <span class="badge">Table demo</span>
          <div class="search">
            <label for="searchInput">Search</label>
            <input id="searchInput" placeholder="type to filter…" />
            <span id="count" class="count"></span>
          </div>
        </div>
      </div>
      <div class="table-scroll">
        <table id="table"></table>
      </div>
    </div>
  </div>

  <script>
  // ----------------------------------------------------------------------------
  // jocarsa|ux v0 — core class (table renderer only for now)
  // Public API (stable):
  //   const ux = new JocarsaUX();
  //   ux.tableRenderer({ target, data, flatten=true, onRender });
  //   ux.setFilter(query); ux.sortBy(columnKey, dir=1);
  // ----------------------------------------------------------------------------
  class JocarsaUX{
    constructor(){
      this.state = { columns: [], rows: [], view: [], sort: {key:null, dir:1}, query:'' };
      this._els = { table:null, search:null, count:null };
    }

    // ---- utils ---------------------------------------------------------------
    static _isPlain(v){ return Object.prototype.toString.call(v) === '[object Object]'; }
    static _flatten(value, prefix=''){
      const out = {}; const stack = [{v:value,p:prefix}];
      while (stack.length){
        const {v,p} = stack.pop();
        if (Array.isArray(v)){
          const primitives = v.every(x => !JocarsaUX._isPlain(x) && !Array.isArray(x));
          if (primitives){ out[p||'value'] = v.join(', '); }
          else v.forEach((x,i)=>{
            const np = p ? `${p}[${i}]` : `[${i}]`;
            if (JocarsaUX._isPlain(x) || Array.isArray(x)) stack.push({v:x,p:np});
            else out[np] = String(x);
          });
        } else if (JocarsaUX._isPlain(v)){
          const ks = Object.keys(v);
          if (!ks.length){ out[p||'value'] = '{}'; continue; }
          ks.forEach(k=>{
            const nv = v[k]; const np = p ? `${p}.${k}` : k;
            if (JocarsaUX._isPlain(nv) || Array.isArray(nv)) stack.push({v:nv,p:np});
            else out[np] = nv==null ? '' : String(nv);
          });
        } else {
          out[p||'value'] = v==null ? '' : String(v);
        }
      }
      return out;
    }
    static _normalizeTop(json){
      if (Array.isArray(json)) return json;
      if (JocarsaUX._isPlain(json)){
        const key = Object.keys(json).find(k=>Array.isArray(json[k]));
        return key ? json[key] : [json];
      }
      return [json];
    }
    static _collectColumns(rows){
      const set = new Set(); rows.forEach(r=>Object.keys(r).forEach(k=>set.add(k))); return Array.from(set);
    }

    // ---- core table renderer -------------------------------------------------
    tableRenderer({ target, data, flatten=true, onRender, searchInput, countEl }={}){
      const table = typeof target === 'string' ? document.querySelector(target) : target;
      if (!table) throw new Error('Target table not found');
      this._els.table = table;
      this._els.search = typeof searchInput === 'string' ? document.querySelector(searchInput) : searchInput;
      this._els.count  = typeof countEl === 'string' ? document.querySelector(countEl) : countEl;

      const arr = JocarsaUX._normalizeTop(data);
      const flat = flatten ? arr.map(JocarsaUX._flatten) : arr;
      const cols = JocarsaUX._collectColumns(flat);
      this.state.columns = cols; this.state.rows = flat; this.state.view = flat.slice();
      this.state.sort = {key:null, dir:1}; this.state.query = '';

      // wire search
      if (this._els.search){
        this._els.search.value = '';
        this._els.search.oninput = ()=>{ this.setFilter(this._els.search.value); };
      }

      this._renderTable();
      if (typeof onRender === 'function') onRender({ columns: cols, rows: flat });
      return this; // chainable
    }

    setFilter(query=''){
      this.state.query = String(query).toLowerCase();
      const { rows, columns } = this.state;
      if (!this.state.query){ this.state.view = rows.slice(); }
      else {
        this.state.view = rows.filter(r=>{
          for (const k of columns){ const v = r[k]; if (v && String(v).toLowerCase().includes(this.state.query)) return true; }
          return false;
        });
      }
      this._renderTableBody();
      return this;
    }

    sortBy(key, dir){
      if (!key) return this;
      const s = this.state;
      if (dir == null){
        if (s.sort.key === key) s.sort.dir *= -1; else { s.sort.key = key; s.sort.dir = 1; }
      } else { s.sort.key = key; s.sort.dir = dir >= 0 ? 1 : -1; }
      const { view } = s; const d = s.sort.dir;
      view.sort((a,b)=>{
        const va=a[key] ?? '', vb=b[key] ?? '';
        const na=Number(va), nb=Number(vb);
        const bothNum = !isNaN(na) && !isNaN(nb);
        if (bothNum) return (na-nb)*d;
        return String(va).localeCompare(String(vb), undefined, {numeric:true,sensitivity:'base'}) * d;
      });
      this._renderTable();
      return this;
    }

    // ---- internals -----------------------------------------------------------
    _renderTable(){
      const table = this._els.table; const { columns } = this.state;
      // header
      const thead = document.createElement('thead');
      const hr = document.createElement('tr');
      columns.forEach(c=>{
        const th = document.createElement('th');
        th.textContent = c; th.className = 'sortable'; th.title = 'Sort by '+c;
        const dir = document.createElement('span'); dir.className='dir';
        if (this.state.sort.key === c) dir.textContent = this.state.sort.dir===1 ? '▲' : '▼';
        th.appendChild(dir);
        th.addEventListener('click', ()=>this.sortBy(c));
        hr.appendChild(th);
      });
      thead.appendChild(hr);

      // body
      const tbody = this._renderTableBody(true);

      table.innerHTML = '';
      table.appendChild(thead);
      table.appendChild(tbody);
    }

    _renderTableBody(makeNew=false){
      const table = this._els.table; const { columns, view } = this.state;
      let tbody = makeNew ? document.createElement('tbody') : table.querySelector('tbody');
      if (!tbody){ tbody = document.createElement('tbody'); table.appendChild(tbody); }
      const frag = document.createDocumentFragment();
      view.forEach(r=>{
        const tr = document.createElement('tr');
        columns.forEach(c=>{ const td=document.createElement('td'); td.textContent = r[c] ?? ''; tr.appendChild(td); });
        frag.appendChild(tr);
      });
      tbody.innerHTML = ''; tbody.appendChild(frag);

      if (this._els.count) this._els.count.textContent = `${view.length} row(s)`;
      return tbody;
    }
  }

  // Expose under a friendly brand alias as well
  window.JocarsaUX = JocarsaUX;         // class
  window['jocarsa|ux'] = { UX: JocarsaUX }; // brand handle (object key with pipe)

  // --- Hardcoded sample & demo wiring ----------------------------------------
  const sample = [
    { id:1, name:'Ada Lovelace', email:'ada@example.com', tags:['math','programming'], profile:{ role:'Analyst', city:'London' }, score:9.5 },
    { id:2, name:'Linus Torvalds', email:'linus@example.com', tags:['linux','git'], profile:{ role:'Engineer', city:'Helsinki' }, score:10 },
    { id:3, name:'Grace Hopper', email:'grace@example.com', tags:['compiler'], profile:{ role:'Rear Admiral', city:'New York' }, score:9.8 }
  ];

  window.addEventListener('DOMContentLoaded', ()=>{
    const ux = new JocarsaUX();
    ux.tableRenderer({
      target:'#table',
      data: sample,
      searchInput:'#searchInput',
      countEl:'#count',
    });
  });
  </script>
</body>
</html>

